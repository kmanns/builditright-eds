{"version":3,"file":"CompanyStructure.js","sources":["../../node_modules/@adobe-commerce/elsie/src/icons/EmptyBox.svg","/@dropins/storefront-company-management/src/hooks/useCompanyTeamForm.ts","/@dropins/storefront-company-management/src/components/CompanyTeamForm/CompanyTeamForm.tsx","/@dropins/storefront-company-management/src/hooks/useCompanyStructureCard.ts","/@dropins/storefront-company-management/src/components/CompanyStructureCard/CompanyStructureCard.tsx","/@dropins/storefront-company-management/src/hooks/usePermissions.ts","/@dropins/storefront-company-management/src/components/CompanyStructureEmpty/CompanyStructureEmpty.tsx","/@dropins/storefront-company-management/src/containers/CompanyStructure/CompanyStructure.tsx"],"sourcesContent":["import * as React from \"react\";\nconst SvgEmptyBox = (props) => /* @__PURE__ */ React.createElement(\"svg\", { width: 24, height: 24, viewBox: \"0 0 24 24\", fill: \"none\", xmlns: \"http://www.w3.org/2000/svg\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M12.002 21L11.8275 21.4686C11.981 21.5257 12.1528 21.5041 12.2873 21.4106C12.4218 21.3172 12.502 21.1638 12.502 21H12.002ZM3.89502 17.9823H3.39502C3.39502 18.1912 3.52485 18.378 3.72059 18.4509L3.89502 17.9823ZM3.89502 8.06421L4.07193 7.59655C3.91831 7.53844 3.74595 7.55948 3.61082 7.65284C3.47568 7.74619 3.39502 7.89997 3.39502 8.06421H3.89502ZM12.0007 21H11.5007C11.5007 21.1638 11.5809 21.3172 11.7154 21.4106C11.8499 21.5041 12.0216 21.5257 12.1751 21.4686L12.0007 21ZM20.1076 17.9823L20.282 18.4509C20.4778 18.378 20.6076 18.1912 20.6076 17.9823H20.1076ZM20.1076 8.06421H20.6076C20.6076 7.89997 20.527 7.74619 20.3918 7.65284C20.2567 7.55948 20.0843 7.53844 19.9307 7.59655L20.1076 8.06421ZM12.0007 11.1311L11.8238 10.6634C11.6293 10.737 11.5007 10.9232 11.5007 11.1311H12.0007ZM20.2858 8.53191C20.5441 8.43421 20.6743 8.14562 20.5766 7.88734C20.4789 7.62906 20.1903 7.49889 19.932 7.5966L20.2858 8.53191ZM12.002 4.94826L12.1775 4.48008C12.0605 4.43623 11.9314 4.43775 11.8154 4.48436L12.002 4.94826ZM5.87955 6.87106C5.62334 6.97407 5.49915 7.26528 5.60217 7.52149C5.70518 7.77769 5.99639 7.90188 6.2526 7.79887L5.87955 6.87106ZM18.1932 7.80315C18.4518 7.90008 18.74 7.76904 18.8369 7.51047C18.9338 7.2519 18.8028 6.96371 18.5442 6.86678L18.1932 7.80315ZM12 4.94827L11.5879 5.23148C11.6812 5.36719 11.8353 5.44827 12 5.44827C12.1647 5.44827 12.3188 5.36719 12.4121 5.23148L12 4.94827ZM14.0263 2L14.2028 1.53218C13.9875 1.45097 13.7446 1.52717 13.6143 1.71679L14.0263 2ZM21.8421 4.94827L22.2673 5.2113C22.3459 5.08422 22.3636 4.92863 22.3154 4.78717C22.2673 4.64571 22.1584 4.53319 22.0186 4.48045L21.8421 4.94827ZM9.97368 2L10.3857 1.71679C10.2554 1.52717 10.0125 1.45097 9.79721 1.53218L9.97368 2ZM2.15789 4.94827L1.98142 4.48045C1.84161 4.53319 1.73271 4.64571 1.68456 4.78717C1.63641 4.92863 1.65406 5.08422 1.73267 5.2113L2.15789 4.94827ZM12 11.1256L11.6702 11.5014C11.8589 11.667 12.1411 11.667 12.3298 11.5014L12 11.1256ZM15.0395 8.45812L14.8732 7.98659C14.8131 8.00779 14.7576 8.04028 14.7097 8.08232L15.0395 8.45812ZM23 5.65024L23.3288 6.0269C23.5095 5.86916 23.5527 5.60532 23.4318 5.39817C23.3109 5.19102 23.0599 5.09893 22.8337 5.17871L23 5.65024ZM8.96053 8.45812L9.29034 8.08232C9.24244 8.04028 9.18695 8.00779 9.12685 7.98659L8.96053 8.45812ZM1 5.65024L1.16632 5.17871C0.940115 5.09893 0.689119 5.19102 0.568192 5.39817C0.447264 5.60532 0.49048 5.86916 0.671176 6.0269L1 5.65024ZM12.1764 20.5314L4.06945 17.5137L3.72059 18.4509L11.8275 21.4686L12.1764 20.5314ZM4.39502 17.9823V8.06421H3.39502V17.9823H4.39502ZM3.71811 8.53187L11.8251 11.5987L12.1789 10.6634L4.07193 7.59655L3.71811 8.53187ZM11.502 11.1311V21H12.502V11.1311H11.502ZM12.1751 21.4686L20.282 18.4509L19.9332 17.5137L11.8262 20.5314L12.1751 21.4686ZM20.6076 17.9823V8.06421H19.6076V17.9823H20.6076ZM19.9307 7.59655L11.8238 10.6634L12.1776 11.5987L20.2845 8.53187L19.9307 7.59655ZM11.5007 11.1311V21H12.5007V11.1311H11.5007ZM19.932 7.5966L11.8251 10.6634L12.1789 11.5987L20.2858 8.53191L19.932 7.5966ZM11.8154 4.48436L5.87955 6.87106L6.2526 7.79887L12.1885 5.41217L11.8154 4.48436ZM11.8265 5.41645L18.1932 7.80315L18.5442 6.86678L12.1775 4.48008L11.8265 5.41645ZM11.502 4.94826V11.1311H12.502V4.94826H11.502ZM12.4121 5.23148L14.4384 2.28321L13.6143 1.71679L11.5879 4.66507L12.4121 5.23148ZM13.8498 2.46782L21.6656 5.4161L22.0186 4.48045L14.2028 1.53218L13.8498 2.46782ZM21.4169 4.68525L20.5485 6.08919L21.3989 6.61524L22.2673 5.2113L21.4169 4.68525ZM12.4121 4.66507L10.3857 1.71679L9.56162 2.28321L11.5879 5.23148L12.4121 4.66507ZM9.79721 1.53218L1.98142 4.48045L2.33437 5.4161L10.1502 2.46782L9.79721 1.53218ZM1.73267 5.2113L2.60109 6.61524L3.45154 6.08919L2.58312 4.68525L1.73267 5.2113ZM12.3298 11.5014L15.3693 8.83392L14.7097 8.08232L11.6702 10.7498L12.3298 11.5014ZM15.2058 8.92965L23.1663 6.12177L22.8337 5.17871L14.8732 7.98659L15.2058 8.92965ZM22.6712 5.27358L19.7764 7.80067L20.4341 8.554L23.3288 6.0269L22.6712 5.27358ZM12.3298 10.7498L9.29034 8.08232L8.63072 8.83392L11.6702 11.5014L12.3298 10.7498ZM9.12685 7.98659L1.16632 5.17871L0.83368 6.12177L8.79421 8.92965L9.12685 7.98659ZM0.671176 6.0269L3.56591 8.554L4.22356 7.80067L1.32882 5.27358L0.671176 6.0269Z\", fill: \"currentColor\" }));\nexport default SvgEmptyBox;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport { useEffect, useState } from 'preact/hooks';\nimport { createCompanyTeam, getCompanyTeam, updateCompanyTeam } from '../api';\nimport { CompanyTeamModel } from '../data/models';\nimport { useText } from '@adobe-commerce/elsie/i18n';\n\n// Field length constants (based on Magento backend validation)\n// Note: Backend uses LessThan validator, so max is 39, not 40 (USF-3506)\nexport const TEAM_FIELD_MAX_LENGTHS = {\n  name: 39,\n  description: 1000,\n} as const;\n\nexport function useCompanyTeamForm(opts: {\n  mode: 'add' | 'edit';\n  entityId?: string;\n  parentStructureId?: string | null;\n  onSaved: (result: { label: string; structureId?: string; entityId?: string; type: 'team'; description?: string }) => void;\n  onError?: (error: string) => void;\n  onSuccess?: (message: string) => void;\n}) {\n  const { mode, entityId, parentStructureId, onSaved, onError, onSuccess } = opts;\n  \n  const translations = useText({\n    teamTitleRequired: 'Company.CompanyStructure.shared.validation.teamTitleRequired',\n    teamNameMaxLength: 'Company.CompanyStructure.shared.validation.teamNameMaxLength',\n    teamDescriptionMaxLength: 'Company.CompanyStructure.shared.validation.teamDescriptionMaxLength',\n    createTeamError: 'Company.CompanyStructure.messages.createTeamError',\n    saveTeamError: 'Company.CompanyStructure.messages.saveTeamError',\n    createTeamSuccess: 'Company.CompanyStructure.messages.createTeamSuccess',\n    updateTeamSuccess: 'Company.CompanyStructure.messages.updateTeamSuccess',\n  });\n  const [values, setValues] = useState<CompanyTeamModel>({ id: '', name: '', description: '' });\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [touched, setTouched] = useState<Record<string, boolean>>({});\n  const [loading, setLoading] = useState<boolean>(false);\n  const [generalError, setGeneralError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (mode !== 'edit' || !entityId) return;\n    setLoading(true);\n    void getCompanyTeam(entityId)\n      .then((t) => {\n        if (!t) return;\n        setValues({ id: t.id, name: t.name || '', description: t.description || '' });\n      })\n      .finally(() => setLoading(false));\n  }, [mode, entityId]);\n\n  const validateField = (field: keyof CompanyTeamModel, value: string): string | null => {\n    if (field === 'name') {\n      if (!value.trim()) return translations.teamTitleRequired;\n      if (value.length > TEAM_FIELD_MAX_LENGTHS.name) return translations.teamNameMaxLength;\n      return null;\n    }\n    if (field === 'description') {\n      if (value && value.length > TEAM_FIELD_MAX_LENGTHS.description) return translations.teamDescriptionMaxLength;\n      return null;\n    }\n    return null;\n  };\n\n  const setValue = (field: keyof CompanyTeamModel, value: string) => {\n    setValues((v) => ({ ...v, [field]: value }));\n    if (generalError) setGeneralError(null);\n  };\n\n  const onBlur = (field: keyof CompanyTeamModel, value?: string) => {\n    // Update form data if value is provided (this also handles generalError clearing)\n    if (value !== undefined) {\n      setValue(field, value);\n    }\n    \n    setTouched((t) => ({ ...t, [field]: true }));\n    \n    // Use provided value or current state value for validation\n    const valueToValidate = value !== undefined ? value : (values[field] || '');\n    const err = validateField(field, valueToValidate);\n    if (err) {\n      setErrors((p) => ({ ...p, [field]: err }));\n    } else {\n      // Clear error if field is now valid\n      setErrors((p) => {\n        const newErrors = { ...p };\n        delete newErrors[field];\n        return newErrors;\n      });\n    }\n  };\n\n  const submit = async () => {\n    // Validate all fields including description for length (USF-3474)\n    const nameErr = validateField('name', values.name);\n    const descErr = validateField('description', values.description || '');\n    const errors: Record<string, string> = {};\n    const touchedFields: Record<string, boolean> = { name: true, description: true };\n    \n    if (nameErr) errors.name = nameErr;\n    if (descErr) errors.description = descErr;\n    \n    setTouched(touchedFields);\n    \n    if (Object.keys(errors).length > 0) {\n      setErrors(errors);\n      return;\n    }\n    const label = values.name;\n    try {\n      if (mode === 'add') {\n        const res = await createCompanyTeam({ name: values.name, description: values.description || null, targetId: parentStructureId ?? null });\n        if (!res) {\n          const errorMessage = translations.createTeamError;\n          if (onError) {\n            onError(errorMessage);\n          } else {\n            setGeneralError(errorMessage);\n          }\n          return;\n        }\n        onSaved({ label, structureId: res.structureId, entityId: res.id, type: 'team', description: values.description || undefined });\n        if (onSuccess) {\n          onSuccess(translations.createTeamSuccess);\n        }\n      } else if (entityId) {\n        await updateCompanyTeam({ id: entityId, name: values.name, description: values.description || null });\n        onSaved({ label, entityId, type: 'team', description: values.description || undefined });\n        if (onSuccess) {\n          onSuccess(translations.updateTeamSuccess);\n        }\n      }\n    } catch (error: unknown) {\n      // Handle GraphQL errors\n      const errorMessage = error instanceof Error ? error.message : translations.saveTeamError;\n      if (onError) {\n        onError(errorMessage);\n      } else {\n        setGeneralError(errorMessage);\n      }\n    }\n  };\n\n  return { values, errors, touched, loading, setValue, onBlur, submit, generalError };\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport { FunctionComponent } from 'preact';\nimport { memo } from 'preact/compat';\nimport { useState } from 'preact/hooks';\nimport { Field, Input, Button, Card, ProgressSpinner, InLineAlert } from '@adobe-commerce/elsie/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { CompanyTeamFormLoader } from '../CompanyLoaders';\nimport { useCompanyTeamForm, TEAM_FIELD_MAX_LENGTHS } from '../../hooks/useCompanyTeamForm';\nimport { CompanyTeamFormProps } from '../../types/companyForm.types';\nimport './CompanyTeamForm.css';\n\n/**\n * CompanyTeamForm component for creating and editing company teams\n * Provides form fields for team information including name and description\n * \n * @param mode - Whether this is an 'add' or 'edit' operation\n * @param entityId - ID of the team being edited (for edit mode)\n * @param parentStructureId - ID of the parent structure node\n * @param permissions - User permissions for editing teams\n * @param onSaved - Callback when team is successfully saved\n * @param onCancel - Callback when form is cancelled\n */\nexport const CompanyTeamForm: FunctionComponent<CompanyTeamFormProps> = memo(({ mode, entityId, parentStructureId, permissions, onSaved, onCancel, onError, onSuccess }) => {\n  const canEditUsers = permissions?.canEditUsers ?? false;\n  const { values, errors, touched, loading, onBlur, submit, generalError } = useCompanyTeamForm({ \n    mode, \n    entityId, \n    parentStructureId, \n    onSaved,\n    onError: onError ? (error: string) => {\n      onError(error);\n      onCancel();\n    } : undefined,\n    onSuccess\n  });\n  const [saving, setSaving] = useState(false);\n  \n  const translations = useText({\n    addTeam: 'Company.CompanyStructure.shared.titles.addTeam',\n    editTeam: 'Company.CompanyStructure.shared.titles.editTeam',\n    teamTitle: 'Company.CompanyStructure.shared.fields.teamTitle',\n    description: 'Company.CompanyStructure.shared.fields.description',\n  });\n\n  return (\n    <div>\n      <h3 className=\"acm-structure-panel__title\">{mode === 'add' ? translations.addTeam : translations.editTeam}</h3>\n      <Card variant=\"secondary\" className={`company-team-form__card ${saving ? 'is-working' : ''}`}>\n        {!onError && generalError ? (\n          <InLineAlert \n            className=\"company-team-form__notification\" \n            type=\"error\" \n            variant=\"secondary\" \n            heading={generalError} \n          />\n        ) : null}\n        {saving ? <div className=\"company-team-form__overlay\" aria-live=\"polite\"><ProgressSpinner size=\"small\" /></div> : null}\n        {loading ? (\n          <CompanyTeamFormLoader />\n        ) : (\n          <div className=\"company-team-form__content\">\n            <Field label={translations.teamTitle} required className=\"acm-structure-panel__field\" error={touched.name && errors.name ? errors.name : undefined}>\n              <Input\n                name=\"team_title\"\n                type=\"text\"\n                value={values.name}\n                onBlur={(e: Event) => { const target = e.target as HTMLInputElement; onBlur('name', target.value); }}\n                variant=\"primary\"\n                size=\"medium\"\n                disabled={!canEditUsers}\n                maxLength={TEAM_FIELD_MAX_LENGTHS.name}\n              />\n            </Field>\n            <Field label={translations.description} className=\"acm-structure-panel__field\" error={touched.description && errors.description ? errors.description : undefined}>\n              <Input name=\"team_description\" type=\"textarea\" value={values.description || ''} onBlur={(e: Event) => { const target = e.target as HTMLInputElement; onBlur('description', target.value); }} variant=\"primary\" size=\"medium\" disabled={!canEditUsers} maxLength={TEAM_FIELD_MAX_LENGTHS.description} />\n            </Field>\n          </div>\n        )}\n      </Card>\n      {!loading ? (\n        <div className=\"acm-structure-modal__actions\">\n          <Button type=\"button\" variant=\"primary\" onClick={async () => { if (saving) return; setSaving(true); try { await submit(); } finally { setSaving(false); } }} disabled={saving || !canEditUsers}>Save</Button>\n          <Button\n            // @ts-ignore\n            type=\"button\"\n            variant=\"secondary\"\n            disabled={saving}\n            onClick={onCancel}\n          >\n            Cancel\n          </Button>\n        </div>\n      ) : null}\n    </div>\n  );\n});\n\nexport default CompanyTeamForm;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport { useEffect, useState, useCallback, useRef } from 'preact/hooks';\nimport { events } from '@adobe-commerce/event-bus';\nimport { getCompanyStructure, updateCompanyStructure, deleteCompanyTeam, updateCompanyUserStatus } from '../api';\nimport type { CompanyStructureNode } from '../data/models';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { EventsList, publishEvents } from '../lib/acdl';\n\nexport type StructureNode = CompanyStructureNode;\n\nimport { UseCompanyStructureProps } from '../types/hook.types';\n\nexport function useCompanyStructureCard({ \n  handleSetInLineAlert,\n  permissions\n}: UseCompanyStructureProps = { permissions: null }) {\n  const canViewUsers = permissions?.canViewUsers ?? false;\n  const translations = useText({\n    loadError: 'Company.CompanyStructure.messages.loadError',\n    updateError: 'Company.CompanyStructure.messages.updateError',\n    failedToMoveItem: 'Company.CompanyStructure.messages.failedToMoveItem',\n    removeUserSuccess: 'Company.CompanyStructure.messages.removeUserSuccess',\n    deleteTeamSuccess: 'Company.CompanyStructure.messages.deleteTeamSuccess',\n    removeMultipleSuccess: 'Company.CompanyStructure.messages.removeMultipleSuccess',\n    moveUserSuccess: 'Company.CompanyStructure.messages.moveUserSuccess',\n    moveTeamSuccess: 'Company.CompanyStructure.messages.moveTeamSuccess',\n  });\n  const { loadError, updateError } = translations;\n\n  const [nodes, setNodes] = useState<StructureNode[] | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [submitLoading, setSubmitLoading] = useState(false);\n  const [showEditForm, setShowEditForm] = useState(false);\n  const [expanded, setExpanded] = useState<Set<string>>(new Set());\n  const [selected, setSelected] = useState<string | null>(null);\n  const [selectedMany, setSelectedMany] = useState<Set<string>>(new Set());\n  const [inputChange, setInputChange] = useState<Record<string, string | number | boolean>>({});\n\n  // Keep stable references to avoid re-creating callbacks/effects and double fetch\n  const alertFnRef = useRef<UseCompanyStructureProps['handleSetInLineAlert']>(handleSetInLineAlert);\n  const inFlightRef = useRef<boolean>(false);\n  const didInitialFetchRef = useRef<boolean>(false);\n  \n  useEffect(() => {\n    alertFnRef.current = handleSetInLineAlert;\n  }, [handleSetInLineAlert]);\n\n  const renderAlertMessage = useCallback(\n    (type: 'success' | 'error', message: string) => {\n      if (!handleSetInLineAlert) return;\n\n      if (type === 'success') {\n        handleSetInLineAlert({\n          type: 'success',\n          text: message,\n        });\n      } else if (type === 'error') {\n        handleSetInLineAlert({\n          type: 'error',\n          text: message,\n        });\n      } else {\n        handleSetInLineAlert();\n      }\n\n      setSubmitLoading(false);\n    },\n    [handleSetInLineAlert]\n  );\n\n  const load = useCallback(async (): Promise<StructureNode[] | null> => {\n    if (inFlightRef.current) {\n      return null;\n    }\n    inFlightRef.current = true;\n    \n    const canView = canViewUsers;\n    if (!canView) {\n      setLoading(false);\n      setNodes(null);\n      setExpanded(new Set());\n      setSelected(null);\n      setSelectedMany(new Set());\n      inFlightRef.current = false;\n      return null;\n    }\n    \n    setLoading(true);\n    \n    try {\n      const nodes = await getCompanyStructure();\n\n      setNodes(nodes);\n      // Default expand all to expose any hidden children while developing\n      setExpanded(new Set(nodes.map((n) => n.id)));\n      setLoading(false);\n      return nodes;\n    } catch (error) {\n      setLoading(false);\n      if (alertFnRef.current) {\n        alertFnRef.current({ type: 'error', text: loadError });\n      }\n      return null;\n    } finally {\n      inFlightRef.current = false;\n    }\n  }, [canViewUsers, loadError]);\n\n  useEffect(() => {\n    if (canViewUsers && !didInitialFetchRef.current) {\n      didInitialFetchRef.current = true;\n      load();\n    }\n  }, [canViewUsers, load]);\n\n  // Re-fetch structure when company context changes/restores (e.g., user switches company)\n  useEffect(() => {\n    const onCompanyContextChanged = () => {\n      setLoading(true);\n      setExpanded(new Set());\n      setSelected(null);\n      setSelectedMany(new Set());\n      // Re-fetch with updated GraphQL headers\n      load();\n    };\n\n    const subChanged = events.on('companyContext/changed', onCompanyContextChanged, { eager: true });\n\n    return () => {\n      subChanged?.off();\n    };\n  }, [load]);\n\n  const move = useCallback(async (id: string, newParentId: string) => {\n    try {\n      setSubmitLoading(true);\n      const ok = await updateCompanyStructure({ id, parentId: newParentId });\n      if (!ok) {\n        renderAlertMessage('error', translations.failedToMoveItem);\n        return false;\n      }\n      \n      // Get node type to determine success message\n      const byId = new Map(nodes?.map((n) => [n.id, n]));\n      const movedNode = byId.get(id);\n      const successMessage = movedNode?.type === 'team' ? translations.moveTeamSuccess : translations.moveUserSuccess;\n      \n      setNodes((prev) => prev ? prev.map((n) => (n.id === id ? { ...n, parentId: newParentId } : n)) : null);\n      setExpanded((prev) => new Set([...prev, newParentId]));\n      \n      // Publish analytics event\n      publishEvents(EventsList.EDIT_COMPANY_STRUCTURE_EVENT, {\n        action: 'move',\n        nodeId: id,\n        newParentId,\n      });\n      \n      // Notify other components that structure was updated\n      events.emit('companyStructure/updated', { \n        message: 'Structure updated',\n        action: 'move',\n        nodeId: id,\n        newParentId,\n        nodes: nodes || [],\n      });\n      \n      renderAlertMessage('success', successMessage);\n      return true;\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : updateError;\n      renderAlertMessage('error', errorMessage);\n      return false;\n    } finally {\n      setSubmitLoading(false);\n    }\n  }, [nodes, renderAlertMessage, updateError, translations.failedToMoveItem, translations.moveUserSuccess, translations.moveTeamSuccess]);\n\n  const expandAll = useCallback(() => {\n    if (nodes) {\n      setExpanded(new Set(nodes.map((n) => n.id)));\n    }\n  }, [nodes]);\n\n  const collapseAll = useCallback(() => {\n    if (nodes) {\n      const roots = nodes.filter((n) => n.parentId === null).map((n) => n.id);\n      setExpanded(new Set(roots));\n    }\n  }, [nodes]);\n\n  const insertNode = useCallback((node: { id: string; parentId: string | null; label: string; type: 'team' | 'user'; entityId?: string; description?: string }) => {\n    setNodes((prev) => {\n      const newNodes = prev ? [...prev, { id: node.id, parentId: node.parentId, label: node.label, type: node.type, entityId: node.entityId, description: node.description }] : [{ id: node.id, parentId: node.parentId, label: node.label, type: node.type, entityId: node.entityId, description: node.description }];\n      \n      // Notify other components that structure was updated\n      events.emit('companyStructure/updated', { \n        message: 'Structure updated',\n        action: 'add',\n        nodeId: node.id,\n        newParentId: node.parentId || undefined,\n        nodes: newNodes,\n      });\n      \n      // Publish analytics event\n      publishEvents(EventsList.EDIT_COMPANY_STRUCTURE_EVENT, {\n        action: 'add',\n        nodeId: node.id,\n        newParentId: node.parentId || undefined,\n        nodeType: node.type,\n      });\n      \n      return newNodes;\n    });\n    if (node.parentId) setExpanded((prev) => new Set([...prev, node.parentId as string]));\n  }, []);\n\n  const renameNodes = useCallback((ids: string[], nextLabel: string, nextDescription?: string) => {\n    if (!nextLabel) return;\n    setNodes((prev) => prev ? prev.map((n) => (ids.includes(n.id) ? { ...n, label: nextLabel, description: nextDescription } : n)) : null);\n  }, []);\n\n  const removeNodes = useCallback(async (ids: string[]) => {\n    if (!ids.length) return;\n    \n    try {\n      setSubmitLoading(true);\n      const byId = new Map((nodes || []).map((n) => [n.id, n] as const));\n      \n      // Determine what type(s) of nodes are being removed\n      const removedNodes = ids.map(id => byId.get(id)).filter(Boolean);\n      \n      for (const id of ids) {\n        const node = byId.get(id);\n        if (!node || !node.entityId) continue;\n        if (node.type === 'team') {\n          await deleteCompanyTeam(node.entityId);\n        } else {\n          // Set user to INACTIVE instead of deleting them from the company\n          // This keeps the user assigned to the company but prevents them from logging in\n          await updateCompanyUserStatus({ id: node.entityId, status: 'INACTIVE' });\n        }\n      }\n      \n      // Remove only the selected nodes locally without reload\n      setNodes((prev) => {\n        if (!prev) return null;\n        const toDelete = new Set(ids);\n        return prev.filter((n) => !toDelete.has(n.id));\n      });\n      setSelected(null);\n      setSelectedMany(new Set());\n      \n      // Publish analytics event\n      publishEvents(EventsList.EDIT_COMPANY_STRUCTURE_EVENT, {\n        action: 'remove',\n        nodeIds: ids,\n        // companyId: company?.id, // Removed since we don't have company data\n      });\n      \n      // Notify other components that structure was updated\n      events.emit('companyStructure/updated', { \n        message: 'Structure updated',\n        action: 'remove',\n        nodeIds: ids,\n        nodes: nodes || [],\n      });\n      \n      // Show appropriate success message\n      let successMessage: string;\n      if (ids.length === 1) {\n        // Single item removed\n        const node = removedNodes[0];\n        successMessage = node?.type === 'team' ? translations.deleteTeamSuccess : translations.removeUserSuccess;\n      } else {\n        // Multiple items removed\n        successMessage = translations.removeMultipleSuccess.replace('{count}', ids.length.toString());\n      }\n      \n      renderAlertMessage('success', successMessage);\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : updateError;\n      renderAlertMessage('error', errorMessage);\n    } finally {\n      setSubmitLoading(false);\n    }\n  }, [nodes, renderAlertMessage, updateError, translations.removeUserSuccess, translations.deleteTeamSuccess, translations.removeMultipleSuccess]);\n\n  const handleInputChange = useCallback(\n    (value: Record<string, string | number | boolean>) => {\n      setInputChange(value);\n    },\n    []\n  );\n\n  const handleShowEditForm = useCallback(() => {\n    setShowEditForm(true);\n    renderAlertMessage('success', ''); // Clear any existing alerts\n    setInputChange({});\n  }, [renderAlertMessage]);\n\n  const handleHideEditForm = useCallback((clearStates?: () => void) => {\n    clearStates?.();\n    setShowEditForm(false);\n    setInputChange({});\n  }, []);\n\n  return {\n    // Core data\n    nodes,\n    \n    // Loading states\n    loading,\n    submitLoading,\n    \n    // UI states\n    showEditForm,\n    \n    // Form data\n    inputChange,\n    \n    // Tree state\n    expanded,\n    setExpanded,\n    selected,\n    setSelected,\n    selectedMany,\n    setSelectedMany,\n    \n    // Actions\n    move,\n    expandAll,\n    collapseAll,\n    insertNode,\n    renameNodes,\n    removeNodes,\n    handleInputChange,\n    handleShowEditForm,\n    handleHideEditForm,\n    renderAlertMessage,\n    \n    // Legacy support (deprecated - use submitLoading instead)\n    working: submitLoading,\n  };\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport { FunctionComponent } from 'preact';\nimport { memo } from 'preact/compat';\nimport { Card, Button, InLineAlert, ProgressSpinner, Modal } from '@adobe-commerce/elsie/components';\nimport { Slot } from '@adobe-commerce/elsie/lib';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { useState } from 'preact/hooks';\nimport { Tree, TreeItem } from '../Tree/Tree';\nimport { CompanyUserForm } from '../CompanyUserForm';\nimport { CompanyTeamForm } from '../CompanyTeamForm';\nimport { CompanyStructureLoader } from '../CompanyLoaders';\nimport { useCompanyStructureCard } from '../../hooks/useCompanyStructureCard';\nimport { useInLineAlert } from '../../hooks/useInLineAlert';\nimport { CompanyStructureCardProps } from '../../types/companyStructure.types';\nimport './CompanyStructureCard.css';\n\n/**\n * CompanyStructureCard component for managing company organizational structure\n * Displays a tree view of company users and teams with CRUD operations\n * \n * @param permissions - User permissions for editing company structure\n * @param slots - Customizable rendering slots for different parts of the component\n */\nexport const CompanyStructureCard: FunctionComponent<CompanyStructureCardProps> = memo(({\n  permissions,\n  slots,\n}) => {\n  const canEditUsers = permissions?.canEditUsers ?? false;\n  const canViewUsers = permissions?.canViewUsers ?? false;\n  const translations = useText({\n    expandAll: 'Company.CompanyStructure.shared.buttons.expandAll',\n    collapseAll: 'Company.CompanyStructure.shared.buttons.collapseAll',\n    addUser: 'Company.CompanyStructure.shared.buttons.addUser',\n    addTeam: 'Company.CompanyStructure.shared.buttons.addTeam',\n    editSelected: 'Company.CompanyStructure.shared.buttons.editSelected',\n    remove: 'Company.CompanyStructure.shared.buttons.remove',\n    ok: 'Company.CompanyStructure.shared.buttons.ok',\n    cancel: 'Company.CompanyStructure.shared.buttons.cancel',\n    close: 'Company.CompanyStructure.shared.buttons.close',\n    deleting: 'Company.CompanyStructure.shared.buttons.deleting',\n    removing: 'Company.CompanyStructure.shared.buttons.removing',\n    noStructureData: 'Company.CompanyStructure.messages.noStructureData',\n    processing: 'Company.CompanyStructure.shared.messages.processing',\n    cannotDeleteUser: 'Company.CompanyStructure.messages.cannotDeleteUser',\n    cannotDeleteTeam: 'Company.CompanyStructure.messages.cannotDeleteTeam',\n    removeUserConfirm: 'Company.CompanyStructure.messages.removeUserConfirm',\n    deleteTeamConfirm: 'Company.CompanyStructure.messages.deleteTeamConfirm',\n    removeItemsConfirm: 'Company.CompanyStructure.messages.removeItemsConfirm',\n    teamDescription: 'Company.CompanyStructure.shared.messages.teamDescription',\n    removeUserMessage: 'Company.CompanyStructure.messages.removeUserMessage',\n    cannotDeleteUserMessage: 'Company.CompanyStructure.messages.cannotDeleteUserMessage',\n    cannotDeleteTeamMessage: 'Company.CompanyStructure.messages.cannotDeleteTeamMessage',\n    removeItemsMessage: 'Company.CompanyStructure.messages.removeItemsMessage',\n    companyStructureActions: 'Company.CompanyStructure.shared.ariaLabels.companyStructureActions',\n    expandAllNodes: 'Company.CompanyStructure.shared.ariaLabels.expandAllNodes',\n    collapseAllNodes: 'Company.CompanyStructure.shared.ariaLabels.collapseAllNodes',\n    addUserAria: 'Company.CompanyStructure.shared.ariaLabels.addUser',\n    addTeamAria: 'Company.CompanyStructure.shared.ariaLabels.addTeam',\n    editSelectedAria: 'Company.CompanyStructure.shared.ariaLabels.editSelected',\n    removeSelectedAria: 'Company.CompanyStructure.shared.ariaLabels.removeSelected',\n    showDescription: 'Company.CompanyStructure.shared.ariaLabels.showDescription',\n    delete: 'Company.CompanyStructure.shared.options.delete',\n    expand: 'Company.CompanyStructure.shared.options.expand',\n    collapse: 'Company.CompanyStructure.shared.options.collapse',\n    deleteTeamMessage: 'Company.CompanyStructure.messages.deleteTeamMessage',\n  });\n  const { inLineAlertProps, handleSetInLineAlert } = useInLineAlert();\n  const {\n    nodes,\n    loading,\n    submitLoading,\n    expanded,\n    setExpanded,\n    selected,\n    setSelected,\n    selectedMany,\n    setSelectedMany,\n    move,\n    expandAll,\n    collapseAll,\n    insertNode,\n    renameNodes,\n    removeNodes,\n  } = useCompanyStructureCard({ handleSetInLineAlert, permissions });\n\n  type PanelKind = null | 'user' | 'team';\n  const [panel, setPanel] = useState<PanelKind>(null);\n  const [mode, setMode] = useState<'add' | 'edit'>('add');\n  const [confirmOpen, setConfirmOpen] = useState(false);\n  const [pendingDeleteIds, setPendingDeleteIds] = useState<string[]>([]);\n  const [confirmContent, setConfirmContent] = useState<{ title: string; body: string; confirmLabel?: string; blocked: boolean }>({ title: '', body: '', confirmLabel: translations.remove, blocked: false });\n  const [descOpen, setDescOpen] = useState<{ id: string; text: string } | null>(null);\n\n  const closePanel = () => setPanel(null);\n  const rootStructureId = nodes?.find((n) => n.parentId === null)?.id ?? null;\n\n  const items: TreeItem[] = (nodes || []).map((n) => ({\n    id: n.id,\n    parentId: n.parentId,\n    label: n.label,\n  }));\n\n  const getSubordinateCount = (nodeId: string): number => {\n    if (!nodes) return 0;\n    let count = 0;\n    const stack = [nodeId];\n    const visited = new Set<string>();\n    while (stack.length > 0) {\n      const currentId = stack.pop();\n      if (!currentId || visited.has(currentId)) continue;\n      visited.add(currentId);\n      const children = nodes.filter(n => n.parentId === currentId);\n      count += children.length;\n      children.forEach(child => stack.push(child.id));\n    }\n    return count;\n  };\n\n\n  const isDescendant = (candidateId: string, potentialAncestorId: string): boolean => {\n    let cur: string | null | undefined = candidateId;\n    const byId = new Map(items.map(i => [i.id, i] as const));\n    const guard = new Set<string>();\n    while (cur) {\n      if (guard.has(cur)) break;\n      guard.add(cur);\n      const node = byId.get(cur);\n      if (!node) break;\n      if (node.parentId === potentialAncestorId) return true;\n      cur = node.parentId ?? null;\n    }\n    return false;\n  };\n\n  const structureData = (nodes || []).map((node) => ({\n    id: node.id,\n    parentId: node.parentId,\n    label: node.label,\n    type: node.type,\n    description: node.description,\n    entityId: node.entityId,\n  }));\n\n  const Default = (\n    <>\n      {(() => {\n        const selectedIds = selectedMany?.size ? Array.from(selectedMany) : (selected ? [selected] : []);\n        const canEdit = canEditUsers && selectedIds.length === 1;\n        const canRemove = canEditUsers && selectedIds.length >= 1;\n        return (\n          <Card variant=\"secondary\" className=\"acm-structure-toolbar-card acm-structure-toolbar-card--spaced\">\n            <div className=\"acm-structure-toolbar\" role=\"toolbar\" aria-label={translations.companyStructureActions}>\n              <Button type=\"button\" variant=\"secondary\" onClick={expandAll} aria-label={translations.expandAllNodes} disabled={!canViewUsers} aria-disabled={!canViewUsers}>{translations.expandAll}</Button>\n              <Button type=\"button\" variant=\"secondary\" onClick={collapseAll} aria-label={translations.collapseAllNodes} disabled={!canViewUsers} aria-disabled={!canViewUsers}>{translations.collapseAll}</Button>\n              <Button type=\"button\" variant=\"primary\" onClick={() => { setMode('add'); setPanel('user'); }} aria-label={translations.addUserAria} disabled={!canEditUsers} aria-disabled={!canEditUsers}>{translations.addUser}</Button>\n              <Button type=\"button\" variant=\"primary\" onClick={() => { setMode('add'); setPanel('team'); }} aria-label={translations.addTeamAria} disabled={!canEditUsers} aria-disabled={!canEditUsers}>{translations.addTeam}</Button>\n              <Button type=\"button\" variant=\"primary\" disabled={!canEdit} aria-disabled={!canEdit} aria-label={translations.editSelectedAria} onClick={() => {\n                if (!canEdit) return;\n                const ids = selectedIds;\n                const node = nodes?.find(n => n.id === ids[0]);\n                if (node?.type === 'user') { setMode('edit'); setPanel('user'); }\n                else { setMode('edit'); setPanel('team'); }\n              }}>{translations.editSelected}</Button>\n              <Button type=\"button\" variant=\"secondary\" disabled={!canRemove || submitLoading} aria-disabled={!canRemove || submitLoading} aria-label={translations.removeSelectedAria} onClick={() => {\n                if (!canRemove || submitLoading) return;\n                const ids = selectedIds;\n                if (ids.length === 1) {\n                  const node = nodes?.find(n => n.id === ids[0]);\n                  if (!node) return;\n                  const hasChildren = nodes?.some(n => n.parentId === node.id);\n                  if (hasChildren) {\n                    setConfirmContent({\n                      title: node.type === 'user' ? translations.cannotDeleteUser : translations.cannotDeleteTeam,\n                      body: node.type === 'user'\n                        ? translations.cannotDeleteUserMessage\n                        : translations.cannotDeleteTeamMessage,\n                      confirmLabel: undefined,\n                      blocked: true,\n                    });\n                    setPendingDeleteIds([]);\n                    setConfirmOpen(true);\n                  } else {\n                    setConfirmContent({\n                      title: node.type === 'user' ? translations.removeUserConfirm : translations.deleteTeamConfirm,\n                      body: node.type === 'user'\n                        ? translations.removeUserMessage\n                        : translations.deleteTeamMessage,\n                        confirmLabel: node.type === 'user' ? translations.remove : translations.delete,\n                      blocked: false,\n                    });\n                    setPendingDeleteIds(ids);\n                    setConfirmOpen(true);\n                  }\n                } else {\n                  setConfirmContent({\n                    title: translations.removeItemsConfirm.replace('{count}', ids.length.toString()),\n                    body: translations.removeItemsMessage,\n                    confirmLabel: translations.remove,\n                    blocked: false,\n                  });\n                  setPendingDeleteIds(ids);\n                  setConfirmOpen(true);\n                }\n              }}>{translations.remove}</Button>\n            </div>\n          </Card>\n        );\n      })()}\n      {panel ? (\n        <div className=\"acm-structure-panel\">\n          {submitLoading ? (\n            <div className=\"acm-structure-working\" aria-live=\"polite\"><ProgressSpinner size=\"small\" /> {translations.processing}</div>\n          ) : null}\n          {panel === 'user' ? (() => {\n            const ids = selectedMany?.size ? Array.from(selectedMany) : (selected ? [selected] : []);\n            const node = ids.length ? nodes?.find(n => n.id === ids[0]) : undefined;\n            const parentStructureId = node?.id ?? rootStructureId;\n            return (\n              <CompanyUserForm\n                mode={mode}\n                entityId={node?.entityId}\n                parentStructureId={parentStructureId}\n                permissions={permissions}\n                onSaved={(res) => {\n                  if (mode === 'add') {\n                    if (res.structureId) {\n                      insertNode({ id: res.structureId, parentId: parentStructureId, label: res.label, type: res.type, entityId: res.entityId, description: res.jobTitle ?? undefined });\n                      if (res.structureId) {\n                        setSelected(res.structureId);\n                        setSelectedMany(new Set([res.structureId]));\n                      }\n                    }\n                  } else if (ids.length) {\n                    // If user was set to INACTIVE, remove them from display (like when removing from structure)\n                    if (res.status === 'INACTIVE') {\n                      removeNodes(ids);\n                    } else {\n                      // Otherwise update the label and job title\n                      renameNodes(ids, res.label, res.jobTitle ?? undefined);\n                    }\n                  }\n                  closePanel();\n                }}\n                onCancel={closePanel}\n                onError={(error) => {\n                  handleSetInLineAlert({ text: error, type: 'error' });\n                }}\n                onSuccess={(message) => {\n                  handleSetInLineAlert({ text: message, type: 'success' });\n                }}\n              />\n            );\n          })() : null}\n          {panel === 'team' ? (() => {\n            const ids = selectedMany?.size ? Array.from(selectedMany) : (selected ? [selected] : []);\n            const node = ids.length ? nodes?.find(n => n.id === ids[0]) : undefined;\n            const parentStructureId = node?.id ?? rootStructureId;\n            return (\n              <CompanyTeamForm\n                mode={mode}\n                entityId={node?.entityId}\n                parentStructureId={parentStructureId}\n                permissions={permissions}\n                onSaved={(res) => {\n                  if (mode === 'add') {\n                    if (res.structureId) {\n                      insertNode({ id: res.structureId, parentId: parentStructureId, label: res.label, type: res.type, entityId: res.entityId, description: (res as { description?: string }).description });\n                      if (res.structureId) {\n                        setSelected(res.structureId);\n                        setSelectedMany(new Set([res.structureId]));\n                      }\n                    }\n                  } else if (ids.length) {\n                    renameNodes(ids, res.label, (res as { description?: string }).description);\n                  }\n                  closePanel();\n                }}\n                onCancel={closePanel}\n                onError={(error) => {\n                  handleSetInLineAlert({ text: error, type: 'error' });\n                }}\n                onSuccess={(message) => {\n                  handleSetInLineAlert({ text: message, type: 'success' });\n                }}\n              />\n            );\n          })() : null}\n        </div>\n      ) : null}\n\n      {inLineAlertProps && inLineAlertProps.text ? (\n        <Card variant=\"secondary\" className=\"acm-structure-message-card\">\n          <InLineAlert \n            className=\"acm-structure-panel__notification\" \n            type={inLineAlertProps.type || 'success'} \n            variant=\"secondary\" \n            heading={inLineAlertProps.text} \n          />\n        </Card>\n      ) : null}\n      {!loading && !submitLoading && nodes && nodes.length === 0 ? (\n        <Card variant=\"secondary\" className=\"acm-structure-message-card\">\n          <InLineAlert className=\"acm-structure-panel__notification\" type=\"warning\" variant=\"secondary\" heading={translations.noStructureData} />\n        </Card>\n      ) : null}\n      {!loading && submitLoading ? (\n        <div className=\"acm-structure-tree-overlay\" aria-live=\"polite\"><ProgressSpinner size=\"medium\" /></div>\n      ) : null}\n      {loading ? (\n        <Card variant=\"secondary\" className=\"acm-structure-message-card\">\n          <div className=\"acm-structure-tree-content\">\n            <CompanyStructureLoader rows={8} />\n          </div>\n        </Card>\n      ) : null}\n      {!loading && nodes && nodes.length > 0 ? (\n        <div className={`acm-structure-tree-card ${submitLoading ? 'is-working' : ''}`}>\n          <Tree\n          rootId={null}\n          items={items}\n          expandedIds={expanded}\n          selectedId={selected}\n          selectedIds={selectedMany}\n          onExpandedChange={setExpanded}\n          onSelectedChange={setSelected}\n          onSelectedIdsChange={setSelectedMany}\n          renderExpander={({ expanded, toggle }) => (\n            <button\n              type=\"button\"\n              className={`acm-structure-expander acm-structure-expander-button ${expanded ? 'is-open' : ''}`}\n              aria-label={expanded ? translations.collapse : translations.expand}\n              onClick={(e) => { e.stopPropagation(); toggle(); }}\n            >\n              <span className={`acm-structure-chevron ${expanded ? 'is-expanded' : ''}`} />\n            </button>\n          )}\n          renderNode={({ item, hasChildren, expander, icon, select }) => {\n            const node = nodes?.find(n => n.id === item.id);\n            const subordinateCount = getSubordinateCount(item.id);\n            const description = node?.description || '';\n            const showDescription = node?.type === 'team' && description;\n            const isRoot = node?.parentId === null;\n            return (\n              <div className=\"acm-structure-row\" onClick={select}>\n                {!isRoot && <span className=\"acm-structure-handle\" aria-hidden />}\n                {icon ? (\n                  <span onClick={(e) => e.stopPropagation()}>{icon()}</span>\n                ) : (\n                  <span className={`acm-structure-icon ${node?.type === 'team' ? 'is-team' : 'is-user'} ${isRoot ? 'is-root' : ''}`} aria-hidden />\n                )}\n                <div className=\"acm-structure-info\">\n                  <span className=\"acm-structure-label\">{item.label}</span>\n                  {description ? (\n                    <span className=\"acm-structure-description\">{description}</span>\n                  ) : null}\n                </div>\n                {showDescription ? (\n                  <Button type=\"button\" variant=\"secondary\" onClick={(e) => { e.stopPropagation(); setDescOpen({ id: item.id, text: description }); }} aria-label={translations.showDescription} className=\"acm-structure-description-button\">?</Button>\n                ) : null}\n                {subordinateCount > 0 ? (\n                  <span className=\"acm-structure-count\">{subordinateCount}</span>\n                ) : null}\n                {hasChildren && expander ? (\n                  <span className=\"acm-structure-expander-wrapper\" onClick={(e) => e.stopPropagation()}>{expander()}</span>\n                ) : null}\n              </div>\n            );\n          }}\n          draggable={(item) => {\n            const node = nodes?.find(n => n.id === item.id);\n            const isRoot = node ? node.parentId === null : false;\n            return !submitLoading && canEditUsers && !isRoot;\n          }}\n          canDrop={(dragId, targetId) => {\n            if (!canEditUsers) return false;\n            if (dragId === targetId) return false;\n            const dragged = nodes?.find(n => n.id === dragId);\n            if (dragged && dragged.parentId === targetId) return false; // no-op move to current parent\n            // prevent moving under own descendant (no cycles)\n            return !isDescendant(targetId, dragId);\n          }}\n          onMove={async ({ id, newParentId }) => {\n            if (!canEditUsers) return;\n            await move(id, newParentId);\n          }}\n        />\n        </div>\n      ) : null}\n      {confirmOpen ? (\n        <Modal\n          // @ts-ignore\n          open={confirmOpen}\n          onClose={() => { if (!submitLoading) { setConfirmOpen(false); setPendingDeleteIds([]); } }}\n        >\n          <div className=\"acm-structure-modal-content\">\n            <h3 className=\"acm-structure-modal-title\">{confirmContent.title}</h3>\n            <div>{confirmContent.body}</div>\n            <div className=\"acm-structure-modal-actions\">\n              {confirmContent.blocked ? (\n                <Button type=\"button\" variant=\"secondary\" disabled={submitLoading} onClick={() => { if (!submitLoading) { setConfirmOpen(false); setPendingDeleteIds([]); } }}>{translations.ok}</Button>\n              ) : (\n                <>\n                  <Button type=\"button\" variant=\"secondary\" disabled={submitLoading} onClick={() => { if (!submitLoading) { setConfirmOpen(false); setPendingDeleteIds([]); } }}>{translations.cancel}</Button>\n                  <Button type=\"button\" variant=\"primary\" disabled={submitLoading} onClick={async () => {\n                    await removeNodes(pendingDeleteIds);\n                    setConfirmOpen(false);\n                    setPendingDeleteIds([]);\n                  }}>{submitLoading ? (confirmContent.confirmLabel === translations.delete ? translations.deleting : translations.removing) : (confirmContent.confirmLabel || translations.remove)}</Button>\n                </>\n              )}\n            </div>\n          </div>\n        </Modal>\n      ) : null}\n      {descOpen ? (\n        <Modal\n          // @ts-ignore\n          open={!!descOpen}\n          onClose={() => setDescOpen(null)}\n        >\n          <div className=\"acm-structure-modal-content\">\n            <h3 className=\"acm-structure-modal-title\">{translations.teamDescription}</h3>\n            <div>{descOpen.text}</div>\n            <div className=\"acm-structure-modal-actions\">\n              <Button type=\"button\" variant=\"secondary\" onClick={() => setDescOpen(null)}>{translations.close}</Button>\n            </div>\n          </div>\n        </Modal>\n      ) : null}\n    </>\n  );\n\n  if (slots?.StructureData) {\n    return (\n      <Slot name=\"StructureData\" slot={slots.StructureData} context={{ structureData, Default }} />\n    );\n  }\n  return Default;\n});\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { useEffect, useState, useCallback } from 'preact/hooks';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { fetchUserPermissions } from '@/company-management/api/fetchUserPermissions/fetchUserPermissions';\nimport { CompanyPermissionFlags } from '@/company-management/types/companyPermission.types';\nimport { buildPermissionFlags } from '@/company-management/lib/company-permissions';\n\n/**\n * Hook for managing user permissions\n * \n * This hook fetches permissions fresh on each use to ensure they're current.\n * Permissions can change during a session (role updates, admin changes, etc.),\n * so we don't cache them indefinitely.\n * \n * Usage:\n * ```tsx\n * const { permissions, loading, error } = usePermissions();\n * \n * if (loading) return <Spinner />;\n * if (error) return <ErrorDisplay error={error} />;\n * \n * return (\n *   <div>\n *     {permissions?.canEditUsers && <EditButton />}\n *     {permissions?.canViewUsers && <ViewButton />}\n *   </div>\n * );\n * ```\n */\nexport const usePermissions = () => {\n  const translations = useText({\n    fetchPermissionsError: 'Company.CompanyStructure.messages.fetchPermissionsError',\n  });\n  \n  const [permissions, setPermissions] = useState<CompanyPermissionFlags | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  // Expose fetchPermissions as a reusable function\n  const refreshPermissions = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      const { roleResponse } = await fetchUserPermissions();\n      \n      // Use the existing buildPermissionFlags function to convert role data to permission flags\n      const role = roleResponse?.data?.customer?.role;\n      const permissionFlags = buildPermissionFlags(role);\n      \n      setPermissions(permissionFlags);\n    } catch (err) {\n      setError(err instanceof Error ? err : new Error(translations.fetchPermissionsError));\n    } finally {\n      setLoading(false);\n    }\n  }, [translations.fetchPermissionsError]);\n\n  useEffect(() => {\n    let isMounted = true;\n\n    const fetchPermissions = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n        \n        const { roleResponse } = await fetchUserPermissions();\n        \n        if (!isMounted) return;\n        \n        // Use the existing buildPermissionFlags function to convert role data to permission flags\n        const role = roleResponse?.data?.customer?.role;\n        const permissionFlags = buildPermissionFlags(role);\n        \n        setPermissions(permissionFlags);\n      } catch (err) {\n        if (!isMounted) return;\n        setError(err instanceof Error ? err : new Error(translations.fetchPermissionsError));\n      } finally {\n        if (isMounted) {\n          setLoading(false);\n        }\n      }\n    };\n\n    fetchPermissions();\n\n    return () => {\n      isMounted = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []); // Intentionally empty - we only want to fetch once on mount\n\n  return {\n    permissions,\n    loading,\n    error,\n    refreshPermissions, // Expose refresh function like useCompanyUsers does\n  };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n  \nimport { FunctionComponent } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\nimport { Button, IllustratedMessage, Icon } from '@adobe-commerce/elsie/components';\nimport { classes } from '@adobe-commerce/elsie/lib';\nimport { EmptyBox } from '@adobe-commerce/elsie/icons';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport './CompanyStructureEmpty.css';\n\nexport const COMPANY_CREATE_URL = '/customer/company/create';\n\nexport interface CompanyStructureEmptyProps extends HTMLAttributes<HTMLDivElement> {\n  createCompanyAccountUrl?: string;\n}\n\nexport const CompanyStructureEmpty: FunctionComponent<CompanyStructureEmptyProps> = ({\n  className,\n  children,\n  createCompanyAccountUrl = COMPANY_CREATE_URL,\n  ...props\n}) => {\n  const translations = useText({\n    individualUserMessage: 'Company.CustomerCompanyInfo.individualUserMessage',\n    createAccountCta: 'Company.CustomerCompanyInfo.createAccountCta',\n  });\n\n  return (\n    <IllustratedMessage\n      className={classes(['company-management-company-structure-empty', className])}\n      icon={<Icon source={EmptyBox} />}\n      heading={translations.individualUserMessage || \"You don't have a company account yet.\"}\n      action={\n        <Button\n          as=\"a\"\n          href={createCompanyAccountUrl}\n          variant=\"primary\"\n          data-testid=\"company-structure-create-company-button\"\n        >\n          {translations.createAccountCta || 'Create a Company Account'}\n        </Button>\n      }\n      variant=\"secondary\"\n      data-testid=\"company-structure-empty\"\n      {...props}\n    />\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport { useEffect, useState } from 'preact/hooks';\nimport { classes, Container } from '@adobe-commerce/elsie/lib';\nimport { Header, IllustratedMessage } from '@adobe-commerce/elsie/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { CompanyStructureCard } from '../../components/CompanyStructureCard';\nimport { CompanyStructureEmpty } from '../../components/CompanyStructureEmpty';\nimport { usePermissions } from '../../hooks/usePermissions';\nimport { useCompanyContextListener } from '@/company-management/hooks/useCompanyContextListener';\nimport { allowCompanyRegistration } from '../../api/allowCompanyRegistration';\nimport { isCompanyUser } from '../../api/isCompanyUser';\nimport { CompanyStructureProps } from '../../types/companyStructure.types';\n\ntype CompanyStructureState = 'loading' | 'redirect-login' | 'redirect-account' | 'show-empty' | 'show-structure' | 'no-access';\n\nexport const CompanyStructure: Container<CompanyStructureProps> = ({\n  className,\n  withHeader = false,\n  slots,\n  isAuthenticated = false,\n  onRedirectLogin,\n  onRedirectAccount,\n}) => {\n  const translations = useText({\n    containerTitle: 'Company.CompanyStructure.containerTitle',\n    noAccessTitle: 'Company.CompanyStructure.noAccess.title',\n    noAccessMessage: 'Company.CompanyStructure.noAccess.message',\n  });\n  const { permissions, loading: permissionsLoading, refreshPermissions } = usePermissions();\n  const [state, setState] = useState<CompanyStructureState>('loading');\n\n  // Refresh permissions when company context changes (like useCompanyUsers does)\n  useCompanyContextListener(refreshPermissions);\n\n  // Check authentication and company status\n  useEffect(() => {\n    let active = true;\n    (async () => {\n      try {\n        if (!isAuthenticated) {\n          if (active) setState('redirect-login');\n          return;\n        }\n\n        const allowed = await allowCompanyRegistration();\n        \n        if (!allowed) {\n          // Provide status logging since company registration link is always visible\n          // and backend configuration is not exposed to frontend users\n          if (active) {\n            console.log('Company registration disabled - redirecting to account dashboard');\n            setState('redirect-account');\n          }\n          return;\n        }\n\n        const belongsToCompany = await isCompanyUser();\n        \n        if (belongsToCompany) {\n          // User has a company - wait for permissions to determine access\n          if (active) setState('show-structure');\n        } else if (active) {\n          // Show empty state and allow company registration\n          setState('show-empty');\n        }\n      } catch (error) {\n        console.error('Error in CompanyStructure - redirecting to login page:', error);\n        if (active) {\n          setState('redirect-login');\n        }\n      }\n    })();\n    return () => { active = false; };\n  }, [isAuthenticated]);\n\n  // Update state based on permissions (handles company switching)\n  useEffect(() => {\n    if (state !== 'show-structure' && state !== 'no-access') return;\n    if (permissionsLoading || !permissions) return;\n\n    const canViewStructure = permissions.canViewUsers ?? false;\n    const newState = canViewStructure ? 'show-structure' : 'no-access';\n    \n    if (state !== newState) {\n      setState(newState);\n    }\n  }, [state, permissions, permissionsLoading]);\n\n  // Handle redirects\n  useEffect(() => {\n    if (state === 'redirect-login' && onRedirectLogin) {\n      onRedirectLogin();\n    }\n    if (state === 'redirect-account' && onRedirectAccount) {\n      onRedirectAccount();\n    }\n  }, [state, onRedirectLogin, onRedirectAccount]);\n\n  if (state === 'loading' || state === 'redirect-login' || state === 'redirect-account') {\n    return null;\n  }\n\n  if (state === 'show-empty') {\n    return <CompanyStructureEmpty className={className} />;\n  }\n\n  if (state === 'no-access') {\n    return (\n      <IllustratedMessage\n        className={className}\n        heading={translations.noAccessTitle || 'Access Restricted'}\n        message={<p>{translations.noAccessMessage || \"You don't have permission to view the company structure. Please contact your company administrator.\"}</p>}\n      />\n    );\n  }\n\n  if (state === 'show-structure') {\n    // Wait for permissions to load before rendering structure card\n    // This prevents the race condition where structure is fetched before permissions are checked\n    if (permissionsLoading || !permissions) {\n      return null;\n    }\n\n    return (\n      <div className={classes(['account-company-structure', className])}>\n        {withHeader ? (\n          <Header\n            title={translations.containerTitle}\n            divider={false}\n            className={'company-structure__title'}\n          />\n        ) : null}\n        <CompanyStructureCard \n          slots={slots} \n          permissions={permissions}\n        />\n      </div>\n    );\n  }\n\n  return null;\n};\n\n"],"names":["SvgEmptyBox","props","React","TEAM_FIELD_MAX_LENGTHS","useCompanyTeamForm","opts","mode","entityId","parentStructureId","onSaved","onError","onSuccess","translations","useText","values","setValues","useState","errors","setErrors","touched","setTouched","loading","setLoading","generalError","setGeneralError","useEffect","getCompanyTeam","t","validateField","field","value","setValue","v","valueToValidate","err","p","newErrors","nameErr","descErr","touchedFields","label","res","createCompanyTeam","errorMessage","updateCompanyTeam","error","CompanyTeamForm","memo","permissions","onCancel","canEditUsers","onBlur","submit","saving","setSaving","jsx","jsxs","Card","InLineAlert","ProgressSpinner","CompanyTeamFormLoader","Field","Input","e","target","Button","useCompanyStructureCard","handleSetInLineAlert","canViewUsers","loadError","updateError","nodes","setNodes","submitLoading","setSubmitLoading","showEditForm","setShowEditForm","expanded","setExpanded","selected","setSelected","selectedMany","setSelectedMany","inputChange","setInputChange","alertFnRef","useRef","inFlightRef","didInitialFetchRef","renderAlertMessage","useCallback","type","message","load","getCompanyStructure","n","onCompanyContextChanged","subChanged","events","move","id","newParentId","updateCompanyStructure","movedNode","successMessage","prev","publishEvents","EventsList","expandAll","collapseAll","roots","insertNode","node","newNodes","renameNodes","ids","nextLabel","nextDescription","removeNodes","byId","removedNodes","deleteCompanyTeam","updateCompanyUserStatus","toDelete","handleInputChange","handleShowEditForm","handleHideEditForm","clearStates","CompanyStructureCard","slots","inLineAlertProps","useInLineAlert","panel","setPanel","setMode","confirmOpen","setConfirmOpen","pendingDeleteIds","setPendingDeleteIds","confirmContent","setConfirmContent","descOpen","setDescOpen","closePanel","rootStructureId","_a","items","getSubordinateCount","nodeId","count","stack","visited","currentId","children","child","isDescendant","candidateId","potentialAncestorId","cur","i","guard","structureData","Default","Fragment","selectedIds","canEdit","canRemove","CompanyUserForm","CompanyStructureLoader","Tree","toggle","item","hasChildren","expander","icon","select","subordinateCount","description","showDescription","isRoot","dragId","targetId","dragged","Modal","Slot","usePermissions","setPermissions","setError","refreshPermissions","roleResponse","fetchUserPermissions","role","_b","permissionFlags","buildPermissionFlags","isMounted","COMPANY_CREATE_URL","CompanyStructureEmpty","className","createCompanyAccountUrl","IllustratedMessage","classes","Icon","EmptyBox","CompanyStructure","withHeader","isAuthenticated","onRedirectLogin","onRedirectAccount","permissionsLoading","state","setState","useCompanyContextListener","active","allowCompanyRegistration","isCompanyUser","newState","Header"],"mappings":"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","x_google_ignoreList":[0]}