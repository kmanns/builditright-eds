{"version":3,"file":"CompanyUsers.js","sources":["/@dropins/storefront-company-management/src/lib/encoding.ts","/@dropins/storefront-company-management/src/lib/userHelpers.ts","/@dropins/storefront-company-management/src/components/CompanyUsersFilters/CompanyUsersFilters.tsx","/@dropins/storefront-company-management/src/hooks/containers/useCompanyUsers.tsx","/@dropins/storefront-company-management/src/hooks/useModal.ts","/@dropins/storefront-company-management/src/components/CompanyUsersManagementModal/CompanyUsersManagementModal.tsx","/@dropins/storefront-company-management/src/containers/CompanyUsers/CompanyUsers.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/**\n * Encodes a string to base64\n * @param value - The string to encode\n * @returns The base64 encoded string\n * @throws Error if encoding fails\n */\nexport const encodeBase64 = (value: string): string => {\n  try {\n    return btoa(value);\n  } catch (error) {\n    throw new Error(`Failed to encode base64: ${error}`);\n  }\n};\n\n/**\n * Decodes a base64 encoded string\n * @param encoded - The base64 encoded string to decode\n * @returns The decoded string, or the original string if decoding fails\n */\nexport const decodeBase64 = (encoded: string): string => {\n  try {\n    return atob(encoded);\n  } catch {\n    // Return original if decoding fails (graceful fallback)\n    return encoded;\n  }\n};\n\n/**\n * Safely encodes a user ID to base64 for API transmission\n * @param userId - The user ID to encode\n * @returns The base64 encoded user ID\n * @throws Error if userId is empty or encoding fails\n */\nexport const encodeUserId = (userId: string): string => {\n  if (!userId || typeof userId !== 'string') {\n    throw new Error('User ID must be a non-empty string');\n  }\n  \n  return encodeBase64(userId);\n};\n\n/**\n * Safely decodes a base64 encoded user ID from API response\n * @param encodedUserId - The base64 encoded user ID\n * @returns The decoded user ID, or the original string if decoding fails\n */\nexport const decodeUserId = (encodedUserId: string): string => {\n  if (!encodedUserId || typeof encodedUserId !== 'string') {\n    return encodedUserId;\n  }\n  \n  return decodeBase64(encodedUserId);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/**\n * Formats a user status string for display\n * @param status - The raw status string (e.g., 'ACTIVE', 'INACTIVE')\n * @param translations - Translation object containing statusActive and statusInactive keys\n * @returns The formatted status string for display\n */\nexport const formatUserStatus = (status: string, translations: { statusActive?: string; statusInactive?: string }): string => {\n  if (!status || typeof status !== 'string') {\n    return '';\n  }\n\n  // Use translations for known statuses\n  if (status === 'ACTIVE' && translations.statusActive) {\n    return translations.statusActive;\n  }\n  \n  if (status === 'INACTIVE' && translations.statusInactive) {\n    return translations.statusInactive;\n  }\n\n  // Fallback to formatted string if status is unknown or no translation available\n  return status.charAt(0).toUpperCase() + status.slice(1).toLowerCase();\n};\n\n/**\n * Formats a user's full name by combining first and last name\n * @param firstName - The user's first name\n * @param lastName - The user's last name\n * @returns The formatted full name, trimmed of extra spaces\n */\nexport const formatUserName = (firstName: string, lastName: string): string => {\n  const first = firstName?.trim() || '';\n  const last = lastName?.trim() || '';\n  \n  return `${first} ${last}`.trim();\n};\n\n/**\n * Checks if a user has a specific status\n * @param userStatus - The user's current status\n * @param expectedStatus - The status to check against\n * @returns true if the user has the expected status\n */\nexport const hasUserStatus = (userStatus: string, expectedStatus: string): boolean => {\n  return userStatus?.toUpperCase() === expectedStatus?.toUpperCase();\n};\n\n/**\n * Gets the opposite status for toggling (ACTIVE <-> INACTIVE)\n * @param currentStatus - The current user status\n * @returns The opposite status, or the current status if not recognized\n */\nexport const getToggleStatus = (currentStatus: string): string => {\n  const status = currentStatus?.toUpperCase();\n  \n  switch (status) {\n    case 'ACTIVE':\n      return 'INACTIVE';\n    case 'INACTIVE':\n      return 'ACTIVE';\n    default:\n      return currentStatus;\n  }\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { Button } from '@adobe-commerce/elsie/components';\n\nexport type FilterType = 'all' | 'active' | 'inactive';\n\nexport interface CompanyUsersFiltersProps {\n  filterType: FilterType;\n  onFilterChange: (filter: FilterType) => void;\n  translations: {\n    showAllUsers: string;\n    showActiveUsers: string;\n    showInactiveUsers: string;\n    ariaFilterOptions: string;\n  };\n}\n\nexport const CompanyUsersFilters = ({\n  filterType,\n  onFilterChange,\n  translations\n}: CompanyUsersFiltersProps) => {\n  const filters: Array<{ type: FilterType; label: string; ariaLabel: string }> = [\n    { type: 'all', label: translations.showAllUsers, ariaLabel: translations.showAllUsers },\n    { type: 'active', label: translations.showActiveUsers, ariaLabel: translations.showActiveUsers },\n    { type: 'inactive', label: translations.showInactiveUsers, ariaLabel: translations.showInactiveUsers }\n  ];\n\n  return (\n    <div className=\"filterButtons\" role=\"group\" aria-label={translations.ariaFilterOptions}>\n      {filters\n        .filter(filter => filter.type !== filterType)\n        .map(filter => (\n          <Button\n            key={filter.type}\n            variant=\"tertiary\"\n            onClick={() => onFilterChange(filter.type)}\n            aria-label={filter.ariaLabel}\n          >\n            {filter.label}\n          </Button>\n        ))}\n    </div>\n  );\n};\n\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { useEffect, useState, useCallback, useRef, useMemo } from 'preact/hooks';\nimport { getCompanyUsers } from '@/company-management/api';\nimport { fetchUserPermissions } from '@/company-management/api/fetchUserPermissions/fetchUserPermissions';\nimport { \n  CompanyUser, \n  CompanyUsersFilter, \n  CompanyUserStatus \n} from '@/company-management/types';\n\nexport type FilterType = 'all' | 'active' | 'inactive';\n\n// Constants\nconst DEFAULT_PAGE_SIZE = 10;\nconst FIRST_PAGE = 1;\n\nexport interface UseCompanyUsersProps {\n  translations: {\n    ariaDataLoaded: string;\n    ariaDataError: string;\n  };\n}\n\nexport interface UseCompanyUsersReturn {\n  // Core data\n  users: CompanyUser[];\n  userPermissions: Set<string> | null;\n  \n  // Pagination state\n  currentPage: number;\n  pageSize: number;\n  totalItems: number;\n  totalPages: number;\n  \n  // Filter state\n  filterType: FilterType;\n  filter: CompanyUsersFilter | undefined;\n  \n  // Loading states\n  loading: boolean;\n  \n  // UI state\n  announcement: string;\n  \n  // Computed values\n  canEditUsers: boolean;\n  \n  // Actions\n  handleFilterChange: (newFilter: FilterType) => void;\n  handlePageSizeChange: (event: Event | { target?: { value: string } } | string) => void;\n  handlePreviousPage: () => void;\n  handleNextPage: () => void;\n  handlePageChange: (newPage: number) => void;\n  refreshUsers: () => Promise<void>;\n}\n\nexport const useCompanyUsers = ({ translations }: UseCompanyUsersProps): UseCompanyUsersReturn => {\n  const [users, setUsers] = useState<CompanyUser[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [currentPage, setCurrentPage] = useState(FIRST_PAGE);\n  const [pageSize, setPageSize] = useState(DEFAULT_PAGE_SIZE);\n  const [filterType, setFilterType] = useState<FilterType>('all');\n  const [totalItems, setTotalItems] = useState(0);\n  const [totalPages, setTotalPages] = useState(1);\n  const [announcement, setAnnouncement] = useState('');\n  const [userPermissions, setUserPermissions] = useState<Set<string> | null>(null);\n\n  // Stable reference to translations to prevent unnecessary re-renders\n  const translationsRef = useRef(translations);\n  translationsRef.current = translations;\n\n  // Memoized filter based on current filter type\n  const filter = useMemo((): CompanyUsersFilter | undefined => {\n    switch (filterType) {\n      case 'active':\n        return { status: 'ACTIVE' as CompanyUserStatus };\n      case 'inactive':\n        return { status: 'INACTIVE' as CompanyUserStatus };\n      default:\n        return undefined;\n    }\n  }, [filterType]);\n\n  // Fetch users data\n  const fetchUsers = useCallback(async () => {\n    setLoading(true);\n    try {\n      const response = await getCompanyUsers({\n        pageSize,\n        currentPage,\n        filter\n      });\n      \n      // Batch state updates for better performance\n      setUsers(response.users);\n      setTotalItems(response.totalCount || response.users.length);\n      setTotalPages(response.pageInfo.totalPages);\n      setAnnouncement(translationsRef.current.ariaDataLoaded.replace('{count}', response.users.length.toString()));\n    } catch (error) {\n      // Batch error state updates\n      setUsers([]);\n      setTotalItems(0);\n      setTotalPages(1);\n      setAnnouncement(translationsRef.current.ariaDataError);\n    } finally {\n      setLoading(false);\n    }\n  }, [pageSize, currentPage, filter]);\n\n  // Fetch user permissions\n  const fetchPermissions = useCallback(async () => {\n    try {\n      const { allowedIds } = await fetchUserPermissions();\n      setUserPermissions(allowedIds);\n    } catch (error) {\n      setUserPermissions(new Set()); // Empty set on error\n    }\n  }, []);\n\n  // Fetch users when dependencies change\n  useEffect(() => {\n    fetchUsers();\n  }, [fetchUsers]);\n\n  // Fetch permissions on component mount\n  useEffect(() => {\n    fetchPermissions();\n  }, [fetchPermissions]);\n\n  // Handle filter changes\n  const handleFilterChange = useCallback((newFilter: FilterType) => {\n    setFilterType(newFilter);\n    setCurrentPage(FIRST_PAGE); // Reset to first page when filter changes\n  }, []);\n\n  // Handle page size change\n  const handlePageSizeChange = useCallback((event: Event | { target?: { value: string } } | string) => {\n    let value: string;\n    if (typeof event === 'string') {\n      value = event;\n    } else if ('target' in event && event.target && 'value' in event.target) {\n      value = event.target.value;\n    } else {\n      return;\n    }\n    const newSize = parseInt(value, 10);\n    if (!isNaN(newSize)) {\n      setPageSize(newSize);\n      setCurrentPage(FIRST_PAGE); // Reset to first page when page size changes\n    }\n  }, []);\n\n  // Handle page navigation\n  const handlePreviousPage = useCallback(() => {\n    if (currentPage > 1) {\n      setCurrentPage(currentPage - 1);\n    }\n  }, [currentPage]);\n\n  const handleNextPage = useCallback(() => {\n    if (currentPage < totalPages) {\n      setCurrentPage(currentPage + 1);\n    }\n  }, [currentPage, totalPages]);\n\n  const handlePageChange = useCallback((newPage: number) => {\n    if (newPage >= 1 && newPage <= totalPages) {\n      setCurrentPage(newPage);\n    }\n  }, [totalPages]);\n\n  // Check if user has permission to edit company users\n  const canEditUsers = userPermissions?.has('Magento_Company::users_edit') || false;\n\n  // Expose refresh function for external use (e.g., after modal operations)\n  const refreshUsers = useCallback(async () => {\n    await fetchPermissions();\n    await fetchUsers();\n  }, [fetchPermissions, fetchUsers]);\n\n  return {\n    // Core data\n    users,\n    userPermissions,\n    \n    // Pagination state\n    currentPage,\n    pageSize,\n    totalItems,\n    totalPages,\n    \n    // Filter state\n    filterType,\n    filter,\n    \n    // Loading states\n    loading,\n    \n    // UI state\n    announcement,\n    \n    // Computed values\n    canEditUsers,\n    \n    // Actions\n    handleFilterChange,\n    handlePageSizeChange,\n    handlePreviousPage,\n    handleNextPage,\n    handlePageChange,\n    refreshUsers,\n  };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { useState, useCallback } from 'preact/hooks';\n\nexport interface UseModalResult {\n  isOpen: boolean;\n  selectedId: string | null;\n  open: (id?: string) => void;\n  close: () => void;\n}\n\nexport const useModal = (onClose?: () => void): UseModalResult => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [selectedId, setSelectedId] = useState<string | null>(null);\n\n  const open = useCallback((id?: string) => {\n    if (id) {\n      setSelectedId(id);\n    }\n    setIsOpen(true);\n  }, []);\n\n  const close = useCallback(() => {\n    setIsOpen(false);\n    setSelectedId(null);\n    onClose?.();\n  }, [onClose]);\n\n  return { isOpen, selectedId, open, close };\n};\n\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FunctionComponent } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\nimport { useState, useCallback, useEffect, useRef } from 'preact/hooks';\nimport { classes } from '@adobe-commerce/elsie/lib';\nimport { Button, InLineAlert } from '@adobe-commerce/elsie/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { deleteCompanyUser, updateCompanyUserStatus } from '@/company-management/api';\nimport type { CompanyUserStatus } from '@/company-management/types';\nimport { useInLineAlert, useCustomerCompanyInfo } from '@/company-management/hooks';\nimport '@/company-management/components/CompanyUsersManagementModal/CompanyUsersManagementModal.css';\n\nexport interface CompanyUsersManagementModalProps extends Omit<HTMLAttributes<HTMLDivElement>, 'onClose'> {\n  /** The ID of the user to manage */\n  userId: string;\n  /** The current status of the user */\n  userStatus: CompanyUserStatus;\n  /** Callback function called when the modal should be closed */\n  onClose: () => void;\n  /** Whether the modal is currently open */\n  isOpen?: boolean;\n  /** Callback for success messages */\n  onSuccess?: (message: string) => void;\n}\n\nexport const CompanyUsersManagementModal: FunctionComponent<CompanyUsersManagementModalProps> = ({\n  className,\n  userId,\n  userStatus,\n  onClose,\n  isOpen = false,\n  onSuccess,\n  ...props\n}) => {\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [isTogglingStatus, setIsTogglingStatus] = useState(false);\n  const { inLineAlertProps, showError, clearAlert } = useInLineAlert();\n  const { companyInfo } = useCustomerCompanyInfo();\n  \n  // Refs for accessibility\n  const modalRef = useRef<HTMLDivElement>(null);\n  const previousFocusRef = useRef<HTMLElement | null>(null);\n  const titleId = `modal-title-${userId}`;\n  const descriptionId = `modal-desc-${userId}`;\n\n  // Text translations\n  const translations = useText({\n    title: 'Company.CompanyUsers.managementModal.title',\n    setActiveText: 'Company.CompanyUsers.managementModal.setActiveText',\n    setInactiveText: 'Company.CompanyUsers.managementModal.setInactiveText',\n    deleteText: 'Company.CompanyUsers.managementModal.deleteText',\n    setActiveButton: 'Company.CompanyUsers.managementModal.setActiveButton',\n    setInactiveButton: 'Company.CompanyUsers.managementModal.setInactiveButton',\n    settingActiveButton: 'Company.CompanyUsers.managementModal.settingActiveButton',\n    settingInactiveButton: 'Company.CompanyUsers.managementModal.settingInactiveButton',\n    deleteButton: 'Company.CompanyUsers.managementModal.deleteButton',\n    deletingButton: 'Company.CompanyUsers.managementModal.deletingButton',\n    cancelButton: 'Company.CompanyUsers.managementModal.cancelButton',\n    setActiveErrorGeneric: 'Company.CompanyUsers.managementModal.setActiveErrorGeneric',\n    setActiveErrorSpecific: 'Company.CompanyUsers.managementModal.setActiveErrorSpecific',\n    setInactiveErrorGeneric: 'Company.CompanyUsers.managementModal.setInactiveErrorGeneric',\n    setInactiveErrorSpecific: 'Company.CompanyUsers.managementModal.setInactiveErrorSpecific',\n    deleteErrorGeneric: 'Company.CompanyUsers.managementModal.deleteErrorGeneric',\n    deleteErrorSpecific: 'Company.CompanyUsers.managementModal.deleteErrorSpecific',\n    setActiveSuccess: 'Company.CompanyUsers.managementModal.setActiveSuccess',\n    setInactiveSuccess: 'Company.CompanyUsers.managementModal.setInactiveSuccess',\n    deleteSuccess: 'Company.CompanyUsers.managementModal.deleteSuccess',\n    ariaCloseModal: 'Company.CompanyUsers.managementModal.ariaLabels.closeModal',\n    ariaModalDescription: 'Company.CompanyUsers.managementModal.ariaLabels.modalDescription',\n  });\n\n  const replaceCompanyNamePlaceholder = useCallback((message: string): string => {\n    const companyName = companyInfo?.companyName || '';\n    return message.replace(/%1/g, companyName);\n  }, [companyInfo?.companyName]);\n\n  const handleToggleStatus = useCallback(async () => {\n    if (isTogglingStatus) return;\n    \n    const newStatus = userStatus === 'ACTIVE' ? 'INACTIVE' : 'ACTIVE';\n    const isActivating = newStatus === 'ACTIVE';\n    \n    setIsTogglingStatus(true);\n    clearAlert();\n    try {\n      const result = await updateCompanyUserStatus({ id: userId, status: newStatus });\n      if (result.success) {\n        const successMsg = isActivating ? translations.setActiveSuccess : translations.setInactiveSuccess;\n        if (onSuccess) {\n          onSuccess(successMsg);\n        }\n        onClose();\n      } else {\n        const errorMsg = isActivating ? translations.setActiveErrorSpecific : translations.setInactiveErrorSpecific;\n        showError(replaceCompanyNamePlaceholder(errorMsg));\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : (isActivating ? translations.setActiveErrorGeneric : translations.setInactiveErrorGeneric);\n      showError(replaceCompanyNamePlaceholder(errorMessage));\n    } finally {\n      setIsTogglingStatus(false);\n    }\n  }, [userId, userStatus, onClose, isTogglingStatus, clearAlert, showError, replaceCompanyNamePlaceholder, translations.setActiveErrorSpecific, translations.setInactiveErrorSpecific, translations.setActiveErrorGeneric, translations.setInactiveErrorGeneric, translations.setActiveSuccess, translations.setInactiveSuccess, onSuccess]);\n\n  const handleDelete = useCallback(async () => {\n    if (isDeleting) return;\n    \n    setIsDeleting(true);\n    clearAlert();\n    try {\n      const result = await deleteCompanyUser({ id: userId });\n      if (result.success) {\n        if (onSuccess) {\n          onSuccess(translations.deleteSuccess);\n        }\n        onClose();\n      } else {\n        showError(replaceCompanyNamePlaceholder(translations.deleteErrorSpecific));\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : translations.deleteErrorGeneric;\n      showError(replaceCompanyNamePlaceholder(errorMessage));\n    } finally {\n      setIsDeleting(false);\n    }\n  }, [userId, onClose, isDeleting, clearAlert, showError, replaceCompanyNamePlaceholder, translations.deleteErrorSpecific, translations.deleteErrorGeneric, translations.deleteSuccess, onSuccess]);\n\n  const handleCancel = useCallback(() => {\n    clearAlert();\n    onClose();\n  }, [onClose, clearAlert]);\n\n  // Handle Escape key\n  const handleKeyDown = useCallback((event: KeyboardEvent) => {\n    if (event.key === 'Escape') {\n      clearAlert();\n      onClose();\n    }\n    \n    // Focus trapping\n    if (event.key === 'Tab') {\n      const modal = modalRef.current;\n      if (!modal) return;\n      \n      const focusableElements = modal.querySelectorAll(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n      );\n      const firstElement = focusableElements[0] as HTMLElement;\n      const lastElement = focusableElements[focusableElements.length - 1] as HTMLElement;\n      \n      if (event.shiftKey) {\n        // Shift + Tab\n        if (document.activeElement === firstElement) {\n          lastElement.focus();\n          event.preventDefault();\n        }\n      } else if (document.activeElement === lastElement) {\n        // Tab\n        firstElement.focus();\n        event.preventDefault();\n      }\n    }\n  }, [onClose, clearAlert]);\n\n  const handleOverlayClick = useCallback((event: MouseEvent) => {\n    if (event.target === event.currentTarget) {\n      clearAlert();\n      onClose();\n    }\n  }, [onClose, clearAlert]);\n\n  const handleCloseClick = useCallback(() => {\n    clearAlert();\n    onClose();\n  }, [onClose, clearAlert]);\n\n  // Focus management and event listeners\n  useEffect(() => {\n    if (isOpen) {\n      // Store current focus\n      previousFocusRef.current = document.activeElement as HTMLElement;\n      \n      // Add keyboard event listener\n      document.addEventListener('keydown', handleKeyDown);\n      \n      // Focus the modal after a brief delay to ensure it's rendered\n      setTimeout(() => {\n        const modal = modalRef.current;\n        if (modal) {\n          const firstButton = modal.querySelector('button') as HTMLElement;\n          if (firstButton) {\n            firstButton.focus();\n          } else {\n            modal.focus();\n          }\n        }\n      }, 100);\n      \n      return () => {\n        document.removeEventListener('keydown', handleKeyDown);\n      };\n    }\n    \n    // Restore focus when modal closes\n    if (previousFocusRef.current) {\n      previousFocusRef.current.focus();\n    }\n  }, [isOpen, handleKeyDown]);\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <div \n      className={classes(['company-management-company-users-management-modal-overlay', className])}\n      onClick={handleOverlayClick}\n      {...props}\n    >\n      <div \n        ref={modalRef}\n        className=\"company-management-company-users-management-modal\"\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-labelledby={titleId}\n        aria-describedby={descriptionId}\n        tabIndex={-1}\n      >\n        <div className=\"company-management-company-users-management-modal__header\">\n          <h2 \n            id={titleId}\n            className=\"company-management-company-users-management-modal__title\"\n          >\n            {translations.title}\n          </h2>\n          <button\n            className=\"company-management-company-users-management-modal__close\"\n            onClick={handleCloseClick}\n            aria-label={translations.ariaCloseModal}\n          >\n            Ã—\n          </button>\n        </div>\n        \n        <div \n          id={descriptionId}\n          className=\"company-management-company-users-management-modal__content\"\n        >\n          <p className=\"company-management-company-users-management-modal__text\">\n            {userStatus === 'ACTIVE' ? translations.setInactiveText : translations.setActiveText}\n          </p>\n          <p className=\"company-management-company-users-management-modal__text\">\n            {translations.deleteText}\n          </p>\n        </div>\n\n        {inLineAlertProps?.text && (\n          <div \n            className=\"company-management-company-users-management-modal__alert\"\n            role=\"alert\"\n            aria-live=\"assertive\"\n          >\n            <InLineAlert\n              type=\"error\"\n              heading={inLineAlertProps.text}\n              icon={inLineAlertProps.icon}\n              data-testid=\"companyUsersManagementModalAlert\"\n            />\n          </div>\n        )}\n\n        <div className=\"company-management-company-users-management-modal__actions\">\n          <Button\n            variant=\"primary\"\n            onClick={handleToggleStatus}\n            disabled={isTogglingStatus}\n            className=\"company-management-company-users-management-modal__button-primary\"\n          >\n            {isTogglingStatus \n              ? (userStatus === 'ACTIVE' ? translations.settingInactiveButton : translations.settingActiveButton)\n              : (userStatus === 'ACTIVE' ? translations.setInactiveButton : translations.setActiveButton)\n            }\n          </Button>\n          \n          <Button\n            variant=\"tertiary\"\n            onClick={handleDelete}\n            disabled={isDeleting}\n            className=\"company-management-company-users-management-modal__button-delete\"\n          >\n            {isDeleting ? translations.deletingButton : translations.deleteButton}\n          </Button>\n          \n          <Button\n            variant=\"secondary\"\n            onClick={handleCancel}\n            className=\"company-management-company-users-management-modal__button-cancel\"\n          >\n            {translations.cancelButton}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { HTMLAttributes } from 'preact/compat';\nimport { useCallback, useRef, useMemo } from 'preact/hooks';\nimport { Container } from '@adobe-commerce/elsie/lib';\nimport { \n  Button, \n  Picker,\n  Modal,\n  InLineAlert,\n  ActionButton,\n  Pagination\n} from '@adobe-commerce/elsie/components';\nimport { Table } from '@adobe-commerce/elsie/components/Table/Table';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { formatUserStatus, formatUserName, decodeUserId } from '@/company-management/lib';\nimport { CompanyUserStatus } from '@/company-management/types';\nimport { CompanyUserForm } from '@/company-management/components/CompanyUserForm';\nimport { CompanyUsersManagementModal } from '@/company-management/components/CompanyUsersManagementModal';\nimport { CompanyUsersFilters } from '@/company-management/components/CompanyUsersFilters';\nimport { useCompanyUsers, useModal, useCompanyContextListener, useUserPermissions, useInLineAlert } from '@/company-management/hooks';\nimport './CompanyUsers.css';\n\nexport interface CompanyUsersProps extends HTMLAttributes<HTMLElement> {}\n\n// Constants\nconst PAGE_SIZE_OPTIONS = [\n  { text: '10', value: '10' },\n  { text: '20', value: '20' },\n  { text: '50', value: '50' },\n  { text: '100', value: '100' }\n];\n\nexport const CompanyUsers: Container<CompanyUsersProps> = ({ children, className, ...props }) => {\n  // Get user permissions\n  const { permissions } = useUserPermissions();\n\n  // Text translations using proper useText pattern\n  const translations = useText({\n    showAllUsers: 'Company.CompanyUsers.filters.showAll',\n    showActiveUsers: 'Company.CompanyUsers.filters.showActive',\n    showInactiveUsers: 'Company.CompanyUsers.filters.showInactive',\n    idColumn: 'Company.CompanyUsers.columns.id',\n    nameColumn: 'Company.CompanyUsers.columns.name',\n    emailColumn: 'Company.CompanyUsers.columns.email',\n    roleColumn: 'Company.CompanyUsers.columns.role',\n    teamColumn: 'Company.CompanyUsers.columns.team',\n    statusColumn: 'Company.CompanyUsers.columns.status',\n    actionsColumn: 'Company.CompanyUsers.columns.actions',\n    statusActive: 'Company.CompanyUsers.status.active',\n    statusInactive: 'Company.CompanyUsers.status.inactive',\n    emptyTeam: 'Company.CompanyUsers.emptyTeam',\n    emptyActions: 'Company.CompanyUsers.emptyActions',\n    itemsRange: 'Company.CompanyUsers.pagination.itemsRange',\n    itemsPerPageLabel: 'Company.CompanyUsers.pagination.itemsPerPage',\n    showLabel: 'Company.CompanyUsers.pagination.show',\n    previousPage: 'Company.CompanyUsers.pagination.previous',\n    nextPage: 'Company.CompanyUsers.pagination.next',\n    pageInfo: 'Company.CompanyUsers.pagination.pageInfo',\n    // Accessibility labels\n    ariaUsersTable: 'Company.CompanyUsers.ariaLabels.usersTable',\n    ariaFilterOptions: 'Company.CompanyUsers.ariaLabels.filterOptions',\n    ariaPaginationNav: 'Company.CompanyUsers.ariaLabels.paginationNav',\n    ariaPageSizeSelector: 'Company.CompanyUsers.ariaLabels.pageSizeSelector',\n    ariaPreviousPageFull: 'Company.CompanyUsers.ariaLabels.previousPageFull',\n    ariaNextPageFull: 'Company.CompanyUsers.ariaLabels.nextPageFull',\n    ariaCurrentPage: 'Company.CompanyUsers.ariaLabels.currentPage',\n    ariaShowingUsers: 'Company.CompanyUsers.ariaLabels.showingUsers',\n    ariaDataLoaded: 'Company.CompanyUsers.ariaLabels.dataLoaded',\n    ariaDataError: 'Company.CompanyUsers.ariaLabels.dataError',\n    ariaPageNavigation: 'Company.CompanyUsers.ariaLabels.pageNavigation',\n    manageUser: 'Company.CompanyUsers.actions.manage',\n    editUser: 'Company.CompanyUsers.actions.edit',\n    ariaManageUser: 'Company.CompanyUsers.ariaLabels.manageUser',\n    ariaEditUser: 'Company.CompanyUsers.ariaLabels.editUser',\n    addNewUser: 'Company.CompanyUsers.actions.addNewUser',\n    noUsersFound: 'Company.CompanyUsers.noUsersFound'\n  });\n\n  // Use the company users hook to manage all user data and pagination\n  const {\n    users,\n    loading,\n    currentPage,\n    pageSize,\n    filterType,\n    totalItems,\n    totalPages,\n    announcement,\n    canEditUsers,\n    handleFilterChange,\n    handlePageSizeChange,\n    handlePageChange,\n    refreshUsers\n  } = useCompanyUsers({\n    translations: {\n      ariaDataLoaded: translations.ariaDataLoaded,\n      ariaDataError: translations.ariaDataError\n    }\n  });\n\n  // Stable reference to translations to prevent unnecessary re-renders\n  const translationsRef = useRef(translations);\n  translationsRef.current = translations;\n\n  // Handle company context changes using reusable hook\n  const handleCompanyContextChange = useCallback(() => {\n    refreshUsers();\n  }, [refreshUsers]);\n\n  useCompanyContextListener(handleCompanyContextChange);\n\n  // Modal management using useModal hook\n  const manageModal = useModal(refreshUsers);\n  const editModal = useModal(refreshUsers);\n  const addModal = useModal(refreshUsers);\n\n  // Alert management for displaying errors\n  const { inLineAlertProps, handleSetInLineAlert } = useInLineAlert();\n\n  // Prepare table columns - memoized to prevent unnecessary re-renders (optimized)\n  const columns = useMemo(() => {\n    const currentTranslations = translationsRef.current;\n    return [\n      { key: 'id', label: currentTranslations.idColumn },\n      { key: 'name', label: currentTranslations.nameColumn },\n      { key: 'email', label: currentTranslations.emailColumn },\n      { key: 'role', label: currentTranslations.roleColumn },\n      { key: 'team', label: currentTranslations.teamColumn },\n      { key: 'status', label: currentTranslations.statusColumn },\n      { key: 'actions', label: currentTranslations.actionsColumn }\n    ];\n  }, []); // No dependencies - only recompute when component mounts\n\n\n  // Prepare table row data - memoized for performance (optimized)\n  const rowData = useMemo(() => users.map((user) => {\n    const fullName = formatUserName(user.firstName, user.lastName);\n    const currentTranslations = translationsRef.current;\n    \n    // Decode ID for display only (base64 -> plain text)\n    const displayId = decodeUserId(user.id);\n    \n    return {\n      id: displayId,\n      name: fullName,\n      email: user.email,\n      role: user.role,\n      team: user.team || currentTranslations.emptyTeam,\n      status: formatUserStatus(user.status, currentTranslations),\n      actions: canEditUsers ? (\n        <div className=\"user-actions\">\n          <ActionButton\n            onClick={() => editModal.open(user.id)}\n            aria-label={currentTranslations.ariaEditUser.replace('{name}', fullName)}\n            className=\"edit-user-button\"\n          >\n            {currentTranslations.editUser}\n          </ActionButton>\n          <ActionButton\n            onClick={() => manageModal.open(user.id)}\n            aria-label={currentTranslations.ariaManageUser.replace('{name}', fullName)}\n            className=\"manage-user-button\"\n          >\n            {currentTranslations.manageUser}\n          </ActionButton>\n        </div>\n      ) : (\n        <span className=\"no-actions\">{currentTranslations.emptyActions}</span>\n      )\n    };\n  }), [users, canEditUsers, editModal, manageModal]);\n\n  // Memoize selected user for performance\n  const selectedUser = useMemo(() => \n    users.find(user => user.id === manageModal.selectedId),\n    [users, manageModal.selectedId]\n  );\n\n  return (\n    <section className={className} {...props}>\n      {/* Screen reader announcements */}\n      <div className=\"sr-only\" role=\"status\" aria-live=\"polite\" aria-atomic=\"true\">\n        {announcement}\n      </div>\n\n      {/* Filter buttons */}\n      <CompanyUsersFilters\n        filterType={filterType}\n        onFilterChange={handleFilterChange}\n        translations={{\n          showAllUsers: translations.showAllUsers,\n          showActiveUsers: translations.showActiveUsers,\n          showInactiveUsers: translations.showInactiveUsers,\n          ariaFilterOptions: translations.ariaFilterOptions\n        }}\n      />\n\n      {/* Alert messages */}\n      {inLineAlertProps && inLineAlertProps.text ? (\n        <InLineAlert\n          className=\"company-users__alert\"\n          type={inLineAlertProps.type || 'success'}\n          variant=\"secondary\"\n          heading={inLineAlertProps.text}\n          icon={inLineAlertProps.icon}\n        />\n      ) : null}\n\n      {/* Table with loading state */}\n      <div aria-busy={loading}>\n        <Table\n          className=\"companyUsersTable\"\n          columns={columns}\n          rowData={rowData}\n          mobileLayout=\"stacked\"\n          loading={loading}\n          aria-label={translations.ariaUsersTable}\n          summary={translations.ariaShowingUsers.replace('{count}', users.length.toString())}\n        />\n        {!loading && users.length === 0 && (\n          <div className=\"companyUsersTable__empty\">\n            {translations.noUsersFound}\n          </div>\n        )}\n      </div>\n\n      {/* Pagination controls (only show when there are users) */}\n      {users.length > 0 && (\n        <nav aria-label={translations.ariaPaginationNav} className=\"paginationContainer\">\n          {/* Items count on the left */}\n          <div aria-live=\"polite\" aria-atomic=\"true\">\n            {(() => {\n              const startItem = totalItems === 0 ? 0 : (currentPage - 1) * pageSize + 1;\n              const endItem = Math.min(currentPage * pageSize, totalItems);\n              return translations.itemsRange\n                .replace('{start}', startItem.toString())\n                .replace('{end}', endItem.toString())\n                .replace('{total}', totalItems.toString());\n            })()}\n          </div>\n\n          {/* Pagination component in the center (only show when multiple pages) */}\n          {totalPages > 1 && (\n            <Pagination\n              currentPage={currentPage}\n              totalPages={totalPages}\n              onChange={handlePageChange}\n              className=\"paginationButtons\"\n            />\n          )}\n\n          {/* Page size picker on the right */}\n          <div className=\"pageSizeSelector\">\n            <label htmlFor=\"page-size-select\" id=\"page-size-label\">\n              <span>{translations.showLabel}</span>\n            </label>\n            <Picker\n              id=\"page-size-select\"\n              name=\"pageSize\"\n              value={pageSize.toString()}\n              options={PAGE_SIZE_OPTIONS}\n              onChange={handlePageSizeChange}\n              aria-labelledby=\"page-size-label\"\n              aria-label={translations.ariaPageSizeSelector || translations.itemsPerPageLabel || 'Items per page'}\n            />\n          </div>\n        </nav>\n      )}\n\n      {/* Add New User Button */}\n      {canEditUsers && (\n        <div className=\"addUserButtonContainer\">\n          <Button\n            variant=\"primary\"\n            onClick={() => addModal.open()}\n            aria-label={translations.addNewUser}\n          >\n            {translations.addNewUser}\n          </Button>\n        </div>\n      )}\n\n      {children}\n\n      {/* User Add Modal (for adding new user) */}\n      {addModal.isOpen && canEditUsers && (\n        <Modal\n          open={addModal.isOpen}\n          onClose={addModal.close}\n          size=\"medium\"\n        >\n          <CompanyUserForm\n            mode=\"add\"\n            entityId={undefined}\n            parentStructureId={undefined}\n            permissions={permissions}\n            onSaved={addModal.close}\n            onCancel={addModal.close}\n            onError={(error) => {\n              handleSetInLineAlert({ text: error, type: 'error' });\n            }}\n            onSuccess={(message) => {\n              handleSetInLineAlert({ text: message, type: 'success' });\n            }}\n          />\n        </Modal>\n      )}\n\n      {/* User Edit Modal (for editing user information) */}\n      {editModal.selectedId && editModal.isOpen && canEditUsers && (\n        <Modal\n          open={editModal.isOpen}\n          onClose={editModal.close}\n          size=\"medium\"\n        >\n          <CompanyUserForm\n            mode=\"edit\"\n            entityId={editModal.selectedId}\n            parentStructureId={undefined}\n            permissions={permissions}\n            onSaved={editModal.close}\n            onCancel={editModal.close}\n            onError={(error) => {\n              handleSetInLineAlert({ text: error, type: 'error' });\n            }}\n            onSuccess={(message) => {\n              handleSetInLineAlert({ text: message, type: 'success' });\n            }}\n          />\n        </Modal>\n      )}\n\n      {/* User Management Modal (for status changes and deletion) */}\n      {manageModal.selectedId && canEditUsers && selectedUser && (\n        <CompanyUsersManagementModal\n          isOpen={manageModal.isOpen}\n          userId={manageModal.selectedId}\n          userStatus={(selectedUser.status as CompanyUserStatus) || 'ACTIVE'}\n          onClose={manageModal.close}\n          onSuccess={(message) => {\n            handleSetInLineAlert({ text: message, type: 'success' });\n          }}\n        />\n      )}\n    </section>\n  );\n};\n"],"names":["decodeBase64","encoded","decodeUserId","encodedUserId","formatUserStatus","status","translations","formatUserName","firstName","lastName","first","last","CompanyUsersFilters","filterType","onFilterChange","filters","filter","jsx","Button","DEFAULT_PAGE_SIZE","FIRST_PAGE","useCompanyUsers","users","setUsers","useState","loading","setLoading","currentPage","setCurrentPage","pageSize","setPageSize","setFilterType","totalItems","setTotalItems","totalPages","setTotalPages","announcement","setAnnouncement","userPermissions","setUserPermissions","translationsRef","useRef","useMemo","fetchUsers","useCallback","response","getCompanyUsers","fetchPermissions","allowedIds","fetchUserPermissions","useEffect","handleFilterChange","newFilter","handlePageSizeChange","event","value","newSize","handlePreviousPage","handleNextPage","handlePageChange","newPage","canEditUsers","refreshUsers","useModal","onClose","isOpen","setIsOpen","selectedId","setSelectedId","open","id","close","CompanyUsersManagementModal","className","userId","userStatus","onSuccess","props","isDeleting","setIsDeleting","isTogglingStatus","setIsTogglingStatus","inLineAlertProps","showError","clearAlert","useInLineAlert","companyInfo","useCustomerCompanyInfo","modalRef","previousFocusRef","titleId","descriptionId","useText","replaceCompanyNamePlaceholder","message","companyName","handleToggleStatus","newStatus","isActivating","updateCompanyUserStatus","successMsg","errorMsg","error","errorMessage","handleDelete","deleteCompanyUser","handleCancel","handleKeyDown","modal","focusableElements","firstElement","lastElement","handleOverlayClick","handleCloseClick","firstButton","classes","jsxs","InLineAlert","PAGE_SIZE_OPTIONS","CompanyUsers","children","permissions","useUserPermissions","handleCompanyContextChange","useCompanyContextListener","manageModal","editModal","addModal","handleSetInLineAlert","columns","currentTranslations","rowData","user","fullName","ActionButton","selectedUser","Table","startItem","endItem","Pagination","Picker","Modal","CompanyUserForm"],"mappings":"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"}