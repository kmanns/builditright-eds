{"version":3,"file":"api.js","sources":["/@dropins/storefront-company-management/src/api/companyRoles/getCompanyRole.ts","/@dropins/storefront-company-management/src/api/companyRoles/utils.ts","/@dropins/storefront-company-management/src/api/initialize/initialize.ts","/@dropins/storefront-company-management/src/api/checkCompanyCreditEnabled/graphql/checkCompanyCreditEnabled.graphql.ts","/@dropins/storefront-company-management/src/api/checkCompanyCreditEnabled/checkCompanyCreditEnabled.ts","/@dropins/storefront-company-management/src/types/api/getCompanyCreditHistoryParams.types.ts","/@dropins/storefront-company-management/src/api/isCompanyAdmin/graphql/isCompanyAdmin.graphql.ts","/@dropins/storefront-company-management/src/api/isCompanyAdmin/isCompanyAdmin.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { fetchGraphQl } from '../fetch-graphql';\nimport { handleNetworkError } from '../../lib/network-error';\nimport { GET_COMPANY_ROLE } from './graphql/queries';\nimport { GetCompanyRoleVariables, GetCompanyRoleResponse } from '../../types/api/companyRoles.types';\nimport { CompanyRoleModel } from '../../data/models/company-role';\nimport { transformGetCompanyRoleResponse } from '../../data/transforms/transform-company-roles';\n\n/**\n * Retrieves complete details for a specific company role by ID.\n * \n * Returns role name, assigned user count, and the complete permission tree\n * structure with this role's granted permissions. Used when editing an\n * existing role or viewing role details.\n * \n * **Permissions Required:**\n * - `Magento_Company::roles_view` (minimum) - To view role details\n * - `Magento_Company::roles_edit` - To modify the role (additional permission)\n * \n * @param variables - Query parameters containing the role ID\n * @returns Promise resolving to complete role details including permissions\n * @throws Error if network request fails, user lacks permission, or role not found\n * \n * @example\n * ```typescript\n * const role = await getCompanyRole({ id: 'cm9sZS8xMjM=' });\n * console.log(`Role: ${role.name}`);\n * console.log(`Users: ${role.usersCount}`);\n * console.log(`Permissions: ${role.permissions.length} categories`);\n * ```\n */\nexport const getCompanyRole = async (\n  variables: GetCompanyRoleVariables\n): Promise<CompanyRoleModel> => {\n  try {\n    const response: GetCompanyRoleResponse = await fetchGraphQl(GET_COMPANY_ROLE, {\n      variables,\n      method: 'GET',\n      cache: 'no-cache',\n    });\n\n    return transformGetCompanyRoleResponse(response);\n  } catch (error) {\n    return handleNetworkError(error as Error);\n  }\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { flattenIdsToArray } from '../../lib/company-permissions';\nimport { CompanyAclResourceModel } from '../../data/models/company-role';\n\n/**\n * Helper function to flatten ACL resources into a list of permission IDs\n */\nexport const flattenPermissionIds = (resources: CompanyAclResourceModel[]): string[] => {\n  return flattenIdsToArray(resources);\n};\n\n/**\n * Helper function to build a permission tree from flat permission IDs\n */\nexport const buildPermissionTree = (\n  allResources: CompanyAclResourceModel[],\n  selectedIds: string[]\n): CompanyAclResourceModel[] => {\n  const selectedSet = new Set(selectedIds);\n  \n  const filterTree = (resource: CompanyAclResourceModel): CompanyAclResourceModel | null => {\n    const filteredChildren = resource.children\n      ?.map(filterTree)\n      .filter((child): child is CompanyAclResourceModel => child !== null) || [];\n    \n    if (selectedSet.has(resource.id) || filteredChildren.length > 0) {\n      return {\n        ...resource,\n        children: filteredChildren,\n      };\n    }\n    \n    return null;\n  };\n  \n  return allResources\n    .map(filterTree)\n    .filter((resource): resource is CompanyAclResourceModel => resource !== null);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n// import { events } from '@adobe-commerce/event-bus';\n\n\nimport { CompanyDropinConfig } from '../../types/api/initialize.types';\n\nexport const initialize = async (config: CompanyDropinConfig = {}) => {\n  return {\n    success: true,\n    config,\n  };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const CHECK_COMPANY_CREDIT_ENABLED = /* GraphQL */ `\n query CHECK_COMPANY_CREDIT_ENABLED {\n   storeConfig{\n     company_credit_enabled\n   }\n  }\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CHECK_COMPANY_CREDIT_ENABLED } from \"./graphql/checkCompanyCreditEnabled.graphql\";\nimport { CheckCompanyCreditEnabledResponse } from '../../types/api/checkCompanyCreditEnabled.types';\nimport { fetchGraphQl } from '../fetch-graphql';\n\nexport const checkCompanyCreditEnabled = async (): Promise<CheckCompanyCreditEnabledResponse> => {\n  try {\n    const response = await fetchGraphQl(CHECK_COMPANY_CREDIT_ENABLED, {\n      method: 'GET',\n      cache: 'no-cache',\n    });\n\n    // If there are errors, return false with error message\n    if (response.errors?.length) {\n      return {\n        creditEnabled: false,\n        error: 'Unable to check company credit configuration'\n      };\n    }\n\n    // Check if company credit is enabled in store config\n    const companyCreditEnabled = response.data?.storeConfig?.company_credit_enabled;\n    \n    if (companyCreditEnabled === true) {\n      return {\n        creditEnabled: true\n      };\n    }\n\n    // If company credit is disabled or not configured\n    return {\n      creditEnabled: false,\n      error: 'Company credit is not enabled in store configuration'\n    };\n\n  } catch (error) {\n    return {\n      creditEnabled: false,\n      error: 'Company credit functionality not available'\n    };\n  }\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport enum CompanyCreditOperationType {\n  ALLOCATION = 'ALLOCATION',\n  UPDATE = 'UPDATE',\n  PURCHASE = 'PURCHASE',\n  REIMBURSEMENT = 'REIMBURSEMENT'\n}\n\nexport interface CompanyCreditHistoryFilterInput {\n  /**\n   * The purchase order number associated with the company credit operation.\n   */\n  customReferenceNumber?: string;\n\n  /**\n   * The type of the company credit operation.\n   */\n  operationType?: CompanyCreditOperationType;\n\n  /**\n   * The name of the person submitting the company credit operation.\n   */\n  updatedBy?: string;\n}\n\nexport interface GetCompanyCreditHistoryParams {\n  /**\n   * Filter criteria for narrowing the results of a credit history search.\n   */\n  filter?: CompanyCreditHistoryFilterInput;\n\n  /**\n   * Number of items to return per page.\n   * @default 20\n   */\n  pageSize?: number;\n\n  /**\n   * Current page number.\n   * @default 1\n   */\n  currentPage?: number;\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const GET_CUSTOMER_COMPANIES_WITH_ROLES = /* GraphQL */ `\n  query GET_CUSTOMER_COMPANIES_WITH_ROLES {\n    customer {\n      companies(input: {}) {\n        items {\n          id\n          name\n        }\n      }\n      role {\n        id\n        name\n      }\n    }\n  }\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n  \nimport { fetchGraphQl } from '../fetch-graphql';\nimport { GET_CUSTOMER_COMPANIES_WITH_ROLES } from './graphql/isCompanyAdmin.graphql';\n\ninterface CompanyRole {\n  id: string;\n  name: string;\n}\n\ninterface CompanyBasicInfo {\n  id: string;\n  name: string;\n}\n\ninterface CustomerCompaniesWithRolesResponse {\n  customer: {\n    companies: {\n      items: CompanyBasicInfo[];\n    };\n    role: CompanyRole | null;\n  } | null;\n}\n\n/**\n * Check if the current authenticated customer is a company administrator in any company\n * @returns Promise<boolean> - true if customer is a company admin in at least one company, false otherwise\n */\nexport const isCompanyAdmin = async (): Promise<boolean> => {\n  try {\n    const response = await fetchGraphQl<CustomerCompaniesWithRolesResponse>(GET_CUSTOMER_COMPANIES_WITH_ROLES, {\n      method: 'POST',\n    });\n\n    if (response.errors?.length) {\n      return false;\n    }\n\n    const customer = response.data?.customer;\n    if (!customer) {\n      return false;\n    }\n\n    // Check if user is part of at least one company\n    const companies = customer.companies?.items ?? [];\n    if (!Array.isArray(companies) || companies.length === 0) {\n      return false;\n    }\n\n    // Check if user has admin role\n    const customerRole = customer.role;\n    if (!customerRole) {\n      return false;\n    }\n\n    // Check if user is company administrator by role ID or name\n    return customerRole.id === '0' || \n           (typeof customerRole.id === 'number' && customerRole.id === 0) ||\n           customerRole.name === 'Company Administrator';\n  } catch (error) {\n    console.error('Error checking if customer is company admin:', error);\n    return false;\n  }\n};\n"],"names":["getCompanyRole","variables","response","fetchGraphQl","GET_COMPANY_ROLE","transformGetCompanyRoleResponse","error","handleNetworkError","flattenPermissionIds","resources","flattenIdsToArray","buildPermissionTree","allResources","selectedIds","selectedSet","filterTree","resource","filteredChildren","_a","child","initialize","config","CHECK_COMPANY_CREDIT_ENABLED","checkCompanyCreditEnabled","_c","_b","CompanyCreditOperationType","GET_CUSTOMER_COMPANIES_WITH_ROLES","isCompanyAdmin","customer","companies","customerRole"],"mappings":"ooCA+CO,MAAMA,EAAiB,MAC5BC,GAC8B,CAC9B,GAAI,CACF,MAAMC,EAAmC,MAAMC,EAAaC,EAAkB,CAC5E,UAAAH,EACA,OAAQ,MACR,MAAO,UAAA,CACR,EAED,OAAOI,EAAgCH,CAAQ,CACjD,OAASI,EAAO,CACd,OAAOC,EAAmBD,CAAc,CAC1C,CACF,ECtCaE,EAAwBC,GAC5BC,EAAkBD,CAAS,EAMvBE,EAAsB,CACjCC,EACAC,IAC8B,CAC9B,MAAMC,EAAc,IAAI,IAAID,CAAW,EAEjCE,EAAcC,GAAsE,OACxF,MAAMC,IAAmBC,EAAAF,EAAS,WAAT,YAAAE,EACrB,IAAIH,GACL,OAAQI,GAA4CA,IAAU,QAAS,CAAA,EAE1E,OAAIL,EAAY,IAAIE,EAAS,EAAE,GAAKC,EAAiB,OAAS,EACrD,CACL,GAAGD,EACH,SAAUC,CAAA,EAIP,IACT,EAEA,OAAOL,EACJ,IAAIG,CAAU,EACd,OAAQC,GAAkDA,IAAa,IAAI,CAChF,EChCaI,EAAa,MAAOC,EAA8B,MACtD,CACL,QAAS,GACT,OAAAA,CAAA,GCRSC,EAA6C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECI7CC,EAA4B,SAAwD,WAC/F,GAAI,CACF,MAAMrB,EAAW,MAAMC,EAAamB,EAA8B,CAChE,OAAQ,MACR,MAAO,UAAA,CACR,EAGD,OAAIJ,EAAAhB,EAAS,SAAT,MAAAgB,EAAiB,OACZ,CACL,cAAe,GACf,MAAO,8CAAA,IAKkBM,GAAAC,EAAAvB,EAAS,OAAT,YAAAuB,EAAe,cAAf,YAAAD,EAA4B,0BAE5B,GACpB,CACL,cAAe,EAAA,EAKZ,CACL,cAAe,GACf,MAAO,sDAAA,CAGX,MAAgB,CACd,MAAO,CACL,cAAe,GACf,MAAO,4CAAA,CAEX,CACF,ECxCO,IAAKE,GAAAA,IACVA,EAAA,WAAa,aACbA,EAAA,OAAS,SACTA,EAAA,SAAW,WACXA,EAAA,cAAgB,gBAJNA,IAAAA,GAAA,CAAA,CAAA,ECAL,MAAMC,EAAkD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EC0BlDC,EAAiB,SAA8B,WAC1D,GAAI,CACF,MAAM1B,EAAW,MAAMC,EAAiDwB,EAAmC,CACzG,OAAQ,MAAA,CACT,EAED,IAAIT,EAAAhB,EAAS,SAAT,MAAAgB,EAAiB,OACnB,MAAO,GAGT,MAAMW,GAAWJ,EAAAvB,EAAS,OAAT,YAAAuB,EAAe,SAChC,GAAI,CAACI,EACH,MAAO,GAIT,MAAMC,IAAYN,EAAAK,EAAS,YAAT,YAAAL,EAAoB,QAAS,CAAA,EAC/C,GAAI,CAAC,MAAM,QAAQM,CAAS,GAAKA,EAAU,SAAW,EACpD,MAAO,GAIT,MAAMC,EAAeF,EAAS,KAC9B,OAAKE,EAKEA,EAAa,KAAO,KACnB,OAAOA,EAAa,IAAO,UAAYA,EAAa,KAAO,GAC5DA,EAAa,OAAS,wBANpB,EAOX,OAASzB,EAAO,CACd,eAAQ,MAAM,+CAAgDA,CAAK,EAC5D,EACT,CACF"}