{"version":3,"file":"createCompany.js","sources":["/@dropins/storefront-company-management/src/api/getStoreConfig/graphql/getStoreConfig.graphql.ts","/@dropins/storefront-company-management/src/api/getStoreConfig/getStoreConfig.ts","/@dropins/storefront-company-management/src/data/transforms/transform-store-config.ts","/@dropins/storefront-company-management/src/api/createCompany/graphql/createCompany.graphql.ts","/@dropins/storefront-company-management/src/data/transforms/company.ts","/@dropins/storefront-company-management/src/api/createCompany/createCompany.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const GET_STORE_CONFIG_QUERY = /* GraphQL */ `\n    query getStoreConfig {\n        storeConfig {\n            default_country\n            store_code\n        }\n    }\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { fetchGraphQl } from '../fetch-graphql';\nimport { GET_STORE_CONFIG_QUERY } from './graphql/getStoreConfig.graphql';\nimport { handleNetworkError } from '@/company-management/lib/network-error';\nimport { handleFetchError } from '@/company-management/lib/fetch-error';\nimport { GetStoreConfigResponse, StoreConfigModel } from '@/company-management/types';\nimport { transformStoreConfig } from '@/company-management/data/transforms';\n\nexport const DEFAULT_COUNTRY = 'US';\n\nexport const STORE_CONFIG_DEFAULTS: StoreConfigModel = {\n  defaultCountry: DEFAULT_COUNTRY,\n  storeCode: '',\n};\n\n/**\n * Retrieves store configuration settings for company forms.\n * \n * Returns store-specific defaults used to pre-populate country/region\n * selectors in company registration and profile forms.\n * \n * @returns Promise resolving to store configuration with default country and store code\n * \n * @example\n * ```typescript\n * const config = await getStoreConfig();\n * // { defaultCountry: 'US', storeCode: 'default' }\n * // Use config.defaultCountry to pre-select country in address forms\n * ```\n */\nexport const getStoreConfig = async (): Promise<StoreConfigModel> => {\n  return await fetchGraphQl(GET_STORE_CONFIG_QUERY, {\n    method: 'GET',\n  })\n    .then((response: GetStoreConfigResponse) => {\n      if (response.errors?.length) return handleFetchError(response.errors);\n\n      return transformStoreConfig(response);\n    })\n    .catch(handleNetworkError);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { GetStoreConfigResponse, StoreConfigModel } from '@/company-management/types';\nimport { STORE_CONFIG_DEFAULTS } from '@/company-management/api/getStoreConfig/getStoreConfig';\n\nexport const transformStoreConfig = (\n  response: GetStoreConfigResponse\n): StoreConfigModel => {\n  if (!response?.data?.storeConfig) return STORE_CONFIG_DEFAULTS;\n\n  const { default_country, store_code } = response.data.storeConfig;\n\n  return {\n    defaultCountry: default_country || STORE_CONFIG_DEFAULTS.defaultCountry,\n    storeCode: store_code || STORE_CONFIG_DEFAULTS.storeCode,\n  };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const CREATE_COMPANY_MUTATION = /* GraphQL */ `\n  mutation CreateCompany($input: CompanyCreateInput!) {\n    createCompany(input: $input) {\n      company {\n        id\n        name\n        email\n        legal_name\n        vat_tax_id\n        reseller_id\n        legal_address {\n          street\n          city\n          region {\n            region_code\n            region\n            region_id\n          }\n          postcode\n          country_code\n          telephone\n        }\n        company_admin {\n          id\n          firstname\n          lastname\n          email\n          job_title\n          telephone\n        }\n      }\n    }\n  }\n`;","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CompanyFormData } from '../models/company';\nimport { CompanyCreateInput } from '@/company-management/api/createCompany';\n\nexport const transformFormDataToCreateInput = (formData: CompanyFormData): CompanyCreateInput => {\n  // Build region object based on form data\n  // Backend GraphQL schema requires region (CustomerAddressRegionInput!)\n  const regionCode = formData.regionCode?.trim();\n  const region = formData.region?.trim();\n  \n  let finalRegion: { region?: string; region_code: string; region_id?: number };\n  \n  if (regionCode) {\n    // Preferred path: explicit regionCode from dropdown selection\n    finalRegion = {\n      region_code: regionCode,\n      ...(formData.regionId && { \n        region_id: typeof formData.regionId === 'string' ? parseInt(formData.regionId, 10) : formData.regionId \n      }),\n    };\n  } else if (region?.includes(',')) {\n    // Dropdown selection fallback: parse \"AL,4\" format\n    const [code, id] = region.split(',');\n    finalRegion = { region_code: code.trim(), region_id: parseInt(id.trim(), 10) };\n  } else if (region && /^\\d+$/.test(region)) {\n    // Numeric-only region without code - invalid state\n    throw new Error('Region selection error: Missing region code. Please ensure regions are properly loaded.');\n  } else if (region) {\n    // Text input: free-form region name (countries without predefined regions)\n    finalRegion = { region, region_code: region };\n  } else {\n    // No region data: countries like UK that don't require regions\n    finalRegion = { region: '', region_code: '', region_id: 0 };\n  }\n\n  return {\n    company_name: formData.companyName || '',\n    company_email: formData.companyEmail || '',\n    legal_name: formData.legalName,\n    vat_tax_id: formData.vatTaxId,\n    reseller_id: formData.resellerId,\n    legal_address: {\n      street: Array.isArray(formData.street) \n        ? formData.street.filter((line): line is string => typeof line === 'string' && line.trim() !== '') // Remove empty lines\n        : [formData.street].filter((line): line is string => typeof line === 'string' && line.trim() !== ''), // Handle case where street is not an array\n      city: formData.city || '',\n      region: finalRegion,\n      postcode: formData.postcode || '',\n      country_id: formData.countryCode || '',\n      telephone: formData.addressTelephone,\n    },\n    company_admin: {\n      email: formData.adminEmail || '',\n      firstname: formData.adminFirstname?.trim() || '',\n      lastname: formData.adminLastname?.trim() || '',\n      job_title: formData.adminJobTitle,\n      telephone: formData.adminWorkTelephone,\n      gender: formData.adminGender ? (typeof formData.adminGender === 'string' ? parseInt(formData.adminGender, 10) : formData.adminGender) : undefined,\n      custom_attributes: formData.adminCustomAttributes?.map((attr: { attribute_code: string; value: string }) => ({\n        attribute_code: attr.attribute_code,\n        value: attr.value,\n      })) || [],\n    },\n  };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/company-management/api/fetch-graphql';\nimport { CREATE_COMPANY_MUTATION } from './graphql/createCompany.graphql';\nimport { CompanyRegistrationModel } from '@/company-management/data/models/company';\nimport { transformFormDataToCreateInput } from '@/company-management/data/transforms/company';\nimport { transformCreateCompanyResponse } from '@/company-management/data/transforms/transform-company';\n\nexport interface CompanyCreateInput {\n  company_name: string;\n  company_email: string;\n  legal_name?: string;\n  vat_tax_id?: string;\n  reseller_id?: string;\n  legal_address: {\n    street: string[];\n    city: string;\n    region: {\n      region_code: string;\n      region?: string;\n      region_id?: number;\n    };\n    postcode: string;\n    country_id: string;\n    telephone?: string;\n  };\n  company_admin: {\n    email: string;\n    firstname: string;\n    lastname: string;\n    job_title?: string;\n    telephone?: string;\n    gender?: number;\n    custom_attributes?: Array<{\n      attribute_code: string;\n      value: string;\n    }>;\n  };\n}\n\n/**\n * Registers a new B2B company with complete business information.\n * \n * This function handles the entire company registration workflow including:\n * - Company details validation (name, email, legal name, tax IDs)\n * - Legal address validation with country/region support\n * - Company administrator account creation\n * - Email uniqueness validation\n * \n * @param formData - Company registration form data containing company info, legal address, and admin details\n * @returns Promise resolving to registration result with success status, company data, or errors\n * \n * @example\n * ```typescript\n * const result = await createCompany({\n *   company_name: 'Acme Corp',\n *   company_email: 'contact@acme.com',\n *   legal_name: 'Acme Corporation Inc.',\n *   vat_tax_id: 'VAT123456789',\n *   legal_address: {\n *     street: ['123 Main St', 'Suite 100'],\n *     city: 'San Francisco',\n *     region: { region_code: 'CA', region: 'California', region_id: 12 },\n *     postcode: '94105',\n *     country_id: 'US',\n *     telephone: '+1-555-123-4567'\n *   },\n *   company_admin: {\n *     email: 'admin@acme.com',\n *     firstname: 'John',\n *     lastname: 'Doe',\n *     job_title: 'CEO'\n *   }\n * });\n * \n * if (result.success) {\n *   console.log('Company registered:', result.company);\n * } else {\n *   console.error('Registration failed:', result.errors);\n * }\n * ```\n */\nexport const createCompany = async (formData: any): Promise<{ success: boolean; company?: CompanyRegistrationModel; errors?: string[] }> => {\n  try {\n    const input = transformFormDataToCreateInput(formData);\n    const response = await fetchGraphQl(CREATE_COMPANY_MUTATION, {\n      method: 'POST',\n      variables: { input },\n    });\n\n    if (response.errors?.length) {\n      return {\n        success: false,\n        errors: response.errors.map((error: any) => error.message),\n      };\n    }\n\n    // Transform the GraphQL response using the dedicated transformer\n    const transformedCompany = transformCreateCompanyResponse(response);\n\n    return {\n      success: true,\n      company: transformedCompany,\n    };\n  } catch (error) {\n    console.error('Failed to create company:', error);\n    return {\n      success: false,\n      errors: ['Failed to create company. Please try again.'],\n    };\n  }\n};"],"names":["GET_STORE_CONFIG_QUERY","DEFAULT_COUNTRY","STORE_CONFIG_DEFAULTS","getStoreConfig","fetchGraphQl","response","_a","handleFetchError","transformStoreConfig","handleNetworkError","default_country","store_code","CREATE_COMPANY_MUTATION","transformFormDataToCreateInput","formData","regionCode","region","_b","finalRegion","code","id","line","_c","_d","_e","attr","createCompany","input","error","transformCreateCompanyResponse"],"mappings":"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"}