{"version":3,"file":"CompanyUserForm.js","sources":["/@dropins/storefront-company-management/src/hooks/useCompanyUserForm.ts","/@dropins/storefront-company-management/src/components/CompanyUserForm/CompanyUserForm.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport { useEffect, useState } from 'preact/hooks';\nimport { createCompanyUser, getCompanyUser, isCompanyUserEmailAvailable, updateCompanyUser } from '@/company-management/api';\nimport { isCompanyAdministrator } from '@/company-management/lib';\nimport { CompanyUserModel } from '@/company-management/data/models';\nimport { useText } from '@adobe-commerce/elsie/i18n';\n\nexport type UserStatus = 'ACTIVE' | 'INACTIVE';\n\n// Field length constants (based on Magento backend validation)\nexport const FIELD_MAX_LENGTHS = {\n  firstName: 255,\n  lastName: 255,\n  email: 254,\n  jobTitle: 255,\n  telephone: 20,\n} as const;\n\n// Character validation patterns (USF-3474)\nconst VALIDATION_PATTERNS = {\n  // Match Magento's Name validator: /(?:[\\p{L}\\p{M}\\,\\-\\_\\.\\''`&\\s\\d]){1,255}+/u\n  name: /^[a-zA-ZÀ-ÿ0-9\\s,\\-_.'`&]+$/,\n  // Match Magento's Telephone validator: /(?:[\\d\\s\\+\\-\\()]{1,20})/u\n  telephone: /^[\\d\\s+\\-()]+$/,\n} as const;\n\nexport function useCompanyUserForm(opts: {\n  mode: 'add' | 'edit';\n  entityId?: string;\n  parentStructureId?: string | null;\n  onSaved: (result: { label: string; structureId?: string; entityId?: string; type: 'user'; status?: UserStatus; jobTitle?: string | null }) => void;\n  onError?: (error: string) => void;\n  onSuccess?: (message: string) => void;\n}) {\n  const { mode, entityId, parentStructureId, onSaved, onError, onSuccess } = opts;\n  \n  const translations = useText({\n    firstNameRequired: 'Company.CompanyStructure.shared.validation.firstNameRequired',\n    lastNameRequired: 'Company.CompanyStructure.shared.validation.lastNameRequired',\n    emailRequired: 'Company.CompanyStructure.shared.validation.emailRequired',\n    emailInvalid: 'Company.CompanyStructure.shared.validation.emailInvalid',\n    jobTitleRequired: 'Company.CompanyStructure.shared.validation.jobTitleRequired',\n    workPhoneRequired: 'Company.CompanyStructure.shared.validation.workPhoneRequired',\n    selectRole: 'Company.CompanyStructure.shared.validation.selectRole',\n    firstNameMaxLength: 'Company.CompanyStructure.shared.validation.firstNameMaxLength',\n    lastNameMaxLength: 'Company.CompanyStructure.shared.validation.lastNameMaxLength',\n    emailMaxLength: 'Company.CompanyStructure.shared.validation.emailMaxLength',\n    jobTitleMaxLength: 'Company.CompanyStructure.shared.validation.jobTitleMaxLength',\n    telephoneMaxLength: 'Company.CompanyStructure.shared.validation.telephoneMaxLength',\n    firstNameInvalidChars: 'Company.CompanyStructure.shared.validation.firstNameInvalidChars',\n    lastNameInvalidChars: 'Company.CompanyStructure.shared.validation.lastNameInvalidChars',\n    telephoneInvalidChars: 'Company.CompanyStructure.shared.validation.telephoneInvalidChars',\n    createUserError: 'Company.CompanyStructure.messages.createUserError',\n    saveUserError: 'Company.CompanyStructure.messages.saveUserError',\n    createUserSuccess: 'Company.CompanyStructure.messages.createUserSuccess',\n    updateUserSuccess: 'Company.CompanyStructure.messages.updateUserSuccess',\n  });\n  const [values, setValues] = useState<Partial<CompanyUserModel> & { roleId: string; status: UserStatus }>({ \n    firstName: '', \n    lastName: '', \n    email: '', \n    jobTitle: '', \n    telephone: '', \n    roleId: '', \n    status: 'ACTIVE' \n  });\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [touched, setTouched] = useState<Record<string, boolean>>({});\n  const [loading, setLoading] = useState(false);\n  const [generalError, setGeneralError] = useState<string | null>(null);\n  const [emailAvailable, setEmailAvailable] = useState<boolean | null>(null);\n  const [emailChecked, setEmailChecked] = useState<string>('');\n  const [originalEmail, setOriginalEmail] = useState<string>('');\n  const [isCompanyAdmin, setIsCompanyAdmin] = useState<boolean>(false);\n\n  useEffect(() => {\n    if (mode !== 'edit' || !entityId) return;\n    setLoading(true);\n    void getCompanyUser(entityId).then((u) => {\n      if (!u) return;\n      const loadedEmail = u.email || '';\n      setValues((v) => ({ ...v, firstName: u.firstName || '', lastName: u.lastName || '', email: loadedEmail, jobTitle: u.jobTitle || '', telephone: u.telephone || '', status: (u.status || 'ACTIVE') as UserStatus }));\n      setOriginalEmail(loadedEmail);\n      if (u?.role?.id) setValues((v) => ({ ...v, roleId: u.role!.id }));\n      setIsCompanyAdmin(u?.isCompanyAdmin ?? false);\n    }).finally(() => setLoading(false));\n  }, [mode, entityId]);\n\n  const isEmailValid = (value: string): boolean => /.+@.+\\..+/.test(value);\n  const validateField = (field: keyof CompanyUserModel | 'roleId', value: any): string | null => {\n    if (field === 'firstName') {\n      if (!value?.trim()) return translations.firstNameRequired;\n      if (value.length > FIELD_MAX_LENGTHS.firstName) return translations.firstNameMaxLength;\n      if (!VALIDATION_PATTERNS.name.test(value)) return translations.firstNameInvalidChars;\n      return null;\n    }\n    if (field === 'lastName') {\n      if (!value?.trim()) return translations.lastNameRequired;\n      if (value.length > FIELD_MAX_LENGTHS.lastName) return translations.lastNameMaxLength;\n      if (!VALIDATION_PATTERNS.name.test(value)) return translations.lastNameInvalidChars;\n      return null;\n    }\n    if (field === 'email') {\n      if (!value?.trim()) return translations.emailRequired;\n      if (value.length > FIELD_MAX_LENGTHS.email) return translations.emailMaxLength;\n      return isEmailValid(value.trim()) ? null : translations.emailInvalid;\n    }\n    // jobTitle and telephone are now optional fields (USF-3012)\n    if (field === 'jobTitle') {\n      if (value && value.length > FIELD_MAX_LENGTHS.jobTitle) return translations.jobTitleMaxLength;\n      return null;\n    }\n    if (field === 'telephone') {\n      if (value && value.length > FIELD_MAX_LENGTHS.telephone) return translations.telephoneMaxLength;\n      if (value && value.trim() && !VALIDATION_PATTERNS.telephone.test(value)) return translations.telephoneInvalidChars;\n      return null;\n    }\n    if (field === 'roleId') return value ? null : translations.selectRole;\n    return null;\n  };\n\n  const setValue = (field: keyof CompanyUserModel | 'roleId', value: any) => {\n    setValues((v) => ({ ...v, [field]: value }));\n    if (field === 'email') setEmailAvailable(null);\n    if (generalError) setGeneralError(null);\n  };\n\n  const onBlur = async (field: keyof CompanyUserModel | 'roleId', value?: any) => {\n    // Update form data if value is provided (this preserves spaces and other characters)\n    if (value !== undefined) {\n      setValue(field, value);\n    }\n    \n    setTouched((t) => ({ ...t, [field]: true }));\n    \n    // Use provided value or current state value for validation\n    const valueToValidate = value !== undefined ? value : values[field];\n    const err = validateField(field, valueToValidate);\n    if (err) {\n      setErrors((p) => ({ ...p, [field]: err }));\n    } else {\n      // Clear error if field is now valid\n      setErrors((p) => {\n        const newErrors = { ...p };\n        delete newErrors[field];\n        return newErrors;\n      });\n    }\n    \n    if (field === 'email') {\n      const emailValue = value !== undefined ? value : (values.email || '');\n      const trimmed = emailValue.trim();\n      if (mode === 'edit' && trimmed.toLowerCase() === (originalEmail || '').trim().toLowerCase()) {\n        setEmailAvailable(null);\n        return;\n      }\n      if (isEmailValid(trimmed) && trimmed !== emailChecked) {\n        const available = await isCompanyUserEmailAvailable(trimmed);\n        setEmailChecked(trimmed);\n        setEmailAvailable(available);\n        if (available === false) setErrors((p) => ({ ...p, email: 'A user with this email address is already a member of your company.' }));\n      }\n    }\n  };\n\n  const submit = async () => {\n    // Validate all fields including optional ones for length (USF-3474)\n    const fields: (keyof CompanyUserModel | 'roleId')[] = ['firstName', 'lastName', 'email', 'roleId', 'jobTitle', 'telephone'];\n    const next: Record<string, string> = {};\n    const touchedFields: Record<string, boolean> = {};\n    \n    for (const f of fields) {\n      touchedFields[f as string] = true;\n      const err = validateField(f, values[f]);\n      if (err) next[f as string] = err;\n    }\n    \n    setErrors(next);\n    setTouched(touchedFields);\n    \n    if (Object.keys(next).length || emailAvailable === false) {\n      // Scroll to the first error field\n      setTimeout(() => {\n        const firstErrorField = document.querySelector('.company-user-form__content .dropin-field__hint--error');\n        if (firstErrorField) {\n          const fieldContainer = firstErrorField.closest('.dropin-field');\n          if (fieldContainer) {\n            fieldContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });\n            const input = fieldContainer.querySelector('input, select') as HTMLElement;\n            if (input) {\n              input.focus();\n            }\n          }\n        }\n      }, 100);\n      return;\n    }\n\n    const label = `${values.firstName || ''} ${values.lastName || ''}`.trim() || values.email || '';\n    const adminEffective = isCompanyAdmin || isCompanyAdministrator({ id: values.roleId });\n    const effectiveStatus = adminEffective ? 'ACTIVE' : values.status;\n    try {\n      if (mode === 'add') {\n        const res = await createCompanyUser({ email: values.email || '', firstName: values.firstName || '', lastName: values.lastName || '', jobTitle: values.jobTitle || '', telephone: values.telephone || '', roleId: values.roleId, status: effectiveStatus, targetId: parentStructureId ?? null });\n        if (!res) {\n          const errorMessage = translations.createUserError;\n          if (onError) {\n            onError(errorMessage);\n          } else {\n            setGeneralError(errorMessage);\n          }\n          return;\n        }\n        onSaved({ label, structureId: res.structureId, entityId: res.id, type: 'user', status: effectiveStatus, jobTitle: res.jobTitle });\n        if (onSuccess) {\n          onSuccess(translations.createUserSuccess);\n        }\n      } else if (entityId) {\n        await updateCompanyUser({ id: entityId, email: values.email || '', firstName: values.firstName || '', lastName: values.lastName || '', jobTitle: values.jobTitle || '', telephone: values.telephone || '', status: effectiveStatus, roleId: values.roleId });\n        onSaved({ label, entityId, type: 'user', status: effectiveStatus, jobTitle: values.jobTitle });\n        if (onSuccess) {\n          onSuccess(translations.updateUserSuccess);\n        }\n      }\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : translations.saveUserError;\n      if (onError) {\n        onError(errorMessage);\n      } else {\n        setGeneralError(errorMessage);\n      }\n    }\n  };\n\n  return { values, errors, touched, loading, setValue, onBlur, submit, isCompanyAdmin, generalError };\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport { FunctionComponent } from 'preact';\nimport { memo } from 'preact/compat';\nimport { useState } from 'preact/hooks';\nimport { Field, Input, Button, Card, Picker, ProgressSpinner, InLineAlert } from '@adobe-commerce/elsie/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { CompanyUserFormLoader } from '@/company-management/components/CompanyLoaders';\nimport { useCompanyUserForm, FIELD_MAX_LENGTHS } from '@/company-management/hooks/useCompanyUserForm';\nimport { useCompanyRoles } from '@/company-management/hooks/useCompanyRoles';\nimport { CompanyUserFormProps } from '@/company-management/types/companyForm.types';\nimport './CompanyUserForm.css';\n\n/**\n * CompanyUserForm component for creating and editing company users\n * Provides form fields for user information including name, email, role, and status\n */\nexport const CompanyUserForm: FunctionComponent<CompanyUserFormProps> = memo(({ mode, entityId, parentStructureId, permissions, onSaved, onCancel, onError, onSuccess }) => {\n  const canEditUsers = permissions?.canEditUsers ?? false;\n  const { roles, isLoading: rolesLoading } = useCompanyRoles();\n  const { values, errors, touched, loading, setValue, onBlur, submit, isCompanyAdmin, generalError } = useCompanyUserForm({ \n    mode, \n    entityId, \n    parentStructureId, \n    onSaved,\n    onError: onError ? (error: string) => {\n      onError(error);\n      onCancel();\n    } : undefined,\n    onSuccess\n  });\n  const [saving, setSaving] = useState(false);\n  \n  const translations = useText({\n    addUser: 'Company.CompanyStructure.shared.titles.addUser',\n    editUser: 'Company.CompanyStructure.shared.titles.editUser',\n    jobTitle: 'Company.CompanyStructure.shared.fields.jobTitle',\n    userRole: 'Company.CompanyStructure.shared.fields.userRole',\n    firstName: 'Company.CompanyStructure.shared.fields.firstName',\n    lastName: 'Company.CompanyStructure.shared.fields.lastName',\n    email: 'Company.CompanyStructure.shared.fields.email',\n    workPhoneNumber: 'Company.CompanyStructure.shared.fields.workPhoneNumber',\n    status: 'Company.CompanyStructure.shared.fields.status',\n    selectRole: 'Company.CompanyStructure.shared.options.selectRole',\n    active: 'Company.CompanyStructure.shared.options.active',\n    inactive: 'Company.CompanyStructure.shared.options.inactive',\n    companyAdministrator: 'Company.CompanyStructure.shared.options.companyAdministrator',\n    save: 'Company.CompanyStructure.shared.buttons.save',\n    cancel: 'Company.CompanyStructure.shared.buttons.cancel',\n  });\n\n  return (\n    <div>\n      <h3 className=\"acm-structure-panel__title\">{mode === 'add' ? translations.addUser : translations.editUser}</h3>\n      <Card variant=\"secondary\" className={`company-user-form__card ${saving ? 'is-working' : ''}`}>\n        {!onError && generalError ? (\n          <InLineAlert \n            className=\"company-user-form__notification\" \n            type=\"error\" \n            variant=\"secondary\" \n            heading={generalError} \n          />\n        ) : null}\n        {saving ? <div className=\"company-user-form__overlay\" aria-live=\"polite\"><ProgressSpinner size=\"small\" /></div> : null}\n        {loading || rolesLoading ? (\n          <CompanyUserFormLoader />\n        ) : (\n          <div className=\"company-user-form__content\">\n\n            <Field label={translations.jobTitle} className=\"acm-structure-panel__field\" error={touched.jobTitle && errors.jobTitle ? errors.jobTitle : undefined}>\n              <Input name=\"job_title\" type=\"text\" value={values.jobTitle || ''} onBlur={(e: Event) => { const target = e.target as HTMLInputElement; onBlur('jobTitle', target.value); }} variant=\"primary\" size=\"medium\" maxLength={FIELD_MAX_LENGTHS.jobTitle} />\n            </Field>\n\n            <Field label={translations.userRole} required className=\"acm-structure-panel__field\" error={!isCompanyAdmin && touched.roleId && errors.roleId ? errors.roleId : undefined} disabled={isCompanyAdmin}>\n              {isCompanyAdmin ? (\n                <Picker name=\"role\" value={'MA=='} options={[{ value: 'MA==', text: translations.companyAdministrator }]} />\n              ) : (\n                <Picker\n                  name=\"role\"\n                  value={values.roleId || 'placeholder'}\n                  onChange={(e: any) => setValue('roleId', String(e?.target?.value === 'placeholder' ? '' : e?.target?.value ?? ''))}\n                  onBlur={(e: Event) => { const target = e.target as HTMLSelectElement; void onBlur('roleId', target.value === 'placeholder' ? '' : target.value); }}\n                  options={[{ value: 'placeholder', text: translations.selectRole, disabled: true }, ...roles.map((r) => ({ value: r.id, text: r.name }))]}\n                />\n              )}\n            </Field>\n\n            <Field label={translations.firstName} required className=\"acm-structure-panel__field\" error={touched.firstName && errors.firstName ? errors.firstName : undefined}>\n              <Input name=\"first_name\" type=\"text\" value={values.firstName} onBlur={(e: Event) => { const target = e.target as HTMLInputElement; onBlur('firstName', target.value); }} variant=\"primary\" size=\"medium\" maxLength={FIELD_MAX_LENGTHS.firstName} />\n            </Field>\n\n            <Field label={translations.lastName} required className=\"acm-structure-panel__field\" error={touched.lastName && errors.lastName ? errors.lastName : undefined}>\n              <Input name=\"last_name\" type=\"text\" value={values.lastName} onBlur={(e: Event) => { const target = e.target as HTMLInputElement; onBlur('lastName', target.value); }} variant=\"primary\" size=\"medium\" maxLength={FIELD_MAX_LENGTHS.lastName} />\n            </Field>\n\n            <Field label={translations.email} required className=\"acm-structure-panel__field\" error={touched.email && errors.email ? errors.email : undefined}>\n              <Input name=\"email\" type=\"email\" value={values.email} onBlur={(e: Event) => { const target = e.target as HTMLInputElement; void onBlur('email', target.value); }} placeholder=\"jdoe@example.com\" variant=\"primary\" size=\"medium\" maxLength={FIELD_MAX_LENGTHS.email} />\n            </Field>\n\n            <Field label={translations.workPhoneNumber} className=\"acm-structure-panel__field\" error={touched.telephone && errors.telephone ? errors.telephone : undefined}>\n              <Input name=\"telephone\" type=\"text\" value={values.telephone || ''} onBlur={(e: Event) => { const target = e.target as HTMLInputElement; onBlur('telephone', target.value); }} variant=\"primary\" size=\"medium\" maxLength={FIELD_MAX_LENGTHS.telephone} />\n            </Field>\n\n            <Field label={translations.status} className=\"acm-structure-panel__field\" disabled={isCompanyAdmin || !canEditUsers}>\n              <Picker\n                name=\"status\"\n                value={values.status}\n                onChange={(e: any) => setValue('status', String(e?.target?.value ?? 'ACTIVE'))}\n                options={[{ value: 'ACTIVE', text: translations.active }, { value: 'INACTIVE', text: translations.inactive }]}\n              />\n            </Field>\n          </div>\n        )}\n      </Card>\n      {!(loading || rolesLoading) ? (\n        <div className=\"acm-structure-modal__actions\">\n          <Button type=\"button\" variant=\"primary\" disabled={saving || !canEditUsers} onClick={async () => { if (saving) return; setSaving(true); try { await submit(); } finally { setSaving(false); } }}>\n            {translations.save}\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"secondary\"\n            disabled={saving}\n            onClick={onCancel}\n          >\n            {translations.cancel}\n          </Button>\n        </div>\n      ) : null}\n    </div>\n  );\n});\n\nexport default CompanyUserForm;\n"],"names":["FIELD_MAX_LENGTHS","VALIDATION_PATTERNS","useCompanyUserForm","opts","mode","entityId","parentStructureId","onSaved","onError","onSuccess","translations","useText","values","setValues","useState","errors","setErrors","touched","setTouched","loading","setLoading","generalError","setGeneralError","emailAvailable","setEmailAvailable","emailChecked","setEmailChecked","originalEmail","setOriginalEmail","isCompanyAdmin","setIsCompanyAdmin","useEffect","getCompanyUser","u","loadedEmail","v","_a","isEmailValid","value","validateField","field","setValue","t","valueToValidate","err","p","newErrors","trimmed","available","isCompanyUserEmailAvailable","fields","next","touchedFields","f","firstErrorField","fieldContainer","input","label","effectiveStatus","isCompanyAdministrator","res","createCompanyUser","errorMessage","updateCompanyUser","error","CompanyUserForm","memo","permissions","onCancel","canEditUsers","roles","rolesLoading","useCompanyRoles","onBlur","submit","saving","setSaving","jsx","jsxs","Card","InLineAlert","ProgressSpinner","CompanyUserFormLoader","Field","Input","e","target","Picker","_b","r","Button"],"mappings":"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"}