{"version":3,"file":"company-permissions.js","sources":["/@dropins/storefront-company-management/src/lib/company-permissions.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CompanyPermissionFlags } from '../types/companyPermission.types';\n\n/**\n * Flattens a nested permissions tree into a Set of permission IDs\n * This is a pure utility function that can be used across the application\n */\nexport const flattenIds = (nodes: any[] = []): Set<string> => {\n  const set = new Set<string>();\n  const stack = [...nodes];\n  while (stack.length) {\n    const node = stack.pop();\n    if (!node) continue;\n    if (typeof node.id === 'string') set.add(node.id);\n    if (Array.isArray(node.children) && node.children.length) {\n      for (const child of node.children) stack.push(child);\n    }\n  }\n  return set;\n};\n\n/**\n * Flattens a nested permissions tree into an Array of permission IDs\n * Convenience function that returns an array instead of a Set\n */\nexport const flattenIdsToArray = (nodes: any[] = []): string[] => {\n  return Array.from(flattenIds(nodes));\n};\n\n/**\n * Determines if a role is a Company Administrator\n */\nexport const isCompanyAdministrator = (role: any): boolean => {\n  return role?.id === '0' || \n         (typeof role?.id === 'number' && role?.id === 0) || \n         role?.id === 'MA==' ||\n         role?.name === 'Company Administrator';\n};\n\n/**\n * Returns the list of permissions that Company Administrators have by default\n */\nexport const getAdminPermissions = (): string[] => [\n  'Magento_Company::view_account',\n  'Magento_Company::edit_account',\n  'Magento_Company::view_address',\n  'Magento_Company::edit_address',\n  'Magento_Company::contacts',\n  'Magento_Company::payment_information',\n  'Magento_Company::shipping_information',\n  'Magento_Company::users_view',\n  'Magento_Company::users_edit',\n  'Magento_Company::roles_view',\n  'Magento_Company::roles_edit',\n];\n\n/**\n * Builds permission flags from role data\n */\nexport const buildPermissionFlags = (role: any): CompanyPermissionFlags => {\n  const allowedIds = flattenIds(role?.permissions || []);\n  const isAdmin = isCompanyAdministrator(role);\n\n  return {\n    canViewAccount: isAdmin || allowedIds.has('Magento_Company::view_account'),\n    canEditAccount: isAdmin || allowedIds.has('Magento_Company::edit_account'),\n    canViewAddress: isAdmin || allowedIds.has('Magento_Company::view_address'),\n    canEditAddress: isAdmin || allowedIds.has('Magento_Company::edit_address'),\n    canViewContacts: isAdmin || allowedIds.has('Magento_Company::contacts'),\n    canViewPaymentInformation: isAdmin || allowedIds.has('Magento_Company::payment_information'),\n    canViewShippingInformation: isAdmin || allowedIds.has('Magento_Company::shipping_information'),\n    canViewUsers: isAdmin || allowedIds.has('Magento_Company::users_view'),\n    canEditUsers: isAdmin || allowedIds.has('Magento_Company::users_edit'),\n    canViewRoles: isAdmin || allowedIds.has('Magento_Company::roles_view'),\n    canManageRoles: isAdmin || allowedIds.has('Magento_Company::roles_edit'),\n  };\n};\n\n"],"names":["flattenIds","nodes","set","stack","node","child","flattenIdsToArray","isCompanyAdministrator","role","getAdminPermissions","buildPermissionFlags","allowedIds","isAdmin"],"mappings":"AAuBO,MAAMA,EAAa,CAACC,EAAe,KAAoB,CAC5D,MAAMC,MAAU,IACVC,EAAQ,CAAC,GAAGF,CAAK,EACvB,KAAOE,EAAM,QAAQ,CACnB,MAAMC,EAAOD,EAAM,IAAA,EACnB,GAAKC,IACD,OAAOA,EAAK,IAAO,UAAUF,EAAI,IAAIE,EAAK,EAAE,EAC5C,MAAM,QAAQA,EAAK,QAAQ,GAAKA,EAAK,SAAS,QAChD,UAAWC,KAASD,EAAK,SAAUD,EAAM,KAAKE,CAAK,CAEvD,CACA,OAAOH,CACT,EAMaI,EAAoB,CAACL,EAAe,KACxC,MAAM,KAAKD,EAAWC,CAAK,CAAC,EAMxBM,EAA0BC,IAC9BA,GAAA,YAAAA,EAAM,MAAO,KACZ,OAAOA,GAAA,YAAAA,EAAM,KAAO,WAAYA,GAAA,YAAAA,EAAM,MAAO,IAC9CA,GAAA,YAAAA,EAAM,MAAO,SACbA,GAAA,YAAAA,EAAM,QAAS,wBAMXC,EAAsB,IAAgB,CACjD,gCACA,gCACA,gCACA,gCACA,4BACA,uCACA,wCACA,8BACA,8BACA,8BACA,6BACF,EAKaC,EAAwBF,GAAsC,CACzE,MAAMG,EAAaX,GAAWQ,GAAA,YAAAA,EAAM,cAAe,CAAA,CAAE,EAC/CI,EAAUL,EAAuBC,CAAI,EAE3C,MAAO,CACL,eAAgBI,GAAWD,EAAW,IAAI,+BAA+B,EACzE,eAAgBC,GAAWD,EAAW,IAAI,+BAA+B,EACzE,eAAgBC,GAAWD,EAAW,IAAI,+BAA+B,EACzE,eAAgBC,GAAWD,EAAW,IAAI,+BAA+B,EACzE,gBAAiBC,GAAWD,EAAW,IAAI,2BAA2B,EACtE,0BAA2BC,GAAWD,EAAW,IAAI,sCAAsC,EAC3F,2BAA4BC,GAAWD,EAAW,IAAI,uCAAuC,EAC7F,aAAcC,GAAWD,EAAW,IAAI,6BAA6B,EACrE,aAAcC,GAAWD,EAAW,IAAI,6BAA6B,EACrE,aAAcC,GAAWD,EAAW,IAAI,6BAA6B,EACrE,eAAgBC,GAAWD,EAAW,IAAI,6BAA6B,CAAA,CAE3E"}