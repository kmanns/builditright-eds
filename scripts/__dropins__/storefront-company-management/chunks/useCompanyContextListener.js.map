{"version":3,"file":"useCompanyContextListener.js","sources":["/@dropins/storefront-company-management/src/hooks/useCompanyContextListener.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { useEffect, useRef } from 'preact/hooks';\nimport { events } from '@adobe-commerce/event-bus';\n\n/**\n * Configuration options for company context event handling\n */\nexport interface CompanyContextListenerOptions {\n  /** Whether to enable eager listening (subscribe immediately on mount) */\n  eager?: boolean;\n  /** Whether the hook is enabled (allows conditional subscription) */\n  enabled?: boolean;\n}\n\n/**\n * Custom hook that listens to company context changes and executes a callback\n * \n * This hook provides a reusable pattern for components that need to respond to\n * company context changes (e.g., user switching companies, company data updates).\n * \n * @param callback - Function to execute when company context changes\n * @param options - Configuration options for the event listener\n * \n * @example\n * ```typescript\n * const MyComponent = () => {\n *   const [data, setData] = useState(null);\n *   \n *   const refreshData = useCallback(async () => {\n *     const newData = await fetchMyData();\n *     setData(newData);\n *   }, []);\n *   \n *   // Listen for company context changes and refresh data\n *   useCompanyContextListener(refreshData);\n *   \n *   return <div>{data}</div>;\n * };\n * ```\n * \n * @example\n * ```typescript\n * // With options\n * useCompanyContextListener(refreshData, {\n *   eager: true,    // Subscribe immediately on mount\n *   enabled: true   // Conditionally enable/disable\n * });\n * ```\n */\nexport const useCompanyContextListener = (\n  callback: () => void,\n  options: CompanyContextListenerOptions = {}\n) => {\n  const { eager = true, enabled = true } = options;\n  \n  // Use ref to maintain stable reference to callback across re-renders\n  const callbackRef = useRef(callback);\n  callbackRef.current = callback;\n\n  useEffect(() => {\n    // Skip subscription if disabled\n    if (!enabled) {\n      return;\n    }\n\n    const handleCompanyContextChange = () => {\n      callbackRef.current();\n    };\n\n    const subscription = events.on(\n      'companyContext/changed',\n      handleCompanyContextChange,\n      { eager }\n    );\n\n    return () => {\n      subscription?.off?.();\n    };\n  }, [eager, enabled]);\n};\n\n"],"names":["useCompanyContextListener","callback","options","eager","enabled","callbackRef","useRef","useEffect","handleCompanyContextChange","subscription","events","_a"],"mappings":"4HAiEO,MAAMA,EAA4B,CACvCC,EACAC,EAAyC,KACtC,CACH,KAAM,CAAE,MAAAC,EAAQ,GAAM,QAAAC,EAAU,IAASF,EAGnCG,EAAcC,EAAOL,CAAQ,EACnCI,EAAY,QAAUJ,EAEtBM,EAAU,IAAM,CAEd,GAAI,CAACH,EACH,OAGF,MAAMI,EAA6B,IAAM,CACvCH,EAAY,QAAA,CACd,EAEMI,EAAeC,EAAO,GAC1B,yBACAF,EACA,CAAE,MAAAL,CAAA,CAAM,EAGV,MAAO,IAAM,QACXQ,EAAAF,GAAA,YAAAA,EAAc,MAAd,MAAAE,EAAA,KAAAF,EACF,CACF,EAAG,CAACN,EAAOC,CAAO,CAAC,CACrB"}