{"version":3,"file":"acceptCompanyInvitation.js","sources":["/@dropins/storefront-company-management/src/api/acceptCompanyInvitation/graphql/acceptCompanyInvitation.graphql.ts","/@dropins/storefront-company-management/src/api/acceptCompanyInvitation/acceptCompanyInvitation.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const ACCEPT_COMPANY_INVITATION = /* GraphQL */ `\n  mutation acceptCompanyInvitation($input: CompanyInvitationInput!) {\n    acceptCompanyInvitation(input: $input) {\n      success\n    }\n  }\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport { handleNetworkError, handleFetchError } from '@/company-management/lib';\nimport { AcceptCompanyInvitationInput, AcceptCompanyInvitationResult } from '@/company-management/types';\nimport { ACCEPT_COMPANY_INVITATION } from './graphql/acceptCompanyInvitation.graphql';\nimport { \n  fetchGraphQl, \n  removeFetchGraphQlHeader, \n  setFetchGraphQlHeader,\n  getConfig \n} from '@/company-management/api/fetch-graphql';\n\n/**\n * Accepts a company invitation using the invitation code and user information\n * @param input - Invitation code, user information (customer_id, company_id, etc.), and optional role_id\n * @returns Promise resolving to result indicating success or failure\n */\nexport async function acceptCompanyInvitation(\n  input: AcceptCompanyInvitationInput\n): Promise<AcceptCompanyInvitationResult | null> {\n  // Save the current X-Adobe-Company header value (if any)\n  const previousCompanyHeader = getConfig().fetchGraphQlHeaders['X-Adobe-Company'];\n  \n  // Temporarily remove X-Adobe-Company header to avoid backend validation error\n  // The acceptCompanyInvitation mutation doesn't allow this header to be set\n  removeFetchGraphQlHeader('X-Adobe-Company');\n\n  try {\n    // GraphQL expects base64-encoded UIDs for IDs\n    const transformedInput = {\n      code: input.code,\n      user: {\n        customer_id: btoa(input.user.customerId),\n        company_id: btoa(input.user.companyId),\n        job_title: input.user.jobTitle,\n        telephone: input.user.telephone,\n        status: input.user.status,\n      },\n      role_id: input.roleId ? btoa(input.roleId) : null,\n    };\n\n    return await fetchGraphQl<{ acceptCompanyInvitation?: { success: boolean } }>(ACCEPT_COMPANY_INVITATION, {\n      variables: { input: transformedInput },\n    })\n      .then((res) => {\n        if (res.errors?.length) return handleFetchError(res.errors);\n\n        const result = res?.data?.acceptCompanyInvitation;\n        if (!result) return null;\n\n        return {\n          success: result.success,\n        };\n      })\n      .catch(handleNetworkError);\n  } finally {\n    // Restore the X-Adobe-Company header if it existed before\n    if (previousCompanyHeader !== null && previousCompanyHeader !== undefined) {\n      setFetchGraphQlHeader('X-Adobe-Company', previousCompanyHeader);\n    }\n  }\n}\n"],"names":["ACCEPT_COMPANY_INVITATION","acceptCompanyInvitation","input","previousCompanyHeader","getConfig","removeFetchGraphQlHeader","transformedInput","fetchGraphQl","res","_a","handleFetchError","result","_b","handleNetworkError","setFetchGraphQlHeader"],"mappings":"wGAiBO,MAAMA,EAA0C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECcvD,eAAsBC,EACpBC,EAC+C,CAE/C,MAAMC,EAAwBC,IAAY,oBAAoB,iBAAiB,EAI/EC,EAAyB,iBAAiB,EAE1C,GAAI,CAEF,MAAMC,EAAmB,CACvB,KAAMJ,EAAM,KACZ,KAAM,CACJ,YAAa,KAAKA,EAAM,KAAK,UAAU,EACvC,WAAY,KAAKA,EAAM,KAAK,SAAS,EACrC,UAAWA,EAAM,KAAK,SACtB,UAAWA,EAAM,KAAK,UACtB,OAAQA,EAAM,KAAK,MAAA,EAErB,QAASA,EAAM,OAAS,KAAKA,EAAM,MAAM,EAAI,IAAA,EAG/C,OAAO,MAAMK,EAAiEP,EAA2B,CACvG,UAAW,CAAE,MAAOM,CAAA,CAAiB,CACtC,EACE,KAAME,GAAQ,SACb,IAAIC,EAAAD,EAAI,SAAJ,MAAAC,EAAY,OAAQ,OAAOC,EAAiBF,EAAI,MAAM,EAE1D,MAAMG,GAASC,EAAAJ,GAAA,YAAAA,EAAK,OAAL,YAAAI,EAAW,wBAC1B,OAAKD,EAEE,CACL,QAASA,EAAO,OAAA,EAHE,IAKtB,CAAC,EACA,MAAME,CAAkB,CAC7B,QAAA,CAEMV,GAA0B,MAC5BW,EAAsB,kBAAmBX,CAAqB,CAElE,CACF"}