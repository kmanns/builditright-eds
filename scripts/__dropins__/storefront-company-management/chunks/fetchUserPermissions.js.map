{"version":3,"file":"fetchUserPermissions.js","sources":["/@dropins/storefront-company-management/src/api/fetchUserPermissions/graphql/getCustomerRole.graphql.ts","/@dropins/storefront-company-management/src/api/fetchUserPermissions/fetchUserPermissions.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nexport const GET_CUSTOMER_ROLE_PERMISSIONS = /* GraphQL */ `\n  query GET_CUSTOMER_ROLE_PERMISSIONS {\n    customer {\n      role {\n        id\n        name\n        permissions {\n          id\n          text\n          children {\n            id\n            text\n            children {\n              id\n              text\n              children {\n                id\n                text\n                children { \n                  id \n                  text \n                }\n              }\n            }\n          }\n        }\n      }\n      status\n    }\n  }\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport { fetchGraphQl } from '../fetch-graphql';\nimport { handleNetworkError, handleFetchError, flattenIds, isCompanyAdministrator, getAdminPermissions } from '@/company-management/lib';\nimport { GET_CUSTOMER_ROLE_PERMISSIONS } from './graphql/getCustomerRole.graphql';\nimport type { FetchUserPermissionsResponse, FetchUserPermissionsResult } from '../../types/api/fetchUserPermissions.types';\n\n/**\n * Fetches user permissions and returns both the allowed permission IDs and the role response\n * This is a general-purpose API function that can be used across the application\n * \n * @returns Promise resolving to object containing allowed permission IDs and role response\n * @throws {Error} When network errors or GraphQL errors occur\n */\nexport async function fetchUserPermissions(): Promise<FetchUserPermissionsResult> {\n  return await fetchGraphQl(GET_CUSTOMER_ROLE_PERMISSIONS, { \n    method: 'GET', \n    cache: 'no-cache' \n  })\n    .then((roleResponse: FetchUserPermissionsResponse) => {\n      if (roleResponse.errors?.length) {\n        return handleFetchError(roleResponse.errors);\n      }\n\n      const role = roleResponse?.data?.customer?.role;\n      const allowedIds = flattenIds(role?.permissions || []);\n\n      const isAdmin = isCompanyAdministrator(role);\n      if (isAdmin) {\n        getAdminPermissions().forEach((id) => allowedIds.add(id));\n      }\n\n      return { allowedIds, roleResponse };\n    })\n    .catch(handleNetworkError);\n}\n"],"names":["GET_CUSTOMER_ROLE_PERMISSIONS","fetchUserPermissions","fetchGraphQl","roleResponse","_a","handleFetchError","role","_c","_b","allowedIds","flattenIds","isCompanyAdministrator","getAdminPermissions","id","handleNetworkError"],"mappings":"8IAgBO,MAAMA,EAA8C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECY3D,eAAsBC,GAA4D,CAChF,OAAO,MAAMC,EAAaF,EAA+B,CACvD,OAAQ,MACR,MAAO,UAAA,CACR,EACE,KAAMG,GAA+C,WACpD,IAAIC,EAAAD,EAAa,SAAb,MAAAC,EAAqB,OACvB,OAAOC,EAAiBF,EAAa,MAAM,EAG7C,MAAMG,GAAOC,GAAAC,EAAAL,GAAA,YAAAA,EAAc,OAAd,YAAAK,EAAoB,WAApB,YAAAD,EAA8B,KACrCE,EAAaC,GAAWJ,GAAA,YAAAA,EAAM,cAAe,CAAA,CAAE,EAGrD,OADgBK,EAAuBL,CAAI,GAEzCM,EAAA,EAAsB,QAASC,GAAOJ,EAAW,IAAII,CAAE,CAAC,EAGnD,CAAE,WAAAJ,EAAY,aAAAN,CAAA,CACvB,CAAC,EACA,MAAMW,CAAkB,CAC7B"}