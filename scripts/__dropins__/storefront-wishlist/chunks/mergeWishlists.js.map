{"version":3,"file":"mergeWishlists.js","sources":["/@dropins/storefront-wishlist/src/api/initialize/initialize.ts","/@dropins/storefront-wishlist/src/data/transforms/transform-store-config.ts","/@dropins/storefront-wishlist/src/data/transforms/transform-wishlist.ts","/@dropins/storefront-wishlist/src/api/getStoreConfig/graphql/StoreConfigQuery.ts","/@dropins/storefront-wishlist/src/api/getStoreConfig/getStoreConfig.ts","/@dropins/storefront-wishlist/src/api/graphql/CustomizableOptionsFragment.graphql.ts","/@dropins/storefront-wishlist/src/api/graphql/WishlistItemFragment.graphql.ts","/@dropins/storefront-wishlist/src/api/graphql/WishlistFragment.graphql.ts","/@dropins/storefront-wishlist/src/api/getWishlists/graphql/getWishlists.graphql.ts","/@dropins/storefront-wishlist/src/api/getWishlists/getWishlists.ts","/@dropins/storefront-wishlist/src/api/addProductsToWishlist/graphql/addProductsToWishlistMutation.ts","/@dropins/storefront-wishlist/src/api/addProductsToWishlist/addProductsToWishlist.ts","/@dropins/storefront-wishlist/src/api/resetWishlist/resetWishlist.ts","/@dropins/storefront-wishlist/src/api/initializeWishlist/initializeWishlist.ts","/@dropins/storefront-wishlist/src/api/mergeWishlists/mergeWishlists.ts"],"sourcesContent":["import { Initializer } from '@adobe-commerce/elsie/lib';\nimport { Lang } from '@adobe-commerce/elsie/i18n';\nimport { events } from '@adobe-commerce/event-bus';\nimport { state } from '@/wishlist/lib/state';\nimport {\n  initializeWishlist,\n  resetWishlist,\n  mergeWishlists,\n} from '@/wishlist/api';\nimport { setPersistedWishlistData } from '@/wishlist/lib/persisted-data';\n\ntype ConfigProps = {\n  langDefinitions?: Lang;\n  isGuestWishlistEnabled?: boolean;\n};\n\nexport const initialize = new Initializer<ConfigProps>({\n  init: async (config) => {\n    const defaultConfig = { isGuestWishlistEnabled: false, ...config };\n\n    initialize.config.setConfig(defaultConfig);\n    initializeWishlist().catch(console.error);\n  },\n\n  listeners: () => [\n    events.on(\n      'wishlist/data',\n      (payload) => {\n        setPersistedWishlistData(payload);\n      },\n      { eager: true }\n    ),\n    events.on(\n      'authenticated',\n      async (authenticated) => {\n        if (state.authenticated && !authenticated) {\n          // Reset wishlist if the user is no longer authenticated\n          events.emit('wishlist/reset', undefined);\n        }\n        // Login event occurred\n        if (authenticated && !state.authenticated) {\n          state.authenticated = authenticated;\n          const wishlist = await initializeWishlist().catch(console.error);\n          if (wishlist) {\n            mergeWishlists(wishlist);\n          }\n        }\n      },\n      { eager: true }\n    ),\n    events.on('wishlist/reset', () => {\n      resetWishlist().catch(console.error);\n      events.emit('wishlist/data', null);\n    }),\n  ],\n});\n\nexport const config = initialize.config;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { StoreConfigModel } from '@/wishlist/data/models';\n\nexport function transformStoreConfig(data: any): StoreConfigModel | null {\n  if (!data) return null;\n\n  return {\n    wishlistIsEnabled: data.storeConfig.magento_wishlist_general_is_enabled,\n    wishlistMultipleListIsEnabled: data.storeConfig.enable_multiple_wishlists,\n    wishlistMaxNumber: data.storeConfig.maximum_number_of_wishlists,\n  };\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport { Wishlist, Item, Option } from '@/wishlist/data/models/wishlist';\n\nexport function transformWishlist(\n  data: any,\n  enteredOptions?: { uid: string; value: string }[]\n): Wishlist | null {\n  if (!data) return null;\n\n  return {\n    id: data.id,\n    updated_at: data.updated_at,\n    sharing_code: data.sharing_code,\n    items_count: data.items_count,\n    items: transformItems(data, enteredOptions ?? []),\n  };\n}\n\nfunction transformItems(\n  data: any,\n  enteredOptions: { uid: string; value: string }[]\n): Item[] {\n  if (!data?.items_v2?.items?.length) return [];\n\n  return data.items_v2.items.map((item: any) => {\n    const selectedOptions = getSelectedOptions(item);\n    return {\n      id: item.id,\n      quantity: item.quantity,\n      description: item.description,\n      added_at: item.added_at,\n      enteredOptions,\n      selectedOptions,\n      product: { sku: item.product.sku },\n    };\n  });\n}\n\nfunction getSelectedOptions(item: Item): Option[] {\n  if (item.__typename === 'ConfigurableWishlistItem') {\n    return item.configurable_options\n      ? item.configurable_options.map((option: any) => ({\n          uid: option.configurable_product_option_value_uid,\n        }))\n      : [];\n  }\n  if (item.__typename === 'BundleWishlistItem') {\n    const values = (item.bundle_options ?? []).flatMap(\n      (option: any) => option.values ?? []\n    );\n    return values.map((value: any) => ({ uid: value.uid }));\n  }\n  return [];\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const STORE_CONFIG_QUERY = `\nquery STORE_CONFIG_QUERY {\n  storeConfig {\n    magento_wishlist_general_is_enabled\n    enable_multiple_wishlists\n    maximum_number_of_wishlists\n  }\n}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/wishlist/api';\nimport { StoreConfigModel } from '@/wishlist/data/models';\nimport { transformStoreConfig } from '@/wishlist/data/transforms';\nimport { handleFetchError } from '@/wishlist/lib/fetch-error';\n\nimport { STORE_CONFIG_QUERY } from './graphql/StoreConfigQuery';\n\nexport const getStoreConfig = async (): Promise<StoreConfigModel | null> => {\n  return fetchGraphQl(STORE_CONFIG_QUERY, {\n    method: 'GET',\n    cache: 'force-cache',\n  }).then(({ errors, data }) => {\n    if (errors) return handleFetchError(errors);\n\n    return transformStoreConfig(data);\n  });\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const CUSTOMIZABLE_OPTIONS_FRAGMENT = `\n  fragment CUSTOMIZABLE_OPTIONS_FRAGMENT on SelectedCustomizableOption {\n    type\n    customizable_option_uid\n    label\n    is_required\n    values {\n      label\n      value\n      price{\n        type\n        units\n        value\n      }\n    }\n  }\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CUSTOMIZABLE_OPTIONS_FRAGMENT } from './CustomizableOptionsFragment.graphql';\n\nconst CONFIGURABLE_WISHLIST_ITEM_FRAGMENT = `\n  ... on ConfigurableWishlistItem {\n    configurable_options {\n      option_label\n      value_label\n      configurable_product_option_value_uid\n      configurable_product_option_uid\n    }\n    configured_variant {\n      canonical_url\n    }\n  }\n`;\n\nconst DOWNLOADABLE_WISHLIST_ITEM_FRAGMENT = `\n  ... on DownloadableWishlistItem {\n    added_at\n    description\n    links_v2 {\n      sample_url\n      sort_order\n      title\n      uid\n    }\n    quantity\n  }\n`;\n\nconst GIFT_CARD_WISHLIST_ITEM_FRAGMENT = `\n  ... on GiftCardWishlistItem {\n    added_at\n    description\n    gift_card_options {\n      amount {\n        value\n        currency\n      }\n      custom_giftcard_amount {\n        value\n        currency\n      }\n      message\n      recipient_email\n      recipient_name\n      sender_email\n      sender_name\n    }\n  }\n`;\n\nconst BUNDLE_WISHLIST_ITEM_FRAGMENT = `\n  ... on BundleWishlistItem {\n    bundle_options {\n      label\n      type\n      uid\n      values {\n        uid\n        label\n        quantity\n      }\n    }\n  }\n`;\n\nexport const WISHLIST_ITEM_FRAGMENT = `\nfragment WISHLIST_ITEM_FRAGMENT on WishlistItemInterface {\n    __typename\n    id\n    quantity\n    description\n    added_at\n    product {\n      sku\n    }\n    ${CONFIGURABLE_WISHLIST_ITEM_FRAGMENT}\n    ${DOWNLOADABLE_WISHLIST_ITEM_FRAGMENT}\n    ${GIFT_CARD_WISHLIST_ITEM_FRAGMENT}\n    ${BUNDLE_WISHLIST_ITEM_FRAGMENT}\n    customizable_options {\n      ...CUSTOMIZABLE_OPTIONS_FRAGMENT\n    }\n  }\n  \n  ${CUSTOMIZABLE_OPTIONS_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { WISHLIST_ITEM_FRAGMENT } from '@/wishlist/api/fragments';\n\nexport const WISHLIST_FRAGMENT = `\nfragment WISHLIST_FRAGMENT on Wishlist {\n    id\n    updated_at\n    sharing_code\n    items_count\n    items_v2 {\n      items {\n        ...WISHLIST_ITEM_FRAGMENT\n      }\n    }\n  }\n\n${WISHLIST_ITEM_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { WISHLIST_FRAGMENT } from '@/wishlist/api/fragments';\n\nexport const GET_WISHLISTS_QUERY = `\n  query GET_WISHLISTS_QUERY {\n    customer {\n      wishlists {\n        ...WISHLIST_FRAGMENT\n      }\n    }\n  }\n\n  ${WISHLIST_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { GET_WISHLISTS_QUERY } from '@/wishlist/api/getWishlists/graphql/getWishlists.graphql';\nimport { Wishlist } from '@/wishlist/data/models';\nimport { transformWishlist } from '@/wishlist/data/transforms';\nimport { state } from '@/wishlist/lib/state';\nimport { fetchGraphQl, getPersistedWishlistData } from '@/wishlist/api';\nimport { handleFetchError } from '@/wishlist/lib/fetch-error';\n\nexport const getWishlists = async (): Promise<void | Wishlist[] | null> => {\n  // When the user is not authenticated, we just have a single wishlist\n  // There is no necessity to check any IDs\n  if (!state.authenticated) {\n    return getPersistedWishlistData();\n  }\n\n  return fetchGraphQl(GET_WISHLISTS_QUERY).then(({ errors, data }) => {\n    if (errors) return handleFetchError(errors);\n\n    if (!data?.customer?.wishlists) {\n      return null;\n    }\n\n    return data.customer.wishlists.map((wishlist: any) =>\n      transformWishlist(wishlist)\n    );\n  });\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { WISHLIST_FRAGMENT } from '@/wishlist/api/fragments';\n\nexport const ADD_PRODUCTS_TO_WISHLIST_MUTATION = `\n  mutation ADD_PRODUCTS_TO_WISHLIST_MUTATION(\n      $wishlistId: ID!, \n      $wishlistItems: [WishlistItemInput!]!,\n    ) {\n    addProductsToWishlist(\n      wishlistId: $wishlistId\n      wishlistItems: $wishlistItems\n    ) {\n      wishlist {\n        ...WISHLIST_FRAGMENT\n      }\n      user_errors {\n        code\n        message\n      }\n    }\n  }\n${WISHLIST_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { fetchGraphQl, getPersistedWishlistData } from '@/wishlist/api';\nimport { state } from '@/wishlist/lib/state';\nimport { handleFetchError } from '@/wishlist/lib/fetch-error';\nimport { ADD_PRODUCTS_TO_WISHLIST_MUTATION } from './graphql/addProductsToWishlistMutation';\nimport { Wishlist } from '@/wishlist/data/models/wishlist';\nimport { transformWishlist } from '@/wishlist/data/transforms';\nimport { events } from '@adobe-commerce/event-bus';\nimport { isMatchingWishlistItem } from '@/wishlist/lib/wishlist-item-comparator';\n\nexport const addProductsToWishlist = async (\n  items: [\n    {\n      sku: string;\n      quantity: number;\n      optionsUIDs?: string[]; // should be the options available for the product\n      enteredOptions?: { uid: string; value: string }[]; // refer to both selected and entered options\n    }\n  ]\n): Promise<Wishlist | null> => {\n  if (!items) return null;\n\n  const wishlist = getPersistedWishlistData();\n  let updatedWishlist = {\n    id: wishlist?.id ?? '',\n    updated_at: '',\n    sharing_code: '',\n    items_count: 0,\n    items: wishlist?.items ?? [],\n  };\n\n  for (const item of items) {\n    const skuExists = updatedWishlist.items?.some((wishlistItem: any) =>\n      isMatchingWishlistItem(wishlistItem, {\n        sku: item.sku,\n        optionUIDs: item.optionsUIDs,\n      })\n    );\n\n    if (skuExists) {\n      continue;\n    }\n\n    const selectedOptions: { uid: string }[] = item.optionsUIDs\n      ? item.optionsUIDs?.map((option: any) => ({\n          uid: option,\n        }))\n      : [];\n\n    updatedWishlist.items = [\n      ...updatedWishlist.items,\n      {\n        id: crypto.randomUUID(),\n        quantity: item.quantity,\n        selectedOptions,\n        enteredOptions: item.enteredOptions ?? [],\n        product: { sku: item.sku },\n      },\n    ];\n  }\n\n  updatedWishlist.items_count = updatedWishlist.items?.length;\n  events.emit('wishlist/data', updatedWishlist);\n\n  if (state.authenticated) {\n    if (!state.wishlistId) {\n      events.emit('wishlist/data', wishlist);\n      throw Error('Wishlist ID is not set');\n    }\n\n    const variables = {\n      wishlistId: state.wishlistId,\n      wishlistItems: items.map(\n        ({ sku, quantity, optionsUIDs, enteredOptions }) => ({\n          sku,\n          quantity,\n          selected_options: optionsUIDs,\n          entered_options: enteredOptions,\n        })\n      ),\n    };\n\n    const { errors, data }: { errors: any; data: any } = await fetchGraphQl(\n      ADD_PRODUCTS_TO_WISHLIST_MUTATION,\n      { variables }\n    );\n\n    const _errors = [\n      ...(data?.addProductsToWishlist?.user_errors ?? []),\n      ...(errors ?? []),\n    ];\n\n    // if saving item to wishlist for logged user failed, we need to restore original wishlist in storage:\n    if (_errors.length > 0) {\n      events.emit('wishlist/data', wishlist);\n      return handleFetchError(_errors);\n    }\n\n    const updatedWishlist = transformWishlist(\n      data.addProductsToWishlist.wishlist,\n      items[0]?.enteredOptions ?? []\n    );\n    events.emit('wishlist/data', updatedWishlist);\n  }\n\n  return null;\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { state } from '@/wishlist/lib/state';\nimport { Wishlist } from '@/wishlist/data/models';\n\nexport const resetWishlist = (): Promise<Wishlist | null> => {\n  state.wishlistId = null;\n  state.authenticated = false;\n\n  return Promise.resolve(null);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { events } from '@adobe-commerce/event-bus';\nimport { state } from '@/wishlist/lib/state';\nimport { getStoreConfig, getWishlists } from '@/wishlist/api';\nimport { getPersistedWishlistData } from '@/wishlist/lib/persisted-data';\nimport { Wishlist } from '@/wishlist/data/models';\n\nexport const initializeWishlist = async (): Promise<Wishlist | null> => {\n  if (state.initializing) return null;\n\n  state.initializing = true;\n\n  // set config\n  if (!state.config) {\n    state.config = await getStoreConfig();\n  }\n\n  const payload = state.authenticated\n    ? await getDefaultWishlist()\n    : await getGuestWishlist();\n\n  events.emit('wishlist/initialized', payload);\n  events.emit('wishlist/data', payload);\n\n  state.initializing = false;\n\n  return payload;\n};\n\nexport async function getDefaultWishlist() {\n  const wishlists = await getWishlists();\n  const wishlist = wishlists ? wishlists[0] : null;\n  if (!wishlist) return null;\n\n  state.wishlistId = wishlist.id;\n\n  return wishlist;\n}\n\nexport async function getGuestWishlist() {\n  try {\n    return await getPersistedWishlistData();\n  } catch (error) {\n    console.error(error);\n    throw error;\n  }\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { Wishlist, Item } from '@/wishlist/data/models';\nimport { addProductsToWishlist } from '@/wishlist/api';\nimport {\n  getPersistedWishlistData,\n  clearPersistedLocalStorage,\n} from '@/wishlist/lib/persisted-data';\nimport { isMatchingWishlistItem } from '@/wishlist/lib/wishlist-item-comparator';\n\nexport const mergeWishlists = async (\n  wishlist: Wishlist\n): Promise<Wishlist | null> => {\n  if (!wishlist) {\n    return null;\n  }\n\n  const guestWishlist: {\n    id?: string;\n    items?: Item[];\n  } = getPersistedWishlistData(true);\n  const itemsToMerge: any[] = [];\n\n  guestWishlist?.items?.forEach((item: any) => {\n    const optionUIDs =\n      item.selectedOptions?.map((option: any) => option.uid) || [];\n\n    const exists = wishlist.items.some((wishlistItem: any) =>\n      isMatchingWishlistItem(wishlistItem, {\n        sku: item.product.sku,\n        optionUIDs,\n      })\n    );\n\n    if (!exists) {\n      const mergeItem = {\n        sku: item.product.sku,\n        quantity: 1,\n        optionsUIDs: optionUIDs,\n        enteredOptions: item.enteredOptions || undefined,\n      };\n\n      itemsToMerge.push(mergeItem);\n    }\n  });\n\n  if (itemsToMerge.length === 0) {\n    return null;\n  }\n\n  const result = await addProductsToWishlist(itemsToMerge);\n  clearPersistedLocalStorage();\n  return result;\n};\n"],"names":["initialize","Initializer","config","defaultConfig","initializeWishlist","events","payload","setPersistedWishlistData","authenticated","state","wishlist","mergeWishlists","resetWishlist","transformStoreConfig","data","transformWishlist","enteredOptions","transformItems","_b","_a","item","selectedOptions","getSelectedOptions","option","value","STORE_CONFIG_QUERY","getStoreConfig","fetchGraphQl","errors","handleFetchError","CUSTOMIZABLE_OPTIONS_FRAGMENT","CONFIGURABLE_WISHLIST_ITEM_FRAGMENT","DOWNLOADABLE_WISHLIST_ITEM_FRAGMENT","GIFT_CARD_WISHLIST_ITEM_FRAGMENT","BUNDLE_WISHLIST_ITEM_FRAGMENT","WISHLIST_ITEM_FRAGMENT","WISHLIST_FRAGMENT","GET_WISHLISTS_QUERY","getWishlists","getPersistedWishlistData","ADD_PRODUCTS_TO_WISHLIST_MUTATION","addProductsToWishlist","items","updatedWishlist","wishlistItem","isMatchingWishlistItem","_c","variables","sku","quantity","optionsUIDs","_errors","_d","_e","getDefaultWishlist","getGuestWishlist","wishlists","error","guestWishlist","itemsToMerge","optionUIDs","mergeItem","result","clearPersistedLocalStorage"],"mappings":"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"}