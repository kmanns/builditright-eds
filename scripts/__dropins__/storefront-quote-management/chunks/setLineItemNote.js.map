{"version":3,"file":"setLineItemNote.js","sources":["/@dropins/storefront-quote-management/src/api/updateQuantities/graphql/UpdateNegotiableQuoteQuantitiesMutation.ts","/@dropins/storefront-quote-management/src/api/updateQuantities/updateQuantities.ts","/@dropins/storefront-quote-management/src/api/removeNegotiableQuoteItems/graphql/RemoveNegotiableQuoteItemsMutation.ts","/@dropins/storefront-quote-management/src/api/removeNegotiableQuoteItems/removeNegotiableQuoteItems.ts","/@dropins/storefront-quote-management/src/api/setLineItemNote/graphql/SetLineItemNoteMutation.ts","/@dropins/storefront-quote-management/src/api/setLineItemNote/setLineItemNote.ts"],"sourcesContent":["/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { NEGOTIABLE_QUOTE_FRAGMENT } from '@/quote-management/api/graphql/NegotiableQuoteFragment';\n\nexport const UPDATE_NEGOTIABLE_QUOTE_QUANTITIES_MUTATION = `\n  mutation UPDATE_NEGOTIABLE_QUOTE_QUANTITIES_MUTATION(\n    $quoteUid: ID!\n    $items: [NegotiableQuoteItemQuantityInput!]!\n  ) {\n    updateNegotiableQuoteQuantities(\n      input: {\n        quote_uid: $quoteUid\n        items: $items\n      }\n    ) {\n      quote {\n        ...NegotiableQuoteFragment\n      }\n    }\n  }\n  ${NEGOTIABLE_QUOTE_FRAGMENT}\n`;\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/quote-management/api';\nimport { events } from '@adobe-commerce/event-bus';\nimport { state } from '@/quote-management/lib/state';\nimport { UPDATE_NEGOTIABLE_QUOTE_QUANTITIES_MUTATION } from './graphql/UpdateNegotiableQuoteQuantitiesMutation';\nimport { NegotiableQuoteModel } from '@/quote-management/data/models/negotiable-quote-model';\nimport { transformQuote } from '@/quote-management/data/transforms';\n\nexport interface QuantityItem {\n  /** The unique ID of the quote item */\n  quoteItemUid: string;\n  /** The new quantity for the item (must be greater than 0) */\n  quantity: number;\n}\n\nexport interface UpdateQuantitiesInput {\n  /** The unique ID of the negotiable quote */\n  quoteUid: string;\n  /** Array of items with their new quantities */\n  items: QuantityItem[];\n}\n\n/**\n * Updates the quantities of items in a negotiable quote.\n *\n * @param input - The input parameters for updating quantities\n * @param input.quoteUid - The unique ID of the negotiable quote\n * @param input.items - Array of items with their new quantities\n * @returns Promise that resolves to the updated quote model\n * @throws Error if validation fails or GraphQL operation fails\n *\n * @example\n * ```ts\n * const quote = await updateQuantities({\n *   quoteUid: 'quote-123',\n *   items: [\n *     { quoteItemUid: 'item-1', quantity: 5 },\n *     { quoteItemUid: 'item-2', quantity: 3 }\n *   ]\n * });\n * ```\n */\nexport const updateQuantities = async (\n  input: UpdateQuantitiesInput\n): Promise<NegotiableQuoteModel | null> => {\n  if (!state.authenticated) {\n    return Promise.reject(new Error('Unauthorized'));\n  }\n\n  const { quoteUid, items } = input;\n\n  // Validate quoteUid\n  if (!quoteUid) {\n    throw new Error('Quote UID is required');\n  }\n\n  // Validate items array\n  if (!items || !Array.isArray(items) || items.length === 0) {\n    throw new Error('Items array is required and must not be empty');\n  }\n\n  // Validate each item\n  for (const item of items) {\n    if (!item.quoteItemUid) {\n      throw new Error('Each item must have a quoteItemUid');\n    }\n    if (typeof item.quantity !== 'number' || item.quantity <= 0) {\n      throw new Error(\n        `Invalid quantity for item ${item.quoteItemUid}: quantity must be a positive number`\n      );\n    }\n    // Ensure quantity is an integer\n    if (!Number.isInteger(item.quantity)) {\n      throw new Error(\n        `Invalid quantity for item ${item.quoteItemUid}: quantity must be an integer`\n      );\n    }\n  }\n\n  // Transform items to snake_case for GraphQL\n  const transformedItems = items.map((item) => ({\n    quote_item_uid: item.quoteItemUid,\n    quantity: item.quantity,\n  }));\n\n  return fetchGraphQl(UPDATE_NEGOTIABLE_QUOTE_QUANTITIES_MUTATION, {\n    variables: {\n      quoteUid,\n      items: transformedItems,\n    },\n  }).then((response) => {\n    const { errors } = response;\n\n    if (errors) {\n      // Provide more detailed error information\n      const errorMessages = errors.map((error) => error.message).join('; ');\n      throw new Error(`Failed to update quote quantities: ${errorMessages}`);\n    }\n\n    // Transform the quote data\n    const quoteData = transformQuote(\n      response.data?.updateNegotiableQuoteQuantities?.quote\n    );\n\n    if (!quoteData) {\n      throw new Error(\n        'Failed to transform quote data: Invalid response structure'\n      );\n    }\n\n    // Emit event with transformed quote data on success\n    events.emit('quote-management/quantities-updated', {\n      quote: quoteData,\n      input: { quoteUid, items },\n    });\n\n    return quoteData;\n  });\n};\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { NEGOTIABLE_QUOTE_FRAGMENT } from '@/quote-management/api/graphql/NegotiableQuoteFragment';\n\nexport const REMOVE_NEGOTIABLE_QUOTE_ITEMS_MUTATION = `\n  mutation REMOVE_NEGOTIABLE_QUOTE_ITEMS_MUTATION(\n    $quoteUid: ID!\n    $quoteItemUids: [ID!]!\n  ) {\n    removeNegotiableQuoteItems(\n      input: {\n        quote_uid: $quoteUid\n        quote_item_uids: $quoteItemUids\n      }\n    ) {\n      quote {\n        ...NegotiableQuoteFragment\n      }\n    }\n  }\n  ${NEGOTIABLE_QUOTE_FRAGMENT}\n`;\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/quote-management/api';\nimport { events } from '@adobe-commerce/event-bus';\nimport { state } from '@/quote-management/lib/state';\nimport { NegotiableQuoteModel } from '@/quote-management/data/models/negotiable-quote-model';\nimport { transformQuote } from '@/quote-management/data/transforms';\nimport { REMOVE_NEGOTIABLE_QUOTE_ITEMS_MUTATION } from './graphql/RemoveNegotiableQuoteItemsMutation';\n\nexport interface RemoveNegotiableQuoteItemsInput {\n  quoteUid: string;\n  quoteItemUids: string[];\n}\n\nexport const removeNegotiableQuoteItems = async (\n  input: RemoveNegotiableQuoteItemsInput\n): Promise<NegotiableQuoteModel | null> => {\n  if (!state.authenticated) {\n    return Promise.reject(new Error('Unauthorized'));\n  }\n\n  const { quoteUid, quoteItemUids } = input;\n\n  if (!quoteUid) {\n    throw new Error('Quote UID is required');\n  }\n\n  if (!Array.isArray(quoteItemUids) || quoteItemUids.length === 0) {\n    throw new Error('At least one quote item UID is required');\n  }\n\n  const response = await fetchGraphQl(REMOVE_NEGOTIABLE_QUOTE_ITEMS_MUTATION, {\n    variables: {\n      quoteUid,\n      quoteItemUids,\n    },\n  });\n\n  const { errors, data } = response;\n\n  if (errors?.length) {\n    const errorMessages = errors.map((error) => error.message).join('; ');\n    throw new Error(\n      `Failed to remove negotiable quote items: ${errorMessages}`\n    );\n  }\n\n  const quote = transformQuote(data?.removeNegotiableQuoteItems?.quote);\n\n  if (!quote) {\n    throw new Error(\n      'Failed to transform quote data: Invalid response structure'\n    );\n  }\n\n  events.emit('quote-management/quote-items-removed', {\n    quote,\n    removedItemUids: quoteItemUids,\n    input,\n  });\n\n  return quote;\n};\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { NEGOTIABLE_QUOTE_FRAGMENT } from '@/quote-management/api/graphql/NegotiableQuoteFragment';\n\nexport const SET_LINE_ITEM_NOTE_MUTATION = /* GraphQL */ `\n  mutation SET_LINE_ITEM_NOTE_MUTATION($input: LineItemNoteInput!) {\n    setLineItemNote(input: $input) {\n      quote {\n        ...NegotiableQuoteFragment\n      }\n    }\n  }\n  ${NEGOTIABLE_QUOTE_FRAGMENT}\n`;\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/quote-management/api';\nimport { events } from '@adobe-commerce/event-bus';\nimport { SET_LINE_ITEM_NOTE_MUTATION } from './graphql/SetLineItemNoteMutation';\nimport { NegotiableQuoteModel } from '@/quote-management/data/models/negotiable-quote-model';\nimport { transformQuote } from '@/quote-management/data/transforms';\nimport { state } from '@/quote-management/lib/state';\n\nexport interface SetLineItemNoteInput {\n  quoteUid: string;\n  itemUid: string;\n  note: string;\n  quantity?: number;\n}\n\nexport const setLineItemNote = async (\n  input: SetLineItemNoteInput\n): Promise<NegotiableQuoteModel | null> => {\n  if (!state.authenticated) {\n    throw new Error('Unauthorized');\n  }\n\n  const { quoteUid, itemUid, note, quantity } = input;\n\n  if (!quoteUid) {\n    throw new Error('Quote UID is required');\n  }\n\n  if (!itemUid) {\n    throw new Error('Item UID is required');\n  }\n\n  if (!note) {\n    throw new Error('Note is required');\n  }\n\n  // Build the mutation input\n  const mutationInput: any = {\n    quote_uid: quoteUid,\n    quote_item_uid: itemUid,\n    note: note.trim(),\n  };\n\n  return fetchGraphQl(SET_LINE_ITEM_NOTE_MUTATION, {\n    variables: {\n      input: mutationInput,\n    },\n  }).then((response) => {\n    const { errors } = response;\n\n    if (errors) {\n      // Provide more detailed error information\n      const errorMessages = errors.map((error) => error.message).join('; ');\n      throw new Error(`Failed to set line item note: ${errorMessages}`);\n    }\n\n    // Transform the quote data\n    const quoteData = transformQuote(response.data?.setLineItemNote?.quote);\n\n    if (!quoteData) {\n      throw new Error(\n        'Failed to transform quote data: Invalid response structure'\n      );\n    }\n\n    // Emit event with transformed quote data on success\n    events.emit('quote-management/line-item-note-set', {\n      quote: quoteData,\n      input: { quoteUid, itemUid, note, quantity },\n    });\n\n    // Also emit the general quote-data event to update all listeners\n    events.emit('quote-management/quote-data', {\n      quote: quoteData,\n      permissions: state.permissions,\n    });\n\n    return quoteData;\n  });\n};\n"],"names":["UPDATE_NEGOTIABLE_QUOTE_QUANTITIES_MUTATION","NEGOTIABLE_QUOTE_FRAGMENT","updateQuantities","input","state","quoteUid","items","item","transformedItems","fetchGraphQl","response","errors","errorMessages","error","quoteData","transformQuote","_b","_a","events","REMOVE_NEGOTIABLE_QUOTE_ITEMS_MUTATION","removeNegotiableQuoteItems","quoteItemUids","data","quote","SET_LINE_ITEM_NOTE_MUTATION","setLineItemNote","itemUid","note","quantity","mutationInput"],"mappings":"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"}