{"version":3,"file":"transform-quote-template.js","sources":["/@dropins/storefront-quote-management/src/data/models/negotiable-quote-template-model.ts","/@dropins/storefront-quote-management/src/data/transforms/transform-quote-template.ts"],"sourcesContent":["/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport {\n  Currency,\n  PaginationInfo,\n  ShippingAddress,\n  NegotiableQuoteHistoryEntry,\n  CartItemModel,\n} from './negotiable-quote-model';\n\nexport interface NegotiableQuoteTemplateModel {\n  id: string;\n  uid: string;\n  name: string;\n  createdAt: string;\n  updatedAt: string;\n  expirationDate?: string;\n  status: NegotiableQuoteTemplateStatus;\n  salesRepName: string;\n  buyer: {\n    firstname: string;\n    lastname: string;\n  };\n  comments?: QuoteTemplateComment[];\n  history?: NegotiableQuoteHistoryEntry[];\n  prices: {\n    subtotalExcludingTax?: Currency;\n    subtotalIncludingTax?: Currency;\n    subtotalWithDiscountExcludingTax?: Currency;\n    grandTotal?: Currency;\n    appliedTaxes?: {\n      amount: Currency;\n      label: string;\n    }[];\n  };\n  items: CartItemModel[];\n  shippingAddresses?: ShippingAddress[];\n  referenceDocuments?: {\n    uid: string;\n    name: string;\n    identifier?: string;\n    url: string;\n  }[];\n  // Template-specific fields\n  quantityThresholds?: {\n    min?: number;\n    max?: number;\n  };\n  canAccept: boolean;\n  canDelete: boolean;\n  canReopen: boolean;\n  canCancel: boolean;\n  canSendForReview: boolean;\n  canGenerateQuoteFromTemplate: boolean;\n  canEditTemplateItems: boolean;\n}\n\nexport enum NegotiableQuoteTemplateStatus {\n  ACTIVE = 'Active',\n  IN_REVIEW = 'In Review',\n  INACTIVE = 'Inactive',\n  SUBMITTED = 'Submitted',\n  PENDING = 'Pending',\n  CLOSED = 'Closed',\n  OPEN = 'Open',\n  UPDATED = 'Updated',\n  EDITED = 'Edited',\n  NEW = 'New',\n  DRAFT = 'Draft',\n  DECLINED = 'Declined',\n  CANCELED = 'Canceled',\n  EXPIRED = 'Expired',\n}\n\n\nexport interface QuoteTemplateComment {\n  uid: string;\n  createdAt: string;\n  author: {\n    firstname: string;\n    lastname: string;\n  };\n  text: string;\n  attachments?: {\n    name: string;\n    url: string;\n  }[];\n}\n\n// List model for getQuoteTemplates\nexport interface NegotiableQuoteTemplatesListModel {\n  items: NegotiableQuoteTemplateListEntry[];\n  pageInfo: {\n    currentPage: number;\n    pageSize: number;\n    totalPages: number;\n  };\n  totalCount: number;\n  paginationInfo?: PaginationInfo;\n  sortFields?: {\n    default: string;\n    options: Array<{\n      label: string;\n      value: string;\n    }>;\n  };\n}\n\nexport interface NegotiableQuoteTemplateListEntry {\n  id: string;\n  uid: string;\n  name: string;\n  createdAt: string;\n  updatedAt: string;\n  status: NegotiableQuoteTemplateStatus;\n  state: 'active' | 'inactive' | 'in_review';\n  lastSharedAt: string;\n  lastOrderedAt: string;\n  expirationDate: string;\n  ordersPlaced: number;\n  prices: {\n    grandTotal: Currency;\n    minNegotiatedGrandTotal: Currency;\n  };\n  canGenerateQuoteFromTemplate?: boolean;\n}\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport {\n  NegotiableQuoteTemplateModel,\n  NegotiableQuoteTemplatesListModel,\n  NegotiableQuoteTemplateStatus,\n} from '../models/negotiable-quote-template-model';\nimport { transformPaginationInfo } from './transform-quote';\nimport { transformHistory } from './transform-history';\nimport { transformQuoteItems } from './transform-quote-items';\n\nexport function transformQuoteTemplate(\n  templateData: any\n): NegotiableQuoteTemplateModel | null {\n  if (!templateData) {\n    return null;\n  }\n\n  return {\n    id: templateData.template_id,\n    uid: templateData.uid,\n    name: templateData.name,\n    createdAt: templateData.created_at,\n    updatedAt: templateData.updated_at,\n    expirationDate: templateData.expiration_date,\n    status: templateData.status,\n    salesRepName: templateData.sales_rep_name,\n    buyer: {\n      firstname: templateData.buyer.firstname,\n      lastname: templateData.buyer.lastname,\n    },\n    comments: templateData.comments?.map((comment: any) => ({\n      uid: comment.uid,\n      createdAt: comment.created_at,\n      author: {\n        firstname: comment.author.firstname,\n        lastname: comment.author.lastname,\n      },\n      text: comment.text,\n      attachments: comment.attachments?.map((a: any) => ({\n        name: a.name,\n        url: a.url,\n      })),\n    })),\n    prices: templateData.prices && {\n      subtotalExcludingTax: templateData.prices.subtotal_excluding_tax && {\n        value: templateData.prices.subtotal_excluding_tax.value,\n        currency: templateData.prices.subtotal_excluding_tax.currency,\n      },\n      subtotalIncludingTax: templateData.prices.subtotal_including_tax && {\n        value: templateData.prices.subtotal_including_tax.value,\n        currency: templateData.prices.subtotal_including_tax.currency,\n      },\n      subtotalWithDiscountExcludingTax: templateData.prices\n        .subtotal_with_discount_excluding_tax && {\n        value: templateData.prices.subtotal_with_discount_excluding_tax.value,\n        currency:\n          templateData.prices.subtotal_with_discount_excluding_tax.currency,\n      },\n      appliedTaxes: templateData.prices.applied_taxes?.map((tax: any) => ({\n        amount: { value: tax.amount.value, currency: tax.amount.currency },\n        label: tax.label,\n      })),\n      grandTotal: templateData.prices.grand_total && {\n        value: templateData.prices.grand_total.value,\n        currency: templateData.prices.grand_total.currency,\n      },\n    },\n    history: transformHistory(templateData.history),\n    items: transformQuoteItems(templateData.items),\n    shippingAddresses: templateData.shipping_addresses?.map((address: any) => ({\n      uid: address.uid,\n      firstname: address.firstname,\n      lastname: address.lastname,\n      company: address.company,\n      street: address.street,\n      city: address.city,\n      postcode: address.postcode,\n      country: {\n        code: address.country.code,\n        label: address.country.label,\n      },\n      telephone: address.telephone,\n      region: address.region\n        ? {\n            code: address.region.code,\n            label: address.region.label,\n            regionId: address.region.region_id,\n          }\n        : undefined,\n    })),\n    referenceDocuments: templateData.reference_document_links?.map((doc: any) => ({\n      uid: doc.link_id,\n      name: doc.document_name,\n      identifier: doc.document_identifier,\n      url: doc.reference_document_url,\n    })),\n    // Calculate permissions based on status\n    canAccept: [\n      NegotiableQuoteTemplateStatus.SUBMITTED,\n      NegotiableQuoteTemplateStatus.PENDING,\n      NegotiableQuoteTemplateStatus.OPEN,\n    ].includes(templateData.status),\n    canDelete: templateData.status === NegotiableQuoteTemplateStatus.DRAFT,\n    canReopen: [\n      NegotiableQuoteTemplateStatus.DECLINED,\n      NegotiableQuoteTemplateStatus.CANCELED,\n      NegotiableQuoteTemplateStatus.EXPIRED,\n    ].includes(templateData.status),\n    canCancel: [\n      NegotiableQuoteTemplateStatus.SUBMITTED,\n      NegotiableQuoteTemplateStatus.PENDING,\n      NegotiableQuoteTemplateStatus.OPEN,\n      NegotiableQuoteTemplateStatus.ACTIVE,\n      NegotiableQuoteTemplateStatus.EDITED,\n    ].includes(templateData.status),\n    canSendForReview: [\n      NegotiableQuoteTemplateStatus.OPEN,\n      NegotiableQuoteTemplateStatus.DRAFT,\n      NegotiableQuoteTemplateStatus.NEW,\n      NegotiableQuoteTemplateStatus.EDITED,\n    ].includes(templateData.status),\n    canGenerateQuoteFromTemplate: [\n      NegotiableQuoteTemplateStatus.ACTIVE,\n    ].includes(templateData.status),\n    canEditTemplateItems: [\n      NegotiableQuoteTemplateStatus.SUBMITTED,\n      NegotiableQuoteTemplateStatus.DRAFT,\n      NegotiableQuoteTemplateStatus.OPEN,\n      NegotiableQuoteTemplateStatus.EDITED,\n    ].includes(templateData.status),\n  };\n}\n\nexport function transformQuoteTemplatesList(\n  templatesData: any\n): NegotiableQuoteTemplatesListModel | null {\n  if (!templatesData) {\n    return null;\n  }\n\n  const transformedModel = {\n    items:\n      templatesData.items?.map((template: any) => ({\n        id: template.template_id,\n        uid: template.uid,\n        name: template.name,\n        createdAt: template.created_at,\n        updatedAt: template.updated_at,\n        status: template.status,\n        state: template.state,\n        prices: {\n          grandTotal: template.prices?.grand_total\n            ? {\n                value: template.prices.grand_total.value,\n                currency: template.prices.grand_total.currency,\n              }\n            : {\n                value: 0,\n                currency: 'USD',\n              },\n          minNegotiatedGrandTotal: {\n            value: template.min_negotiated_grand_total,\n            currency: template.prices?.grand_total?.currency || 'USD',\n          },\n        },\n        lastSharedAt: template.last_shared_at,\n        lastOrderedAt: template.last_ordered_at,\n        expirationDate: template.expiration_date,\n        ordersPlaced: template.orders_placed,\n        canGenerateQuoteFromTemplate: [\n          NegotiableQuoteTemplateStatus.ACTIVE,\n        ].includes(template.status),\n      })) || [],\n    pageInfo: {\n      currentPage: templatesData.page_info.current_page,\n      pageSize: templatesData.page_info.page_size,\n      totalPages: templatesData.page_info.total_pages,\n    },\n    totalCount: templatesData.total_count,\n    sortFields: templatesData.sort_fields\n      ? {\n          default: templatesData.sort_fields.default,\n          options: templatesData.sort_fields.options,\n        }\n      : undefined,\n  };\n\n  // Calculate pagination info\n  const paginationInfo = transformPaginationInfo(transformedModel);\n\n  return {\n    ...transformedModel,\n    paginationInfo: paginationInfo || undefined,\n  };\n}\n"],"names":["NegotiableQuoteTemplateStatus","transformQuoteTemplate","templateData","_a","comment","a","_b","tax","transformHistory","transformQuoteItems","_c","address","_d","doc","transformQuoteTemplatesList","templatesData","transformedModel","template","paginationInfo","transformPaginationInfo"],"mappings":"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"}