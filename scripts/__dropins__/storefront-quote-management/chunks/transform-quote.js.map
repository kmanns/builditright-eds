{"version":3,"file":"transform-quote.js","sources":["/@dropins/storefront-quote-management/src/data/models/negotiable-quote-model.ts","/@dropins/storefront-quote-management/src/api/fetch-graphql/fetch-graphql.ts","/@dropins/storefront-quote-management/src/data/transforms/transform-history.ts","/@dropins/storefront-quote-management/src/data/transforms/transform-quote-items.ts","/@dropins/storefront-quote-management/src/data/transforms/transform-quote.ts"],"sourcesContent":["/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nexport interface ShippingAddress {\n  /**\n   * The unique string identifier of the address\n   */\n  uid?: string;\n  firstname: string;\n  lastname: string;\n  company?: string;\n  street: string[];\n  city: string;\n  region?: {\n    code: string;\n    label: string;\n    regionId: number;\n  };\n  postcode: string;\n  country: {\n    code: string;\n    label: string;\n  };\n  telephone: string;\n}\n\nexport interface NegotiableQuoteModel {\n  uid: string;\n  name: string;\n  createdAt: string;\n  salesRepName: string;\n  expirationDate: string;\n  updatedAt: string;\n  status: NegotiableQuoteStatus;\n  isVirtual: boolean;\n  buyer: {\n    firstname: string;\n    lastname: string;\n  };\n  email?: string;\n  templateName?: string;\n  totalQuantity: number;\n  comments?: {\n    uid: string;\n    createdAt: string;\n    author: {\n      firstname: string;\n      lastname: string;\n    };\n    text: string;\n    attachments?: {\n      name: string;\n      url: string;\n    }[];\n  }[];\n  history?: NegotiableQuoteHistoryEntry[];\n  prices: {\n    appliedDiscounts?: Discount[];\n    appliedTaxes?: Tax[];\n    discount?: Currency;\n    grandTotal?: Currency;\n    grandTotalExcludingTax?: Currency;\n    shippingExcludingTax?: Currency;\n    shippingIncludingTax?: Currency;\n    subtotalExcludingTax?: Currency;\n    subtotalIncludingTax?: Currency;\n    subtotalWithDiscountExcludingTax?: Currency;\n    totalTax?: Currency;\n  };\n  items: CartItemModel[];\n  shippingAddresses?: ShippingAddress[];\n  canCheckout: boolean;\n  canSendForReview: boolean;\n  lockedForEditing?: boolean;\n  canDelete: boolean;\n  canClose: boolean;\n  canUpdateQuote: boolean;\n  readOnly: boolean;\n}\n\nexport interface ConfigurableOption {\n  optionLabel: string;\n  valueLabel: string;\n}\n\nexport interface BundleOption {\n  label: string;\n  values: {\n    label: string;\n    quantity: number;\n    originalPrice: Currency;\n    price: Currency;\n  }[];\n}\n\nexport interface CustomizableOption {\n  type: string;\n  label: string;\n  values: {\n    label: string;\n    value: string;\n  }[];\n}\n\nexport interface CartItemModel {\n  itemType: string;\n  uid: string;\n  product: {\n    uid: string;\n    sku: string;\n    name: string;\n    templateId?: string;\n    templateName?: string;\n    priceRange: {\n      maximumPrice: {\n        regularPrice: Currency;\n      };\n    };\n  };\n  image: ItemImage;\n  links?: ItemLinks;\n  discounted: boolean;\n  discountedTotal: Currency;\n  catalogDiscount: {\n    amountOff: number;\n    percentOff: number;\n  };\n  discounts: {\n    label: string;\n    value: string;\n    amount: Currency;\n  }[];\n  discountPercentage?: number;\n  insufficientQuantity?: boolean;\n  outOfStock?: boolean;\n  stockStatus: string;\n  quantity: number;\n  prices: {\n    regularPrice: Currency;\n    priceIncludingTax: Currency;\n    originalItemPrice: Currency;\n    originalRowTotal: Currency;\n    rowTotal: Currency;\n    rowTotalIncludingTax: Currency;\n  };\n  savingsAmount?: Currency;\n  configurableOptions?: ConfigurableOption[];\n  bundleOptions?: BundleOption[];\n  customizableOptions?: CustomizableOption[];\n  noteFromBuyer?: ItemNote[];\n  noteFromSeller?: ItemNote[];\n}\n\ninterface ItemImage {\n  src: string;\n  alt: string;\n}\n\ninterface ItemLinks {\n  count: number;\n  result: string;\n}\n\nexport interface ItemNote {\n  createdAt: string;\n  creatorId: number;\n  creatorType: number;\n  negotiableQuoteItemUid: string;\n  note: string;\n  noteUid: string;\n}\n\nexport interface Currency {\n  value: number;\n  currency: string;\n}\n\nexport interface Tax {\n  amount: Currency;\n  label: string;\n}\n\nexport interface Discount {\n  amount: Currency;\n  label: string;\n  coupon?: Coupon;\n}\n\nexport interface Coupon {\n  code: string;\n}\n\nexport interface NegotiableQuoteListEntry {\n  uid: string;\n  name: string;\n  createdAt: string;\n  updatedAt: string;\n  status: NegotiableQuoteStatus;\n  buyer: {\n    firstname: string;\n    lastname: string;\n  };\n  templateName: string;\n  prices: {\n    grandTotal: Currency;\n  };\n}\nexport interface NegotiableQuotesListModel {\n  items: NegotiableQuoteListEntry[];\n  pageInfo: {\n    currentPage: number;\n    pageSize: number;\n    totalPages: number;\n  };\n  totalCount: number;\n  paginationInfo?: PaginationInfo;\n  sortFields?: {\n    default: string;\n    options: Array<{\n      label: string;\n      value: string;\n    }>;\n  };\n}\n\nexport interface NegotiableQuoteHistoryEntry {\n  author: {\n    firstname: string;\n    lastname: string;\n  };\n  changeType: NegotiableQuoteHistoryEntryChangeType;\n  changes: {\n    commentAdded?: {\n      comment: string;\n    };\n    customChanges?: {\n      new_value: string;\n      old_value: string;\n      title: string;\n    };\n    expiration?: {\n      newExpiration: string;\n      oldExpiration: string;\n    };\n    productsRemoved?: {\n      productsRemovedFromCatalog: string[];\n      productsRemovedFromQuote?: {\n        uid: string;\n        name: string;\n        sku: string;\n        quantity: number;\n      }[];\n    };\n    statuses?: {\n      changes: {\n        newStatus: string;\n        oldStatus: string;\n      }[];\n    };\n    total?: {\n      newPrice: Currency;\n      oldPrice: Currency;\n    };\n  };\n  createdAt: string;\n  uid: string;\n}\n\nexport enum NegotiableQuoteHistoryEntryChangeType {\n  CREATED = 'CREATED',\n  UPDATED = 'UPDATED',\n  CLOSED = 'CLOSED',\n  UPDATED_BY_SYSTEM = 'UPDATED_BY_SYSTEM',\n}\n\n// See: https://experienceleague.adobe.com/en/docs/commerce-admin/b2b/quotes/quotes#quote-status\nexport enum NegotiableQuoteStatus {\n  NEW = 'NEW', // Currently not returned by the API, but is used to indicate a new quote\n  SUBMITTED = 'SUBMITTED',\n  PENDING = 'PENDING',\n  UPDATED = 'UPDATED',\n  OPEN = 'OPEN',\n  ORDERED = 'ORDERED',\n  CLOSED = 'CLOSED',\n  DECLINED = 'DECLINED',\n  EXPIRED = 'EXPIRED',\n  DRAFT = 'DRAFT',\n}\n\nexport interface PaginationInfo {\n  currentPage: number;\n  totalCount: number;\n  pageSize: number;\n  startItem: number;\n  endItem: number;\n  totalPages: number;\n  pageSizeOptions?: number[];\n}\n","import { FetchGraphQL } from '@adobe-commerce/fetch-graphql';\n\nexport const {\n  setEndpoint,\n  setFetchGraphQlHeader,\n  removeFetchGraphQlHeader,\n  setFetchGraphQlHeaders,\n  fetchGraphQl,\n  getConfig,\n} = new FetchGraphQL().getMethods();\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { NegotiableQuoteHistoryEntry, NegotiableQuoteHistoryEntryChangeType  } from '../models/negotiable-quote-model';\n\n/**\n * Transforms a history entry from the API format to the model format\n * @param historyEntry - Raw history entry from API\n * @returns Transformed history entry\n */\nexport function transformHistoryEntry(\n  historyEntry: any\n): NegotiableQuoteHistoryEntry {\n  return {\n    uid: historyEntry.uid,\n    createdAt: historyEntry.created_at,\n    author: {\n      firstname: historyEntry.author.firstname,\n      lastname: historyEntry.author.lastname,\n    },\n    changeType: historyEntry.change_type as NegotiableQuoteHistoryEntryChangeType,\n    changes: {\n      commentAdded: historyEntry.changes?.comment_added && {\n        comment: historyEntry.changes.comment_added.comment,\n      },\n      customChanges: historyEntry.changes?.custom_changes && {\n        new_value: historyEntry.changes.custom_changes.new_value,\n        old_value: historyEntry.changes.custom_changes.old_value,\n        title: historyEntry.changes.custom_changes.title,\n      },\n      expiration: historyEntry.changes?.expiration && {\n        newExpiration: historyEntry.changes.expiration.new_expiration,\n        oldExpiration: historyEntry.changes.expiration.old_expiration,\n      },\n      productsRemoved: historyEntry.changes?.products_removed && {\n        productsRemovedFromCatalog:\n          historyEntry.changes.products_removed.products_removed_from_catalog ||\n          [],\n        productsRemovedFromQuote:\n          historyEntry.changes.products_removed.products_removed_from_quote ||\n          [],\n      },\n      statuses: historyEntry.changes?.statuses && {\n        changes:\n          historyEntry.changes.statuses.changes?.map((change: any) => ({\n            newStatus: change?.new_status,\n            oldStatus: change?.old_status,\n          })) || [],\n      },\n      total:\n        historyEntry.changes?.total &&\n        historyEntry.changes.total.new_price &&\n        historyEntry.changes.total.old_price && {\n          newPrice: {\n            value: historyEntry.changes.total.new_price.value,\n            currency: historyEntry.changes.total.new_price.currency,\n          },\n          oldPrice: {\n            value: historyEntry.changes.total.old_price.value,\n            currency: historyEntry.changes.total.old_price.currency,\n          },\n        },\n    },\n  };\n}\n\n/**\n * Transforms an array of history entries from the API format to the model format\n * @param historyEntries - Array of raw history entries from API\n * @returns Array of transformed history entries\n */\nexport function transformHistory(\n  historyEntries: any[] | null | undefined\n): NegotiableQuoteHistoryEntry[] | undefined {\n  if (!historyEntries) {\n    return undefined;\n  }\n\n  return historyEntries.map(transformHistoryEntry);\n}\n\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { CartItemModel } from '../models/negotiable-quote-model';\nimport { state } from '@/quote-management/lib/state';\n\n/**\n * Finds the most applicable price tier for a given quantity\n * @param priceTiers - Array of price tier objects\n * @param quantity - Current item quantity\n * @returns The applicable tier or null if none found\n */\nfunction findApplicablePriceTier(priceTiers: any[], quantity: number) {\n  if (!priceTiers?.length) return null;\n\n  // Sort price tiers by quantity in descending order to find the highest applicable tier\n  const sortedTiers = [...priceTiers].sort(\n    (a: any, b: any) => b.quantity - a.quantity\n  );\n\n  // Find the highest tier where the current quantity meets or exceeds the tier's minimum quantity\n  return sortedTiers.find((tier: any) => quantity >= tier.quantity) || null;\n}\n\n/**\n * Helper function to get the image for a cart item component\n * @param item - Cart item from API\n * @returns Image object with src and alt\n */\nfunction getImage(item: any) {\n  const config = state.config;\n\n  return {\n    // Use parent thumbnail if configured, otherwise use own variant. Use the parent thumbnail as a fallback\n    src: config?.useConfigurableParentThumbnail\n      ? item.product.thumbnail.url\n      : item.configured_variant?.thumbnail?.url || item.product.thumbnail.url,\n    alt: config?.useConfigurableParentThumbnail\n      ? item.product.thumbnail.label\n      : item.configured_variant?.thumbnail?.label ||\n        item.product.thumbnail.label,\n  };\n}\n\n/**\n * Helper function to get downloadable links for a cart item component\n * @param item - Cart item from API\n * @returns Links object with count and result, or null if no links\n */\nfunction getLinks(item: any) {\n  return item.links?.length > 0\n    ? {\n        count: item.links.length,\n        result: item.links.map((link: any) => link.title).join(', '),\n      }\n    : null;\n}\n\n/**\n * Helper function to check if an item is discounted\n * @param item - Cart item from API\n * @returns True if the item has a discount\n */\nfunction getDiscounted(item: any) {\n  const quantity = item.quantity;\n  const isConfigurable = item.__typename === 'ConfigurableCartItem';\n\n  // Get price tiers and price range based on item type\n  const priceTiers = isConfigurable\n    ? item.configured_variant?.price_tiers\n    : item.product.price_tiers;\n  const priceRange = isConfigurable\n    ? item.configured_variant?.price_range\n    : item.product.price_range;\n\n  // Check price tiers first for discount eligibility\n  const applicableTier = findApplicablePriceTier(priceTiers, quantity);\n  if (applicableTier) {\n    return applicableTier.discount.amount_off > 0;\n  }\n\n  // Fallback to regular price range discount\n  return (priceRange?.maximum_price?.discount?.amount_off ?? 0) > 0;\n}\n\n/**\n * Helper function to get the discount percentage of an item\n * @param item - Cart item from API\n * @returns Discount percentage rounded to nearest integer, or undefined if no discount\n */\nfunction getDiscountPercentage(item: any) {\n  const quantity = item.quantity;\n\n  // Check price tiers first for discount percentage\n  const applicableTier = findApplicablePriceTier(\n    item.product.price_tiers,\n    quantity\n  );\n\n  if (applicableTier) {\n    return Math.round(applicableTier.discount.percent_off);\n  }\n\n  // Fallback to product-specific discount percentage\n  let percent_off;\n\n  if (item.__typename === 'ConfigurableCartItem') {\n    percent_off =\n      item?.configured_variant?.price_range?.maximum_price?.discount\n        ?.percent_off;\n  } else if (item.__typename === 'BundleCartItem') {\n    return undefined;\n  } else {\n    percent_off =\n      item?.product?.price_range?.maximum_price?.discount?.percent_off;\n  }\n\n  if (percent_off === 0) {\n    return undefined;\n  }\n\n  return Math.round(percent_off);\n}\n\n/**\n * Helper function to get the regular price of an item\n * @param item - Cart item from API\n * @returns Regular price object with value and currency\n */\nfunction getRegularPrice(item: any) {\n  if (item.__typename === 'ConfigurableCartItem') {\n    return {\n      value:\n        item.configured_variant?.price_range?.maximum_price.regular_price.value,\n      currency:\n        item.configured_variant?.price_range?.maximum_price.regular_price\n          .currency,\n    };\n  }\n  return {\n    value: item.prices.original_item_price.value,\n    currency: item.prices.original_item_price.currency,\n  };\n}\n\n/**\n * Helper function to get the savings amount of an item\n * @param item - Cart item from API\n * @returns Savings amount object with value and currency, or undefined if no savings\n */\nfunction getSavingsAmount(item: any) {\n  let amount_off;\n  let currency;\n\n  amount_off =\n    item?.prices?.original_row_total?.value - item?.prices?.row_total?.value;\n  currency = item?.prices?.row_total?.currency;\n\n  if (amount_off === 0) {\n    return undefined;\n  }\n  return {\n    value: amount_off,\n    currency,\n  };\n}\n\n/**\n * Transforms a single quote item from the API format to the model format\n * @param item - Raw quote item from API\n * @returns Transformed quote item\n */\nexport function transformQuoteItem(item: any): CartItemModel {\n  return {\n    itemType: item.__typename,\n    uid: item.uid,\n    product: {\n      uid: item.product.uid,\n      sku: item.product.sku,\n      name: item.product.name,\n      priceRange: {\n        maximumPrice: {\n          regularPrice: {\n            value:\n              item.product.price_range.maximum_price.regular_price.value,\n            currency:\n              item.product.price_range.maximum_price.regular_price.currency,\n          },\n        },\n      },\n    },\n    image: getImage(item),\n    links: getLinks(item),\n    discounted: getDiscounted(item),\n    discountedTotal: {\n      value: item.prices.row_total.value,\n      currency: item.prices.row_total.currency,\n    },\n    catalogDiscount: {\n      amountOff: item.prices.catalog_discount.amount_off,\n      percentOff: item.prices.catalog_discount.percent_off,\n    },\n    discounts:\n      item.prices?.discounts?.map((discount: any) => ({\n        label: discount.label,\n        value: discount.value,\n        amount: {\n          value: discount.amount.value,\n          currency: discount.amount.currency,\n        },\n      })) ?? [],\n    discountPercentage: getDiscountPercentage(item),\n    insufficientQuantity:\n      (item.__typename === 'ConfigurableCartItem'\n        ? item.configured_variant?.stock_status ?? item.product.stock_status\n        : item.product.stock_status\n      ) === 'IN_STOCK' && !item.is_available,\n    outOfStock: item.product.stock_status === 'OUT_OF_STOCK',\n    stockStatus: item.product.stock_status,\n    quantity: item.quantity,\n    prices: {\n      regularPrice: getRegularPrice(item),\n      priceIncludingTax: {\n        value: item.prices.price_including_tax.value,\n        currency: item.prices.price_including_tax.currency,\n      },\n      originalItemPrice: {\n        value: item.prices.original_item_price.value,\n        currency: item.prices.original_item_price.currency,\n      },\n      originalRowTotal: {\n        value: item.prices.original_row_total.value,\n        currency: item.prices.original_row_total.currency,\n      },\n      rowTotal: {\n        value: item.prices.row_total.value,\n        currency: item.prices.row_total.currency,\n      },\n      rowTotalIncludingTax: {\n        value: item.prices.row_total_including_tax.value,\n        currency: item.prices.row_total_including_tax.currency,\n      },\n    },\n    savingsAmount: getSavingsAmount(item),\n    noteFromBuyer: item.note_from_buyer?.map((note: any) => ({\n      createdAt: note.created_at,\n      creatorId: note.creator_id,\n      creatorType: note.creator_type,\n      negotiableQuoteItemUid: note.negotiable_quote_item_uid,\n      note: note.note,\n      noteUid: note.note_uid,\n    })),\n    noteFromSeller: item.note_from_seller?.map((note: any) => ({\n      createdAt: note.created_at,\n      creatorId: note.creator_id,\n      creatorType: note.creator_type,\n      negotiableQuoteItemUid: note.negotiable_quote_item_uid,\n      note: note.note,\n      noteUid: note.note_uid,\n    })),\n    configurableOptions: item.configurable_options?.map((option: any) => ({\n      optionLabel: option.option_label,\n      valueLabel: option.value_label,\n    })),\n    bundleOptions: item.bundle_options?.map((option: any) => ({\n      label: option.label,\n      values: option.values.map((value: any) => ({\n        label: value.label,\n        quantity: value.quantity,\n        originalPrice: {\n          value: value.original_price.value,\n          currency: value.original_price.currency,\n        },\n        price: {\n          value: value.priceV2.value,\n          currency: value.priceV2.currency,\n        },\n      })),\n    })),\n    customizableOptions: item.customizable_options?.map((option: any) => ({\n      type: option.type,\n      label: option.label,\n      values: option.values.map((value: any) => ({\n        label: value.label,\n        value: value.value,\n      })),\n    })),\n  };\n}\n\n/**\n * Transforms an array of quote items from the API format to the model format\n * @param items - Array of raw quote items from API\n * @returns Array of transformed quote items\n */\nexport function transformQuoteItems(\n  items: any[] | null | undefined\n): CartItemModel[] {\n  if (!items) {\n    return [];\n  }\n\n  return items.map(transformQuoteItem);\n}\n\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport {\n  CartItemModel,\n  NegotiableQuoteListEntry,\n  NegotiableQuoteModel,\n  NegotiableQuotesListModel,\n  NegotiableQuoteStatus,\n  PaginationInfo,\n  ShippingAddress,\n} from '@/quote-management/data/models/negotiable-quote-model';\nimport { state } from '@/quote-management/lib/state';\nimport { transformHistory } from './transform-history';\nimport { transformQuoteItems } from './transform-quote-items';\n\n// Quote statuses that allow editing/sending for review\nconst EDITABLE_QUOTE_STATUSES = [\n  'DRAFT',\n  'UPDATED',\n  'DECLINED',\n  'EXPIRED',\n  'NEW',\n  'OPEN',\n] as const;\n\n// Helper function to get the total quantity of a quote (number of quote line items or total quantity)\nfunction getTotalQuantity(quote: any) {\n  if (!quote.items) return 0;\n\n  const config = state.config;\n\n  if (config?.quoteSummaryDisplayTotal === 0) return quote.items.length;\n  if (config?.quoteSummaryDisplayTotal === 1) return quote.total_quantity;\n  // Default to items count if unexpected config value or error returned\n  return quote.items.length;\n}\n\nfunction checkAllItemsHaveStock(items: CartItemModel[]): boolean {\n  return items.every((item) => !item.outOfStock && !item.insufficientQuantity);\n}\n\n// Base helper that transforms a single quote object directly\nfunction transformSingleQuote(quote: any): NegotiableQuoteModel {\n  const isQuoteNew = isNewQuote(quote);\n  const isGeneratedFromTemplate = Boolean(quote.template_name?.trim());\n  const quoteItems = transformQuoteItems(quote.items);\n  return {\n    uid: quote.uid,\n    name: quote.name,\n    createdAt: quote.created_at,\n    updatedAt: quote.updated_at,\n    expirationDate: quote.expiration_date,\n    status: isQuoteNew ? NegotiableQuoteStatus.NEW : quote.status,\n    isVirtual: Boolean(quote.is_virtual),\n    salesRepName: quote.sales_rep_name,\n    buyer: {\n      firstname: quote.buyer.firstname,\n      lastname: quote.buyer.lastname,\n    },\n    email: quote.email,\n    templateName: quote.template_name,\n    totalQuantity: getTotalQuantity(quote),\n    comments: quote.comments?.map((comment: any) => {\n      const baseComment: any = {\n        uid: comment.uid,\n        createdAt: comment.created_at,\n        author: {\n          firstname: comment.author.firstname,\n          lastname: comment.author.lastname,\n        },\n        text: comment.text,\n      };\n\n      if (\n        Array.isArray(comment.attachments) &&\n        comment.attachments.length > 0\n      ) {\n        baseComment.attachments = comment.attachments.map((a: any) => ({\n          name: a.name,\n          url: a.url,\n        }));\n      }\n\n      return baseComment;\n    }),\n    prices: quote.prices && {\n      appliedDiscounts: quote.prices.discounts?.map((discount: any) => ({\n        amount: {\n          value: discount.amount.value,\n          currency: discount.amount.currency,\n        },\n        label: discount.label,\n        coupon: discount.coupon,\n      })),\n      appliedTaxes: quote.prices.applied_taxes?.map((tax: any) => ({\n        amount: { value: tax.amount.value, currency: tax.amount.currency },\n        label: tax.label,\n      })),\n      discount:\n        quote.prices.discounts &&\n        quote.prices.grand_total &&\n        calculateTotal(\n          quote.prices.discounts,\n          quote.prices.grand_total.currency\n        ),\n      grandTotal: quote.prices.grand_total && {\n        value: quote.prices.grand_total.value,\n        currency: quote.prices.grand_total.currency,\n      },\n      grandTotalExcludingTax: quote.prices.grand_total_excluding_tax && {\n        value: quote.prices.grand_total_excluding_tax.value,\n        currency: quote.prices.grand_total_excluding_tax.currency,\n      },\n      subtotalExcludingTax: quote.prices.subtotal_excluding_tax && {\n        value: quote.prices.subtotal_excluding_tax.value,\n        currency: quote.prices.subtotal_excluding_tax.currency,\n      },\n      subtotalIncludingTax: quote.prices.subtotal_including_tax && {\n        value: quote.prices.subtotal_including_tax.value,\n        currency: quote.prices.subtotal_including_tax.currency,\n      },\n      subtotalWithDiscountExcludingTax: quote.prices\n        .subtotal_with_discount_excluding_tax && {\n        value: quote.prices.subtotal_with_discount_excluding_tax.value,\n        currency: quote.prices.subtotal_with_discount_excluding_tax.currency,\n      },\n      ...transformShippingPrices(quote),\n      totalTax:\n        quote.prices.applied_taxes &&\n        quote.prices.grand_total &&\n        calculateTotal(\n          quote.prices.applied_taxes,\n          quote.prices.grand_total.currency\n        ),\n    },\n    history: transformHistory(quote.history),\n    items: quoteItems,\n    shippingAddresses: quote.shipping_addresses?.map((address: any) => {\n      const shippingAddress: ShippingAddress = {\n        uid: address.uid,\n        firstname: address.firstname,\n        lastname: address.lastname,\n        company: address.company,\n        street: address.street,\n        city: address.city,\n        postcode: address.postcode,\n        country: {\n          code: address.country.code,\n          label: address.country.label,\n        },\n        telephone: address.telephone,\n      };\n\n      if (address.region) {\n        shippingAddress.region = {\n          code: address.region.code,\n          label: address.region.label,\n          regionId: address.region.region_id,\n        };\n      }\n\n      return shippingAddress;\n    }),\n    canCheckout:\n      ['UPDATED', 'DECLINED'].includes(quote.status) &&\n      state.permissions.checkoutQuote &&\n      quote.shipping_addresses?.length > 0 &&\n      checkAllItemsHaveStock(quoteItems),\n    canSendForReview:\n      !isGeneratedFromTemplate &&\n      (isQuoteNew || EDITABLE_QUOTE_STATUSES.includes(quote.status)) &&\n      state.permissions.editQuote,\n    canUpdateQuote:\n      !isGeneratedFromTemplate &&\n      (isQuoteNew || EDITABLE_QUOTE_STATUSES.includes(quote.status)) &&\n      state.permissions.editQuote,\n    canDelete:\n      !isGeneratedFromTemplate &&\n      !['PENDING', 'SUBMITTED', 'ORDERED'].includes(quote.status) &&\n      state.permissions.deleteQuote,\n    canClose: quote.status\n      ? !isGeneratedFromTemplate &&\n        !['DRAFT', 'CLOSED', 'ORDERED', 'OPEN'].includes(quote.status)\n      : false,\n    readOnly:\n      isGeneratedFromTemplate ||\n      (!isQuoteNew &&\n        ['ORDERED', 'SUBMITTED', 'CLOSED', 'PENDING'].includes(quote.status)) ||\n      !state.permissions.editQuote,\n  };\n}\n\nexport function transformQuote(quoteData: any): NegotiableQuoteModel | null {\n  if (!quoteData) {\n    return null;\n  }\n\n  return transformSingleQuote(quoteData);\n}\n\n// quote is new if it has a status of SUBMITTED and there is no history entry that\n// has a change_type of UPDATED with a non-empty array of status changes\nfunction isNewQuote(quote: any): boolean {\n  return (\n    quote.status === 'SUBMITTED' &&\n    !(quote.history ?? []).some(\n      (history: any) =>\n        history.change_type === 'UPDATED' &&\n        (history.changes?.statuses?.changes ?? []).length > 0\n    )\n  );\n}\n\nfunction transformNegotiableQuoteListEntry(\n  quote: any\n): NegotiableQuoteListEntry {\n  const isQuoteNew = isNewQuote(quote);\n  return {\n    uid: quote.uid,\n    name: quote.name,\n    createdAt: quote.created_at,\n    updatedAt: quote.updated_at,\n    status: isQuoteNew ? NegotiableQuoteStatus.NEW : quote.status,\n    buyer: {\n      firstname: quote.buyer.firstname,\n      lastname: quote.buyer.lastname,\n    },\n    templateName: quote.template_name,\n    prices: {\n      grandTotal: {\n        value: quote.prices.grand_total.value,\n        currency: quote.prices.grand_total.currency,\n      },\n    },\n  };\n}\n\nexport function transformNegotiableQuotesList(\n  quotesData: any\n): NegotiableQuotesListModel | null {\n  if (!quotesData) {\n    return null;\n  }\n\n  const transformedModel = {\n    items:\n      quotesData.items\n        ?.filter((quote: any) => quote?.uid)\n        .map(transformNegotiableQuoteListEntry) || [],\n    pageInfo: {\n      currentPage: quotesData.page_info.current_page,\n      pageSize: quotesData.page_info.page_size,\n      totalPages: quotesData.page_info.total_pages,\n    },\n    totalCount: quotesData.total_count,\n    sortFields: quotesData.sort_fields\n      ? {\n          default: quotesData.sort_fields.default,\n          options: quotesData.sort_fields.options,\n        }\n      : undefined,\n  };\n\n  // Calculate pagination info\n  const paginationInfo = transformPaginationInfo(transformedModel);\n\n  return {\n    ...transformedModel,\n    paginationInfo: paginationInfo || undefined,\n  };\n}\n\nexport function transformPaginationInfo(\n  quotesData: NegotiableQuotesListModel | null\n): PaginationInfo | null {\n  if (!quotesData?.pageInfo || !quotesData.totalCount) {\n    return null;\n  }\n\n  const { currentPage, pageSize, totalPages } = quotesData.pageInfo;\n  const { totalCount } = quotesData;\n\n  const startItem = totalCount > 0 ? (currentPage - 1) * pageSize + 1 : 0;\n  const endItem = Math.min(currentPage * pageSize, totalCount);\n\n  const pageSizeOptions = [20, 30, 50, 100, 200]; // Default page size options\n\n  return {\n    currentPage,\n    totalCount,\n    pageSize,\n    startItem,\n    endItem,\n    totalPages,\n    pageSizeOptions,\n  };\n}\n\n// TODO: Check if admin has this configuration\nexport const getDefaultPageSizeOptions = () => [20, 30, 50, 100, 200];\n\nexport function calculateTotal(data: any[], currency: string) {\n  if (!data?.length)\n    return {\n      value: 0,\n      currency,\n    };\n\n  return data.reduce(\n    (acc: any, item: any) => {\n      return {\n        value: acc.value + item.amount.value,\n        currency: item.amount.currency,\n      };\n    },\n    { value: 0, currency }\n  );\n}\n\nexport function transformShippingPrices(quote: any) {\n  if (!quote || !quote.shipping_addresses?.length) {\n    return {};\n  }\n\n  const shippingAddress = quote.shipping_addresses[0];\n  const selectedShippingMethod = shippingAddress.selected_shipping_method;\n\n  if (!selectedShippingMethod) {\n    return {};\n  }\n\n  return {\n    shippingIncludingTax: selectedShippingMethod.price_incl_tax && {\n      value: selectedShippingMethod.price_incl_tax.value,\n      currency: selectedShippingMethod.price_incl_tax.currency,\n    },\n    shippingExcludingTax: selectedShippingMethod.price_excl_tax && {\n      value: selectedShippingMethod.price_excl_tax.value,\n      currency: selectedShippingMethod.price_excl_tax.currency,\n    },\n  };\n}\n"],"names":["NegotiableQuoteStatus","setEndpoint","setFetchGraphQlHeader","removeFetchGraphQlHeader","setFetchGraphQlHeaders","fetchGraphQl","getConfig","FetchGraphQL","transformHistoryEntry","historyEntry","_a","_b","_c","_d","_e","_f","change","_g","transformHistory","historyEntries","findApplicablePriceTier","priceTiers","quantity","a","b","tier","getImage","item","config","state","getLinks","link","getDiscounted","isConfigurable","priceRange","applicableTier","getDiscountPercentage","percent_off","_h","getRegularPrice","getSavingsAmount","amount_off","currency","transformQuoteItem","discount","note","option","value","transformQuoteItems","items","EDITABLE_QUOTE_STATUSES","getTotalQuantity","quote","checkAllItemsHaveStock","transformSingleQuote","isQuoteNew","isNewQuote","isGeneratedFromTemplate","quoteItems","comment","baseComment","tax","calculateTotal","transformShippingPrices","address","shippingAddress","transformQuote","quoteData","history","transformNegotiableQuoteListEntry","transformNegotiableQuotesList","quotesData","transformedModel","paginationInfo","transformPaginationInfo","currentPage","pageSize","totalPages","totalCount","startItem","endItem","getDefaultPageSizeOptions","data","acc","selectedShippingMethod"],"mappings":"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"}