{"version":3,"file":"api.js","sources":["/@dropins/storefront-quote-management/src/utils/mapAuthPermissions.ts","/@dropins/storefront-quote-management/src/api/initialize/initialize.ts","/@dropins/storefront-quote-management/src/data/transforms/transform-store-config.ts","/@dropins/storefront-quote-management/src/api/getStoreConfig/graphql/StoreConfigQuery.ts","/@dropins/storefront-quote-management/src/api/getStoreConfig/getStoreConfig.ts","/@dropins/storefront-quote-management/src/api/setShippingAddress/graphql/SetNegotiableQuoteShippingAddressMutation.ts","/@dropins/storefront-quote-management/src/api/setShippingAddress/setShippingAddress.ts","/@dropins/storefront-quote-management/src/api/getQuoteTemplateData/graphql/getQuoteTemplateData.ts","/@dropins/storefront-quote-management/src/api/getQuoteTemplateData/getQuoteTemplateData.ts","/@dropins/storefront-quote-management/src/api/addQuoteTemplateShippingAddress/graphql/setNegotiableQuoteTemplateShippingAddress.ts","/@dropins/storefront-quote-management/src/api/addQuoteTemplateShippingAddress/addQuoteTemplateShippingAddress.ts"],"sourcesContent":["/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { State } from '@/quote-management/types/state.types';\n\n/**\n * Type definition for the auth/permissions event payload\n * Contains flat Adobe Commerce permission keys with boolean values\n */\nexport type AuthPermissionsPayload = {\n  all?: boolean;\n  'Magento_NegotiableQuote::all'?: boolean;\n  'Magento_NegotiableQuote::manage'?: boolean;\n  'Magento_NegotiableQuote::checkout'?: boolean;\n  'Magento_NegotiableQuoteTemplate::all'?: boolean;\n  'Magento_NegotiableQuoteTemplate::view_template'?: boolean;\n  'Magento_NegotiableQuoteTemplate::manage'?: boolean;\n  'Magento_NegotiableQuoteTemplate::generate_quote'?: boolean;\n  [key: string]: boolean | undefined;\n};\n\n/**\n * Maps the auth/permissions event payload to internal permissions structure.\n * \n * Implements hierarchical permission checking:\n * 1. Top-level \"all\": If true, grants all permissions\n * 2. Module-level \"::all\": Grants all permissions for that module\n * 3. Specific permissions: Maps individual keys to internal flags\n * \n * @param payload - The raw auth/permissions event payload\n * @returns Typed permissions object matching the state structure\n * \n * @example\n * ```typescript\n * const permissions = mapAuthPermissions({\n *   \"Magento_NegotiableQuote::manage\": true,\n *   \"Magento_NegotiableQuote::checkout\": true\n * });\n * // Returns: { requestQuote: true, editQuote: true, deleteQuote: true, checkoutQuote: true, ... }\n * ```\n */\nexport function mapAuthPermissions(\n  payload: AuthPermissionsPayload | null | undefined\n): State['permissions'] {\n  // Handle null/undefined payload - return all false\n  if (!payload || typeof payload !== 'object') {\n    return {\n      requestQuote: false,\n      editQuote: false,\n      deleteQuote: false,\n      checkoutQuote: false,\n      viewQuoteTemplates: false,\n      manageQuoteTemplates: false,\n      generateQuoteFromTemplate: false,\n    };\n  }\n\n  // If top-level \"all\" is true, grant all permissions\n  if (payload.all === true) {\n    return {\n      requestQuote: true,\n      editQuote: true,\n      deleteQuote: true,\n      checkoutQuote: true,\n      viewQuoteTemplates: true,\n      manageQuoteTemplates: true,\n      generateQuoteFromTemplate: true,\n    };\n  }\n\n  // Check module-level \"all\" permissions\n  const hasAllQuotePermissions = payload['Magento_NegotiableQuote::all'] === true;\n  const hasAllTemplatePermissions = payload['Magento_NegotiableQuoteTemplate::all'] === true;\n\n  // Map specific permissions with fallback to module-level \"all\"\n  const hasManagePermission = \n    hasAllQuotePermissions || payload['Magento_NegotiableQuote::manage'] === true;\n\n  return {\n    // Magento_NegotiableQuote::manage maps to request, edit, and delete\n    requestQuote: hasManagePermission,\n    editQuote: hasManagePermission,\n    deleteQuote: hasManagePermission,\n    \n    // Magento_NegotiableQuote::checkout maps to checkoutQuote\n    checkoutQuote: \n      hasAllQuotePermissions || payload['Magento_NegotiableQuote::checkout'] === true,\n    \n    // Template permissions\n    viewQuoteTemplates: \n      hasAllTemplatePermissions || payload['Magento_NegotiableQuoteTemplate::view_template'] === true,\n    manageQuoteTemplates: \n      hasAllTemplatePermissions || payload['Magento_NegotiableQuoteTemplate::manage'] === true,\n    generateQuoteFromTemplate: \n      hasAllTemplatePermissions || payload['Magento_NegotiableQuoteTemplate::generate_quote'] === true,\n  };\n}\n\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { Initializer } from '@adobe-commerce/elsie/lib';\nimport { Lang } from '@adobe-commerce/elsie/i18n';\nimport { events } from '@adobe-commerce/event-bus';\nimport {\n  state,\n  DEFAULT_CONFIG,\n  DEFAULT_PERMISSIONS,\n} from '@/quote-management/lib/state';\nimport {\n  getQuoteData,\n  getStoreConfig,\n  getQuoteTemplateData,\n} from '@/quote-management/api';\nimport { mapAuthPermissions, AuthPermissionsPayload } from '@/quote-management/utils/mapAuthPermissions';\n\ntype ConfigProps = {\n  langDefinitions?: Lang;\n  quoteId?: string;\n  quoteTemplateId?: string;\n};\n\nfunction loadQuoteData(permissions: typeof DEFAULT_PERMISSIONS) {\n  // Prevent loading quote data twice\n  if (state.quoteDataLoaded) return;\n\n  const config = initialize.config.getConfig();\n  const { quoteId, quoteTemplateId } = config;\n\n\n  // Only proceed if we have permissions and at least one ID to load\n  if (!permissions.editQuote || (!quoteId && !quoteTemplateId)) {\n    return;\n  }\n\n  // Mark as loaded before starting the async operations to prevent duplicate calls\n  state.quoteDataLoaded = true;\n\n  if (quoteId) {\n    getQuoteData(quoteId)\n      .then((quote) => {\n        if (!state.quoteDataInitialized) {\n          events.emit('quote-management/quote-data/initialized', { quote, permissions });\n        }\n        state.quoteDataInitialized = true;\n      })\n      .catch((error) => {\n        state.quoteDataLoaded = false;\n        events.emit('quote-management/quote-data/error', { error });\n      });\n  }\n\n  if (quoteTemplateId) {\n    getQuoteTemplateData(quoteTemplateId)\n      .catch((error) => {\n        state.quoteDataLoaded = false;\n        events.emit('quote-management/quote-template-data/error', { error });\n      });\n  }\n}\n\nexport const initialize = new Initializer<ConfigProps>({\n  init: async (config) => {\n    const defaultConfig = {};\n\n    // Set config\n    initialize.config.setConfig({ ...defaultConfig, ...config });\n\n    // Fetch store config\n    await getStoreConfig()\n      .then((config) => {\n        state.config = config;\n      })\n      .catch((error) => {\n        console.error('Failed to fetch store config: ', error);\n        state.config = DEFAULT_CONFIG;\n      });\n\n    // Mark initialization as complete\n    state.initialized = true;\n    events.emit('quote-management/initialized', { config: state.config });\n  },\n\n  listeners: () => [\n    events.on('authenticated', async (authenticated) => {\n      state.authenticated = !!authenticated;\n\n      // Defensive: reset permissions if user logs out\n      // This ensures permissions are cleared even if auth/permissions event doesn't fire\n      if (!authenticated) {\n        state.permissions = DEFAULT_PERMISSIONS;\n        state.quoteDataLoaded = false;\n        events.emit('quote-management/permissions', DEFAULT_PERMISSIONS);\n      }\n    },\n      {\n        eager: true,\n      }\n    ),\n\n    events.on('auth/permissions', async (payload: AuthPermissionsPayload) => {\n      // Map the auth permissions payload to internal permissions structure\n      const permissions = mapAuthPermissions(payload);\n\n      state.permissions = permissions;\n      // Reset quote data loaded flag when permissions change to allow reloading\n      state.quoteDataLoaded = false;\n      events.emit('quote-management/permissions', state.permissions);\n    }, {\n      eager: true,\n    }),\n\n    events.on('quote-management/permissions', async (permissions) => {\n      // Only process quote data loading after initialization is complete\n      if (!state.initialized) {\n        return;\n      }\n\n      loadQuoteData(permissions);\n    }, { eager: true }),\n\n    events.on('quote-management/initialized', async () => {\n      loadQuoteData(state.permissions);\n    }, { eager: true }),\n\n    events.on('checkout/updated', async (data) => {\n      // Only process after initialization is complete\n      if (!state.initialized) {\n        return;\n      }\n\n      if (data?.type !== 'quote') {\n        return;\n      }\n\n      // Reset the flag to allow reloading of quote data\n      state.quoteDataLoaded = false;\n      loadQuoteData(state.permissions);\n    }, { eager: true }),\n  ],\n});\n\nexport const config = initialize.config;\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport {\n  QuoteDisplayAmount,\n  StoreConfigModel,\n} from '@/quote-management/data/models';\nimport { DEFAULT_CONFIG } from '@/quote-management/lib/state';\n\nexport function transformStoreConfig(data: any): StoreConfigModel {\n  if (!data) return DEFAULT_CONFIG;\n\n  const transformQuoteDisplayAmountSetting = (\n    quoteDisplayAmountSetting: number\n  ) => {\n    if (\n      [\n        QuoteDisplayAmount.TAX_EXCLUDED,\n        QuoteDisplayAmount.TAX_INCLUDED,\n        QuoteDisplayAmount.TAX_INCLUDED_AND_EXCLUDED,\n      ].includes(quoteDisplayAmountSetting)\n    ) {\n      return quoteDisplayAmountSetting;\n    }\n\n    return QuoteDisplayAmount.TAX_EXCLUDED;\n  };\n\n  return {\n    quoteSummaryDisplayTotal: data.cart_summary_display_quantity,\n    quoteSummaryMaxItems: data.max_items_in_order_summary,\n    quoteDisplaySettings: {\n      zeroTax: data.shopping_cart_display_zero_tax,\n      subtotal: transformQuoteDisplayAmountSetting(\n        data.shopping_cart_display_subtotal\n      ),\n      price: transformQuoteDisplayAmountSetting(\n        data.shopping_cart_display_price\n      ),\n      shipping: transformQuoteDisplayAmountSetting(\n        data.shopping_cart_display_shipping\n      ),\n      fullSummary: data.shopping_cart_display_full_summary,\n      grandTotal: data.shopping_cart_display_grand_total,\n    },\n    useConfigurableParentThumbnail:\n      data.configurable_thumbnail_source === 'parent',\n    quoteMinimumAmount: data.quote_minimum_amount ?? null,\n    quoteMinimumAmountMessage: data.quote_minimum_amount_message ?? null,\n  };\n}\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nexport const STORE_CONFIG_QUERY = /* GraphQL */ `\n  query STORE_CONFIG_QUERY {\n    storeConfig {\n      cart_summary_display_quantity\n      max_items_in_order_summary\n      shopping_cart_display_full_summary\n      shopping_cart_display_grand_total\n      shopping_cart_display_price\n      shopping_cart_display_shipping\n      shopping_cart_display_subtotal\n      shopping_cart_display_zero_tax\n      configurable_thumbnail_source\n      quote_minimum_amount\n      quote_minimum_amount_message\n    }\n  }\n`;\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/quote-management/api';\nimport { StoreConfigModel } from '@/quote-management/data/models';\nimport { transformStoreConfig } from '@/quote-management/data/transforms';\nimport { STORE_CONFIG_QUERY } from './graphql/StoreConfigQuery';\n\nexport const getStoreConfig = async (): Promise<StoreConfigModel> => {\n  return fetchGraphQl(STORE_CONFIG_QUERY, {\n    method: 'GET',\n    cache: 'force-cache',\n  }).then(({ errors, data }) => {\n    if (errors) {\n      const errorMessage = errors.map((e: any) => e.message).join(', ');\n      throw new Error(`Failed to get store config: ${errorMessage}`);\n    }\n\n    return transformStoreConfig(data.storeConfig);\n  });\n};\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { NEGOTIABLE_QUOTE_FRAGMENT } from '@/quote-management/api/graphql/NegotiableQuoteFragment';\n\nexport const SET_NEGOTIABLE_QUOTE_SHIPPING_ADDRESS_MUTATION = `\n  mutation SET_NEGOTIABLE_QUOTE_SHIPPING_ADDRESS_MUTATION(\n    $quoteUid: ID!\n    $addressId: ID\n    $addressData: NegotiableQuoteAddressInput\n  ) {\n    setNegotiableQuoteShippingAddress(\n      input: {\n        quote_uid: $quoteUid\n        shipping_addresses: {\n          customer_address_uid: $addressId\n          address: $addressData\n        }\n      }\n    ) {\n      quote {\n        ...NegotiableQuoteFragment\n      }\n    }\n  }\n  ${NEGOTIABLE_QUOTE_FRAGMENT}\n`;\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/quote-management/api';\nimport { events } from '@adobe-commerce/event-bus';\nimport { SET_NEGOTIABLE_QUOTE_SHIPPING_ADDRESS_MUTATION } from './graphql/SetNegotiableQuoteShippingAddressMutation';\nimport { NegotiableQuoteModel } from '@/quote-management/data/models/negotiable-quote-model';\nimport { transformQuote } from '@/quote-management/data/transforms';\n\nexport interface AddressInput {\n  /** City name */\n  city: string;\n  /** Optional company name */\n  company?: string;\n  /** Two-letter country code (e.g., 'US') */\n  countryCode: string;\n  /** First name */\n  firstname: string;\n  /** Last name */\n  lastname: string;\n  /** Postal/ZIP code */\n  postcode: string;\n  /** Optional state/province name */\n  region?: string;\n  /** Optional state/province ID */\n  regionId?: number;\n  /** Whether to save this address to the customer's address book */\n  saveInAddressBook?: boolean;\n  /** Street address lines (array) */\n  street: string[];\n  /** Phone number */\n  telephone: string;\n  /** \n   * Additional input (optional custom fields for the address).\n   * These fields will be merged into the address data sent to GraphQL.\n   * Standard fields take precedence over additional fields to prevent\n   * accidental override of required address attributes.\n   * \n   * @example\n   * ```ts\n   * additionalInput: {\n   *   vat_id: 'GB123456789',\n   *   custom_attribute: 'value',\n   *   delivery_instructions: 'Leave at door'\n   * }\n   * ```\n   */\n  additionalInput?: Record<string, any>;\n}\n\nexport interface SetShippingAddressInput {\n  /** The unique ID of the negotiable quote */\n  quoteUid: string;\n  /** The ID of a saved customer address (use this OR addressData, not both) */\n  addressId?: number;\n  /** New address data (use this OR addressId, not both) */\n  addressData?: AddressInput;\n}\n\n/**\n * Transform camelCase address data to snake_case for GraphQL mutation.\n * Additional fields from additionalInput are spread into the result, with\n * standard fields taking precedence (defensive flexibility approach).\n */\nfunction transformAddressToSnakeCase(address: AddressInput) {\n  const { additionalInput, ...standardFields } = address;\n  \n  // Build the standard transformed fields\n  const transformedStandardFields = {\n    city: standardFields.city,\n    company: standardFields.company,\n    country_code: standardFields.countryCode,\n    firstname: standardFields.firstname,\n    lastname: standardFields.lastname,\n    postcode: standardFields.postcode,\n    region: standardFields.region,\n    region_id: standardFields.regionId,\n    save_in_address_book: standardFields.saveInAddressBook,\n    street: standardFields.street,\n    telephone: standardFields.telephone,\n  };\n  \n  // Spread additional input first, then standard fields take precedence\n  // This provides defensive flexibility: allows custom fields while protecting core fields\n  return {\n    ...(additionalInput || {}),\n    ...transformedStandardFields,\n  };\n}\n\n/**\n * Sets or updates the shipping address for a negotiable quote.\n * \n * @param input - The input parameters for setting the shipping address\n * @param input.quoteUid - The unique ID of the negotiable quote\n * @param input.addressId - Optional ID of a saved customer address (use this OR addressData)\n * @param input.addressData - Optional new address data (use this OR addressId)\n * @param input.addressData.additionalInput - Optional additional address fields to pass through to GraphQL\n * @returns Promise that resolves to the updated quote model with shipping addresses including uid field\n * @throws Error if validation fails or GraphQL operation fails\n * \n * @example\n * ```ts\n * // Using a saved address\n * const quote = await setShippingAddress({\n *   quoteUid: 'quote-123',\n *   addressId: 5\n * });\n * \n * // Using new address data\n * const quote = await setShippingAddress({\n *   quoteUid: 'quote-123',\n *   addressData: {\n *     firstname: 'John',\n *     lastname: 'Doe',\n *     street: ['123 Main St'],\n *     city: 'San Francisco',\n *     countryCode: 'US',\n *     postcode: '94103',\n *     telephone: '555-1234'\n *   }\n * });\n * \n * // Using address data with additional custom fields\n * const quote = await setShippingAddress({\n *   quoteUid: 'quote-123',\n *   addressData: {\n *     firstname: 'John',\n *     lastname: 'Doe',\n *     street: ['123 Main St'],\n *     city: 'San Francisco',\n *     countryCode: 'US',\n *     postcode: '94103',\n *     telephone: '555-1234',\n *     additionalInput: {\n *       vat_id: 'GB123456789',\n *       custom_attribute_1: 'value1',\n *       delivery_instructions: 'Leave at door'\n *     }\n *   }\n * });\n * \n * // Access address identifier\n * if (quote?.shippingAddresses?.[0]) {\n *   console.log('Address UID:', quote.shippingAddresses[0].uid);\n * }\n * ```\n */\nexport const setShippingAddress = async (\n  input: SetShippingAddressInput\n): Promise<NegotiableQuoteModel | null> => {\n  const { quoteUid, addressId, addressData } = input;\n\n  if (!quoteUid) {\n    throw new Error('Quote UID is required');\n  }\n\n  // Validate that exactly one of addressId or addressData is provided\n  if (addressId === undefined && !addressData) {\n    throw new Error('Either addressId or addressData must be provided');\n  }\n\n  if (addressId !== undefined && addressData) {\n    throw new Error('Cannot provide both addressId and addressData');\n  }\n\n  // Transform addressData to snake_case if provided\n  const transformedAddressData = addressData\n    ? transformAddressToSnakeCase(addressData)\n    : null;\n\n  return fetchGraphQl(SET_NEGOTIABLE_QUOTE_SHIPPING_ADDRESS_MUTATION, {\n    variables: {\n      quoteUid,\n      addressId: addressId || null,\n      addressData: transformedAddressData,\n    },\n  }).then((response) => {\n    const { errors } = response;\n\n    if (errors) {\n      // Provide more detailed error information\n      const errorMessages = errors.map((error) => error.message).join('; ');\n      throw new Error(`Failed to set shipping address: ${errorMessages}`);\n    }\n\n    // Transform the quote data\n    const quoteData = transformQuote(\n      response.data?.setNegotiableQuoteShippingAddress?.quote\n    );\n\n    if (!quoteData) {\n      throw new Error(\n        'Failed to transform quote data: Invalid response structure'\n      );\n    }\n\n    // Emit event with transformed quote data on success\n    events.emit('quote-management/shipping-address-set', {\n      quote: quoteData,\n      input: { quoteUid, addressId, addressData },\n    });\n\n    return quoteData;\n  });\n};\n\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this \n * file in accordance with the terms of the Adobe license agreement \n * accompanying it. \n *******************************************************************/\n\nimport { NEGOTIABLE_QUOTE_TEMPLATE_FRAGMENT } from '@/quote-management/api/graphql/NegotiableQuoteTemplateFragment';\n\nexport const GET_QUOTE_TEMPLATE_DATA = /* GraphQL */ `\n  query QUOTE_TEMPLATE_DATA_QUERY($templateId: ID!) {\n    negotiableQuoteTemplate(templateId: $templateId) {\n      ...NegotiableQuoteTemplateFragment\n    }\n  }\n\n  ${NEGOTIABLE_QUOTE_TEMPLATE_FRAGMENT}\n`;\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this \n * file in accordance with the terms of the Adobe license agreement \n * accompanying it. \n *******************************************************************/\n\nimport { fetchGraphQl } from '@/quote-management/api';\nimport { GET_QUOTE_TEMPLATE_DATA } from './graphql/getQuoteTemplateData';\nimport { transformQuoteTemplate } from '@/quote-management/data/transforms';\nimport { NegotiableQuoteTemplateModel } from '@/quote-management/data/models/negotiable-quote-template-model';\nimport { state } from '@/quote-management/lib/state';\nimport { events } from '@adobe-commerce/event-bus';\n\nexport const getQuoteTemplateData = async (templateId: string): Promise<NegotiableQuoteTemplateModel | null> => {\n\n  if (!state.authenticated) {\n    throw new Error('Unauthorized');\n  }\n\n  if (!templateId) {\n    throw new Error('Template ID is required');\n  }\n\n  try {\n    const results: any = await fetchGraphQl(GET_QUOTE_TEMPLATE_DATA, {\n      variables: { templateId },\n    });\n\n\n    if (!results?.data?.negotiableQuoteTemplate) {\n      throw new Error('Quote template not found');\n    }\n\n    const transformedData = transformQuoteTemplate(results.data.negotiableQuoteTemplate);\n\n    if (!transformedData) {\n      throw new Error('Failed to transform quote template data');\n    }\n\n    events.emit('quote-management/quote-template-data', {\n      quoteTemplate: transformedData,\n      permissions: state.permissions,\n    });\n\n    return transformedData;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { NEGOTIABLE_QUOTE_TEMPLATE_FRAGMENT } from '@/quote-management/api/graphql/NegotiableQuoteTemplateFragment';\n\nexport const SET_NEGOTIABLE_QUOTE_TEMPLATE_SHIPPING_ADDRESS_MUTATION = /* GraphQL */ `\n  mutation SET_NEGOTIABLE_QUOTE_TEMPLATE_SHIPPING_ADDRESS_MUTATION(\n    $templateId: ID!\n    $shippingAddress: NegotiableQuoteTemplateShippingAddressInput!\n  ) {\n    setNegotiableQuoteTemplateShippingAddress(\n      input: {\n        template_id: $templateId\n        shipping_address: $shippingAddress\n      }\n    ) {\n      ...NegotiableQuoteTemplateFragment\n    }\n  }\n  \n  ${NEGOTIABLE_QUOTE_TEMPLATE_FRAGMENT}\n`;\n\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/quote-management/api';\nimport { SET_NEGOTIABLE_QUOTE_TEMPLATE_SHIPPING_ADDRESS_MUTATION } from './graphql/setNegotiableQuoteTemplateShippingAddress';\nimport { transformQuoteTemplate } from '@/quote-management/data/transforms';\nimport { state } from '@/quote-management/lib/state';\nimport { events } from '@adobe-commerce/event-bus';\n\nexport interface NegotiableQuoteAddressInput {\n  city: string;\n  company?: string;\n  countryCode: string;\n  fax?: string;\n  firstname: string;\n  lastname: string;\n  middlename?: string;\n  postcode?: string;\n  prefix?: string;\n  region?: string;\n  regionId?: number;\n  saveInAddressBook?: boolean;\n  street: string[];\n  suffix?: string;\n  telephone?: string;\n  vatId?: string;\n}\n\nexport interface NegotiableQuoteTemplateShippingAddressInput {\n  address?: NegotiableQuoteAddressInput;\n  customerAddressUid?: string;\n  customerNotes?: string;\n}\n\nexport interface AddQuoteTemplateShippingAddressParams {\n  templateId: string;\n  shippingAddress: NegotiableQuoteTemplateShippingAddressInput;\n}\n\nexport const addQuoteTemplateShippingAddress = async (\n  params: AddQuoteTemplateShippingAddressParams\n) => {\n  if (!params.templateId) {\n    throw new Error('Template ID is required');\n  }\n\n  if (!params.shippingAddress) {\n    throw new Error('Shipping address is required');\n  }\n\n  if (!state.authenticated) {\n    throw new Error('Unauthorized');\n  }\n\n  // Validate that at least one of address or customerAddressUid is provided\n  if (\n    !params.shippingAddress.address &&\n    !params.shippingAddress.customerAddressUid\n  ) {\n    throw new Error('Either address or customerAddressUid must be provided');\n  }\n\n  try {\n    const results: any = await fetchGraphQl(\n      SET_NEGOTIABLE_QUOTE_TEMPLATE_SHIPPING_ADDRESS_MUTATION,\n      {\n        variables: {\n          templateId: params.templateId,\n          shippingAddress: {\n            address: params.shippingAddress.address\n              ? {\n                  city: params.shippingAddress.address.city,\n                  company: params.shippingAddress.address.company,\n                  country_code: params.shippingAddress.address.countryCode,\n                  fax: params.shippingAddress.address.fax,\n                  firstname: params.shippingAddress.address.firstname,\n                  lastname: params.shippingAddress.address.lastname,\n                  middlename: params.shippingAddress.address.middlename,\n                  postcode: params.shippingAddress.address.postcode,\n                  prefix: params.shippingAddress.address.prefix,\n                  region: params.shippingAddress.address.region,\n                  region_id: params.shippingAddress.address.regionId,\n                  save_in_address_book:\n                    params.shippingAddress.address.saveInAddressBook,\n                  street: params.shippingAddress.address.street,\n                  suffix: params.shippingAddress.address.suffix,\n                  telephone: params.shippingAddress.address.telephone,\n                  vat_id: params.shippingAddress.address.vatId,\n                }\n              : undefined,\n            customer_address_uid: params.shippingAddress.customerAddressUid,\n            customer_notes: params.shippingAddress.customerNotes,\n          },\n        },\n      }\n    );\n\n    if (!results?.data?.setNegotiableQuoteTemplateShippingAddress) {\n      throw new Error('No quote template data received');\n    }\n\n    const transformedData = transformQuoteTemplate(\n      results.data.setNegotiableQuoteTemplateShippingAddress\n    );\n\n    if (!transformedData) {\n      throw new Error('Failed to transform quote template data');\n    }\n\n    events.emit('quote-management/quote-template-data', {\n      quoteTemplate: transformedData,\n      permissions: state.permissions,\n    });\n\n    return transformedData;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n"],"names":["mapAuthPermissions","payload","hasAllQuotePermissions","hasAllTemplatePermissions","hasManagePermission","loadQuoteData","permissions","state","config","initialize","quoteId","quoteTemplateId","getQuoteData","quote","events","error","getQuoteTemplateData","Initializer","defaultConfig","getStoreConfig","DEFAULT_CONFIG","authenticated","DEFAULT_PERMISSIONS","data","transformStoreConfig","transformQuoteDisplayAmountSetting","quoteDisplayAmountSetting","QuoteDisplayAmount","STORE_CONFIG_QUERY","fetchGraphQl","errors","errorMessage","e","SET_NEGOTIABLE_QUOTE_SHIPPING_ADDRESS_MUTATION","NEGOTIABLE_QUOTE_FRAGMENT","transformAddressToSnakeCase","address","additionalInput","standardFields","transformedStandardFields","setShippingAddress","input","quoteUid","addressId","addressData","transformedAddressData","response","errorMessages","quoteData","transformQuote","_b","_a","GET_QUOTE_TEMPLATE_DATA","NEGOTIABLE_QUOTE_TEMPLATE_FRAGMENT","templateId","results","transformedData","transformQuoteTemplate","SET_NEGOTIABLE_QUOTE_TEMPLATE_SHIPPING_ADDRESS_MUTATION","addQuoteTemplateShippingAddress","params"],"mappings":"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"}