{"version":3,"file":"RequestNegotiableQuoteForm.js","sources":["/@dropins/storefront-quote-management/src/components/RequestNegotiableQuoteForm/RequestNegotiableQuoteForm.tsx","/@dropins/storefront-quote-management/src/containers/RequestNegotiableQuoteForm/RequestNegotiableQuoteForm.tsx"],"sourcesContent":["/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this \n * file in accordance with the terms of the Adobe license agreement \n * accompanying it. \n *******************************************************************/\n\nimport { FunctionComponent, VNode } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\nimport { classes, VComponent } from '@adobe-commerce/elsie/lib';\nimport '@/quote-management/components/RequestNegotiableQuoteForm/RequestNegotiableQuoteForm.css';\n\nexport interface RequestNegotiableQuoteFormProps extends Omit<HTMLAttributes<HTMLFormElement>, 'title'> {\n  title: VNode;\n  banner?: VNode;\n  commentField?: VNode;\n  quoteNameField?: VNode;\n  attachFile?: VNode;\n  attachedFilesList?: VNode;\n  requestButton?: VNode;\n  saveButton?: VNode;\n  onSubmit: (e: Event) => void;\n}\n\nexport const RequestNegotiableQuoteForm: FunctionComponent<RequestNegotiableQuoteFormProps> = ({\n  className,\n  title,\n  banner,\n  commentField,\n  quoteNameField,\n  attachFile,\n  attachedFilesList,\n  requestButton,\n  saveButton,\n  onSubmit,\n  ...props\n}) => {\n  return (\n    <form {...props} className={classes(['request-negotiable-quote-form', className])} onSubmit={onSubmit}>\n      {banner &&\n        <VComponent\n          node={banner}\n          className={classes(['request-negotiable-quote-form__banner'])}\n        />\n      }\n      {title &&\n        <VComponent\n          node={title}\n          className={classes(['request-negotiable-quote-form__title'])}\n        />\n      }\n      {commentField &&\n        <VComponent\n          node={commentField}\n          className={classes(['request-negotiable-quote-form__comment-field'])}\n        />\n      }\n      {quoteNameField &&\n        <VComponent\n          node={quoteNameField}\n          className={classes(['request-negotiable-quote-form__quote-name-field'])}\n        />\n      }\n      {attachFile &&\n        <VComponent\n          node={attachFile}\n          className={classes(['request-negotiable-quote-form__attach-file-field'])}\n        />\n      }\n      {attachedFilesList &&\n        <VComponent\n          node={attachedFilesList}\n          className={classes(['request-negotiable-quote-form__attached-files-list'])}\n        />\n      }\n      <div className={classes(['request-negotiable-quote-form__actions'])}>\n        {requestButton &&\n          <VComponent\n            node={requestButton}\n            className={classes(['request-negotiable-quote-form__request-button'])}\n          />\n        }\n        {saveButton &&\n          <VComponent\n            node={saveButton}\n            className={classes(['request-negotiable-quote-form__save-button'])}\n          />\n        }\n      </div>\n    </form>\n  );\n};\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this \n * file in accordance with the terms of the Adobe license agreement \n * accompanying it. \n *******************************************************************/\n\nimport { HTMLAttributes, useCallback, useEffect, useState } from 'preact/compat';\nimport { Container, getFormErrors, getFormValues, Slot, SlotProps } from '@adobe-commerce/elsie/lib';\nimport { InLineAlert, Button, InputFile, TextArea, Input, Field, InLineAlertProps } from '@adobe-commerce/elsie/components';\nimport { WarningFilled, CheckWithCircle, Add } from '@adobe-commerce/elsie/icons';\nimport RequestNegotiableQuoteFormComponent from '@/quote-management/components/RequestNegotiableQuoteForm';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { events } from '@adobe-commerce/event-bus';\nimport { requestNegotiableQuote, RequestNegotiableQuoteInput, uploadFile } from '@/quote-management/api';\nimport { state } from '@/quote-management/lib/state';\nimport { AttachedFilesList, AttachedFile } from '@/quote-management/components';\nimport { formatFileSize, validateFileType, validateFileSize } from '@/quote-management/utils/fileUtils';\n\nexport type RequestNegotiableQuoteHandlers = {\n  onAttachFiles?: (files: File[]) => Promise<void>;\n  onRequestNegotiableQuote?: typeof requestNegotiableQuote;\n  onSaveNegotiableQuote?: typeof requestNegotiableQuote;\n  onSubmitErrors?: (errors: Record<string, string>) => void;\n  onError?: (props: {\n    error: string,\n    isFormDisabled: boolean,\n    setIsFormDisabled: (isFormDisabled: boolean) => void,\n  }) => void;\n};\n\nexport interface RequestNegotiableQuoteFormProps\n  extends Omit<HTMLAttributes<HTMLDivElement>, 'onError'>,\n  RequestNegotiableQuoteHandlers {\n  cartId: string;\n  maxFiles?: number;\n  maxFileSize?: number;\n  acceptedFileTypes?: string[];\n  slots?: {\n    ErrorBanner?: SlotProps<{\n      message: string,\n    }>;\n    SuccessBanner?: SlotProps<{\n      message: string,\n    }>;\n    Title?: SlotProps<{\n      text: string,\n    }>;\n    CommentField?: SlotProps<{\n      formErrors: Record<string, string>;\n      isFormDisabled: boolean;\n      setFormErrors: (errors: Record<string, string>) => void;\n    }>;\n    QuoteNameField?: SlotProps<{\n      formErrors: Record<string, string>;\n      isFormDisabled: boolean;\n      setFormErrors: (errors: Record<string, string>) => void;\n    }>;\n    AttachFileField?: SlotProps<{\n      onChange: (files: File[]) => void, formErrors: Record<string, string>,\n      isFormDisabled: boolean,\n      attachedFiles: AttachedFile[]\n    }>;\n    AttachedFilesList?: SlotProps<{\n      files: AttachedFile[];\n      onRemove: (key: string) => void;\n      disabled?: boolean;\n    }>;\n    RequestButton?: SlotProps<{\n      requestNegotiableQuote: typeof requestNegotiableQuote;\n      formErrors: Record<string, string>;\n      isFormDisabled: boolean;\n      setIsFormDisabled: (isFormDisabled: boolean) => void;\n    }>;\n    SaveDraftButton?: SlotProps<{\n      requestNegotiableQuote: typeof requestNegotiableQuote;\n      formErrors: Record<string, string>;\n      isFormDisabled: boolean;\n      setIsFormDisabled: (isFormDisabled: boolean) => void;\n    }>;\n  };\n}\n\nexport const RequestNegotiableQuoteForm: Container<RequestNegotiableQuoteFormProps> = ({\n  cartId,\n  slots,\n  onRequestNegotiableQuote,\n  onSaveNegotiableQuote,\n  onAttachFiles,\n  onSubmitErrors,\n  onError,\n  className,\n  maxFiles,\n  maxFileSize,\n  acceptedFileTypes,\n}) => {\n  const [comment, setComment] = useState<string | undefined>(undefined);\n  const [quoteName, setQuoteName] = useState<string | undefined>(undefined);\n  const [attachedFiles, setAttachedFiles] = useState<AttachedFile[]>([]);\n  const [error, setError] = useState<string | undefined>(undefined);\n  const [formErrors, setFormErrors] = useState<Record<string, string>>({});\n  const [success, setSuccess] = useState<string | undefined>(undefined);\n  const [isFormDisabled, setIsFormDisabled] = useState<boolean>(false);\n\n  const dictionary = useText({\n    title: 'NegotiableQuote.Request.title',\n    comment: 'NegotiableQuote.Request.comment',\n    commentError: 'NegotiableQuote.Request.commentError',\n    quoteName: 'NegotiableQuote.Request.quoteName',\n    quoteNameError: 'NegotiableQuote.Request.quoteNameError',\n    attachmentsError: 'NegotiableQuote.Request.attachmentsError',\n    maxFilesExceeded: 'NegotiableQuote.Request.maxFilesExceeded',\n    maxFileSizeExceeded: 'NegotiableQuote.Request.maxFileSizeExceeded',\n    invalidFileType: 'NegotiableQuote.Request.invalidFileType',\n    requestCta: 'NegotiableQuote.Request.requestCta',\n    saveDraftCta: 'NegotiableQuote.Request.saveDraftCta',\n    errorHeader: 'NegotiableQuote.Request.error.header',\n    unauthenticated: 'NegotiableQuote.Request.error.unauthenticated',\n    unauthorized: 'NegotiableQuote.Request.error.unauthorized',\n    missingCart: 'NegotiableQuote.Request.error.missingCart',\n    successHeader: 'NegotiableQuote.Request.success.header',\n    submitSuccess: 'NegotiableQuote.Request.success.submitted',\n    draftSuccess: 'NegotiableQuote.Request.success.draftSaved',\n  });\n\n  useEffect(() => {\n    const permissionsEvent = events.on(\n      'quote-management/permissions',\n      (permissions: typeof state.permissions) => {\n        setError(undefined);\n        if (!permissions.requestQuote) {\n          setError(dictionary.unauthorized);\n          setIsFormDisabled(true);\n        }\n        else {\n          setIsFormDisabled(false);\n        }\n      },\n      { eager: true }\n    );\n    return () => permissionsEvent?.off();\n  }, [dictionary.unauthorized]);\n\n  useEffect(() => {\n    const authenticatedEvent = events.on(\n      'authenticated',\n      (authenticated: boolean) => {\n        setError(undefined);\n        if (!authenticated) {\n          setError(dictionary.unauthenticated);\n          setIsFormDisabled(true);\n        }\n        else {\n          setIsFormDisabled(false);\n        }\n      },\n      { eager: true }\n    );\n    return () => authenticatedEvent?.off();\n  }, [dictionary.unauthenticated]);\n\n  useEffect(() => {\n    if (!cartId) {\n      setError(dictionary.missingCart);\n      setIsFormDisabled(true);\n    }\n  }, [cartId, dictionary.missingCart]);\n\n  useEffect(() => {\n    if (error) {\n      onError?.({ error, isFormDisabled, setIsFormDisabled });\n    }\n  }, [error, onError, isFormDisabled]);\n\n  const handleAttachFiles = useCallback(async (files: File[]) => {\n    /* istanbul ignore next: defensive guard; */\n    if (!files?.length) return;\n\n    // Check maxFiles limit\n    if (maxFiles && attachedFiles.length + files.length > maxFiles) {\n      setFormErrors(prev => ({\n        ...prev,\n        attachments: dictionary.maxFilesExceeded.replace('{maxFiles}', String(maxFiles))\n      }));\n      return;\n    }\n\n    // Validate file types and sizes before uploading\n    for (const file of files) {\n      if (maxFileSize && !validateFileSize(file.size, maxFileSize)) {\n        setFormErrors(prev => ({\n          ...prev,\n          attachments: dictionary.maxFileSizeExceeded.replace('{maxSize}', formatFileSize(maxFileSize))\n        }));\n        return;\n      }\n\n      if (acceptedFileTypes && !validateFileType(file.type, acceptedFileTypes)) {\n        setFormErrors(prev => ({ ...prev, attachments: dictionary.invalidFileType }));\n        return;\n      }\n    }\n\n    // Set form errors without attachments key\n    setFormErrors(prev => { \n      // Disable eslint rule for unused attachments key\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const { attachments, ...rest } = prev;\n      return rest;\n    });\n\n\n    if (onAttachFiles) {\n      onAttachFiles(files)?.catch(() => {\n        setFormErrors(prev => ({ ...prev, attachments: dictionary.attachmentsError }));\n      });\n      return;\n    }\n\n    // Add files with 'uploading' status\n    const newFiles: AttachedFile[] = files.map(file => ({\n      key: `temp-${Date.now()}-${Math.random()}-${file.name}`,\n      name: file.name,\n      size: file.size,\n      status: 'uploading',\n    }));\n\n    setAttachedFiles(prev => [...prev, ...newFiles]);\n\n    // Upload each file and update its status\n    for (let i = 0; i < files.length; i++) {\n      const file = files[i];\n      const tempKey = newFiles[i].key;\n\n      try {\n        const result = await uploadFile(file);\n        setAttachedFiles(prev => prev.map(f =>\n          f.key === tempKey\n            ? { ...f, key: result.key, status: 'success' }\n            : f\n        ));\n      } catch (error) {\n        setFormErrors(prev => ({ ...prev, attachments: (error as Error).message }));\n        setAttachedFiles(prev => prev.map(f =>\n          f.key === tempKey\n            ? { ...f, status: 'error', error: (error as Error).message }\n            : f\n        ));\n      }\n    }\n  }, [onAttachFiles, dictionary, maxFiles, maxFileSize, acceptedFileTypes, attachedFiles]);\n\n  const handleRemoveFile = useCallback((key: string) => {\n    setAttachedFiles(prev => prev.filter(f => f.key !== key));\n  }, []);\n\n  /*\n  * This function is used to get the banner node.\n  * It can be used to render a success or error banner depending on the success or error state.\n  */\n  const getBannerNode = () => {\n    let inlineAlertProps: InLineAlertProps | undefined;\n    let slotProps: any | undefined;\n\n    if (success) {\n      slotProps = {\n        name: 'SuccessBanner',\n        slot: slots?.SuccessBanner,\n        context: {\n          message: success,\n        },\n        'data-testid': 'form-success-banner',\n      };\n      inlineAlertProps = {\n        type: 'success',\n        variant: 'primary',\n        icon: <CheckWithCircle />,\n        heading: dictionary.successHeader,\n        description: success,\n        className: 'request-negotiable-quote-form__success-banner',\n      };\n    }\n    else if (error) {\n      slotProps = {\n        name: 'ErrorBanner',\n        slot: slots?.ErrorBanner,\n        context: {\n          message: error,\n        },\n        'data-testid': 'form-error-banner',\n      };\n      inlineAlertProps = {\n        type: 'error',\n        variant: 'primary',\n        icon: <WarningFilled />,\n        heading: dictionary.errorHeader,\n        description: error,\n        className: 'request-negotiable-quote-form__error-banner',\n      };\n    }\n\n    if (slotProps && inlineAlertProps) {\n      return <Slot {...slotProps}>\n        <InLineAlert {...inlineAlertProps} />\n      </Slot>;\n    }\n\n    return undefined;\n  }\n\n  /*\n  * This function is used to validate the parent form of the button that was clicked.\n  */\n  const validateParentForm = (e: Event) => {\n    setFormErrors({});\n    const closestForm = (e.target as HTMLElement).closest('form') as HTMLFormElement;\n    const formErrors = getFormErrors(closestForm);\n    if (Object.keys(formErrors).length > 0) {\n      setFormErrors(formErrors);\n      onSubmitErrors?.(formErrors);\n    }\n  };\n\n  const formSubmitHandler = (e: Event) => {\n    e.preventDefault();\n    setIsFormDisabled(true);\n\n    const form = (e.target as HTMLFormElement);\n\n    const currentFormErrors = getFormErrors(form);\n\n    const mergedFormErrors = { ...currentFormErrors, ...formErrors };\n\n    if (Object.keys(mergedFormErrors).length > 0) {\n      onSubmitErrors?.(mergedFormErrors)\n      return;\n    }\n\n    // Since we have multiple submit buttons, we need to determine which one was clicked.\n    const buttonTarget = (e as SubmitEvent).submitter as HTMLButtonElement;\n\n    const formValues = getFormValues(form);\n\n    setComment(formValues.comment);\n    setQuoteName(formValues.quoteName);\n\n    const isDraft = buttonTarget?.dataset?.draft === 'true' || false;\n\n    // Only include successfully uploaded files\n    const successfulAttachments = attachedFiles\n      .filter(f => f.status === 'success')\n      .map(f => ({ key: f.key }));\n\n    const contextData: RequestNegotiableQuoteInput = {\n      cartId: cartId!,\n      quoteName: formValues.quoteName,\n      comment: formValues.comment,\n      attachments: successfulAttachments,\n      isDraft,\n    }\n\n    let submitHandler;\n    let successMessage;\n\n    if (isDraft) {\n      submitHandler = onSaveNegotiableQuote ?? requestNegotiableQuote;\n      successMessage = dictionary.draftSuccess;\n    } else {\n      submitHandler = onRequestNegotiableQuote ?? requestNegotiableQuote;\n      successMessage = dictionary.submitSuccess;\n    }\n\n    submitHandler(contextData).then(() => {\n      setSuccess(successMessage);\n    })\n      .catch(error => {\n        setError(error.message);\n      })\n  };\n\n  const titleNode = (\n    <Slot name=\"Title\" slot={slots?.Title} context={{ text: dictionary.title }}>\n      <span data-testid=\"form-title\">{dictionary.title}</span>\n    </Slot>\n  );\n\n  const commentFieldNode = (\n    <Slot\n      name=\"CommentField\"\n      slot={slots?.CommentField}\n      context={{\n        value: comment,\n        required: true,\n        errorMessage: formErrors.comment,\n        setFormErrors,\n        isFormDisabled\n      } as any}\n    >\n      <TextArea\n        name=\"comment\"\n        value={comment}\n        label={dictionary.comment}\n        required\n        autoComplete=\"off\"\n        data-testid=\"form-comment-field\"\n        errorMessage={formErrors.comment}\n        disabled={isFormDisabled}\n      />\n    </Slot>\n  );\n\n  const quoteNameFieldNode = (\n    <Slot\n      name=\"QuoteNameField\"\n      slot={slots?.QuoteNameField}\n      context={{\n        value: quoteName,\n        required: true,\n        errorMessage: formErrors.quoteName,\n        setFormErrors,\n        isFormDisabled\n      } as any}\n    >\n      <Field\n        error={formErrors.quoteName}\n        disabled={isFormDisabled}\n      >\n        <Input\n          value={quoteName}\n          name=\"quoteName\"\n          floatingLabel={dictionary.quoteName}\n          required\n          autoComplete=\"off\"\n          data-testid=\"form-quote-name-field\"\n        />\n      </Field>\n    </Slot>\n  );\n\n  const attachFileNode = (\n    <Slot\n      name=\"AttachFileField\"\n      slot={slots?.AttachFileField}\n      context={{ onChange: handleAttachFiles, formErrors, isFormDisabled, attachedFiles }}\n    >\n      <InputFile\n        multiple\n        onChange={(e: Event) => {\n          const target = e.target as HTMLInputElement;\n          const fileList = target?.files;\n          const files = fileList ? Array.from(fileList) : [];\n\n          if (files.length > 0) {\n            void handleAttachFiles(files);\n          }\n        }}\n        icon={<Add />}\n        disabled={isFormDisabled}\n        data-testid=\"form-attach-file-field\"\n        accept={acceptedFileTypes?.join(',')}\n      />\n    </Slot>\n  );\n\n  const attachedFilesListNode = attachedFiles.length > 0 ? (\n    <Slot\n      name=\"AttachedFilesList\"\n      slot={slots?.AttachedFilesList}\n      context={{ files: attachedFiles, onRemove: handleRemoveFile, disabled: isFormDisabled }}\n    >\n      <AttachedFilesList\n        files={attachedFiles}\n        onRemove={handleRemoveFile}\n        disabled={isFormDisabled}\n      />\n    </Slot>\n  ) : undefined;\n\n  const requestButtonNode = (\n    <Slot\n      name=\"RequestButton\"\n      slot={slots?.RequestButton}\n      context={\n        {\n          requestNegotiableQuote,\n          formErrors,\n          isFormDisabled,\n          setIsFormDisabled\n        }\n      }\n    >\n      <Button\n        type=\"submit\"\n        data-testid=\"form-request-button\"\n        onClick={validateParentForm}\n        disabled={isFormDisabled}\n      >\n        {dictionary.requestCta}\n      </Button>\n    </Slot>\n  );\n\n  const saveButtonNode = (\n    <Slot\n      name=\"SaveDraftButton\"\n      slot={slots?.SaveDraftButton}\n      context={\n        {\n          requestNegotiableQuote,\n          formErrors,\n          isFormDisabled,\n          setIsFormDisabled\n        }\n      }\n    >\n      <Button\n        type=\"submit\"\n        data-draft=\"true\"\n        variant=\"secondary\"\n        data-testid=\"form-save-draft-button\"\n        onClick={validateParentForm}\n        disabled={isFormDisabled}\n      >\n        {dictionary.saveDraftCta}\n      </Button>\n    </Slot>\n  );\n\n  return (\n    <RequestNegotiableQuoteFormComponent\n      title={titleNode}\n      banner={getBannerNode()}\n      commentField={commentFieldNode}\n      quoteNameField={quoteNameFieldNode}\n      attachFile={attachFileNode}\n      attachedFilesList={attachedFilesListNode}\n      requestButton={requestButtonNode}\n      saveButton={saveButtonNode}\n      onSubmit={formSubmitHandler}\n      className={className}\n      disabled={isFormDisabled}\n      data-testid=\"form-container\"\n    />\n  );\n};\n"],"names":["RequestNegotiableQuoteForm","className","title","banner","commentField","quoteNameField","attachFile","attachedFilesList","requestButton","saveButton","onSubmit","props","jsxs","classes","jsx","VComponent","cartId","slots","onRequestNegotiableQuote","onSaveNegotiableQuote","onAttachFiles","onSubmitErrors","onError","maxFiles","maxFileSize","acceptedFileTypes","comment","setComment","useState","quoteName","setQuoteName","attachedFiles","setAttachedFiles","error","setError","formErrors","setFormErrors","success","setSuccess","isFormDisabled","setIsFormDisabled","dictionary","useText","useEffect","permissionsEvent","events","permissions","authenticatedEvent","authenticated","handleAttachFiles","useCallback","files","prev","file","validateFileSize","formatFileSize","validateFileType","attachments","rest","_a","newFiles","i","tempKey","result","uploadFile","f","handleRemoveFile","key","getBannerNode","inlineAlertProps","slotProps","CheckWithCircle","WarningFilled","Slot","InLineAlert","validateParentForm","closestForm","getFormErrors","formSubmitHandler","form","mergedFormErrors","buttonTarget","formValues","getFormValues","isDraft","successfulAttachments","contextData","submitHandler","successMessage","requestNegotiableQuote","titleNode","commentFieldNode","TextArea","quoteNameFieldNode","Field","Input","attachFileNode","InputFile","target","fileList","Add","attachedFilesListNode","AttachedFilesList","requestButtonNode","Button","saveButtonNode","RequestNegotiableQuoteFormComponent"],"mappings":"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"}