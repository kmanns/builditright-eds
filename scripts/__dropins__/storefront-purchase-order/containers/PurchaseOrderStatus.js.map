{"version":3,"file":"PurchaseOrderStatus.js","sources":["/@dropins/storefront-purchase-order/src/hooks/usePurchaseOrderStatus.tsx","/@dropins/storefront-purchase-order/src/components/PurchaseOrderStatusContent/PurchaseOrderStatusContent.tsx","/@dropins/storefront-purchase-order/src/containers/PurchaseOrderStatus/PurchaseOrderStatus.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { useState, useCallback } from 'preact/hooks';\nimport {\n  approvePurchaseOrders,\n  cancelPurchaseOrders,\n  placeOrderForPurchaseOrder,\n  rejectPurchaseOrders,\n} from '@/b2b-purchase-order/api';\nimport { InLineAlertProps } from '@adobe-commerce/elsie/components';\nimport {\n  UsePurchaseOrderStatusReturn,\n  PURCHASE_ORDER_ACTION,\n  PURCHASE_ORDER_STATUS,\n} from '@/b2b-purchase-order/types/hooks';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { usePurchaseOrderData } from './usePurchaseOrderData';\nimport { events } from '@adobe-commerce/event-bus';\n\nexport const usePurchaseOrderStatus = (): UsePurchaseOrderStatusReturn => {\n  const { poDataLoading, purchaseOrderData } = usePurchaseOrderData();\n\n  const t = useText({\n    approvalSuccessMessage:\n      'PurchaseOrders.purchaseOrderStatus.alertMessages.success.approval',\n    rejectSuccessMessage:\n      'PurchaseOrders.purchaseOrderStatus.alertMessages.success.reject',\n    cancelSuccessMessage:\n      'PurchaseOrders.purchaseOrderStatus.alertMessages.success.cancel',\n    placeOrderSuccessMessage:\n      'PurchaseOrders.purchaseOrderStatus.alertMessages.success.placeOrder',\n    approvalErrorMessage:\n      'PurchaseOrders.purchaseOrderStatus.alertMessages.errors.approval',\n    rejectErrorMessage:\n      'PurchaseOrders.purchaseOrderStatus.alertMessages.errors.reject',\n    cancelErrorMessage:\n      'PurchaseOrders.purchaseOrderStatus.alertMessages.errors.cancel',\n    placeOrderErrorMessage:\n      'PurchaseOrders.purchaseOrderStatus.alertMessages.errors.placeOrder',\n  });\n\n  const poId = purchaseOrderData?.uid ?? null;\n  const status =\n    (purchaseOrderData?.status as PURCHASE_ORDER_STATUS) ?? 'PENDING';\n  const availableActions =\n    (purchaseOrderData?.availableActions as PURCHASE_ORDER_ACTION[]) ?? [];\n\n  const [alertType, setAlertType] =\n    useState<NonNullable<InLineAlertProps['type']>>('success');\n  const [alertMessage, setAlertMessage] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [isDismissed, setIsDismissed] = useState(true);\n  const handleOnDismiss = () => {\n    setIsDismissed(true);\n  };\n\n  const showAlert = useCallback(\n    (isSuccess: boolean, actionType: PURCHASE_ORDER_ACTION) => {\n      let message = '';\n      if (isSuccess) {\n        switch (actionType) {\n          case 'APPROVE':\n            message = t.approvalSuccessMessage;\n            break;\n          case 'REJECT':\n            message = t.rejectSuccessMessage;\n            break;\n          case 'CANCEL':\n            message = t.cancelSuccessMessage;\n            break;\n          case 'PLACE_ORDER':\n            message = t.placeOrderSuccessMessage;\n            break;\n        }\n        setAlertType('success');\n      } else {\n        switch (actionType) {\n          case 'APPROVE':\n            message = t.approvalErrorMessage;\n            break;\n          case 'REJECT':\n            message = t.rejectErrorMessage;\n            break;\n          case 'CANCEL':\n            message = t.cancelErrorMessage;\n            break;\n          case 'PLACE_ORDER':\n            message = t.placeOrderErrorMessage;\n            break;\n        }\n        setAlertType('error');\n      }\n\n      setAlertMessage(message);\n      setIsDismissed(false);\n    },\n    [t]\n  );\n\n  const handleAction = useCallback(\n    async (\n      apiFn: (id: string) => Promise<any>,\n      actionType: PURCHASE_ORDER_ACTION\n    ) => {\n      if (!poId) return;\n      setLoading(true);\n      try {\n        await apiFn(poId);\n        showAlert(true, actionType);\n      } catch {\n        showAlert(false, actionType);\n      } finally {\n        setLoading(false);\n        events.emit('purchase-order/refresh', true);\n      }\n    },\n    [poId, showAlert]\n  );\n\n  const handleApprove = useCallback(\n    () => handleAction(approvePurchaseOrders, 'APPROVE'),\n    [handleAction]\n  );\n  const handleReject = useCallback(\n    () => handleAction(rejectPurchaseOrders, 'REJECT'),\n    [handleAction]\n  );\n  const handleCancel = useCallback(\n    () => handleAction(cancelPurchaseOrders, 'CANCEL'),\n    [handleAction]\n  );\n  const handlePlaceOrder = useCallback(\n    () => handleAction(placeOrderForPurchaseOrder, 'PLACE_ORDER'),\n    [handleAction]\n  );\n\n  return {\n    poId,\n    status,\n    availableActions,\n    alertType,\n    loading,\n    poDataLoading,\n    isDismissed,\n    alertMessage,\n    handleOnDismiss,\n    handleApprove,\n    handleReject,\n    handleCancel,\n    handlePlaceOrder,\n  };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FunctionComponent } from 'preact';\nimport { classes, Slot } from '@adobe-commerce/elsie/lib';\nimport '@/b2b-purchase-order/components/PurchaseOrderStatusContent/PurchaseOrderStatusContent.css';\nimport { PurchaseOrderStatusContentProps } from '@/b2b-purchase-order/types/components';\nimport { Button } from '@adobe-commerce/elsie/components';\nimport { PURCHASE_ORDER_ACTION } from '@/b2b-purchase-order/types/hooks';\n\nexport const PurchaseOrderStatusContent: FunctionComponent<\n  PurchaseOrderStatusContentProps\n> = ({\n  slots,\n  t,\n  loading,\n  children,\n  availableActions = [],\n  handleApprove,\n  handleReject,\n  handleCancel,\n  handlePlaceOrder,\n}) => {\n  const renderButtons = availableActions.map((action) => {\n    switch (action as PURCHASE_ORDER_ACTION) {\n      case 'APPROVE':\n        return (\n          <Button\n            variant=\"secondary\"\n            disabled={loading}\n            type=\"button\"\n            key={action}\n            onClick={handleApprove}\n          >\n            {t.approveButtonText}\n          </Button>\n        );\n      case 'PLACE_ORDER':\n        return (\n          <Button\n            variant=\"secondary\"\n            disabled={loading}\n            type=\"button\"\n            key={action}\n            onClick={handlePlaceOrder}\n          >\n            {t.placeOrderButtonText}\n          </Button>\n        );\n      case 'REJECT':\n        return (\n          <Button\n            variant=\"secondary\"\n            disabled={loading}\n            type=\"button\"\n            key={action}\n            onClick={handleReject}\n          >\n            {t.rejectButtonText}\n          </Button>\n        );\n      case 'CANCEL':\n        return (\n          <Button\n            variant=\"secondary\"\n            disabled={loading}\n            type=\"button\"\n            key={action}\n            onClick={handleCancel}\n          >\n            {t.cancelButtonText}\n          </Button>\n        );\n      default:\n        return null;\n    }\n  });\n\n  return (\n    <div className={classes(['b2b-purchase-order-status-content'])}>\n      <div className={'b2b-purchase-order-status-content__message'}>\n        {t.statusMessageText}\n      </div>\n      {children}\n      <div className={'b2b-purchase-order-status-content__actions'}>\n        <Slot\n          data-testid=\"PurchaseOrderActions\"\n          name=\"PurchaseOrderActions\"\n          slot={slots?.PurchaseOrderActions}\n          context={{\n            loading,\n            availableActions,\n            handleApprove,\n            handleReject,\n            handleCancel,\n            handlePlaceOrder,\n          }}\n        >\n          {renderButtons}\n        </Slot>\n      </div>\n    </div>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { useText, Text } from '@adobe-commerce/elsie/i18n';\nimport { classes, Container } from '@adobe-commerce/elsie/lib';\nimport {\n  Card,\n  InLineAlert,\n  Skeleton,\n  SkeletonRow,\n} from '@adobe-commerce/elsie/components';\nimport { usePurchaseOrderStatus } from '@/b2b-purchase-order/hooks';\nimport { PurchaseOrderStatusProps } from '@/b2b-purchase-order/types/containers';\nimport {\n  PurchaseOrderStatusContent,\n  PurchaseOrdersHeader,\n} from '@/b2b-purchase-order/components';\n\nexport const PurchaseOrderStatus: Container<PurchaseOrderStatusProps> = ({\n  className,\n  withHeader = true,\n  withWrapper = true,\n  slots,\n}) => {\n  const {\n    poId,\n    status,\n    availableActions,\n    alertType,\n    loading,\n    poDataLoading,\n    isDismissed,\n    alertMessage,\n    handleOnDismiss,\n    handleApprove,\n    handleReject,\n    handleCancel,\n    handlePlaceOrder,\n  } = usePurchaseOrderStatus();\n\n  const t = useText({\n    statusHeadingText: `PurchaseOrders.purchaseOrderStatus.status.${status.toLowerCase()}.title`,\n    statusMessageText: `PurchaseOrders.purchaseOrderStatus.status.${status.toLowerCase()}.message`,\n    approveButtonText: 'PurchaseOrders.purchaseOrderStatus.buttons.approve',\n    cancelButtonText: 'PurchaseOrders.purchaseOrderStatus.buttons.cancel',\n    rejectButtonText: 'PurchaseOrders.purchaseOrderStatus.buttons.reject',\n    placeOrderButtonText:\n      'PurchaseOrders.purchaseOrderStatus.buttons.placeOrder',\n  });\n\n  const isActionAvailable = availableActions.length > 0;\n\n  if (!poId) return null;\n\n  const renderStatusContent = (\n    <>\n      {withHeader && withWrapper ? (\n        <PurchaseOrdersHeader headerText={t.statusHeadingText} divider={true} />\n      ) : null}\n      {poDataLoading ? (\n        <Skeleton data-testid={'status-content-loader-skeleton-test-id'}>\n          <SkeletonRow\n            size=\"small\"\n            variant=\"row\"\n            fullWidth\n            lines={1}\n            style={{ maxWidth: 300 }}\n          />\n          <SkeletonRow size=\"medium\" variant=\"row\" fullWidth lines={1} />\n        </Skeleton>\n      ) : isActionAvailable ? (\n        <PurchaseOrderStatusContent\n          t={t}\n          loading={loading}\n          handleApprove={handleApprove}\n          handleReject={handleReject}\n          handleCancel={handleCancel}\n          handlePlaceOrder={handlePlaceOrder}\n          availableActions={availableActions}\n          slots={slots}\n        />\n      ) : (\n        <div className={'purchase-order-status__empty'}>\n          <Text id=\"PurchaseOrders.purchaseOrderStatus.emptyText\" />\n        </div>\n      )}\n    </>\n  );\n\n  return (\n    <div className={classes(['purchase-order-status', className])}>\n      {!isDismissed && alertMessage ? (\n        <InLineAlert\n          style={{ marginBottom: '1rem', textTransform: 'capitalize' }}\n          heading={alertType}\n          onDismiss={handleOnDismiss}\n          description={alertMessage}\n          type={alertType}\n        />\n      ) : null}\n      {withHeader && !withWrapper ? (\n        <PurchaseOrdersHeader headerText={t.statusHeadingText} />\n      ) : null}\n      {withWrapper ? (\n        <Card variant=\"secondary\">{renderStatusContent}</Card>\n      ) : (\n        renderStatusContent\n      )}\n    </div>\n  );\n};\n"],"names":["usePurchaseOrderStatus","poDataLoading","purchaseOrderData","usePurchaseOrderData","t","useText","poId","status","availableActions","alertType","setAlertType","useState","alertMessage","setAlertMessage","loading","setLoading","isDismissed","setIsDismissed","handleOnDismiss","showAlert","useCallback","isSuccess","actionType","message","handleAction","apiFn","events","handleApprove","approvePurchaseOrders","handleReject","rejectPurchaseOrders","handleCancel","cancelPurchaseOrders","handlePlaceOrder","placeOrderForPurchaseOrder","PurchaseOrderStatusContent","slots","children","renderButtons","action","jsx","Button","classes","Slot","PurchaseOrderStatus","className","withHeader","withWrapper","isActionAvailable","renderStatusContent","jsxs","Fragment","PurchaseOrdersHeader","Skeleton","SkeletonRow","Text","InLineAlert","Card"],"mappings":"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"}