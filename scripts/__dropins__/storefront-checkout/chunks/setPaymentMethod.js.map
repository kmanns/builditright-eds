{"version":3,"file":"setPaymentMethod.js","sources":["/@dropins/storefront-checkout/src/api/setPaymentMethod/graphql/setPaymentMethodOnCart.graphql.ts","/@dropins/storefront-checkout/src/api/setPaymentMethod/graphql/setPaymentMethodOnQuote.graphql.ts","/@dropins/storefront-checkout/src/api/setPaymentMethod/setPaymentMethod.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CHECKOUT_DATA_FRAGMENT } from '@/checkout/api/graphql/CheckoutDataFragment.graphql';\n\nexport const setPaymentMethodOnCartMutation = /* GraphQL */ `\n  mutation setPaymentMethodOnCart(\n    $cartId: String!\n    $input: PaymentMethodInput!\n  ) {\n    setPaymentMethodOnCart(\n      input: { cart_id: $cartId, payment_method: $input }\n    ) {\n      cart {\n        ...CHECKOUT_DATA_FRAGMENT\n      }\n    }\n  }\n\n  ${CHECKOUT_DATA_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { NEGOTIABLE_QUOTE_FRAGMENT } from '@/checkout/api/graphql/NegotiableQuoteFragment.graphql';\n\nexport const setPaymentMethodOnQuoteMutation = /* GraphQL */ `\n  mutation setPaymentMethodOnQuote(\n    $quoteId: ID!\n    $input: NegotiableQuotePaymentMethodInput!\n  ) {\n    setNegotiableQuotePaymentMethod(\n      input: { quote_uid: $quoteId, payment_method: $input }\n    ) {\n      quote {\n        ...NEGOTIABLE_QUOTE_FRAGMENT\n      }\n    }\n  }\n\n  ${NEGOTIABLE_QUOTE_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  setPaymentMethodOnCartMutation,\n  setPaymentMethodOnQuoteMutation,\n} from '@/checkout/api/setPaymentMethod/graphql';\nimport { PaymentMethodInput as PaymentMethodInputModel } from '@/checkout/data/models';\nimport {\n  transformCart,\n  transformNegotiableQuote,\n  transformPaymentMethodInputModelToCartInput,\n  transformPaymentMethodInputModelToQuoteInput,\n} from '@/checkout/data/transforms';\nimport { dispatchApiCall } from '@/checkout/lib/dispatchApiCall';\nimport { QueueName } from '@/checkout/lib/enqueueRequest';\nimport { MissingPaymentMethod } from '@/checkout/lib/errors/customErrors';\nimport { ensureHasCartOrQuoteId } from '@/checkout/lib/guards';\nimport { state } from '@/checkout/lib/state';\n\nconst createPaymentMethodSetter = <TTransformedInput, TTransformedOutput>(\n  entityId: string,\n  entityKey: string,\n  mutation: string,\n  transformer: (data: any) => TTransformedOutput,\n  transformInput: (input: PaymentMethodInputModel) => TTransformedInput,\n  path: string\n) => {\n  return async (\n    input: PaymentMethodInputModel\n  ): Promise<TTransformedOutput> => {\n    return await dispatchApiCall({\n      type: 'mutation',\n      query: mutation,\n      options: {\n        variables: {\n          [entityKey]: entityId,\n          input: transformInput(input),\n        },\n      },\n      path,\n      queueName: QueueName.Updates,\n      transformer,\n    });\n  };\n};\n\nconst ensureHasPaymentMethodCode = (input: PaymentMethodInputModel) => {\n  if (!input.code) {\n    throw new MissingPaymentMethod();\n  }\n};\n\nexport const setPaymentMethod = async (input: PaymentMethodInputModel) => {\n  ensureHasCartOrQuoteId();\n  ensureHasPaymentMethodCode(input);\n\n  const isCart = Boolean(state.cartId);\n\n  const setter = isCart\n    ? createPaymentMethodSetter(\n        state.cartId!,\n        'cartId',\n        setPaymentMethodOnCartMutation,\n        transformCart,\n        transformPaymentMethodInputModelToCartInput,\n        'setPaymentMethodOnCart.cart'\n      )\n    : createPaymentMethodSetter(\n        state.quoteId!,\n        'quoteId',\n        setPaymentMethodOnQuoteMutation,\n        transformNegotiableQuote,\n        transformPaymentMethodInputModelToQuoteInput,\n        'setNegotiableQuotePaymentMethod.quote'\n      );\n\n  return await setter(input);\n};\n"],"names":["setPaymentMethodOnCartMutation","CHECKOUT_DATA_FRAGMENT","setPaymentMethodOnQuoteMutation","NEGOTIABLE_QUOTE_FRAGMENT","createPaymentMethodSetter","entityId","entityKey","mutation","transformer","transformInput","path","input","dispatchApiCall","QueueName","ensureHasPaymentMethodCode","MissingPaymentMethod","setPaymentMethod","ensureHasCartOrQuoteId","state","transformCart","transformPaymentMethodInputModelToCartInput","transformNegotiableQuote","transformPaymentMethodInputModelToQuoteInput"],"mappings":"wTAmBa,MAAAA,EAA+C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAcxDC,CAAsB;AAAA,ECdbC,EAAgD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAczDC,CAAyB;AAAA,ECCvBC,EAA4B,CAChCC,EACAC,EACAC,EACAC,EACAC,EACAC,IAEO,MACLC,GAEO,MAAMC,EAAgB,CAC3B,KAAM,WACN,MAAOL,EACP,QAAS,CACP,UAAW,CACT,CAACD,CAAS,EAAGD,EACb,MAAOI,EAAeE,CAAK,CAAA,CAE/B,EACA,KAAAD,EACA,UAAWG,EAAU,QACrB,YAAAL,CAAA,CACD,EAICM,EAA8BH,GAAmC,CACjE,GAAA,CAACA,EAAM,KACT,MAAM,IAAII,CAEd,EAEaC,EAAmB,MAAOL,IACdM,EAAA,EACvBH,EAA2BH,CAAK,EAsBzB,MApBQ,EAAQO,EAAM,OAGzBd,EACEc,EAAM,OACN,SACAlB,EACAmB,EACAC,EACA,6BAAA,EAEFhB,EACEc,EAAM,QACN,UACAhB,EACAmB,EACAC,EACA,uCACF,GAEgBX,CAAK"}