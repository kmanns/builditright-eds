{"version":3,"file":"transform-shipping-methods.js","sources":["/@dropins/storefront-checkout/src/data/transforms/transform-custom-attributes.ts","/@dropins/storefront-checkout/src/data/transforms/transform-cart-address.ts","/@dropins/storefront-checkout/src/data/transforms/transform-country.ts","/@dropins/storefront-checkout/src/data/transforms/transform-region.ts","/@dropins/storefront-checkout/src/data/transforms/transform-shipping-methods.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CustomAttribute as CustomAttributeModel } from '@/checkout/data/models/custom-attribute';\nimport { AttributeValue } from '@/checkout/__generated__/types';\n\nconst isAttributeValue = (attribute: any): attribute is AttributeValue => {\n  if (!attribute) return false;\n  return 'code' in attribute && 'value' in attribute;\n};\n\nexport const transformCustomAttributes = (\n  data: Array<AttributeValue | any | null> | null | undefined\n): CustomAttributeModel[] => {\n  if (!data) return [];\n  return data.filter(isAttributeValue).map((attribute) => {\n    const { code, value } = attribute;\n    return { code, value };\n  });\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  AddressInput as AddressInputModel,\n  CartAddress as CartAddressModel,\n  CartShippingAddress as CartShippingAddressModel,\n} from '@/checkout/data/models';\n\nimport {\n  transformAddressCountry,\n  transformAddressRegion,\n  transformCustomAttributes,\n  transformSelectedShippingMethod,\n  transformShippingMethods,\n} from '@/checkout/data/transforms';\n\nimport { GetCartQuery } from '@/checkout/__generated__/types';\n\ntype ShippingAddresses = NonNullable<\n  GetCartQuery['cart']\n>['shipping_addresses'];\ntype CartShippingAddress = ShippingAddresses[0];\ntype NonNullableShippingAddress = NonNullable<CartShippingAddress>;\n\ntype CartBillingAddress = NonNullable<GetCartQuery['cart']>['billing_address'];\ntype NonNullableBillingAddress = NonNullable<CartBillingAddress>;\n\nconst transformBaseCartAddress = (\n  data: NonNullableShippingAddress | NonNullableBillingAddress\n): CartAddressModel => {\n  const street = data.street.filter(Boolean) as string[];\n\n  return {\n    city: data.city,\n    company: data.company || undefined,\n    country: transformAddressCountry(data.country),\n    customAttributes: transformCustomAttributes(data.custom_attributes),\n    fax: data.fax || undefined,\n    firstName: data.firstname,\n    id: data?.id || undefined,\n    lastName: data.lastname,\n    middleName: data.middlename || undefined,\n    postCode: data.postcode || undefined,\n    prefix: data.prefix || undefined,\n    region: transformAddressRegion(data.region),\n    street,\n    suffix: data.suffix || undefined,\n    telephone: data.telephone || undefined,\n    uid: data.uid,\n    vatId: data.vat_id || undefined,\n  };\n};\n\nconst transformCartBillingAddress = (\n  data: CartBillingAddress\n): CartAddressModel | undefined => {\n  if (!data) return;\n  return transformBaseCartAddress(data);\n};\n\nconst transformCartShippingAddress = (\n  data: ShippingAddresses\n): CartShippingAddressModel[] => {\n  return data\n    .filter((address) => !!address)\n    .map((address) => {\n      const {\n        available_shipping_methods,\n        selected_shipping_method,\n        same_as_billing,\n        ...baseData\n      } = address as NonNullableShippingAddress;\n\n      return {\n        ...transformBaseCartAddress(baseData as NonNullableShippingAddress),\n        availableShippingMethods: transformShippingMethods(\n          available_shipping_methods\n        ),\n        selectedShippingMethod: transformSelectedShippingMethod(\n          selected_shipping_method\n        ),\n        sameAsBilling: same_as_billing,\n      };\n    });\n};\n\nconst transformAddressToCartAddressInput = <T extends CartAddressModel>(\n  address?: T | null\n): AddressInputModel | undefined => {\n  if (!address) return;\n  return {\n    city: address.city,\n    company: address.company,\n    countryCode: address.country.code,\n    customAttributes: address.customAttributes || [],\n    firstName: address.firstName,\n    lastName: address.lastName,\n    postcode: address.postCode,\n    region: address.region?.code,\n    regionId: address.region?.id,\n    street: address.street,\n    telephone: address.telephone,\n    vatId: address.vatId,\n    prefix: address.prefix,\n    suffix: address.suffix,\n    middleName: address.middleName,\n    fax: address.fax,\n  };\n};\n\nexport {\n  CartBillingAddress,\n  CartShippingAddress,\n  transformAddressToCartAddressInput,\n  transformCartBillingAddress,\n  transformCartShippingAddress,\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  CartAddressCountry,\n  NegotiableQuoteAddressCountry,\n} from '@/checkout/__generated__/types';\n\nimport { Country as CountryModel } from '@/checkout/data/models';\n\ntype AddressCountry = CartAddressCountry | NegotiableQuoteAddressCountry;\ntype OptionalAddressCountry = AddressCountry | undefined | null;\n\nexport const transformAddressCountry = (\n  data: OptionalAddressCountry\n): CountryModel => ({\n  code: data?.code ?? '',\n  label: data?.label ?? '',\n});\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { Region as RegionModel } from '@/checkout/data/models';\nimport {\n  CartAddressRegion,\n  NegotiableQuoteAddressRegion,\n} from '@/checkout/__generated__/types';\n\ntype AddressRegion = CartAddressRegion | NegotiableQuoteAddressRegion;\ntype OptionalAddressRegion = AddressRegion | undefined | null;\n\nexport const transformAddressRegion = (\n  data: OptionalAddressRegion\n): RegionModel | undefined => {\n  if (!data?.code || !data?.label) return;\n  return {\n    code: data.code,\n    name: data.label,\n    id: data.region_id ?? undefined,\n  };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { ShippingMethod } from '@/checkout/data/models/shipping-method';\nimport { GetCartQuery } from '@/checkout/__generated__/types';\n\ntype Cart = NonNullable<GetCartQuery['cart']>;\ntype ShippingAddresses = Cart['shipping_addresses'];\ntype ShippingAddress = NonNullable<NonNullable<ShippingAddresses>[number]>;\ntype AvailableShippingMethods = ShippingAddress['available_shipping_methods'];\ntype AvailableShippingMethod = NonNullable<AvailableShippingMethods>[number];\ntype SelectedShippingMethod = ShippingAddress['selected_shipping_method'];\n\ntype FilteredShippingMethod = Omit<\n  NonNullable<AvailableShippingMethod>,\n  | 'method_code'\n  | 'method_title'\n  | 'amount'\n  | 'price_excl_tax'\n  | 'price_incl_tax'\n> & {\n  method_code: string;\n  method_title: string;\n  amount: {\n    value: number;\n    currency: string;\n  };\n  price_excl_tax: {\n    value: number;\n    currency: string;\n  };\n  price_incl_tax: {\n    value: number;\n    currency: string;\n  };\n};\n\nconst byPrice = (a: ShippingMethod, b: ShippingMethod) =>\n  a.amount.value - b.amount.value;\n\nexport const isNullish = (value: any): boolean =>\n  value === null || value === undefined;\n\nconst isValid = (method: AvailableShippingMethod | SelectedShippingMethod) => {\n  if (!method) return false;\n  if (!method.method_code || !method.method_title) return false;\n  if (isNullish(method.amount.value) || !method.amount.currency) return false;\n  return true;\n};\n\nconst buildShippingMethod = (data: FilteredShippingMethod): ShippingMethod => {\n  return {\n    amount: {\n      value: data.amount.value,\n      currency: data.amount.currency,\n    },\n    title: data.method_title,\n    code: data.method_code,\n    carrier: {\n      code: data.carrier_code,\n      title: data.carrier_title,\n    },\n    value: `${data.carrier_code} - ${data.method_code}`,\n    ...(data.price_excl_tax && {\n      amountExclTax: {\n        value: data.price_excl_tax.value,\n        currency: data.price_excl_tax.currency,\n      },\n    }),\n    ...(data.price_incl_tax && {\n      amountInclTax: {\n        value: data.price_incl_tax.value,\n        currency: data.price_incl_tax.currency,\n      },\n    }),\n  };\n};\n\nexport const transformSelectedShippingMethod = (\n  data: SelectedShippingMethod\n): ShippingMethod | undefined => {\n  if (!isValid(data)) return;\n  return buildShippingMethod(data as FilteredShippingMethod);\n};\n\nexport const transformAvailableShippingMethod = (\n  data: AvailableShippingMethod\n): ShippingMethod | undefined => {\n  if (!isValid(data)) return;\n  return buildShippingMethod(data as FilteredShippingMethod);\n};\n\nexport const transformShippingMethods = (\n  data: AvailableShippingMethods\n): ShippingMethod[] => {\n  if (!data) return [];\n\n  return data\n    .filter(isValid)\n    .map((method) => buildShippingMethod(method as FilteredShippingMethod))\n    .sort(byPrice);\n};\n"],"names":["isAttributeValue","attribute","transformCustomAttributes","data","code","value","transformBaseCartAddress","street","transformAddressCountry","transformAddressRegion","transformCartBillingAddress","transformCartShippingAddress","address","available_shipping_methods","selected_shipping_method","same_as_billing","baseData","transformShippingMethods","transformSelectedShippingMethod","transformAddressToCartAddressInput","_a","_b","byPrice","a","b","isNullish","isValid","method","buildShippingMethod"],"mappings":"6FAoBA,MAAMA,EAAoBC,GACnBA,EACE,SAAUA,GAAa,UAAWA,EADlB,GAIZC,EACXC,GAEKA,EACEA,EAAK,OAAOH,CAAgB,EAAE,IAAKC,GAAc,CAChD,KAAA,CAAE,KAAAG,EAAM,MAAAC,CAAA,EAAUJ,EACjB,MAAA,CAAE,KAAAG,EAAM,MAAAC,CAAM,CAAA,CACtB,EAJiB,CAAC,ECcfC,EACJH,GACqB,CACrB,MAAMI,EAASJ,EAAK,OAAO,OAAO,OAAO,EAElC,MAAA,CACL,KAAMA,EAAK,KACX,QAASA,EAAK,SAAW,OACzB,QAASK,EAAwBL,EAAK,OAAO,EAC7C,iBAAkBD,EAA0BC,EAAK,iBAAiB,EAClE,IAAKA,EAAK,KAAO,OACjB,UAAWA,EAAK,UAChB,IAAIA,GAAA,YAAAA,EAAM,KAAM,OAChB,SAAUA,EAAK,SACf,WAAYA,EAAK,YAAc,OAC/B,SAAUA,EAAK,UAAY,OAC3B,OAAQA,EAAK,QAAU,OACvB,OAAQM,EAAuBN,EAAK,MAAM,EAC1C,OAAAI,EACA,OAAQJ,EAAK,QAAU,OACvB,UAAWA,EAAK,WAAa,OAC7B,IAAKA,EAAK,IACV,MAAOA,EAAK,QAAU,MACxB,CACF,EAEMO,EACJP,GACiC,CACjC,GAAKA,EACL,OAAOG,EAAyBH,CAAI,CACtC,EAEMQ,EACJR,GAEOA,EACJ,OAAQS,GAAY,CAAC,CAACA,CAAO,EAC7B,IAAKA,GAAY,CACV,KAAA,CACJ,2BAAAC,EACA,yBAAAC,EACA,gBAAAC,EACA,GAAGC,CAAA,EACDJ,EAEG,MAAA,CACL,GAAGN,EAAyBU,CAAsC,EAClE,yBAA0BC,EACxBJ,CACF,EACA,uBAAwBK,EACtBJ,CACF,EACA,cAAeC,CACjB,CAAA,CACD,EAGCI,EACJP,GACkC,SAClC,GAAKA,EACE,MAAA,CACL,KAAMA,EAAQ,KACd,QAASA,EAAQ,QACjB,YAAaA,EAAQ,QAAQ,KAC7B,iBAAkBA,EAAQ,kBAAoB,CAAC,EAC/C,UAAWA,EAAQ,UACnB,SAAUA,EAAQ,SAClB,SAAUA,EAAQ,SAClB,QAAQQ,EAAAR,EAAQ,SAAR,YAAAQ,EAAgB,KACxB,UAAUC,EAAAT,EAAQ,SAAR,YAAAS,EAAgB,GAC1B,OAAQT,EAAQ,OAChB,UAAWA,EAAQ,UACnB,MAAOA,EAAQ,MACf,OAAQA,EAAQ,OAChB,OAAQA,EAAQ,OAChB,WAAYA,EAAQ,WACpB,IAAKA,EAAQ,GACf,CACF,EChGaJ,EACXL,IACkB,CAClB,MAAMA,GAAA,YAAAA,EAAM,OAAQ,GACpB,OAAOA,GAAA,YAAAA,EAAM,QAAS,EACxB,GCNaM,EACXN,GAC4B,CAC5B,GAAI,IAACA,GAAA,MAAAA,EAAM,OAAQ,EAACA,GAAA,MAAAA,EAAM,QACnB,MAAA,CACL,KAAMA,EAAK,KACX,KAAMA,EAAK,MACX,GAAIA,EAAK,WAAa,MACxB,CACF,ECgBMmB,EAAU,CAACC,EAAmBC,IAClCD,EAAE,OAAO,MAAQC,EAAE,OAAO,MAEfC,EAAapB,GACxBA,GAAU,KAENqB,EAAWC,GACX,GAACA,GACD,CAACA,EAAO,aAAe,CAACA,EAAO,cAC/BF,EAAUE,EAAO,OAAO,KAAK,GAAK,CAACA,EAAO,OAAO,UAIjDC,EAAuBzB,IACpB,CACL,OAAQ,CACN,MAAOA,EAAK,OAAO,MACnB,SAAUA,EAAK,OAAO,QACxB,EACA,MAAOA,EAAK,aACZ,KAAMA,EAAK,YACX,QAAS,CACP,KAAMA,EAAK,aACX,MAAOA,EAAK,aACd,EACA,MAAO,GAAGA,EAAK,YAAY,MAAMA,EAAK,WAAW,GACjD,GAAIA,EAAK,gBAAkB,CACzB,cAAe,CACb,MAAOA,EAAK,eAAe,MAC3B,SAAUA,EAAK,eAAe,QAAA,CAElC,EACA,GAAIA,EAAK,gBAAkB,CACzB,cAAe,CACb,MAAOA,EAAK,eAAe,MAC3B,SAAUA,EAAK,eAAe,QAAA,CAChC,CAEJ,GAGWe,EACXf,GAC+B,CAC3B,GAACuB,EAAQvB,CAAI,EACjB,OAAOyB,EAAoBzB,CAA8B,CAC3D,EASac,EACXd,GAEKA,EAEEA,EACJ,OAAOuB,CAAO,EACd,IAAKC,GAAWC,EAAoBD,CAAgC,CAAC,EACrE,KAAKL,CAAO,EALG,CAAC"}