{"version":3,"file":"synchronizeCheckout.js","sources":["/@dropins/storefront-checkout/src/api/authenticateCustomer/authenticateCustomer.ts","/@dropins/storefront-checkout/src/data/transforms/transform-payment-methods.ts","/@dropins/storefront-checkout/src/data/transforms/transform-cart.ts","/@dropins/storefront-checkout/src/data/transforms/transform-quote-address.ts","/@dropins/storefront-checkout/src/data/transforms/transform-negotiable-quote.ts","/@dropins/storefront-checkout/src/api/getCart/graphql/getCart.graphql.ts","/@dropins/storefront-checkout/src/api/getCart/getCart.ts","/@dropins/storefront-checkout/src/api/getNegotiableQuote/graphql/getNegotiableQuote.graphql.ts","/@dropins/storefront-checkout/src/api/getNegotiableQuote/getNegotiableQuote.ts","/@dropins/storefront-checkout/src/api/initialize/listeners.ts","/@dropins/storefront-checkout/src/api/initialize/initialize.ts","/@dropins/storefront-checkout/src/types/guards.ts","/@dropins/storefront-checkout/src/api/initializeCheckout/initializeCheckout.ts","/@dropins/storefront-checkout/src/api/resetCheckout/resetCheckout.ts","/@dropins/storefront-checkout/src/api/synchronizeCheckout/synchronizeCheckout.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { state } from '@/checkout/lib/state';\n\nexport const authenticateCustomer = async (authenticated = false) => {\n  state.authenticated = authenticated;\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { PaymentMethod } from '@/checkout/data/models/payment-method';\nimport { GetCartQuery } from '@/checkout/__generated__/types';\n\ntype SelectedPaymentMethod = NonNullable<\n  GetCartQuery['cart']\n>['selected_payment_method'];\n\ntype AvailablePaymentMethods = NonNullable<\n  GetCartQuery['cart']\n>['available_payment_methods'];\n\ntype AvailablePaymentMethod = NonNullable<AvailablePaymentMethods>[number];\n\ntype NonNullabePaymentMethod = NonNullable<AvailablePaymentMethod>;\n\nconst transformSelectedPaymentMethod = (\n  data: SelectedPaymentMethod\n): PaymentMethod | undefined => {\n  if (!data) return;\n  const { code, title, ...additionalData } = data;\n  return { code, title, additionalData };\n};\n\nconst transformAvailablePaymentMethods = (\n  data: AvailablePaymentMethods\n): PaymentMethod[] | undefined => {\n  if (!data) return;\n\n  return data\n    .filter((method) => !!method)\n    .map((method) => {\n      const { code, title, ...additionalData } =\n        method as NonNullabePaymentMethod;\n      return { code, title, additionalData };\n    });\n};\n\nexport { transformAvailablePaymentMethods, transformSelectedPaymentMethod };\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { config } from '@/checkout/api';\nimport { Cart as CartModel } from '@/checkout/data/models';\nimport {\n  transformAvailablePaymentMethods,\n  transformSelectedPaymentMethod,\n} from '@/checkout/data/transforms/transform-payment-methods';\nimport { GetCartQuery } from '@/checkout/__generated__/types';\nimport { merge } from '@adobe-commerce/elsie/lib';\n\nimport {\n  transformCartBillingAddress,\n  transformCartShippingAddress,\n} from '@/checkout/data/transforms/transform-cart-address';\nimport { state } from '@/checkout/lib/state';\n\ntype Cart = GetCartQuery['cart'];\n\nconst transformCart = (data: Cart): CartModel | undefined => {\n  if (!data) return;\n\n  const model = {\n    type: 'cart' as const,\n    availablePaymentMethods: transformAvailablePaymentMethods(\n      data.available_payment_methods\n    ),\n    billingAddress: transformCartBillingAddress(data.billing_address),\n    email: data.email ?? undefined,\n    id: data.id,\n    isEmpty: data.total_quantity === 0,\n    isVirtual: data.is_virtual,\n    selectedPaymentMethod: transformSelectedPaymentMethod(\n      data.selected_payment_method\n    ),\n    shippingAddresses: transformCartShippingAddress(data.shipping_addresses),\n    isGuest: !state.authenticated,\n  };\n\n  // Extend the model merging custom transformer, if provided\n  return merge(\n    model, // default transformer\n    config.getConfig().models?.CartModel?.transformer?.(data) // custom transformer\n  );\n};\n\nexport { Cart, transformCart };\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  Address as AddressModel,\n  ShippingAddress as ShippingAddressModel,\n} from '@/checkout/data/models';\n\nimport {\n  transformAddressCountry,\n  transformAddressRegion,\n  transformCustomAttributes,\n  transformSelectedShippingMethod,\n  transformShippingMethods,\n} from '@/checkout/data/transforms';\nimport { GetNegotiableQuoteQuery } from '@/checkout/__generated__/types';\n\ntype QuoteShippingAddresses = NonNullable<\n  GetNegotiableQuoteQuery['negotiableQuote']\n>['shipping_addresses'];\ntype QuoteShippingAddress = QuoteShippingAddresses[0];\ntype NonNullableShippingAddress = NonNullable<QuoteShippingAddress>;\n\ntype QuoteBillingAddress = NonNullable<\n  GetNegotiableQuoteQuery['negotiableQuote']\n>['billing_address'];\ntype NonNullableBillingAddress = NonNullable<QuoteBillingAddress>;\n\nconst transformAddress = (\n  data: NonNullableShippingAddress | NonNullableBillingAddress\n): AddressModel => {\n  const street = data.street.filter(Boolean) as string[];\n\n  return {\n    city: data.city,\n    company: data.company || undefined,\n    country: transformAddressCountry(data.country),\n    customAttributes: transformCustomAttributes(data.custom_attributes),\n    customerAddressUid: data.customer_address_uid || undefined,\n    fax: data.fax || undefined,\n    firstName: data.firstname,\n    lastName: data.lastname,\n    middleName: data.middlename || undefined,\n    postCode: data.postcode || undefined,\n    prefix: data.prefix || undefined,\n    region: transformAddressRegion(data.region),\n    street,\n    suffix: data.suffix || undefined,\n    telephone: data.telephone || undefined,\n    uid: data.uid,\n    vatId: data.vat_id || undefined,\n  };\n};\n\nconst transformQuoteBillingAddress = (\n  data: QuoteBillingAddress\n): AddressModel | undefined => {\n  if (!data) return;\n  return transformAddress(data);\n};\n\nconst transformQuoteShippingAddress = (\n  data: QuoteShippingAddresses\n): ShippingAddressModel[] => {\n  return data\n    .filter((address) => !!address)\n    .map((address) => {\n      const {\n        available_shipping_methods,\n        selected_shipping_method,\n        ...baseData\n      } = address as NonNullableShippingAddress;\n\n      return {\n        ...transformAddress(baseData as NonNullableShippingAddress),\n        availableShippingMethods: transformShippingMethods(\n          available_shipping_methods\n        ),\n        selectedShippingMethod: transformSelectedShippingMethod(\n          selected_shipping_method\n        ),\n      };\n    });\n};\n\nexport {\n  QuoteBillingAddress,\n  QuoteShippingAddress,\n  transformQuoteBillingAddress,\n  transformQuoteShippingAddress,\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { NegotiableQuote as NegotiableQuoteModel } from '@/checkout/data/models/';\nimport { GetNegotiableQuoteQuery } from '@/checkout/__generated__/types';\n\nimport {\n  transformAvailablePaymentMethods,\n  transformQuoteBillingAddress,\n  transformQuoteShippingAddress,\n  transformSelectedPaymentMethod,\n} from '@/checkout/data/transforms';\n\ntype NegotiableQuote = GetNegotiableQuoteQuery['negotiableQuote'];\n\nexport const transformNegotiableQuote = (\n  data: NegotiableQuote | undefined\n): NegotiableQuoteModel | null => {\n  if (!data) return null;\n\n  return {\n    type: 'quote' as const,\n    availablePaymentMethods: transformAvailablePaymentMethods(\n      data.available_payment_methods\n    ),\n    billingAddress: transformQuoteBillingAddress(data.billing_address),\n    email: data.email ?? '',\n    isEmpty: data.total_quantity === 0,\n    isVirtual: data.is_virtual,\n    name: data.name,\n    selectedPaymentMethod: transformSelectedPaymentMethod(\n      data.selected_payment_method\n    ),\n    shippingAddresses: transformQuoteShippingAddress(data.shipping_addresses),\n    status: data.status,\n    uid: data.uid,\n  };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CHECKOUT_DATA_FRAGMENT } from '@/checkout/api/graphql/CheckoutDataFragment.graphql';\n\nexport const getCartQuery = /* GraphQL */ `\n  query getCart($cartId: String!) {\n    cart(cart_id: $cartId) {\n      ...CHECKOUT_DATA_FRAGMENT\n    }\n  }\n\n  ${CHECKOUT_DATA_FRAGMENT}\n`;\n\nexport const getCustomerCartQuery = /* GraphQL */ `\n  query getCustomerCart {\n    cart: customerCart {\n      ...CHECKOUT_DATA_FRAGMENT\n    }\n  }\n\n  ${CHECKOUT_DATA_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  getCartQuery,\n  getCustomerCartQuery,\n} from '@/checkout/api/getCart/graphql';\nimport { transformCart } from '@/checkout/data/transforms';\nimport { dispatchApiCall } from '@/checkout/lib/dispatchApiCall';\nimport { state } from '@/checkout/lib';\nimport { MissingCart } from '@/checkout/lib/errors';\n\nexport const getCart = async () => {\n  const cartId = state.cartId;\n  const isGuest = state.authenticated === false;\n  const query = isGuest ? getCartQuery : getCustomerCartQuery;\n  const variables = isGuest ? { cartId } : {};\n\n  if (isGuest && !cartId) throw new MissingCart();\n\n  return await dispatchApiCall({\n    type: 'query',\n    query,\n    options: { method: 'POST', cache: 'no-cache', variables },\n    path: 'cart',\n    transformer: transformCart,\n  });\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { NEGOTIABLE_QUOTE_FRAGMENT } from '@/checkout/api/graphql/NegotiableQuoteFragment.graphql';\n\nexport const getNegotiableQuoteQuery = /* GraphQL */ `\n  query getNegotiableQuote($quoteId: ID!) {\n    negotiableQuote(uid: $quoteId) {\n      ...NEGOTIABLE_QUOTE_FRAGMENT\n    }\n  }\n\n  ${NEGOTIABLE_QUOTE_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { getNegotiableQuoteQuery } from '@/checkout/api/getNegotiableQuote/graphql';\nimport { transformNegotiableQuote as transformer } from '@/checkout/data/transforms';\nimport { state } from '@/checkout/lib';\nimport { dispatchApiCall } from '@/checkout/lib/dispatchApiCall';\nimport {\n  MissingNegotiableQuoteId,\n  Unauthenticated,\n} from '@/checkout/lib/errors';\n\ntype GetNegotiableQuoteInput = {\n  uid?: string;\n};\n\nexport const getNegotiableQuote = async (\n  input: GetNegotiableQuoteInput = {}\n) => {\n  const quoteId = input.uid ?? state.quoteId;\n  const isGuest = state.authenticated === false;\n\n  if (isGuest) throw new Unauthenticated();\n  if (!quoteId) throw new MissingNegotiableQuoteId();\n\n  const variables = { quoteId };\n\n  return await dispatchApiCall({\n    type: 'query',\n    query: getNegotiableQuoteQuery,\n    options: { method: 'GET', cache: 'no-cache', variables },\n    path: 'negotiableQuote',\n    transformer,\n  });\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  authenticateCustomer,\n  ConfigProps,\n  initializeCheckout,\n  resetCheckout,\n  synchronizeCheckout,\n} from '@/checkout/api';\nimport { ErrorCodes } from '@/checkout/lib/errors';\nimport { PermissionsModel } from '@/checkout/types';\nimport { events, Events } from '@adobe-commerce/event-bus';\n\ntype Listener = [keyof Events, (...args: any[]) => void, { eager: boolean }?];\n\nconst asEager = { eager: true };\n\nexport const addCheckoutEventListeners = (config: ConfigProps | undefined) => {\n  const useB2bQuotes = config?.features?.b2b?.quotes ?? false;\n\n  const handleAuthenticated = (isAuthenticated = false) => {\n    authenticateCustomer(isAuthenticated);\n\n    if (!useB2bQuotes) return;\n    if (isAuthenticated) return;\n\n    const destination = config?.features?.b2b?.routeLogin?.();\n    if (destination) {\n      window.location.assign(destination);\n    }\n  };\n\n  const cartListeners: Listener[] = [\n    ['cart/initialized', initializeCheckout, asEager],\n    ['cart/reset', resetCheckout],\n    ['cart/updated', synchronizeCheckout],\n    [\n      'auth/permissions',\n      (permissions: PermissionsModel) => {\n        if (permissions['admin'] === true) return;\n\n        if (!permissions['Magento_Sales::place_order']) {\n          const message =\n            config?.langDefinitions?.default?.Checkout?.ServerError\n              ?.permissionDenied ||\n            'You do not have permission to complete checkout. Please contact your administrator for assistance.';\n          events.emit('checkout/error', {\n            message,\n            code: ErrorCodes.PERMISSION_DENIED,\n          });\n        }\n      },\n      asEager,\n    ],\n  ];\n\n  const quoteListeners: Listener[] = [\n    [\n      'quote-management/quote-data/initialized',\n      (data) => {\n        if (!data.quote.canCheckout) {\n          const message =\n            config?.langDefinitions?.default?.Checkout?.Quote\n              ?.permissionDenied ||\n            'You do not have permission to checkout with this quote.';\n          events.emit('checkout/error', {\n            message,\n            code: ErrorCodes.QUOTE_PERMISSION_DENIED,\n          });\n          return;\n        }\n\n        initializeCheckout(data.quote);\n      },\n      asEager,\n    ],\n    [\n      'quote-management/quote-data/error',\n      () => {\n        const message =\n          config?.langDefinitions?.default?.Checkout?.Quote?.dataError ||\n          'We were unable to retrieve the quote data. Please try again later.';\n        events.emit('checkout/error', {\n          message,\n          code: ErrorCodes.QUOTE_DATA_ERROR,\n        });\n      },\n    ],\n  ];\n\n  const listeners: Listener[] = [\n    ['authenticated', handleAuthenticated, asEager],\n    ...(useB2bQuotes ? quoteListeners : cartListeners),\n  ];\n\n  return listeners.map(([eventName, handler, options]) => {\n    return events.on(eventName, handler, options);\n  });\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { addCheckoutEventListeners } from '@/checkout/api/initialize/listeners';\nimport {\n  Cart as CartModel,\n  Customer as CustomerModel,\n  ShippingMethod,\n} from '@/checkout/data/models';\nimport { state } from '@/checkout/lib';\nimport { Filter, Selector } from '@/checkout/types/utils';\nimport { definition } from '@adobe-commerce/elsie/i18n';\nimport { deepmerge, Initializer, Model } from '@adobe-commerce/elsie/lib';\n\nconst url = new URL(window.location.href);\nconst quoteId = url.searchParams.get('quoteId');\nstate.quoteId = quoteId;\n\nexport type ConfigProps = {\n  defaults?: {\n    isBillToShipping?: boolean;\n    selectedShippingMethod?: Selector<ShippingMethod>;\n  };\n  shipping?: {\n    filterOptions?: Filter<ShippingMethod>;\n  };\n  features?: {\n    b2b?: {\n      quotes?: boolean;\n      routeLogin?: () => string | void;\n    };\n  };\n  langDefinitions?: typeof definition & { default: { Checkout: any } };\n  models?: {\n    CartModel?: Model<CartModel>;\n    CustomerModel?: Model<CustomerModel>;\n  };\n};\n\nexport const initialize = new Initializer<ConfigProps>({\n  init: async (_config = {}) => {\n    initialize.config.setConfig(\n      deepmerge(\n        {\n          defaults: {\n            isBillToShipping: true,\n            selectedShippingMethod: (options) => {\n              return options.length > 0 ? options[0] : null;\n            },\n          },\n          features: {\n            b2b: { quotes: false },\n          },\n        },\n        _config\n      )\n    );\n  },\n  listeners: addCheckoutEventListeners,\n});\n\nexport const config = initialize.config;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  CartModel,\n  InitializeInput,\n  NegotiableQuoteModel,\n  SynchronizeInput,\n} from '@/checkout/types';\n\nexport const isCartInput = (\n  input: NonNullable<InitializeInput | SynchronizeInput>\n): input is CartModel => {\n  return 'id' in input;\n};\n\nexport const isNegotiableQuoteInput = (\n  input: NonNullable<InitializeInput | SynchronizeInput>\n): input is NegotiableQuoteModel => {\n  return 'uid' in input;\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  getCart,\n  getNegotiableQuote,\n  getStoreConfig,\n  synchronizeCheckout,\n} from '@/checkout/api';\nimport { state } from '@/checkout/lib';\nimport { InitializeInput, isCartInput } from '@/checkout/types';\nimport { events } from '@adobe-commerce/event-bus';\n\nconst getInitialData = async (input: NonNullable<InitializeInput>) => {\n  try {\n    if (isCartInput(input)) {\n      state.cartId = input.id;\n      state.quoteId = null;\n      return (await getCart()) ?? null;\n    }\n    state.cartId = null;\n    state.quoteId = input.uid;\n    return (await getNegotiableQuote()) ?? null;\n  } catch (error) {\n    console.error('Checkout initialization failed:', error);\n    return null;\n  }\n};\n\nexport const initializeCheckout = async (input: InitializeInput) => {\n  if (state.initialized) {\n    await synchronizeCheckout(input);\n    return;\n  }\n\n  if (!state.config) {\n    state.config = await getStoreConfig();\n  }\n\n  const initialData = input ? await getInitialData(input) : null;\n\n  state.initialized = true;\n  events.emit('checkout/initialized', initialData);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { state } from '@/checkout/lib/state';\nimport { events } from '@adobe-commerce/event-bus';\n\nexport const resetCheckout = () => {\n  if (!state.initialized) return;\n  state.cartId = null;\n  state.quoteId = null;\n  events.emit('checkout/updated', null);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  getCart,\n  getNegotiableQuote,\n  initializeCheckout,\n  resetCheckout,\n} from '@/checkout/api';\nimport { state } from '@/checkout/lib/state';\nimport { isCartInput, SynchronizeInput } from '@/checkout/types';\nimport { events } from '@adobe-commerce/event-bus';\n\nconst getSynchronizedData = async (input: NonNullable<SynchronizeInput>) => {\n  try {\n    if (isCartInput(input)) {\n      state.cartId = input.id;\n      state.quoteId = null;\n      return (await getCart()) ?? null;\n    }\n    state.cartId = null;\n    state.quoteId = input.uid;\n    return (await getNegotiableQuote()) ?? null;\n  } catch (error) {\n    console.error('Checkout synchronization failed:', error);\n    return null;\n  }\n};\n\nexport const synchronizeCheckout = async (data: SynchronizeInput) => {\n  if (!state.initialized) return initializeCheckout(data);\n\n  if (data === null) {\n    resetCheckout();\n    return;\n  }\n\n  const update = await getSynchronizedData(data);\n\n  events.emit('checkout/updated', update);\n};\n"],"names":["authenticateCustomer","authenticated","state","transformSelectedPaymentMethod","data","code","title","additionalData","transformAvailablePaymentMethods","method","transformCart","model","transformCartBillingAddress","transformCartShippingAddress","merge","_c","_b","_a","config","transformAddress","street","transformAddressCountry","transformCustomAttributes","transformAddressRegion","transformQuoteBillingAddress","transformQuoteShippingAddress","address","available_shipping_methods","selected_shipping_method","baseData","transformShippingMethods","transformSelectedShippingMethod","transformNegotiableQuote","getCartQuery","CHECKOUT_DATA_FRAGMENT","getCustomerCartQuery","getCart","cartId","isGuest","query","variables","MissingCart","dispatchApiCall","getNegotiableQuoteQuery","NEGOTIABLE_QUOTE_FRAGMENT","getNegotiableQuote","input","quoteId","Unauthenticated","MissingNegotiableQuoteId","transformer","asEager","addCheckoutEventListeners","useB2bQuotes","isAuthenticated","destination","message","_d","events","ErrorCodes","initializeCheckout","resetCheckout","synchronizeCheckout","permissions","eventName","handler","options","url","initialize","Initializer","_config","deepmerge","isCartInput","getInitialData","error","getStoreConfig","initialData","getSynchronizedData","update"],"mappings":"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"}