{"version":3,"file":"PaymentOnAccount2.js","sources":["/@dropins/storefront-checkout/src/components/PaymentOnAccount/PaymentOnAccountSkeleton.tsx","/@dropins/storefront-checkout/src/components/PaymentOnAccount/PaymentOnAccount.tsx","/@dropins/storefront-checkout/src/containers/PaymentOnAccount/PaymentOnAccount.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FunctionComponent } from 'preact';\nimport { Skeleton, SkeletonRow } from '@adobe-commerce/elsie/components';\n\nexport const PaymentOnAccountSkeleton: FunctionComponent = () => {\n  return (\n    <Skeleton data-testid=\"payment-on-account-skeleton\">\n      <SkeletonRow fullWidth={true} size=\"medium\" />\n      <SkeletonRow fullWidth={true} size=\"medium\" />\n    </Skeleton>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { WithConditionals } from '@/checkout/components/ConditionalWrapper/ConditionalWrapper';\nimport '@/checkout/components/PaymentOnAccount/PaymentOnAccount.css';\nimport { PaymentOnAccountSkeleton } from '@/checkout/components/PaymentOnAccount/PaymentOnAccountSkeleton';\nimport { Money } from '@/checkout/data/models';\nimport {\n  Field,\n  InLineAlert,\n  Input,\n  Price,\n} from '@adobe-commerce/elsie/components';\nimport { Text, useText } from '@adobe-commerce/elsie/i18n';\nimport { classes, getPriceFormatter } from '@adobe-commerce/elsie/lib';\nimport { FunctionComponent } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\n\nexport type CompanyCredit = {\n  availableCredit: Money;\n  exceedLimit?: boolean;\n};\n\nexport interface PaymentOnAccountProps extends HTMLAttributes<HTMLFormElement> {\n  referenceNumber?: string;\n  onReferenceNumberChange?: (event: Event) => void;\n  onReferenceNumberBlur?: (event: Event) => void;\n  companyCredit?: CompanyCredit | null;\n  totalAmount?: Money | null;\n}\n\nconst calculateExceededAmount = (\n  companyCredit: CompanyCredit | null,\n  totalAmount: Money | null\n): Money | null => {\n  if (!companyCredit?.availableCredit || !totalAmount) return null;\n\n  const availableValue = companyCredit.availableCredit.value;\n  const cartValue = totalAmount.value;\n  const exceededValue = cartValue - availableValue;\n\n  if (exceededValue <= 0) return null;\n\n  return {\n    value: exceededValue,\n    currency: companyCredit.availableCredit.currency,\n  };\n};\n\nconst PaymentOnAccountComponent: FunctionComponent<PaymentOnAccountProps> = ({\n  className,\n  referenceNumber = '',\n  onReferenceNumberChange,\n  onReferenceNumberBlur,\n  companyCredit = null,\n  totalAmount = null,\n  ...props\n}) => {\n  const exceededAmount = calculateExceededAmount(companyCredit, totalAmount);\n  const creditLimit = companyCredit?.availableCredit;\n\n  const priceFormatter = getPriceFormatter({\n    currency: totalAmount?.currency ?? '',\n  });\n\n  const translations = useText({\n    referenceNumberLabel: 'Checkout.PaymentOnAccount.referenceNumberLabel',\n    referenceNumberPlaceholder:\n      'Checkout.PaymentOnAccount.referenceNumberPlaceholder',\n    referenceNumberHint: 'Checkout.PaymentOnAccount.referenceNumberHint',\n    availableCreditLabel: 'Checkout.PaymentOnAccount.availableCreditLabel',\n    exceedLimitError: 'Checkout.PaymentOnAccount.exceedLimitError',\n    exceedLimitWarning: (exceededAmount ? (\n      <Text\n        fields={{\n          creditLimit: priceFormatter.format(creditLimit?.value ?? 0),\n          exceededAmount: priceFormatter.format(exceededAmount?.value ?? 0),\n        }}\n        id=\"Checkout.PaymentOnAccount.exceedLimitWarning\"\n      />\n    ) : (\n      ''\n    )) as any,\n  });\n\n  return (\n    <div\n      className=\"checkout-payment-on-account\"\n      data-testid=\"checkout-payment-on-account\"\n    >\n      <form\n        {...props}\n        noValidate\n        className={classes(['checkout-payment-on-account__form', className])}\n        data-testid=\"checkout-payment-on-account-form\"\n        name=\"checkout-payment-on-account__form\"\n      >\n        {companyCredit && companyCredit.availableCredit && (\n          <div\n            className=\"checkout-payment-on-account__credit\"\n            data-testid=\"checkout-payment-on-account-credit\"\n          >\n            <span className=\"checkout-payment-on-account__credit-label\">\n              {translations.availableCreditLabel}\n            </span>\n            <span className=\"checkout-payment-on-account__credit-amount\">\n              <Price\n                amount={companyCredit?.availableCredit.value}\n                currency={companyCredit?.availableCredit.currency}\n              />\n            </span>\n          </div>\n        )}\n\n        <Field hint={translations.referenceNumberHint}>\n          <Input\n            aria-label={translations.referenceNumberLabel}\n            floatingLabel={translations.referenceNumberLabel}\n            id=\"reference-number\"\n            name=\"reference-number\"\n            placeholder={translations.referenceNumberPlaceholder}\n            type=\"text\"\n            value={referenceNumber}\n            onBlur={onReferenceNumberBlur}\n            onChange={onReferenceNumberChange}\n          />\n        </Field>\n\n        {exceededAmount && (\n          <div\n            className=\"checkout-payment-on-account__exceed-message\"\n            data-testid=\"checkout-payment-on-account-exceed-message\"\n          >\n            <InLineAlert\n              heading={\n                companyCredit?.exceedLimit\n                  ? translations.exceedLimitWarning\n                  : translations.exceedLimitError\n              }\n              type={companyCredit?.exceedLimit ? 'warning' : 'error'}\n              variant=\"primary\"\n            />\n          </div>\n        )}\n      </form>\n    </div>\n  );\n};\n\nexport const PaymentOnAccount = WithConditionals(\n  PaymentOnAccountComponent,\n  PaymentOnAccountSkeleton\n);\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  HTMLAttributes,\n  useCallback,\n  useEffect,\n  useState,\n} from 'preact/compat';\nimport { Container } from '@adobe-commerce/elsie/lib';\nimport { PaymentOnAccount as PaymentOnAccountComponent } from '@/checkout/components/PaymentOnAccount';\nimport { Money, CompanyCredit } from '@/checkout/data/models';\nimport { getCompanyCredit } from '@/checkout/api';\nimport { events } from '@adobe-commerce/event-bus';\nimport { state } from '@/checkout/lib';\nimport { CartModel, NegotiableQuoteModel } from '@/checkout/types/storefront';\n\nexport interface PaymentOnAccountProps extends HTMLAttributes<HTMLDivElement> {\n  initialReferenceNumber?: string;\n  onReferenceNumberChange?: (referenceNumber: string) => void;\n  onReferenceNumberBlur?: (referenceNumber: string) => void;\n}\n\nexport const PaymentOnAccount: Container<PaymentOnAccountProps> = ({\n  initialReferenceNumber = '',\n  onReferenceNumberChange,\n  onReferenceNumberBlur,\n  ...props\n}) => {\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [companyCredit, setCompanyCredit] = useState<CompanyCredit | null>(\n    null\n  );\n  const [totalAmount, setTotalAmount] = useState<Money | null>(null);\n  const [referenceNumber, setReferenceNumber] = useState<string>(\n    initialReferenceNumber\n  );\n\n  const isAuthenticated = state.authenticated;\n  const hasCartRef = Boolean(state.cartId);\n  const hasQuoteRef = Boolean(state.quoteId);\n\n  const handleCartData = useCallback((data: CartModel | null) => {\n    setTotalAmount(data?.total?.includingTax || null);\n  }, []);\n\n  const handleQuoteData = useCallback(\n    (data: { quote: NegotiableQuoteModel }) => {\n      setTotalAmount(data?.quote?.prices?.grandTotal || null);\n    },\n    []\n  );\n\n  const handleReferenceNumberChange = useCallback(\n    (event: Event) => {\n      const target = event.target as HTMLInputElement;\n      const value = target.value;\n      setReferenceNumber(value);\n      onReferenceNumberChange?.(value);\n    },\n    [onReferenceNumberChange]\n  );\n\n  const handleReferenceNumberBlur = useCallback(\n    (event: Event) => {\n      const target = event.target as HTMLInputElement;\n      const value = target.value;\n      onReferenceNumberBlur?.(value);\n    },\n    [onReferenceNumberBlur]\n  );\n\n  useEffect(() => {\n    if (!hasCartRef) return;\n\n    // @ts-ignore\n    const onCartData = events.on('cart/data', handleCartData, { eager: true });\n\n    return () => {\n      onCartData?.off();\n    };\n  }, [hasCartRef, handleCartData]);\n\n  useEffect(() => {\n    if (!hasQuoteRef) return;\n\n    const onQuoteData = events.on(\n      'quote-management/quote-data',\n      handleQuoteData,\n      { eager: true }\n    );\n\n    return () => {\n      onQuoteData?.off();\n    };\n  }, [hasQuoteRef, handleQuoteData]);\n\n  useEffect(() => {\n    if (!isAuthenticated) return;\n\n    getCompanyCredit()\n      .then((credit) => {\n        setCompanyCredit(credit);\n      })\n      .catch((error) => {\n        console.error('Failed to fetch company credit:', error);\n        setCompanyCredit(null);\n      })\n      .finally(() => {\n        setIsInitialized(true);\n      });\n  }, [isAuthenticated]);\n\n  return (\n    <div {...props}>\n      <PaymentOnAccountComponent\n        companyCredit={companyCredit}\n        initialized={isInitialized}\n        referenceNumber={referenceNumber}\n        totalAmount={totalAmount}\n        onReferenceNumberBlur={handleReferenceNumberBlur}\n        onReferenceNumberChange={handleReferenceNumberChange}\n      />\n    </div>\n  );\n};\n"],"names":["PaymentOnAccountSkeleton","jsxs","Skeleton","jsx","SkeletonRow","calculateExceededAmount","companyCredit","totalAmount","availableValue","exceededValue","PaymentOnAccountComponent","className","referenceNumber","onReferenceNumberChange","onReferenceNumberBlur","props","exceededAmount","creditLimit","priceFormatter","getPriceFormatter","translations","useText","Text","classes","Price","Field","Input","InLineAlert","PaymentOnAccount","WithConditionals","initialReferenceNumber","isInitialized","setIsInitialized","useState","setCompanyCredit","setTotalAmount","setReferenceNumber","isAuthenticated","state","hasCartRef","hasQuoteRef","handleCartData","useCallback","data","_a","handleQuoteData","_b","handleReferenceNumberChange","event","value","handleReferenceNumberBlur","useEffect","onCartData","events","onQuoteData","getCompanyCredit","credit","error"],"mappings":"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"}