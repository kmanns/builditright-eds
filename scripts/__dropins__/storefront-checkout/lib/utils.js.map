{"version":3,"file":"utils.js","sources":["/@dropins/storefront-checkout/src/lib/utils/api.ts","/@dropins/storefront-checkout/src/lib/utils/forms.ts","/@dropins/storefront-checkout/src/lib/utils/fragments.ts","/@dropins/storefront-checkout/src/lib/utils/meta.ts","/@dropins/storefront-checkout/src/lib/utils/transformers.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  estimateShippingMethods,\n  setBillingAddress,\n  setShippingAddress,\n} from '@/checkout/api';\nimport {\n  BillingAddressInput,\n  ShippingAddressInput,\n} from '@/checkout/data/models/api';\nimport { transformAddressFormValuesToAddressInput } from '@/checkout/lib/utils';\nimport { debounce } from '@adobe-commerce/elsie/lib';\nimport { isSetAddressRequestPending } from '@/checkout/store/ui';\n\ntype AddressFormChange = {\n  data: Record<string, any>;\n  isDataValid: boolean;\n};\n\nlet ongoingSetAddressCalls = 0;\n\nexport function setAddressOnCart({\n  type = 'shipping',\n  debounceMs = 0,\n}: {\n  type?: 'shipping' | 'billing';\n  debounceMs?: number;\n}) {\n  const api = type === 'shipping' ? setShippingAddress : setBillingAddress;\n\n  const debouncedApi = debounce(\n    (address: ShippingAddressInput | BillingAddressInput) => {\n      ongoingSetAddressCalls += 1;\n      api(address)\n        .catch(console.error)\n        .finally(() => {\n          ongoingSetAddressCalls -= 1;\n          if (ongoingSetAddressCalls === 0) {\n            isSetAddressRequestPending.value = false;\n          }\n        });\n    },\n    debounceMs\n  );\n\n  return ({ data, isDataValid }: AddressFormChange) => {\n    if (!isDataValid) return;\n    isSetAddressRequestPending.value = true;\n    const address = transformAddressFormValuesToAddressInput(data);\n    debouncedApi(address);\n  };\n}\n\nexport function estimateShippingCost({ debounceMs = 0 }) {\n  let prevEstimateShippingData: {\n    countryCode?: string;\n    regionCode?: string;\n    regionId?: string;\n    postcode?: string;\n  } = {};\n\n  let shouldCancelDebounce = false;\n\n  const debouncedApi = debounce((data: Record<string, any>) => {\n    if (shouldCancelDebounce) return;\n\n    const estimateShippingInputCriteria = {\n      country_code: data.countryCode,\n      region_name: String(data.region?.regionCode || ''),\n      region_id: String(data.region?.regionId || ''),\n      zip: data.postcode,\n    };\n\n    estimateShippingMethods({ criteria: estimateShippingInputCriteria });\n\n    prevEstimateShippingData = {\n      countryCode: data.countryCode,\n      regionCode: data.region?.regionCode || '',\n      regionId: data.region?.regionId || '',\n      postcode: data.postcode,\n    };\n  }, debounceMs);\n\n  return ({ data, isDataValid }: AddressFormChange) => {\n    if (isDataValid) {\n      shouldCancelDebounce = true;\n      return;\n    }\n\n    if (\n      prevEstimateShippingData.countryCode === data.countryCode &&\n      prevEstimateShippingData.regionCode === (data.region?.regionCode || '') &&\n      prevEstimateShippingData.regionId === (data.region?.regionId || '') &&\n      prevEstimateShippingData.postcode === data.postcode\n    )\n      return;\n\n    debouncedApi(data);\n  };\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { scrollToParentContainer } from '@/checkout/lib/utils';\nimport { FormRef } from '@/checkout/types';\nimport { RefObject } from 'preact';\n\ntype HTMLForm = {\n  name: string;\n  ref?: RefObject<FormRef>;\n};\n\nexport function validateForm(\n  form: HTMLForm,\n  autoScrollOnError: boolean = false\n): boolean {\n  const { name, ref } = form;\n  const formElement = document.forms.namedItem(name);\n\n  if (!formElement || formElement.offsetParent === null) {\n    return true;\n  }\n\n  formElement.setAttribute('novalidate', '');\n\n  const validationResult =\n    ref?.current?.handleValidationSubmit(false) ?? formElement.checkValidity();\n\n  if (!validationResult && autoScrollOnError) {\n    scrollToParentContainer(formElement);\n  }\n\n  return validationResult;\n}\n\nexport function validateForms(forms: HTMLForm[]): boolean {\n  for (const form of forms) {\n    if (!validateForm(form, true)) {\n      return false;\n    }\n  }\n  return true;\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport function createFragment(html: string): DocumentFragment {\n  return document.createRange().createContextualFragment(html);\n}\n\nexport function createScopedSelector(\n  fragment: DocumentFragment\n): (selector: string) => HTMLElement | null {\n  return function (selector: string): HTMLElement | null {\n    return fragment.querySelector(selector);\n  };\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport function createMetaTag(property: string, content: string, type: string) {\n  if (!property || !type) {\n    return;\n  }\n\n  const meta = document.head.querySelector<HTMLMetaElement>(\n    `meta[${type}=\"${property}\"]`\n  );\n\n  if (!content) {\n    meta?.remove();\n    return;\n  }\n\n  if (meta) {\n    meta.setAttribute('content', content);\n  } else {\n    const newMeta = document.createElement('meta');\n    newMeta.setAttribute(type, property);\n    newMeta.setAttribute('content', content);\n    document.head.appendChild(newMeta);\n  }\n}\n\nexport function setMetaTags(dropin: string) {\n  createMetaTag('title', dropin, 'name');\n  createMetaTag('description', dropin, 'name');\n  createMetaTag('keywords', dropin, 'name');\n  createMetaTag('og:description', dropin, 'property');\n  createMetaTag('og:title', dropin, 'property');\n  createMetaTag('og:url', window.location.href, 'property');\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  BillingAddressInput,\n  ShippingAddressInput,\n} from '@/checkout/data/models/api';\nimport { CartAddress } from '@/checkout/data/models/cart';\n\nexport const transformAddressFormValuesToAddressInput = (\n  data: Record<string, any>\n): ShippingAddressInput | BillingAddressInput => {\n  const isNewAddress = !data?.id && !data?.uid;\n\n  if (!isNewAddress) {\n    return {\n      customerAddressId: data.id,\n      customerAddressUid: data.uid,\n    };\n  }\n\n  const customAttributes = data.customAttributes?.map(\n    ({ code, value }: { code: string; value: unknown }) => ({\n      code,\n      value: String(value),\n    })\n  );\n\n  return {\n    address: {\n      city: data.city,\n      company: data?.company,\n      countryCode: data.countryCode,\n      customAttributes,\n      fax: data.fax,\n      firstName: data.firstName,\n      lastName: data.lastName,\n      middleName: data.middleName,\n      postcode: data.postcode,\n      prefix: data.prefix,\n      region: data?.region?.regionCode,\n      regionId: data?.region?.regionId,\n      street: data.street,\n      suffix: data.suffix,\n      telephone: data.telephone,\n      vatId: data.vatId,\n      saveInAddressBook: data.saveAddressBook,\n    },\n  };\n};\n\nexport const transformCartAddressToFormValues = (\n  address: CartAddress\n): Record<string, any> => {\n  return {\n    city: address.city,\n    company: address?.company,\n    countryCode: address.country?.code,\n    customAttributes: address.customAttributes,\n    fax: address.fax,\n    firstName: address.firstName,\n    lastName: address.lastName,\n    middleName: address.middleName,\n    postcode: address.postCode,\n    prefix: address.prefix,\n    region: {\n      regionCode: address.region?.code,\n      regionId: address.region?.id,\n    },\n    street: address.street,\n    suffix: address.suffix,\n    telephone: address.telephone,\n    vatId: address.vatId,\n  };\n};\n"],"names":["ongoingSetAddressCalls","setAddressOnCart","type","debounceMs","api","setShippingAddress","setBillingAddress","debouncedApi","debounce","address","isSetAddressRequestPending","data","isDataValid","transformAddressFormValuesToAddressInput","estimateShippingCost","prevEstimateShippingData","shouldCancelDebounce","estimateShippingInputCriteria","_a","_b","estimateShippingMethods","_c","_d","validateForm","form","autoScrollOnError","name","ref","formElement","validationResult","scrollToParentContainer","validateForms","forms","createFragment","html","createScopedSelector","fragment","selector","createMetaTag","property","content","meta","newMeta","setMetaTags","dropin","customAttributes","code","value","transformCartAddressToFormValues"],"mappings":"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"}