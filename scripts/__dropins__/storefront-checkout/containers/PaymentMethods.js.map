{"version":3,"file":"PaymentMethods.js","sources":["../../node_modules/@adobe-commerce/elsie/src/icons/Wallet.svg","/@dropins/storefront-checkout/src/components/PaymentMethods/PaymentMethodsSkeleton.tsx","/@dropins/storefront-checkout/src/components/PaymentMethods/PaymentMethods.tsx","../../node_modules/@adobe-commerce/elsie/src/lib/debounce.ts","/@dropins/storefront-checkout/src/containers/PaymentMethods/handlers.tsx","/@dropins/storefront-checkout/src/containers/PaymentMethods/PaymentMethods.tsx"],"sourcesContent":["import * as React from \"react\";\nconst SvgWallet = (props) => /* @__PURE__ */ React.createElement(\"svg\", { width: 24, height: 24, viewBox: \"0 0 24 24\", fill: \"none\", xmlns: \"http://www.w3.org/2000/svg\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { vectorEffect: \"non-scaling-stroke\", d: \"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z\", stroke: \"currentColor\", strokeWidth: 1, strokeLinecap: \"round\", strokeLinejoin: \"round\" }), /* @__PURE__ */ React.createElement(\"path\", { vectorEffect: \"non-scaling-stroke\", d: \"M19.35 11.64H14.04V14.81H19.35V11.64Z\", stroke: \"currentColor\", strokeWidth: 1, strokeLinecap: \"round\", strokeLinejoin: \"round\" }), /* @__PURE__ */ React.createElement(\"path\", { vectorEffect: \"non-scaling-stroke\", d: \"M17.9304 11.64V8.25H15.1504\", stroke: \"currentColor\", strokeWidth: 1, strokeLinecap: \"round\", strokeLinejoin: \"round\" }));\nexport default SvgWallet;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { Skeleton, SkeletonRow } from '@adobe-commerce/elsie/components';\nimport { FunctionComponent } from 'preact';\n\nexport const PaymentMethodsSkeleton: FunctionComponent = () => {\n  return (\n    <Skeleton data-testid=\"payment-methods-skeleton\">\n      <SkeletonRow size=\"medium\" variant=\"heading\" />\n      <SkeletonRow size=\"medium\" variant=\"empty\" />\n      <SkeletonRow fullWidth={true} size=\"xlarge\" />\n      <SkeletonRow fullWidth={true} size=\"xlarge\" />\n    </Skeleton>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { WithConditionals } from '@/checkout/components/ConditionalWrapper/ConditionalWrapper';\nimport '@/checkout/components/PaymentMethods/PaymentMethods.css';\nimport { PaymentMethodsSkeleton } from '@/checkout/components/PaymentMethods/PaymentMethodsSkeleton';\nimport { PaymentMethodConfig } from '@/checkout/containers';\nimport { PaymentMethod } from '@/checkout/data/models/payment-method';\nimport { scrollToElement } from '@/checkout/lib';\nimport { UIComponentType } from '@/checkout/types';\nimport {\n  Icon,\n  IllustratedMessage,\n  InLineAlert,\n  RadioButton,\n  ToggleButton,\n} from '@adobe-commerce/elsie/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { Wallet } from '@adobe-commerce/elsie/icons';\nimport { classes, VComponent } from '@adobe-commerce/elsie/lib';\nimport { FunctionComponent, VNode } from 'preact';\nimport { HTMLAttributes, useEffect, useRef } from 'preact/compat';\n\ninterface ExtendedPaymentMethod extends PaymentMethodConfig, PaymentMethod {}\n\nexport interface PaymentMethodsProps\n  extends Omit<HTMLAttributes<HTMLDivElement>, 'title'> {\n  error?: string | null;\n  busy?: boolean;\n  onDismissError?: () => void;\n  onSelectionChange?: (value: PaymentMethod) => void;\n  options?: ExtendedPaymentMethod[];\n  paymentMethodContent?: VNode;\n  selection: PaymentMethod | null;\n  title?: VNode;\n  UIComponentType?: UIComponentType;\n}\n\ninterface PaymentOptionProps {\n  UIComponentType?: UIComponentType;\n  busy?: boolean;\n  code: string;\n  icon?: string;\n  onSelectionChange: (value: PaymentMethod) => void;\n  selected: boolean;\n  title: string;\n}\n\nconst PaymentOption: FunctionComponent<PaymentOptionProps> = ({\n  UIComponentType = 'ToggleButton',\n  busy,\n  code,\n  icon,\n  onSelectionChange,\n  selected,\n  title,\n}) => {\n  const commonProps = {\n    busy,\n    className: 'checkout-payment-methods__method',\n    label: title,\n    name: 'payment-method',\n    onChange: () => onSelectionChange({ code, title }),\n    value: code,\n  };\n\n  return UIComponentType === 'ToggleButton' ? (\n    <ToggleButton\n      {...commonProps}\n      // @ts-ignore\n      icon={icon ? <Icon source={icon} /> : undefined}\n      selected={selected}\n    />\n  ) : (\n    <RadioButton {...commonProps} checked={selected} icon={icon ?? undefined} />\n  );\n};\n\nconst PaymentMethodsComponent: FunctionComponent<PaymentMethodsProps> = ({\n  className,\n  error = null,\n  busy = false,\n  onDismissError,\n  onSelectionChange = () => {},\n  options,\n  paymentMethodContent,\n  selection,\n  title,\n  UIComponentType,\n}) => {\n  const translations = useText({\n    EmptyState: 'Checkout.PaymentMethods.emptyState',\n  });\n\n  const hasError = error !== null;\n  const errorRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (hasError && errorRef.current) {\n      scrollToElement(errorRef.current);\n    }\n  }, [hasError]);\n\n  return (\n    <div\n      className={classes(['checkout-payment-methods', className])}\n      data-testid=\"checkout-payment-methods\"\n    >\n      {title && (\n        <VComponent className=\"checkout-payment-methods__title\" node={title} />\n      )}\n\n      {!busy && options!.length === 0 && (\n        <IllustratedMessage\n          data-testid=\"checkout-payment-methods-empty\"\n          icon={<Icon source={Wallet} />}\n          message={<p>{translations.EmptyState}</p>}\n        />\n      )}\n\n      <div\n        className={classes([\n          'checkout-payment-methods__wrapper',\n          ['checkout-payment-methods__wrapper--busy', busy],\n        ])}\n        data-testid=\"checkout-payment-methods-wrapper\"\n      >\n        <div\n          className={classes([\n            'checkout-payment-methods__methods',\n            ['checkout-payment-methods--full-width', options!.length % 2 !== 0],\n          ])}\n        >\n          {options?.map((method) => (\n            <PaymentOption\n              key={method.code}\n              UIComponentType={UIComponentType}\n              busy={busy}\n              code={method.code}\n              icon={method.icon}\n              selected={selection?.code === method.code}\n              title={method.displayLabel ?? true ? method.title : ''}\n              onSelectionChange={onSelectionChange}\n            />\n          ))}\n        </div>\n\n        {paymentMethodContent && (\n          <div className=\"checkout-payment-methods__content\">\n            {paymentMethodContent}\n          </div>\n        )}\n      </div>\n\n      {hasError && (\n        <div\n          ref={errorRef}\n          className=\"checkout-payment-methods__error\"\n          data-testid=\"checkout-payment-methods-alert\"\n        >\n          <InLineAlert\n            heading={error}\n            type=\"error\"\n            variant=\"primary\"\n            onDismiss={onDismissError}\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport const PaymentMethods = WithConditionals(\n  PaymentMethodsComponent,\n  PaymentMethodsSkeleton\n);\n","/********************************************************************\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this \n * file in accordance with the terms of the Adobe license agreement \n * accompanying it. \n *******************************************************************/\n\nexport const debounce = (fn: Function, ms: number) => {\n  let timeoutId: ReturnType<typeof setTimeout>;\n  return function (this: any, ...args: any[]) {\n    clearTimeout(timeoutId);\n    timeoutId = setTimeout(() => fn.apply(this, args), ms);\n  };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { setPaymentMethod } from '@/checkout/api';\nimport {\n  PaymentMethodConfig,\n  PaymentOnAccount,\n  PurchaseOrder,\n} from '@/checkout/containers';\nimport { validateNotEmpty } from '@/checkout/lib/validation';\nimport { render as Checkout } from '@/checkout/render/render';\nimport { Container } from '@adobe-commerce/elsie/lib';\nimport { debounce } from '@adobe-commerce/elsie/lib/debounce';\n\ninterface HandlerConfig {\n  Container: Container<any>;\n  autoSync: boolean;\n  formName?: string;\n  validateRefNumber: boolean;\n}\n\nexport enum HandlerCode {\n  PaymentOnAccount = 'companycredit',\n  PurchaseOrder = 'purchaseorder',\n}\n\nconst HANDLERS_CONFIG: Record<HandlerCode, HandlerConfig> = {\n  [HandlerCode.PaymentOnAccount]: {\n    Container: PaymentOnAccount,\n    autoSync: true,\n    formName: 'payment-on-account',\n    validateRefNumber: false,\n  },\n  [HandlerCode.PurchaseOrder]: {\n    Container: PurchaseOrder,\n    autoSync: false,\n    formName: 'purchase-order',\n    validateRefNumber: true,\n  },\n} as const;\n\n// Cache for debounced handlers to prevent memory leaks\nconst debouncedHandlers = new Map<string, ReturnType<typeof debounce>>();\n\nexport const handleRefNumberChange = (code: string, isRequired: boolean) => {\n  const key = `${code}-${isRequired}`;\n\n  if (!debouncedHandlers.has(key)) {\n    const debouncedFn = debounce(async (refNumber: string) => {\n      if (!isRequired || validateNotEmpty(refNumber)) {\n        try {\n          await setPaymentMethod({\n            code,\n            purchase_order_number: refNumber,\n          });\n        } catch (error) {\n          console.error(`Failed to set payment method for ${code}:`, error);\n        }\n      }\n    }, 1000);\n\n    debouncedHandlers.set(key, debouncedFn);\n  }\n\n  return debouncedHandlers.get(key)!;\n};\n\nconst handlerCache: Partial<Record<HandlerCode, PaymentMethodConfig>> = {};\n\nexport const resetHandlersCache = () => {\n  Object.keys(handlerCache).forEach((key) => {\n    delete handlerCache[key as HandlerCode];\n  });\n\n  debouncedHandlers.clear();\n};\n\nexport const createHandler = (code: HandlerCode): PaymentMethodConfig => {\n  if (!(code in HANDLERS_CONFIG)) {\n    throw new Error(`Invalid handler code: ${code}`);\n  }\n\n  if (handlerCache[code]) {\n    return handlerCache[code] as PaymentMethodConfig;\n  }\n\n  const config = HANDLERS_CONFIG[code];\n\n  const { autoSync, Container, formName, validateRefNumber } = config;\n\n  const handler: PaymentMethodConfig = {\n    enabled: true,\n    autoSync,\n    render: (ctx) => {\n      const initialReferenceNumber = String(\n        ctx.additionalData?.purchase_order_number ?? ''\n      );\n\n      const $wrapper = document.createElement('div');\n\n      Checkout.render(Container, {\n        name: formName,\n        initialReferenceNumber,\n        onReferenceNumberChange: handleRefNumberChange(code, validateRefNumber),\n      })($wrapper);\n\n      ctx.replaceHTML($wrapper);\n    },\n  };\n\n  handlerCache[code] = handler;\n\n  return handler;\n};\n\nexport const defaultHandlers = {\n  [HandlerCode.PaymentOnAccount]: createHandler(HandlerCode.PaymentOnAccount),\n  [HandlerCode.PurchaseOrder]: createHandler(HandlerCode.PurchaseOrder),\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { setPaymentMethod } from '@/checkout/api';\nimport { PaymentMethods as PaymentMethodsComponent } from '@/checkout/components/PaymentMethods/PaymentMethods';\nimport { Cart } from '@/checkout/data/models/cart';\nimport {\n  AdditionalData,\n  PaymentMethod\n} from '@/checkout/data/models/payment-method';\nimport { NegotiableQuote } from '@/checkout/data/models/quote';\nimport {\n  getLatestCheckoutUpdate,\n  getValue,\n  hasPendingUpdates,\n  hasShippingAddress,\n  isVirtualCart,\n  notifyValues,\n  state\n} from '@/checkout/lib';\nimport { TitleProps, UIComponentType } from '@/checkout/types';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport {\n  Container,\n  deepmerge,\n  Slot,\n  SlotProps\n} from '@adobe-commerce/elsie/lib';\nimport { events } from '@adobe-commerce/event-bus';\nimport { HTMLAttributes } from 'preact/compat';\nimport { useCallback, useEffect, useMemo, useState } from 'preact/hooks';\nimport { defaultHandlers } from './handlers';\n\ninterface RenderContext {\n  additionalData?: AdditionalData;\n  cartId: string;\n  replaceHTML: (domElement: HTMLElement) => void;\n  setAdditionalData: (data: AdditionalData) => void;\n}\n\nexport interface PaymentMethodConfig {\n  autoSync?: boolean;\n  displayLabel?: boolean;\n  enabled?: boolean;\n  icon?: string;\n  render?: SlotProps<RenderContext>;\n}\n\nexport interface PaymentMethodHandlers {\n  [code: string]: PaymentMethodConfig;\n}\n\ninterface CartSyncError {\n  method: PaymentMethod;\n  error: Error;\n}\n\nexport interface PaymentMethodsProps\n  extends HTMLAttributes<HTMLDivElement>,\n  TitleProps {\n  slots?: {\n    Methods?: PaymentMethodHandlers;\n  } & TitleProps['slots'];\n  UIComponentType?: UIComponentType;\n  active?: boolean;\n  autoSync?: boolean;\n  onCartSyncError?: (error: CartSyncError) => void;\n  onSelectionChange?: (method: PaymentMethod) => void;\n}\n\nfunction isAvailable(\n  selection: PaymentMethod | null,\n  options: PaymentMethod[]\n) {\n  if (!selection) return false;\n  return options.some((option) => option.code === selection.code);\n}\n\nfunction isEqual(a: PaymentMethod | null, b: PaymentMethod | null) {\n  if (!a || !b) return false;\n  return a.code === b.code;\n}\n\nfunction isValid(method: PaymentMethod | null) {\n  if (!method) return false;\n  return !!method.code && !!method.title;\n}\n\nexport const PaymentMethods: Container<PaymentMethodsProps> = ({\n  UIComponentType = 'ToggleButton',\n  active = true,\n  autoSync = true,\n  displayTitle = true,\n  slots,\n  onCartSyncError,\n  onSelectionChange,\n}) => {\n  const [error, setError] = useState<string | null>(null);\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [selection, setSelection] = useState<PaymentMethod | null>(null);\n  const [options, setOptions] = useState<PaymentMethod[]>([]);\n  const isBusy = hasPendingUpdates.value;\n\n  const { cartSyncError, defaultTitle } = useText({\n    cartSyncError: 'Checkout.PaymentMethods.cartSyncError',\n    defaultTitle: 'Checkout.PaymentMethods.title',\n  });\n\n  const availableHandlers = useMemo(() => {\n    const customHandlers = slots?.Methods ?? {};\n    return deepmerge(defaultHandlers, customHandlers);\n  }, [slots?.Methods]);\n\n  const getSlot = useCallback((method: PaymentMethod) => {\n    return availableHandlers[method.code]?.render;\n  }, [availableHandlers]);\n\n  const hasAutoSyncEnabled = useCallback((method: PaymentMethod) => {\n    const config = availableHandlers[method.code];\n    if (!config) return autoSync;\n    return config.autoSync !== false;\n  }, [autoSync, availableHandlers]);\n\n  const isEnabled = useCallback((method: PaymentMethod) => {\n    const config = availableHandlers[method.code]?.enabled;\n    return config !== false;\n  }, [availableHandlers]);\n\n  const withIcons = useCallback((options: PaymentMethod[]) => {\n    return options.map((option) => {\n      const handler = availableHandlers[option.code];\n      if (!handler) return option;\n      return {\n        ...option,\n        icon: handler.icon\n      };\n    });\n  }, [availableHandlers]);\n\n  const setAdditionalData = useCallback((additionalData: AdditionalData) => {\n    setSelection((prev) => {\n      if (!prev) return prev;\n      return { ...prev, additionalData };\n    });\n  }, []);\n\n  const handleDismissError = useCallback(() => {\n    setError(null);\n  }, []);\n\n  const updateSelection = useCallback((selection: PaymentMethod | null) => {\n    setError(null);\n    setSelection(selection);\n  }, []);\n\n  const updateCartSelection = useCallback(\n    async (selection: PaymentMethod, fallback?: PaymentMethod | null) => {\n      const canSetSelectionOnCart = isVirtualCart() || hasShippingAddress();\n\n      if (!canSetSelectionOnCart) return;\n      if (!hasAutoSyncEnabled(selection)) return;\n\n      setPaymentMethod({ code: selection.code }).catch((error) => {\n        updateSelection(fallback ?? null);\n        setError(onCartSyncError ? null : cartSyncError);\n        onCartSyncError?.({ method: selection, error });\n      });\n    },\n    [\n      cartSyncError,\n      hasAutoSyncEnabled,\n      onCartSyncError,\n      updateSelection,\n    ]\n  );\n\n  const handleSelectionChange = useCallback(\n    async (selection: PaymentMethod) => {\n      const prevSelection = getValue('selectedPaymentMethod');\n      updateSelection(selection);\n      onSelectionChange?.(selection);\n      await updateCartSelection(selection, prevSelection);\n    },\n    [onSelectionChange, updateSelection, updateCartSelection]\n  );\n\n  const handleCheckoutData = useCallback(\n    (data: Cart | NegotiableQuote | null) => {\n      const isEmptyCart = !data || data.isEmpty;\n\n      if (isEmptyCart) {\n        updateSelection(null);\n        setOptions([]);\n        return;\n      }\n\n      const availableOptions = data.availablePaymentMethods ?? [];\n      const enabledOptions = availableOptions.filter(isEnabled);\n\n      setOptions(enabledOptions);\n\n      if (enabledOptions.length === 0) {\n        updateSelection(null);\n        return;\n      }\n\n      const cartSelection = data.selectedPaymentMethod ?? null;\n      const hasCartSelection = isValid(cartSelection);\n      const userSelection = getValue('selectedPaymentMethod');\n      const isUserSelectionAvailable = isAvailable(userSelection, enabledOptions);\n      const haveSameSelection = isEqual(userSelection, cartSelection);\n\n      // User has valid selection that differs from cart\n      if (userSelection && isUserSelectionAvailable && !haveSameSelection) {\n        updateCartSelection(userSelection, cartSelection);\n        return;\n      }\n\n      // User has invalid selection but cart has valid selection\n      if (\n        (!userSelection || !isUserSelectionAvailable) &&\n        hasCartSelection &&\n        isAvailable(cartSelection, enabledOptions)\n      ) {\n        updateSelection(cartSelection);\n        return;\n      }\n\n      // Neither user nor cart has valid selection (or both selections are unavailable)\n      if (\n        (!userSelection || !isUserSelectionAvailable) &&\n        (!hasCartSelection ||\n          !isAvailable(cartSelection, enabledOptions))\n      ) {\n        const newSelection = enabledOptions[0];\n        updateSelection(newSelection);\n        updateCartSelection(newSelection);\n      }\n    },\n    [isEnabled, updateSelection, updateCartSelection]\n  );\n\n  useEffect(() => {\n    if (!active) return;\n\n    const pastUpdate = getLatestCheckoutUpdate();\n\n    if (pastUpdate) {\n      setIsInitialized(true);\n      // When component becomes active, restore key state so handleCheckoutData can work properly\n      const userSelection = getValue('selectedPaymentMethod');\n      if (userSelection) {\n        setSelection(userSelection);\n      }\n      handleCheckoutData(pastUpdate);\n      return;\n    }\n\n    const onCheckoutInit = events.on(\n      'checkout/initialized',\n      (data: Cart | NegotiableQuote | null) => {\n        setIsInitialized(true);\n        handleCheckoutData(data);\n      },\n      { eager: true }\n    );\n\n    return () => {\n      onCheckoutInit?.off();\n    };\n  }, [active, handleCheckoutData]);\n\n  useEffect(() => {\n    if (!active) return;\n\n    const onCheckoutUpdated = events.on(\n      'checkout/updated',\n      handleCheckoutData,\n      { eager: false }\n    );\n\n    return () => {\n      onCheckoutUpdated?.off();\n    };\n  }, [active, handleCheckoutData]);\n\n  useEffect(() => {\n    notifyValues({ selectedPaymentMethod: selection });\n  }, [selection]);\n\n  const titleContent = useMemo(() => {\n    if (!displayTitle) return undefined;\n\n    return (\n      <Slot name=\"checkout-payment-methods-title\" slot={slots?.Title}>\n        <h2>{defaultTitle}</h2>\n      </Slot>\n    );\n  }, [displayTitle, slots?.Title, defaultTitle]);\n\n  const paymentMethodContent = useMemo(() => {\n    if (!selection) return;\n\n    const slot = getSlot(selection);\n    if (!slot) return;\n\n    return (\n      <Slot\n        key={selection!.code}\n        context={{\n          additionalData: selection!.additionalData,\n          cartId: state.cartId ?? '',\n          replaceHTML(domElement: HTMLElement) {\n            this.replaceWith(domElement);\n          },\n          setAdditionalData,\n        }}\n        name=\"PaymentMethodContent\"\n        slot={slot}\n      />\n    );\n\n  }, [getSlot, selection, setAdditionalData]);\n\n  return (\n    <PaymentMethodsComponent\n      UIComponentType={UIComponentType}\n      busy={isBusy}\n      error={error}\n      initialized={isInitialized}\n      options={withIcons(options)}\n      paymentMethodContent={paymentMethodContent}\n      selection={selection}\n      title={titleContent}\n      visible={active}\n      onDismissError={handleDismissError}\n      onSelectionChange={handleSelectionChange}\n    />\n  );\n};\n"],"names":["SvgWallet","props","React","PaymentMethodsSkeleton","jsxs","Skeleton","jsx","SkeletonRow","PaymentOption","UIComponentType","busy","code","icon","onSelectionChange","selected","title","commonProps","ToggleButton","Icon","RadioButton","PaymentMethodsComponent","className","error","onDismissError","options","paymentMethodContent","selection","translations","useText","hasError","errorRef","useRef","useEffect","scrollToElement","classes","VComponent","IllustratedMessage","Wallet","method","InLineAlert","PaymentMethods","WithConditionals","debounce","fn","ms","timeoutId","args","HandlerCode","HANDLERS_CONFIG","PaymentOnAccount","PurchaseOrder","debouncedHandlers","handleRefNumberChange","isRequired","key","debouncedFn","refNumber","validateNotEmpty","setPaymentMethod","handlerCache","resetHandlersCache","createHandler","config","autoSync","Container","formName","validateRefNumber","handler","ctx","initialReferenceNumber","_a","$wrapper","Checkout","defaultHandlers","isAvailable","option","isEqual","a","b","isValid","active","displayTitle","slots","onCartSyncError","setError","useState","isInitialized","setIsInitialized","setSelection","setOptions","isBusy","hasPendingUpdates","cartSyncError","defaultTitle","availableHandlers","useMemo","customHandlers","deepmerge","getSlot","useCallback","hasAutoSyncEnabled","isEnabled","withIcons","setAdditionalData","additionalData","prev","handleDismissError","updateSelection","updateCartSelection","fallback","isVirtualCart","hasShippingAddress","handleSelectionChange","prevSelection","getValue","handleCheckoutData","data","enabledOptions","cartSelection","hasCartSelection","userSelection","isUserSelectionAvailable","haveSameSelection","newSelection","pastUpdate","getLatestCheckoutUpdate","onCheckoutInit","events","onCheckoutUpdated","notifyValues","titleContent","Slot","slot","state","domElement"],"mappings":"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","x_google_ignoreList":[0,3]}