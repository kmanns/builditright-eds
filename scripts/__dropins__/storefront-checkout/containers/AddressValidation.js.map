{"version":3,"file":"AddressValidation.js","sources":["/@dropins/storefront-checkout/src/components/AddressValidation/AddressValidation.tsx","/@dropins/storefront-checkout/src/containers/AddressValidation/AddressValidation.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport '@/checkout/components/AddressValidation/AddressValidation.css';\nimport { AddressInput } from '@/checkout/data/models';\nimport { classes } from '@adobe-commerce/elsie/lib';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { FunctionComponent } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\nimport { Header, ToggleButton } from '@adobe-commerce/elsie/components';\n\nexport interface AddressValidationProps extends HTMLAttributes<HTMLDivElement> {\n  busy?: boolean;\n  currentAddress: AddressInput | null | undefined;\n  selection: 'suggested' | 'original' | null;\n  suggestedAddress: AddressInput | null;\n  onSelectionChange: (selection: 'suggested' | 'original') => void;\n}\n\nexport function formatAddressLine(\n  address: AddressInput | null | undefined\n): string[] {\n  if (!address) return [];\n  const name = `${address.firstName} ${address.lastName}`.trim();\n  const street = address.street?.[0] ?? '';\n  const city = address.city ?? '';\n  const region = address.region || '';\n  const post = address.postcode ?? '';\n  const country = address.countryCode ?? '';\n\n  let cityRegion = '';\n  if (city && region) {\n    cityRegion = `${city}, ${region}`;\n  } else if (city) {\n    cityRegion = city;\n  } else if (region) {\n    cityRegion = region;\n  }\n\n  let cityRegionPost = cityRegion;\n  if (post) {\n    cityRegionPost = cityRegion ? `${cityRegion} ${post}` : post;\n  }\n\n  let line3 = cityRegionPost;\n  if (country) {\n    line3 = cityRegionPost ? `${cityRegionPost}, ${country}` : country;\n  }\n\n  return [name, street, line3];\n}\n\nconst AddressBlock: FunctionComponent<{\n  title: string;\n  address: AddressInput | null | undefined;\n  selected: boolean;\n  busy?: boolean;\n  onChange: () => void;\n}> = ({ title, address, selected, busy, onChange }) => {\n  const [line1, line2, line3] = formatAddressLine(address);\n  const label = (\n    <div>\n      <div className=\"checkout-address-validation__option-title\">\n        <strong>{title}</strong>\n      </div>\n      {line1 && <div>{line1}</div>}\n      {line2 && <div>{line2}</div>}\n      {line3 && <div>{line3}</div>}\n    </div>\n  );\n  return (\n    <div className=\"checkout-address-validation__option\">\n      <ToggleButton\n        busy={busy}\n        className=\"checkout-address-validation__radio\"\n        label={label}\n        name=\"address-validation-choice\"\n        selected={selected}\n        value={title}\n        onChange={onChange}\n      />\n    </div>\n  );\n};\n\nexport const AddressValidation: FunctionComponent<AddressValidationProps> = ({\n  busy = false,\n  className,\n  currentAddress,\n  onSelectionChange,\n  selection,\n  suggestedAddress,\n}) => {\n  const hasSuggestion = !!suggestedAddress;\n  const translations = useText({\n    title: 'Checkout.AddressValidation.title',\n    subtitle: 'Checkout.AddressValidation.subtitle',\n    suggestedAddress: 'Checkout.AddressValidation.suggestedAddress',\n    originalAddress: 'Checkout.AddressValidation.originalAddress',\n  });\n\n  return (\n    <div className={classes(['checkout-address-validation', className])}>\n      <Header\n        className=\"checkout-address-validation__title\"\n        divider={false}\n        title={translations.title}\n      />\n      <div className=\"checkout-address-validation__subtitle\">\n        {translations.subtitle}\n      </div>\n\n      <div\n        className={classes([\n          'checkout-address-validation__options',\n          busy && 'checkout-address-validation__options--busy',\n        ])}\n      >\n        {hasSuggestion && (\n          <AddressBlock\n            address={suggestedAddress}\n            busy={busy}\n            selected={selection === 'suggested'}\n            title={translations.suggestedAddress}\n            onChange={() => onSelectionChange('suggested')}\n          />\n        )}\n\n        <AddressBlock\n          address={currentAddress}\n          busy={busy}\n          selected={selection === 'original'}\n          title={translations.originalAddress}\n          onChange={() => onSelectionChange('original')}\n        />\n      </div>\n    </div>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { Container } from '@adobe-commerce/elsie/lib';\nimport { useCallback, useEffect, useMemo, useState } from 'preact/hooks';\nimport { AddressValidation as AddressValidationComponent } from '@/checkout/components';\nimport { Cart, AddressInput, NegotiableQuote } from '@/checkout/data/models';\nimport { getLatestCheckoutUpdate } from '@/checkout/lib';\nimport { events } from '@adobe-commerce/event-bus';\nimport { transformAddressToCartAddressInput } from '@/checkout/data/transforms/transform-cart-address';\n\nexport interface AddressValidationProps {\n  suggestedAddress: Partial<AddressInput> | null;\n  handleSelectedAddress?: (payload: {\n    selection: 'suggested' | 'original';\n    address: AddressInput | null | undefined;\n  }) => void;\n}\n\nexport const AddressValidation: Container<AddressValidationProps> = ({\n  suggestedAddress,\n  handleSelectedAddress,\n}) => {\n  const [selection, setSelection] = useState<'suggested' | 'original' | null>(\n    null\n  );\n  const [currentAddress, setCurrentAddress] = useState<\n    AddressInput | null | undefined\n  >(undefined);\n  const [busy, setBusy] = useState(false);\n\n  const mergedSuggestedAddress = useMemo<AddressInput | null>(() => {\n    if (!suggestedAddress || !currentAddress) return null;\n    return { ...currentAddress, regionId: undefined, ...suggestedAddress };\n  }, [currentAddress, suggestedAddress]);\n\n  const handleCheckoutData = useCallback(\n    (data: Cart | NegotiableQuote | null) => {\n      const addr = (data as Cart | null)?.shippingAddresses?.[0];\n      const input = transformAddressToCartAddressInput(addr);\n      setCurrentAddress(input);\n    },\n    []\n  );\n\n  useEffect(() => {\n    const onCheckoutInitialized = events.on(\n      'checkout/initialized',\n      (data: Cart | NegotiableQuote | null) => {\n        handleCheckoutData(data);\n      },\n      { eager: true }\n    );\n\n    return () => {\n      onCheckoutInitialized?.off();\n    };\n  }, [handleCheckoutData]);\n\n  useEffect(() => {\n    const pastUpdate = getLatestCheckoutUpdate();\n    if (pastUpdate) {\n      handleCheckoutData(pastUpdate);\n    }\n\n    const onCheckoutUpdated = events.on(\n      'checkout/updated',\n      (data: Cart | NegotiableQuote | null) => {\n        handleCheckoutData(data);\n      },\n      { eager: false }\n    );\n\n    return () => {\n      onCheckoutUpdated?.off();\n    };\n  }, [handleCheckoutData]);\n\n  const onSelectionChange = useCallback(\n    async (sel: 'suggested' | 'original') => {\n      setSelection(sel);\n      const chosen =\n        sel === 'suggested' ? mergedSuggestedAddress : currentAddress;\n      setBusy(true);\n      try {\n        await handleSelectedAddress?.({ selection: sel, address: chosen });\n      } finally {\n        setBusy(false);\n      }\n    },\n    [mergedSuggestedAddress, currentAddress, handleSelectedAddress]\n  );\n\n  return (\n    <AddressValidationComponent\n      busy={busy}\n      currentAddress={currentAddress}\n      selection={selection}\n      suggestedAddress={mergedSuggestedAddress}\n      onSelectionChange={onSelectionChange}\n    />\n  );\n};\n"],"names":["formatAddressLine","address","name","street","_a","city","region","post","country","cityRegion","cityRegionPost","line3","AddressBlock","title","selected","busy","onChange","line1","line2","jsx","ToggleButton","AddressValidation","className","currentAddress","onSelectionChange","selection","suggestedAddress","hasSuggestion","translations","useText","jsxs","classes","Header","handleSelectedAddress","setSelection","useState","setCurrentAddress","setBusy","mergedSuggestedAddress","useMemo","handleCheckoutData","useCallback","data","addr","input","transformAddressToCartAddressInput","useEffect","onCheckoutInitialized","events","pastUpdate","getLatestCheckoutUpdate","onCheckoutUpdated","sel","chosen","AddressValidationComponent"],"mappings":"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"}