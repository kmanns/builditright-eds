{"version":3,"file":"ServerError.js","sources":["/@dropins/storefront-checkout/src/components/ServerError/ServerError.tsx","/@dropins/storefront-checkout/src/containers/ServerError/ServerError.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport '@/checkout/components/ServerError/ServerError.css';\nimport {\n  Button,\n  Icon,\n  IllustratedMessage,\n} from '@adobe-commerce/elsie/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { OrderError } from '@adobe-commerce/elsie/icons';\nimport { classes } from '@adobe-commerce/elsie/lib';\nimport { FunctionComponent, RefObject } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\n\nexport interface ServerErrorProps\n  extends Omit<HTMLAttributes<HTMLDivElement>, 'icon'> {\n  errorMessageRef?: RefObject<HTMLParagraphElement>;\n  errorMessage: string;\n  contactSupport?: string;\n  onClick?: (e: any) => void;\n}\n\nexport const ServerError: FunctionComponent<ServerErrorProps> = ({\n  className,\n  contactSupport,\n  errorMessage,\n  onClick,\n  errorMessageRef,\n}) => {\n  const translations = useText({\n    Title: 'Checkout.ServerError.title',\n    Message: 'Checkout.ServerError.message',\n    ContactSupport: 'Checkout.ServerError.contactSupport',\n    Button: 'Checkout.ServerError.button',\n  });\n\n  const heading = errorMessage !== '' ? errorMessage : translations.Title;\n\n  return (\n    <IllustratedMessage\n      action={\n        <Button\n          className={classes(['checkout-server-error__button'])}\n          name=\"server-error-button\"\n          onClick={onClick}\n        >\n          {translations.Button}\n        </Button>\n      }\n      aria-describedby=\"checkout-server-error__message\"\n      aria-invalid=\"true\"\n      aria-live=\"polite\"\n      className={classes(['checkout-server-error', className])}\n      data-testid=\"checkout-server-error\"\n      heading={heading}\n      icon={\n        <Icon\n          className={classes(['checkout-server-error__icon'])}\n          source={OrderError}\n        />\n      }\n      message={\n        <p\n          ref={errorMessageRef}\n          data-testid=\"checkout-server-error-message\"\n          id={classes(['checkout-server-error__message'])}\n        >\n          {translations.Message}\n          <br />\n          <span>{contactSupport ?? translations.ContactSupport}</span>\n        </p>\n      }\n    />\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { ServerError as ServerErrorComponent } from '@/checkout/components';\nimport { CheckoutError } from '@/checkout/data/models/checkout';\nimport { scrollToElement } from '@/checkout/lib';\nimport { Container } from '@adobe-commerce/elsie/lib';\nimport { events } from '@adobe-commerce/event-bus';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nexport interface ServerErrorProps {\n  autoScroll?: boolean;\n  onRetry?: (error: CheckoutError | null) => void;\n  onServerError?: (error: string) => void;\n  active?: boolean;\n}\n\nexport const ServerError: Container<ServerErrorProps> = ({\n  active = true,\n  onRetry,\n  onServerError,\n  autoScroll = false,\n}) => {\n  const [error, setError] = useState<CheckoutError | null>(null);\n  const errorMessageRef = useRef<HTMLParagraphElement>(null);\n\n  const handleClick = async () => {\n    onRetry?.(error);\n    setError(null);\n  };\n\n  useEffect(() => {\n    const subscription = events.on(\n      'checkout/error',\n      (error: CheckoutError | undefined) => {\n        setError(error || null);\n        if (error && onServerError) {\n          onServerError(error.message);\n        }\n      },\n      { eager: true }\n    );\n\n    return () => {\n      subscription?.off();\n    };\n  }, [onServerError]);\n\n  useEffect(() => {\n    if (!autoScroll || !error || !errorMessageRef.current) return;\n    scrollToElement(errorMessageRef.current);\n  }, [error, autoScroll]);\n\n  if (!active || !error) return null;\n\n  return (\n    <ServerErrorComponent\n      errorMessage={error.message}\n      errorMessageRef={errorMessageRef}\n      onClick={handleClick}\n    />\n  );\n};\n"],"names":["ServerError","className","contactSupport","errorMessage","onClick","errorMessageRef","translations","useText","heading","jsx","IllustratedMessage","Button","classes","Icon","OrderError","jsxs","active","onRetry","onServerError","autoScroll","error","setError","useState","useRef","handleClick","useEffect","subscription","events","scrollToElement","ServerErrorComponent"],"mappings":"uyBAqCO,MAAMA,EAAmD,CAAC,CAC/D,UAAAC,EACA,eAAAC,EACA,aAAAC,EACA,QAAAC,EACA,gBAAAC,CACF,IAAM,CACJ,MAAMC,EAAeC,EAAQ,CAC3B,MAAO,6BACP,QAAS,+BACT,eAAgB,sCAChB,OAAQ,6BAAA,CACT,EAEKC,EAAUL,IAAiB,GAAKA,EAAeG,EAAa,MAGhE,OAAAG,EAACC,EAAA,CACC,OACED,EAACE,EAAA,CACC,UAAWC,EAAQ,CAAC,+BAA+B,CAAC,EACpD,KAAK,sBACL,QAAAR,EAEC,SAAaE,EAAA,MAAA,CAChB,EAEF,mBAAiB,iCACjB,eAAa,OACb,YAAU,SACV,UAAWM,EAAQ,CAAC,wBAAyBX,CAAS,CAAC,EACvD,cAAY,wBACZ,QAAAO,EACA,KACEC,EAACI,EAAA,CACC,UAAWD,EAAQ,CAAC,6BAA6B,CAAC,EAClD,OAAQE,CAAA,CACV,EAEF,QACEC,EAAC,IAAA,CACC,IAAKV,EACL,cAAY,gCACZ,GAAIO,EAAQ,CAAC,gCAAgC,CAAC,EAE7C,SAAA,CAAaN,EAAA,UACb,KAAG,EAAA,EACHG,EAAA,OAAA,CAAM,SAAkBP,GAAAI,EAAa,cAAe,CAAA,CAAA,CAAA,CAAA,CACvD,CAEJ,CAEJ,EC1DaN,EAA2C,CAAC,CACvD,OAAAgB,EAAS,GACT,QAAAC,EACA,cAAAC,EACA,WAAAC,EAAa,EACf,IAAM,CACJ,KAAM,CAACC,EAAOC,CAAQ,EAAIC,EAA+B,IAAI,EACvDjB,EAAkBkB,EAA6B,IAAI,EAEnDC,EAAc,SAAY,CAC9BP,GAAA,MAAAA,EAAUG,GACVC,EAAS,IAAI,CACf,EAwBA,OAtBAI,EAAU,IAAM,CACd,MAAMC,EAAeC,EAAO,GAC1B,iBACCP,GAAqC,CACpCC,EAASD,GAAS,IAAI,EAClBA,GAASF,GACXA,EAAcE,EAAM,OAAO,CAE/B,EACA,CAAE,MAAO,EAAK,CAChB,EAEA,MAAO,IAAM,CACXM,GAAA,MAAAA,EAAc,KAChB,CAAA,EACC,CAACR,CAAa,CAAC,EAElBO,EAAU,IAAM,CACV,CAACN,GAAc,CAACC,GAAS,CAACf,EAAgB,SAC9CuB,EAAgBvB,EAAgB,OAAO,CAAA,EACtC,CAACe,EAAOD,CAAU,CAAC,EAElB,CAACH,GAAU,CAACI,EAAc,KAG5BX,EAACoB,EAAA,CACC,aAAcT,EAAM,QACpB,gBAAAf,EACA,QAASmB,CAAA,CACX,CAEJ"}