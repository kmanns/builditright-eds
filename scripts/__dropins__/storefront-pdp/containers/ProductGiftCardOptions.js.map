{"version":3,"file":"ProductGiftCardOptions.js","sources":["/@dropins/storefront-pdp/src/containers/ProductGiftCardOptions/ProductGiftCardOptions.tsx"],"sourcesContent":["/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2024 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { HTMLAttributes, useEffect, useState } from 'preact/compat';\nimport { Container, classes } from '@adobe-commerce/elsie/lib';\nimport { events } from '@adobe-commerce/event-bus';\nimport { ProductModel } from '@/pdp/data/models';\nimport { Option, ValuesModel } from '@/pdp/data/models/values-model';\nimport {\n  getFetchedProductData,\n  setProductConfigurationValid,\n  setProductConfigurationValues,\n} from '@/pdp/api';\nimport { GiftCardOptions } from '@/pdp/components/GiftCardOptions';\n\nexport interface ProductGiftCardOptionsProps\n  extends HTMLAttributes<HTMLDivElement> {\n  scope?: string;\n}\n\nexport const ProductGiftCardOptions: Container<\n  ProductGiftCardOptionsProps,\n  ProductModel | null\n> = ({ initialData = null, scope, children, ...props }) => {\n  const [data, setData] = useState<ProductModel | null>(initialData);\n  const [values, setValues] = useState<ValuesModel>({\n    sku: '',\n    quantity: 1,\n    enteredOptions: [],\n  });\n\n  useEffect(() => {\n    const dataEvent = events.on('pdp/data', setData, { scope });\n    const valuesEvent = events.on('pdp/values', setValues, { eager: true });\n\n    return () => {\n      dataEvent?.off();\n      valuesEvent?.off();\n    };\n  }, [scope]);\n\n  const handleOptionChange = (uid: string, value: string) => {\n    const prevOptions = values.enteredOptions || [];\n    const idx = prevOptions.findIndex((field) => field.uid === uid);\n    let newEnteredOptions;\n    if (idx !== -1) {\n      newEnteredOptions = prevOptions.map((field) =>\n        field.uid === uid ? { ...field, value } : field\n      );\n    } else {\n      newEnteredOptions = [...prevOptions, { uid, value }];\n    }\n\n    setProductConfigurationValues((prev) => ({\n      ...prev,\n      enteredOptions: newEnteredOptions,\n    }));\n  };\n\n  const handleValidationChange = (valid: boolean) => {\n    setProductConfigurationValid(() => valid);\n  };\n\n  if (!data) return null;\n\n  return (\n    <div\n      {...props}\n      className={classes(['pdp-gift-card-options', props.className])}\n    >\n      {data?.attributes?.map(\n        ({ id, value }: { id: string; value: any }, index: number) => {\n          if (id !== 'ac_giftcard') {\n            return null;\n          }\n          let optionData: { options: Option[] } = { options: [] };\n          try {\n            optionData = JSON.parse(value);\n          } catch {}\n\n          return (\n            <GiftCardOptions\n              key={`giftcard-${index}`}\n              options={optionData.options}\n              className={props.className}\n              optionValues={(values.enteredOptions || []).map((opt) => ({\n                id: opt.uid,\n                value: opt.value,\n              }))}\n              currency={data.prices?.final?.currency}\n              onOptionChange={handleOptionChange}\n              onValidationChange={handleValidationChange}\n            />\n          );\n        }\n      )}\n    </div>\n  );\n};\n\nProductGiftCardOptions.getInitialData = getFetchedProductData;\n"],"names":["ProductGiftCardOptions","initialData","scope","children","props","data","setData","useState","values","setValues","useEffect","dataEvent","events","valuesEvent","handleOptionChange","uid","value","prevOptions","idx","field","newEnteredOptions","setProductConfigurationValues","prev","handleValidationChange","valid","setProductConfigurationValid","jsx","classes","id","index","optionData","GiftCardOptions","opt","_b","_a","getFetchedProductData"],"mappings":"uiBAiCa,MAAAA,EAGT,CAAC,CAAE,YAAAC,EAAc,KAAM,MAAAC,EAAO,SAAAC,EAAU,GAAGC,KAAY,OACzD,KAAM,CAACC,EAAMC,CAAO,EAAIC,EAA8BN,CAAW,EAC3D,CAACO,EAAQC,CAAS,EAAIF,EAAsB,CAChD,IAAK,GACL,SAAU,EACV,eAAgB,CAAA,CAAC,CAClB,EAEDG,EAAU,IAAM,CACd,MAAMC,EAAYC,EAAO,GAAG,WAAYN,EAAS,CAAE,MAAAJ,EAAO,EACpDW,EAAcD,EAAO,GAAG,aAAcH,EAAW,CAAE,MAAO,GAAM,EAEtE,MAAO,IAAM,CACXE,GAAA,MAAAA,EAAW,MACXE,GAAA,MAAAA,EAAa,KACf,CAAA,EACC,CAACX,CAAK,CAAC,EAEJ,MAAAY,EAAqB,CAACC,EAAaC,IAAkB,CACnD,MAAAC,EAAcT,EAAO,gBAAkB,CAAC,EACxCU,EAAMD,EAAY,UAAWE,GAAUA,EAAM,MAAQJ,CAAG,EAC1D,IAAAK,EACAF,IAAQ,GACVE,EAAoBH,EAAY,IAAKE,GACnCA,EAAM,MAAQJ,EAAM,CAAE,GAAGI,EAAO,MAAAH,GAAUG,CAC5C,EAEAC,EAAoB,CAAC,GAAGH,EAAa,CAAE,IAAAF,EAAK,MAAAC,EAAO,EAGrDK,EAA+BC,IAAU,CACvC,GAAGA,EACH,eAAgBF,CAAA,EAChB,CACJ,EAEMG,EAA0BC,GAAmB,CACjDC,EAA6B,IAAMD,CAAK,CAC1C,EAEI,OAACnB,EAGHqB,EAAC,MAAA,CACE,GAAGtB,EACJ,UAAWuB,EAAQ,CAAC,wBAAyBvB,EAAM,SAAS,CAAC,EAE5D,6BAAM,2BAAY,IACjB,CAAC,CAAE,GAAAwB,EAAI,MAAAZ,GAAqCa,IAAkB,SAC5D,GAAID,IAAO,cACF,OAAA,KAET,IAAIE,EAAoC,CAAE,QAAS,EAAG,EAClD,GAAA,CACWA,EAAA,KAAK,MAAMd,CAAK,CAAA,MACvB,CAAA,CAGN,OAAAU,EAACK,EAAA,CAEC,QAASD,EAAW,QACpB,UAAW1B,EAAM,UACjB,cAAeI,EAAO,gBAAkB,CAAA,GAAI,IAAKwB,IAAS,CACxD,GAAIA,EAAI,IACR,MAAOA,EAAI,KAAA,EACX,EACF,UAAUC,GAAAC,EAAA7B,EAAK,SAAL,YAAA6B,EAAa,QAAb,YAAAD,EAAoB,SAC9B,eAAgBnB,EAChB,mBAAoBS,CAAA,EATf,YAAYM,CAAK,EAUxB,CAAA,EAGN,CACF,EAjCgB,IAmCpB,EAEA7B,EAAuB,eAAiBmC"}