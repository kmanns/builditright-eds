{"version":3,"file":"ProductPrice.js","sources":["/@dropins/storefront-pdp/src/components/Price/Price.tsx","/@dropins/storefront-pdp/src/components/PriceTiers/PriceTiers.tsx","/@dropins/storefront-pdp/src/containers/ProductPrice/ProductPrice.tsx"],"sourcesContent":["/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2024 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\nimport { FunctionComponent, VNode } from 'preact';\n\nimport { HTMLAttributes } from 'preact/compat';\nimport { classes, VComponent } from '@adobe-commerce/elsie/lib';\nimport '@/pdp/components/Price/Price.css';\nimport { useText } from '@adobe-commerce/elsie/i18n';\n\nexport interface PriceProps extends HTMLAttributes<HTMLDivElement> {\n  price?: VNode;\n  specialPrice?: VNode;\n  tiers?: VNode;\n}\n\nexport const Price: FunctionComponent<PriceProps> = ({\n  className,\n  price,\n  specialPrice,\n  tiers,\n  children,\n  ...props\n}) => {\n  const RegularPriceLabel = useText('PDP.Product.RegularPrice.label').label;\n  const SpecialPriceLabel = useText('PDP.Product.SpecialPrice.label').label;\n  const TierPriceLabel = useText('PDP.Product.TierPrice.label').label;\n\n  return (\n    <div {...props} className={classes(['pdp-price', className])}>\n      {specialPrice && (\n        <VComponent\n          node={specialPrice}\n          className={classes([\n            'pdp-price__amount-special',\n            'pdp-price__amount',\n          ])}\n          aria-label={SpecialPriceLabel}\n          role=\"text\"\n        />\n      )}\n      {price && (\n        <VComponent\n          node={price}\n          className={classes([\n            'pdp-price__amount-regular',\n            'pdp-price__amount--grey',\n          ])}\n          aria-label={RegularPriceLabel}\n          role=\"text\"\n        />\n      )}\n      {tiers && (\n        <VComponent\n          node={tiers}\n          className={classes(['pdp-price__tiers'])}\n          aria-label={TierPriceLabel}\n          role=\"text\"\n        />\n      )}\n    </div>\n  );\n};\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { HTMLAttributes } from 'preact/compat';\nimport '@/pdp/components/PriceTiers/PriceTiers.css';\nimport { FunctionalComponent } from 'preact';\nimport { Price } from '@adobe-commerce/elsie/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { Tier } from '@/pdp/data/models';\n\nexport interface PriceTiersProps extends HTMLAttributes<HTMLDivElement> {\n  locale?: string;\n  tiers: Tier[];\n  regularPrice?: number; // Base price to calculate savings percentage\n}\n\nexport const PriceTiers: FunctionalComponent<PriceTiersProps> = ({\n  locale,\n  tiers,\n  regularPrice,\n  ...props\n}) => {\n  const TierPricingLabel = useText('PDP.Product.TierPricing.label').label;\n\n  if (!tiers || tiers.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"pdp-price-tiers\" {...props}>\n      {tiers.map((tier, index) => {\n        const tierPrice = tier?.tier?.amount ?? 0;\n        const quantity = tier?.quantity ?? 0;\n        const currency = tier?.tier?.currency ?? '';\n\n        let savingsPercent = 0;\n        if (regularPrice && tierPrice && tierPrice < regularPrice) {\n          savingsPercent = Math.round(\n            ((regularPrice - tierPrice) / regularPrice) * 100\n          );\n        }\n\n        const textBeforePrice = TierPricingLabel.replace(\n          '{quantity}',\n          quantity.toString()\n        ).split('{price}')[0];\n\n        const textAfterPrice = TierPricingLabel.replace(\n          '{quantity}',\n          quantity.toString()\n        )\n          .split('{price}')[1]\n          .replace(\n            '{percent}',\n            savingsPercent > 0 ? savingsPercent.toString() : '0'\n          );\n\n        return (\n          <div key={index} className=\"pdp-price-tiers__tier\">\n            <span className=\"pdp-price-tiers__text\">\n              {textBeforePrice}\n              <Price\n                amount={tierPrice}\n                currency={currency}\n                locale={locale}\n                className=\"pdp-price-tiers__price\"\n              />\n              {textAfterPrice}\n            </span>\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2024 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { HTMLAttributes, useEffect, useState } from 'preact/compat';\nimport { Container, toLanguageTag } from '@adobe-commerce/elsie/lib';\nimport { Price, PriceRange } from '@/pdp/components';\nimport PriceTiers from '@/pdp/components/PriceTiers';\nimport { events } from '@adobe-commerce/event-bus';\nimport { ProductModel } from '@/pdp/data/models';\nimport { config, getFetchedProductData } from '@/pdp/api';\n\nexport interface ProductPriceProps extends HTMLAttributes<HTMLDivElement> {\n  scope?: string;\n}\n\nexport const ProductPrice: Container<\n  ProductPriceProps,\n  ProductModel | null\n> = ({ initialData = null, scope, children, ...props }) => {\n  const { globalLocale = 'en-US' } = config.getConfig();\n\n  const [data, setData] = useState<ProductModel | null>(initialData);\n\n  const [locale, setLocale] = useState<string>(globalLocale);\n\n  useEffect(() => {\n    const dataEvent = events.on('pdp/data', setData, { scope });\n    const localeEvent = events.on('locale', setLocale);\n\n    return () => {\n      dataEvent?.off();\n      localeEvent?.off();\n    };\n  }, [scope]);\n\n  if (!data || !data.prices) return null;\n\n  return (\n    <Price\n      {...props}\n      specialPrice={\n        data.prices?.visible ? (\n          <PriceRange {...data.prices?.final} locale={toLanguageTag(locale)} />\n        ) : undefined\n      }\n      price={\n        data.prices?.visible &&\n        data.prices?.regular &&\n        data.prices?.final.amount !== data.prices?.regular.amount ? (\n          <PriceRange\n            {...data.prices?.regular}\n            locale={toLanguageTag(locale)}\n          />\n        ) : undefined\n      }\n      tiers={\n        data.prices?.visible && data.prices?.tiers?.length > 0 ? (\n          <PriceTiers\n            tiers={data.prices.tiers}\n            locale={toLanguageTag(locale)}\n            regularPrice={data.prices.regular?.amount}\n          />\n        ) : undefined\n      }\n    />\n  );\n};\n\nProductPrice.getInitialData = getFetchedProductData;\n"],"names":["Price","className","price","specialPrice","tiers","children","props","RegularPriceLabel","useText","SpecialPriceLabel","TierPriceLabel","jsxs","classes","jsx","VComponent","PriceTiers","locale","regularPrice","TierPricingLabel","tier","index","tierPrice","_a","quantity","currency","_b","savingsPercent","textBeforePrice","textAfterPrice","ProductPrice","initialData","scope","globalLocale","config","data","setData","useState","setLocale","useEffect","dataEvent","events","localeEvent","PriceRange","toLanguageTag","_c","_d","_e","_f","_g","_h","_j","_i","_k","getFetchedProductData"],"mappings":"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"}