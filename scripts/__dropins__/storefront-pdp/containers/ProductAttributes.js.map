{"version":3,"file":"ProductAttributes.js","sources":["/@dropins/storefront-pdp/src/containers/ProductAttributes/ProductAttributes.tsx"],"sourcesContent":["/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2024 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { HTMLAttributes, useEffect, useState, useMemo } from 'preact/compat';\nimport { classes, Container, Slot, SlotProps } from '@adobe-commerce/elsie/lib';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { events } from '@adobe-commerce/event-bus';\nimport { ProductModel } from '@/pdp/data/models';\nimport { isDateValid, toDateString } from '@/pdp/lib/date';\nimport { config, getFetchedProductData } from '@/pdp/api';\n\ntype DefaultSlotContext = {\n  data: ProductModel | null;\n};\n\nexport interface ProductAttributesProps extends HTMLAttributes<HTMLDivElement> {\n  scope?: string;\n  slots?: {\n    Attributes?: SlotProps<DefaultSlotContext>;\n  };\n}\n\nexport const ProductAttributes: Container<\n  ProductAttributesProps,\n  ProductModel | null\n> = ({ initialData = null, scope, children, slots, ...props }) => {\n  const DetailsLabel = useText('PDP.Product.Details.label').label;\n  const { globalLocale = 'en-US' } = config.getConfig();\n\n  const [locale, setLocale] = useState<string>(globalLocale);\n  const [data, setData] = useState<ProductModel | null>(initialData);\n\n  const defaultSlotContext: DefaultSlotContext = useMemo(\n    () => ({ data }),\n    [data]\n  );\n\n  // Listen for events\n  useEffect(() => {\n    const dataEvent = events.on('pdp/data', setData, { scope });\n    const localeEvent = events.on('locale', setLocale);\n\n    return () => {\n      dataEvent?.off();\n      localeEvent?.off();\n    };\n  }, [scope]);\n\n  if (!data) return null;\n\n  return (\n    <div {...props} className={classes(['pdp-attributes', props.className])}>\n      {DetailsLabel}\n      {slots?.Attributes ? (\n        <Slot\n          name=\"Attributes\"\n          slot={slots?.Attributes}\n          context={{ ...defaultSlotContext }}\n        />\n      ) : (\n        <ul>\n          {data?.attributes?.map(\n            (\n              { id, label, value }: { id: string; label: string; value: any },\n              index: number\n            ) => {\n              if (id?.startsWith('ac_') || !value) {\n                return null;\n              }\n\n              const __html = isDateValid(value)\n                ? toDateString(value, locale)\n                : value.toString();\n\n              return (\n                <li key={`attribute-${index}`}>\n                  {/* eslint-disable-next-line react/no-danger */}\n                  {label}: <span dangerouslySetInnerHTML={{ __html }} />\n                </li>\n              );\n            }\n          )}\n        </ul>\n      )}\n    </div>\n  );\n};\n\nProductAttributes.getInitialData = getFetchedProductData;\n"],"names":["ProductAttributes","initialData","scope","children","slots","props","DetailsLabel","useText","globalLocale","config","locale","setLocale","useState","data","setData","defaultSlotContext","useMemo","useEffect","dataEvent","events","localeEvent","jsxs","classes","jsx","Slot","_a","id","label","value","index","__html","isDateValid","toDateString","getFetchedProductData"],"mappings":"mkBAmCa,MAAAA,EAGT,CAAC,CAAE,YAAAC,EAAc,KAAM,MAAAC,EAAO,SAAAC,EAAU,MAAAC,EAAO,GAAGC,KAAY,OAC1D,MAAAC,EAAeC,EAAQ,2BAA2B,EAAE,MACpD,CAAE,aAAAC,EAAe,SAAYC,EAAO,UAAU,EAE9C,CAACC,EAAQC,CAAS,EAAIC,EAAiBJ,CAAY,EACnD,CAACK,EAAMC,CAAO,EAAIF,EAA8BX,CAAW,EAE3Dc,EAAyCC,EAC7C,KAAO,CAAE,KAAAH,CAAK,GACd,CAACA,CAAI,CACP,EAaI,OAVJI,EAAU,IAAM,CACd,MAAMC,EAAYC,EAAO,GAAG,WAAYL,EAAS,CAAE,MAAAZ,EAAO,EACpDkB,EAAcD,EAAO,GAAG,SAAUR,CAAS,EAEjD,MAAO,IAAM,CACXO,GAAA,MAAAA,EAAW,MACXE,GAAA,MAAAA,EAAa,KACf,CAAA,EACC,CAAClB,CAAK,CAAC,EAELW,EAGHQ,EAAC,MAAK,CAAA,GAAGhB,EAAO,UAAWiB,EAAQ,CAAC,iBAAkBjB,EAAM,SAAS,CAAC,EACnE,SAAA,CAAAC,EACAF,GAAA,MAAAA,EAAO,WACNmB,EAACC,EAAA,CACC,KAAK,aACL,KAAMpB,GAAA,YAAAA,EAAO,WACb,QAAS,CAAE,GAAGW,CAAmB,CAAA,CAAA,EAGnCQ,EAAC,KACE,CAAA,UAAAE,EAAAZ,GAAA,YAAAA,EAAM,aAAN,YAAAY,EAAkB,IACjB,CACE,CAAE,GAAAC,EAAI,MAAAC,EAAO,MAAAC,CAAA,EACbC,IACG,CACH,GAAIH,GAAA,MAAAA,EAAI,WAAW,QAAU,CAACE,EACrB,OAAA,KAGH,MAAAE,EAASC,EAAYH,CAAK,EAC5BI,EAAaJ,EAAOlB,CAAM,EAC1BkB,EAAM,SAAS,EAEnB,SACG,KAEE,CAAA,SAAA,CAAAD,EAAM,KAAGJ,EAAA,OAAA,CAAK,wBAAyB,CAAE,OAAAO,EAAU,CAAA,CAF7C,CAAA,EAAA,aAAaD,CAAK,EAG3B,CAAA,EAIR,CAAA,CAAA,EAEJ,EApCgB,IAsCpB,EAEA7B,EAAkB,eAAiBiC"}