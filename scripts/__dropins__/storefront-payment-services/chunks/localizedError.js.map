{"version":3,"file":"localizedError.js","sources":["/@dropins/storefront-payment-services/src/lib/signals.ts","/@dropins/storefront-payment-services/src/hooks/useLocale.ts","/@dropins/storefront-payment-services/src/lib/i18n.ts","/@dropins/storefront-payment-services/src/lib/localizedError.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { PaymentServicesSDK } from '@adobe-commerce/payment-services-sdk';\nimport { computed } from '@adobe-commerce/elsie/lib/signals';\nimport { state } from './state';\n\n/**\n * Payment Services SDK signal. Invariants:\n *  - (paymentsSDK !== null) -> sdk.Payment.init() called and awaited for all locations\n */\nexport const paymentsSDK = computed<{\n    checkout?: PaymentServicesSDK\n    productDetail?: PaymentServicesSDK\n} >(\n  () => state.value.paymentsSDK || {}\n);\n\n/**\n * Payment Services drop-in status signal.\n */\nexport const status = computed(() => state.value.status);\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { useEffect, useState } from \"preact/compat\";\nimport { Lang } from \"@adobe-commerce/elsie/i18n\";\nimport { events } from \"@adobe-commerce/event-bus\";\n\nexport const DEFAULT_LOCALE: Lang = \"en_US\";\n\nexport function useLocale(): Lang {\n  const [locale, setLocale] = useState<string>(events.lastPayload(\"locale\") || DEFAULT_LOCALE);\n\n  useEffect(() => {\n    const subscription = events.on(\"locale\", setLocale);\n    return () => subscription?.off();\n  }, [locale]);\n\n  return locale as Lang\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport deepmerge from 'deepmerge';\nimport { Lang, translate as _translate } from '@adobe-commerce/elsie/i18n';\nimport { config } from '@/api';\nimport defaultTranslations from '@/i18n/en_US.json';\nimport { DEFAULT_LOCALE } from '@/hooks/useLocale';\nimport { events } from '@adobe-commerce/event-bus';\n\ntype DeepStringTree = string | { [k: string]: DeepStringTree };\n\n/**\n * Translates a text into the current locale (imperative version of useText hook).\n *\n * Example\n * ~~~\n *\n *    translate(\"PaymentServices.messages.methodLoading\")\n *\n *  @param key key of text to translate\n */\nexport function translate(key: string): string {\n  const locale = events.lastPayload('locale') || DEFAULT_LOCALE;\n  const translations = getDefinitionByLanguage(locale);\n  return _translate(key, '', translations);\n}\n\nfunction getDefinitionByLanguage(lang: Lang): DeepStringTree {\n  const langDefinitions = config.getConfig().langDefinitions;\n  if (!langDefinitions) {\n    return defaultTranslations;\n  }\n\n  const translations = deepmerge.all([\n    defaultTranslations,\n    langDefinitions.default || {},\n    langDefinitions[lang] || {},\n  ]);\n\n  return translations as DeepStringTree;\n}\n","import { translate } from '@/lib/i18n';\n\n/**\n * Represents a user-friendly, localized error intended for UI display.\n *\n * @property {string} name - A localized, user-facing string that serves as the name of the error (e.g., \"Network error\").\n * @property {string} message - A localized, user-facing message that describes the error in detail (e.g., \"An unexpected network error occurred.\").\n *\n * @example\n *   throw new LocalizedError('Verbindingsfout', 'Er is een onverwachte netwerkfout opgetreden.');\n *\n *   // Usage\n *   try {\n *     // ...\n *   } catch (e) {\n *     if (e instanceof LocalizedError) {\n *       showError(e.name, e.message);\n *     }\n *   }\n */\nclass LocalizedError extends Error {\n  constructor(localizedName: string, localizedMessage: string) {\n    super(localizedMessage);\n    this.name = localizedName;\n  }\n}\n\nconst getErrorKey: Record<ErrorCategory, (error: Error) => string> = {\n  ApplePay: (_error) => 'default',\n  CreditCard: (_error) => 'default',\n};\n\nexport function fromPaymentsSDKError(\n  category: ErrorCategory,\n  error: Error\n): LocalizedError {\n  const errorKey = getErrorKey[category]?.(error) || 'default';\n  const i18nKey = `PaymentServices.${category}.errors.${errorKey}`;\n  const localizedName = translate(`${i18nKey}.name`) ?? 'Error';\n  const localizedMessage =\n    translate(`${i18nKey}.message`) ?? `${i18nKey}.message`;\n\n  return new LocalizedError(localizedName, localizedMessage);\n}\n\nexport type ErrorCategory = 'CreditCard' | 'ApplePay';\n\nexport default LocalizedError;\n"],"names":["paymentsSDK","computed","state","status","DEFAULT_LOCALE","useLocale","locale","setLocale","useState","events","useEffect","subscription","translate","key","translations","getDefinitionByLanguage","_translate","lang","langDefinitions","config","deepmerge","defaultTranslations","LocalizedError","localizedName","localizedMessage","getErrorKey","_error","fromPaymentsSDKError","category","error","errorKey","_a","i18nKey"],"mappings":"sTAyBO,MAAMA,EAAcC,EAIzB,IAAMC,EAAM,MAAM,aAAe,CAAA,CACnC,EAKaC,EAASF,EAAS,IAAMC,EAAM,MAAM,MAAM,ECd1CE,EAAuB,QAE7B,SAASC,GAAkB,CAChC,KAAM,CAACC,EAAQC,CAAS,EAAIC,EAAiBC,EAAO,YAAY,QAAQ,GAAKL,CAAc,EAE3F,OAAAM,EAAU,IAAM,CACd,MAAMC,EAAeF,EAAO,GAAG,SAAUF,CAAS,EAClD,MAAO,IAAMI,GAAA,YAAAA,EAAc,KAC7B,EAAG,CAACL,CAAM,CAAC,EAEJA,CACT,CCIO,SAASM,EAAUC,EAAqB,CAC7C,MAAMP,EAASG,EAAO,YAAY,QAAQ,GAAKL,EACzCU,EAAeC,EAAwBT,CAAM,EACnD,OAAOU,EAAWH,EAAK,GAAIC,CAAY,CACzC,CAEA,SAASC,EAAwBE,EAA4B,CAC3D,MAAMC,EAAkBC,EAAO,UAAA,EAAY,gBAC3C,OAAKD,EAIgBE,EAAU,IAAI,CACjCC,EACAH,EAAgB,SAAW,CAAA,EAC3BA,EAAgBD,CAAI,GAAK,CAAA,CAAC,CAC3B,EAPQI,CAUX,CCnCA,MAAMC,UAAuB,KAAM,CACjC,YAAYC,EAAuBC,EAA0B,CAC3D,MAAMA,CAAgB,EACtB,KAAK,KAAOD,CACd,CACF,CAEA,MAAME,EAA+D,CACnE,SAAWC,GAAW,UACtB,WAAaA,GAAW,SAC1B,EAEO,SAASC,EACdC,EACAC,EACgB,OAChB,MAAMC,IAAWC,EAAAN,EAAYG,KAAZ,YAAAG,EAAA,KAAAN,EAAwBI,KAAU,UAC7CG,EAAU,mBAAmBJ,CAAQ,WAAWE,CAAQ,GACxDP,EAAgBX,EAAU,GAAGoB,CAAO,OAAO,GAAK,QAChDR,EACJZ,EAAU,GAAGoB,CAAO,UAAU,GAAK,GAAGA,CAAO,WAE/C,OAAO,IAAIV,EAAeC,EAAeC,CAAgB,CAC3D"}