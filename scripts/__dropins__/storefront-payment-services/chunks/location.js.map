{"version":3,"file":"location.js","sources":["../../node_modules/@adobe-commerce/payment-services-sdk/dist/index.js","/@dropins/storefront-payment-services/src/lib/state.ts","/@dropins/storefront-payment-services/src/lib/actions.ts","/@dropins/storefront-payment-services/src/lib/utils.ts","/@dropins/storefront-payment-services/src/api/initialize/initialize.ts","/@dropins/storefront-payment-services/src/data/models/method.ts","/@dropins/storefront-payment-services/src/data/models/location.ts"],"sourcesContent":["/**\n * Copyright 2024 Adobe\n * All Rights Reserved.\n *\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n'use strict';\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\n\nfunction loadPaymentServicesSDK() {\n    return __awaiter(this, arguments, void 0, function* (params = {}) {\n        if (\"PaymentServicesSDK\" in window) {\n            return window.PaymentServicesSDK;\n        }\n        yield addScriptToDocument(params.customUrl || \"https://payments-sdk.live.commerce-payment-services.com/v0/4/PaymentSDK.js?v=0.4.1\", params.scriptAttributes || {});\n        if (!(\"PaymentServicesSDK\" in window)) {\n            throw new Error(\"Script loaded, but Payment Services SDK not found.\");\n        }\n        return window.PaymentServicesSDK;\n    });\n}\nfunction addScriptToDocument(src, { crossOrigin, integrity }) {\n    const script = document.createElement(\"script\");\n    if (crossOrigin !== null && crossOrigin !== undefined) {\n        script.crossOrigin = crossOrigin;\n    }\n    if (integrity !== null && integrity !== undefined) {\n        script.integrity = integrity;\n    }\n    return new Promise((resolve, reject) => {\n        script.src = src;\n        script.async = true;\n        script.onload = () => resolve();\n        script.onerror = (err) => reject(err);\n        document.head.appendChild(script);\n    });\n}\n\nexports.loadPaymentServicesSDK = loadPaymentServicesSDK;\n//# sourceMappingURL=index.js.map\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { PaymentServicesSDK } from '@adobe-commerce/payment-services-sdk';\nimport { signal } from '@adobe-commerce/elsie/lib/signals';\n\n/**\n * Payment Services drop-in state.\n */\nexport type State = {\n  status: 'initializing' | 'error' | 'ready';\n  /**\n   * Invariants\n   *  - (status === \"ready\") === (paymentsSDK !== null)\n   *  - (paymentsSDK !== null) -> sdk.Payment.init() called and awaited for all locations\n   */\n  paymentsSDK: {\n    checkout: PaymentServicesSDK\n    productDetail: PaymentServicesSDK\n  } | null;\n};\n\n/**\n * Reactive atomic drop-in state.\n */\nexport const state = signal<State>({\n  status: 'initializing',\n  paymentsSDK: null,\n});\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { PaymentServicesSDK } from '@adobe-commerce/payment-services-sdk';\nimport { state } from './state';\n\n/**\n * Finalize Payment Services drop-in initialization with \"ready\" status.\n */\nexport function initializationSucceeded(paymentsSDK: {\n  checkout: PaymentServicesSDK\n  productDetail: PaymentServicesSDK\n}) {\n  state.value = { paymentsSDK, status: 'ready' };\n}\n\n/**\n * Finalize Payment Services drop-in initialization with \"error\" status.\n */\nexport function initializationFailed() {\n  state.value = { paymentsSDK: null, status: 'error' };\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/**\n * Awaitable 'sleep'.\n */\nexport function timeout(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\n/**\n * Converts SCREAMING_SNAKE_CASE to kebab-case.\n */\nexport function screamingSnakeToKebabCase(screamCaseText: string) {\n  return screamCaseText.toLowerCase().replace('_', '-');\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  loadPaymentServicesSDK,\n  PaymentServicesSDK,\n} from '@adobe-commerce/payment-services-sdk';\nimport { Initializer } from '@adobe-commerce/elsie/lib';\nimport { Lang } from '@adobe-commerce/elsie/i18n';\nimport { events, Events } from '@adobe-commerce/event-bus';\nimport * as actions from '@/lib/actions';\nimport { PaymentLocation, PaymentMethodCode } from '@/api';\nimport { screamingSnakeToKebabCase } from \"@/lib/utils\";\n\nexport type ConfigProps = {\n  /**\n   * Adobe Commerce GraphQL API URL, e.g., \"https://magento.test/graphql\".\n   * When not set, this defaults to \"/graphql\".\n   */\n  apiUrl?: string;\n  /**\n   * The Payment Services drop-in may send GraphQL requests on behalf of the shopper. This requires GraphQL\n   * authorization, which can be performed using authorization tokens or session cookies.\n   *\n   * For token-based authorization, the \"getCustomerToken\" function should return a customer token as a string, or null\n   * for guest checkouts. The \"getCustomerToken\" function should not be provided for session-based authorization.\n   *\n   * For more information, see: https://developer.adobe.com/commerce/webapi/graphql/usage/authorization-tokens/.\n   */\n  getCustomerToken?: (() => string | null) | null;\n  /**\n   * Adobe Commerce store view code on which the Payment Services drop-in should perform GraphQL requests.\n   * When not set, no 'Store' header will be sent.\n   */\n  storeViewCode?: string;\n  /**\n   * Dictionary of language definitions for the Payment Services drop-in.\n   */\n  langDefinitions?: Record<'default' | Lang, object>;\n};\n\nexport const initialize = new Initializer<ConfigProps>({\n  /**\n   * Triggers asynchronous initialization of the Payment Services drop-in.\n   *\n   * Note that the returned promise resolves immediately. Thus, promise resolution cannot be used to determine that the\n   * initialization finished.\n   */\n  init: async (config) => {\n    const defaultConfig = {};\n\n    initialize.config.setConfig({ ...defaultConfig, ...config });\n\n    loadPaymentServicesSDK()\n      .then(async (PaymentServicesSDK) => {\n        const [checkoutSDK, productDetailSDK] = await Promise.all([\n          initLocation(PaymentServicesSDK, PaymentLocation.CHECKOUT),\n          initLocation(PaymentServicesSDK, PaymentLocation.PRODUCT_DETAIL),\n        ]);\n\n        actions.initializationSucceeded({\n          checkout: checkoutSDK,\n          productDetail: productDetailSDK,\n        });\n      })\n      .catch((error) => {\n        console.error(\n          'Error occurred during payment services drop-in initialization.',\n          error\n        );\n        actions.initializationFailed();\n      });\n  },\n\n  listeners: () => [\n    // events.on('authenticated', (authenticated) => {\n    //   console.log('authenticated', authenticated);\n    // }),\n  ],\n});\n\nasync function initLocation(\n  SDKClass: typeof PaymentServicesSDK,\n  location: PaymentLocation\n) {\n  const config = initialize.config.getConfig();\n  const sdk = new SDKClass({\n    apiUrl: config?.apiUrl,\n    getCustomerToken: config?.getCustomerToken,\n    storeViewCode: config?.storeViewCode,\n  });\n  await sdk.Payment.init({ location });\n  notifyLocationInitialized(sdk, location);\n  return sdk;\n}\n\nfunction notifyLocationInitialized(\n  sdk: PaymentServicesSDK,\n  location: PaymentLocation\n) {\n  const name = `payment-services/initialized/${screamingSnakeToKebabCase(\n    location\n  )}` as keyof Events;\n\n  const payload: { availablePaymentMethods: PaymentMethodCode[] } = {\n    availablePaymentMethods: [],\n  };\n\n  if (sdk.Payment.ApplePay.isAvailable()) {\n    payload.availablePaymentMethods.push(PaymentMethodCode.APPLE_PAY);\n  }\n\n  if (sdk.Payment.CreditCard.isAvailable()) {\n    payload.availablePaymentMethods.push(PaymentMethodCode.CREDIT_CARD);\n  }\n\n  events.emit(name, payload);\n}\n\nexport const config = initialize.config;\n","export enum PaymentMethodCode {\n  APPLE_PAY = 'payment_services_paypal_apple_pay',\n  CREDIT_CARD = 'payment_services_paypal_hosted_fields',\n  FASTLANE = 'payment_services_paypal_fastlane',\n  GOOGLE_PAY = 'payment_services_paypal_google_pay',\n  SMART_BUTTONS = 'payment_services_paypal_smart_buttons',\n  VAULT = 'payment_services_paypal_vault',\n}\n","export enum PaymentLocation {\n    CHECKOUT = 'CHECKOUT',\n    PRODUCT_DETAIL = 'PRODUCT_DETAIL',\n}\n"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","reject","fulfilled","step","e","rejected","result","loadPaymentServicesSDK","params","addScriptToDocument","src","crossOrigin","integrity","script","err","loadPaymentServicesSDK_1","state","signal","initializationSucceeded","paymentsSDK","initializationFailed","screamingSnakeToKebabCase","screamCaseText","initialize","Initializer","config","defaultConfig","PaymentServicesSDK","checkoutSDK","productDetailSDK","initLocation","PaymentLocation","actions.initializationSucceeded","error","actions.initializationFailed","SDKClass","location","sdk","notifyLocationInitialized","name","payload","PaymentMethodCode","events"],"mappings":"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","x_google_ignoreList":[0]}