{"version":3,"file":"RequisitionListGrid.js","sources":["/@dropins/storefront-requisition-list/src/hooks/useRequisitionListGrid.tsx","/@dropins/storefront-requisition-list/src/containers/RequisitionListGrid/RequisitionListGrid.tsx","/@dropins/storefront-requisition-list/src/components/RequisitionListGridWrapper/RequisitionListGridWrapper.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { useMemo, useState, useCallback, useEffect } from 'preact/compat';\nimport { VNode } from 'preact';\nimport { Button } from '@adobe-commerce/elsie/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { RequisitionList as RequisitionListModel } from '@/requisitionList/data/models/requisitionList';\nimport { getRequisitionLists } from '@/requisitionList/api/getRequisitionLists';\nimport { RequisitionLists } from '@/requisitionList/data/models/requisitionLists';\nimport { events } from '@adobe-commerce/event-bus';\nimport { DEFAULT_PAGE_SIZE } from '@/requisitionList/lib/constants';\n\ntype Row = Record<string, VNode | string | number | undefined>;\ntype Callbacks = {\n  handleOpenRenameModal: (rl: RequisitionListModel) => void;\n  handleOpenDeleteModal: (rl: RequisitionListModel) => void;\n};\n\nexport function useRequisitionListGrid(\n  callbacks?: Callbacks,\n  routeRequisitionListDetails?: (uid: string) => string | void,\n  closeModal?: () => void\n) {\n  const translations = useText({\n    actionRename: 'RequisitionList.RequisitionListView.actionRename',\n    actionDeleteList: 'RequisitionList.RequisitionListView.actionDeleteList',\n  });\n\n  const [reqLists, setReqLists] = useState<RequisitionLists | null>(null);\n  const [isAdding, setIsAdding] = useState(false);\n  const [isFetching, setIsFetching] = useState(false);\n\n  const handleAddNew = useCallback(() => {\n    // Close any open modal before opening create form\n    if (closeModal) {\n      closeModal();\n    }\n    setIsAdding(true);\n  }, [closeModal]);\n\n  const handleCancelCreate = useCallback(() => setIsAdding(false), []);\n\n  // Wrap callbacks to close create form when opening modals\n  const wrappedCallbacks = useMemo(() => {\n    if (!callbacks) return undefined;\n\n    return {\n      handleOpenRenameModal: (rl: RequisitionListModel) => {\n        // Close create form if open - use functional update to avoid dependency on isAdding\n        setIsAdding((current) => {\n          if (current) return false;\n          return current;\n        });\n        callbacks.handleOpenRenameModal(rl);\n      },\n      handleOpenDeleteModal: (rl: RequisitionListModel) => {\n        // Close create form if open - use functional update to avoid dependency on isAdding\n        setIsAdding((current) => {\n          if (current) return false;\n          return current;\n        });\n        callbacks.handleOpenDeleteModal(rl);\n      },\n    };\n  }, [callbacks]);\n\n  const fetchPage = useCallback(async (page: number, pageSize: number) => {\n    setIsFetching(true);\n    try {\n      const data = await getRequisitionLists(page, pageSize);\n      const currentPage = data?.page_info?.current_page ?? 1;\n      const totalPages = data?.page_info?.total_pages ?? 0;\n      const hasRows = (data?.items?.length ?? 0) > 0;\n\n      if (!hasRows && currentPage > 1 && totalPages >= currentPage - 1) {\n        const prev = currentPage - 1;\n        const prevData = await getRequisitionLists(prev, pageSize);\n        setReqLists(prevData);\n      } else {\n        setReqLists(data);\n      }\n    } finally {\n      setIsFetching(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    const requisitionListsEvent = events.on(\n      'requisitionLists/data',\n      (data: RequisitionLists) => {\n        if (data && data.items) {\n          setReqLists(data);\n        }\n      },\n      { eager: true }\n    );\n    return () => {\n      requisitionListsEvent?.off();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!reqLists) {\n      void fetchPage(1, DEFAULT_PAGE_SIZE);\n    }\n  }, [reqLists, fetchPage]);\n\n  const handlePageChange = useCallback(\n    (page?: number) => {\n      const currentPage = page ?? reqLists?.page_info?.current_page ?? 1;\n      const currentPageSize =\n        reqLists?.page_info?.page_size ?? DEFAULT_PAGE_SIZE;\n      return fetchPage(currentPage, currentPageSize);\n    },\n    [fetchPage, reqLists]\n  );\n\n  const handlePageSizeChange = useCallback(\n    async (pageSize: number) => {\n      // Reset to page 1 when changing page size\n      await fetchPage(1, pageSize);\n    },\n    [fetchPage]\n  );\n\n  const rows: Row[] = useMemo(\n    () =>\n      (reqLists?.items ?? []).map((rl: RequisitionListModel) => {\n        return {\n          name: (\n            <div className=\"requisition-list-grid-wrapper__name\">\n              <div className=\"requisition-list-grid-wrapper__name__title\">\n                <a\n                  href=\"#\"\n                  onClick={(e: Event): void => {\n                    e.preventDefault();\n                    if (routeRequisitionListDetails) {\n                      const result = routeRequisitionListDetails(rl.uid);\n                      if (typeof result === 'string') {\n                        window.location.href = result;\n                      }\n                    }\n                  }}\n                >\n                  {rl.name}\n                </a>\n              </div>\n              {rl.description && (\n                <div className=\"requisition-list-grid-wrapper__name__description\">\n                  {rl.description}\n                </div>\n              )}\n            </div>\n          ),\n          items_count: rl.items_count,\n          last_updated: new Date(rl.updated_at).toLocaleString(),\n          actions: (\n            <div className=\"requisition-list-grid-wrapper__actions\">\n              <Button\n                variant=\"tertiary\"\n                type=\"button\"\n                data-testid=\"rename-button\"\n                onClick={() => wrappedCallbacks?.handleOpenRenameModal(rl)}\n              >\n                {translations.actionRename}\n              </Button>\n              <Button\n                variant=\"tertiary\"\n                type=\"button\"\n                data-testid=\"delete-button\"\n                onClick={() => wrappedCallbacks?.handleOpenDeleteModal(rl)}\n              >\n                {translations.actionDeleteList}\n              </Button>\n            </div>\n          ),\n        };\n      }),\n    [\n      reqLists?.items,\n      translations.actionRename,\n      translations.actionDeleteList,\n      wrappedCallbacks,\n      routeRequisitionListDetails,\n    ]\n  );\n\n  return {\n    rows,\n    isLoading: isFetching || !reqLists,\n    pageInfo: reqLists?.page_info,\n    totalCount: reqLists?.total_count,\n    handlePageChange,\n    handlePageSizeChange,\n    isAdding,\n    handleAddNew,\n    handleCancelCreate,\n  };\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { HTMLAttributes, useState, useCallback } from 'preact/compat';\nimport { Header } from '@adobe-commerce/elsie/components';\nimport { Container, Slot, SlotProps } from '@adobe-commerce/elsie/lib';\nimport { RequisitionList as RequisitionListModel } from '@/requisitionList/data/models/requisitionList';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport {\n  RequisitionListGridWrapper,\n  RequisitionListModal,\n  RequisitionListForm,\n  NotFound,\n} from '@/requisitionList/components';\nimport { useRequisitionListGrid } from '@/requisitionList/hooks/useRequisitionListGrid';\nimport { useRequisitionListEnabled } from '@/requisitionList/hooks/useRequisitionListEnabled';\nimport { deleteRequisitionList } from '@/requisitionList/api/deleteRequisitionList/deleteRequisitionList';\nimport { updateRequisitionList } from '@/requisitionList/api/updateRequisitionList';\nimport { events } from '@adobe-commerce/event-bus';\n\nexport interface RequisitionListGridProps\n  extends HTMLAttributes<HTMLDivElement> {\n  routeRequisitionListDetails?: (uid: string) => string | void;\n  /**\n   * Fallback URL to redirect when requisition lists are not enabled.\n   * Defaults to '/customer/account'\n   */\n  fallbackRoute?: string;\n  slots?: {\n    Header?: SlotProps;\n  };\n}\n\nexport const RequisitionListGrid: Container<RequisitionListGridProps> = ({\n  routeRequisitionListDetails,\n  fallbackRoute = '/customer/account',\n  slots,\n}: RequisitionListGridProps) => {\n  const { isEnabled } = useRequisitionListEnabled();\n\n  const [modal, setModal] = useState<{\n    type: 'rename' | 'delete' | null;\n    isOpen: boolean;\n    isLoading: boolean;\n    requisitionList: RequisitionListModel | null;\n  }>({\n    type: null,\n    isOpen: false,\n    isLoading: false,\n    requisitionList: null,\n  });\n\n  const closeModal = useCallback(() => {\n    setModal({\n      type: null,\n      isOpen: false,\n      isLoading: false,\n      requisitionList: null,\n    });\n  }, []);\n\n  const handleOpenRenameModal = useCallback((rl: RequisitionListModel) => {\n    setModal({\n      type: 'rename',\n      isOpen: true,\n      isLoading: false,\n      requisitionList: rl,\n    });\n  }, []);\n\n  const handleOpenDeleteModal = useCallback((rl: RequisitionListModel) => {\n    setModal({\n      type: 'delete',\n      isOpen: true,\n      isLoading: false,\n      requisitionList: rl,\n    });\n  }, []);\n\n  const {\n    rows,\n    isLoading,\n    pageInfo,\n    totalCount,\n    handlePageChange,\n    handlePageSizeChange,\n    isAdding,\n    handleAddNew,\n    handleCancelCreate,\n  } = useRequisitionListGrid(\n    { handleOpenRenameModal, handleOpenDeleteModal },\n    routeRequisitionListDetails,\n    closeModal\n  );\n\n  const handleRenameSubmit = useCallback(\n    async (values: { name: string; description?: string }) => {\n      /* istanbul ignore next: Defensive check - modal.requisitionList should always be set when this function is called */\n      if (!modal.requisitionList) return;\n\n      try {\n        await updateRequisitionList(\n          modal.requisitionList.uid,\n          values.name,\n          values.description\n        );\n        events.emit('requisitionList/alert', {\n          action: 'update',\n          type: 'success',\n          context: 'requisitionList',\n        });\n        await handlePageChange();\n        closeModal();\n      } catch (error) {\n        events.emit('requisitionList/alert', {\n          action: 'update',\n          type: 'error',\n          context: 'requisitionList',\n        });\n      }\n    },\n    [modal.requisitionList, handlePageChange, closeModal]\n  );\n\n  const handleDeleteConfirm = async () => {\n    /* istanbul ignore next: Defensive check - modal.requisitionList should always be set when this function is called */\n    if (!modal.requisitionList) return;\n    setModal({ ...modal, isLoading: true });\n    await deleteRequisitionList(modal.requisitionList.uid)\n      .then(async () => {\n        events.emit('requisitionList/alert', {\n          type: 'success',\n          action: 'delete',\n          context: 'requisitionList',\n        });\n      })\n      .catch(() => {\n        events.emit('requisitionList/alert', {\n          type: 'error',\n          action: 'delete',\n          context: 'requisitionList',\n        });\n      })\n      .finally(async () => {\n        await handlePageChange();\n        closeModal();\n      });\n  };\n\n  const translations = useText({\n    containerTitle: `RequisitionList.containerTitle`,\n    updateTitle: `RequisitionList.RequisitionListForm.updateTitle`,\n    deleteRequisitionListTitle:\n      'RequisitionList.RequisitionListWrapper.deleteRequisitionListTitle',\n    deleteRequisitionListMessage:\n      'RequisitionList.RequisitionListWrapper.deleteRequisitionListMessage',\n    cancelAction: 'RequisitionList.RequisitionListWrapper.cancelAction',\n    confirmAction: 'RequisitionList.RequisitionListWrapper.confirmAction',\n    notEnabledTitle: `RequisitionList.RequisitionListsNotEnabled.title`,\n    notEnabledMessage: `RequisitionList.RequisitionListsNotEnabled.message`,\n    notEnabledActionLabel: `RequisitionList.RequisitionListsNotEnabled.actionLabel`,\n  });\n\n  const getHeader = useCallback(() => {\n    if (slots?.Header) {\n      return (\n        <Slot\n          name=\"Header\"\n          aria-label={translations.containerTitle}\n          title={translations.containerTitle}\n          slot={slots.Header}\n        />\n      );\n    }\n    return (\n      <Header\n        aria-label={translations.containerTitle}\n        role=\"region\"\n        title={translations.containerTitle}\n      />\n    );\n  }, [slots, translations.containerTitle]);\n\n  if (isEnabled === false) {\n    return (\n      <NotFound\n        title={translations.notEnabledTitle}\n        message={translations.notEnabledMessage}\n        actionLabel={translations.notEnabledActionLabel}\n        onAction={() => {\n          window.location.href = fallbackRoute;\n        }}\n      />\n    );\n  }\n\n  return (\n    <>\n      <RequisitionListGridWrapper\n        header={getHeader()}\n        rows={rows}\n        skeletonRowCount={10}\n        isLoading={isLoading}\n        pageInfo={pageInfo}\n        totalCount={totalCount}\n        handlePageChange={handlePageChange}\n        handlePageSizeChange={handlePageSizeChange}\n        defaultPageSize={10}\n        isAdding={isAdding}\n        handleAddNew={handleAddNew}\n        handleCancelCreate={handleCancelCreate}\n      />\n\n      {/* Rename Modal */}\n      {modal.type === 'rename' && modal.isOpen && modal.requisitionList && (\n        <RequisitionListModal\n          isOpen={modal.isOpen}\n          isLoading={modal.isLoading}\n          title={translations.updateTitle}\n          modalContent={\n            <RequisitionListForm\n              mode=\"update\"\n              defaultValues={{\n                name: modal.requisitionList.name,\n                description: modal.requisitionList.description || '',\n              }}\n              onSubmit={handleRenameSubmit}\n              onCancel={closeModal}\n            />\n          }\n          handleModalOnClose={closeModal}\n        />\n      )}\n\n      {/* Delete Confirmation Modal */}\n      {modal.type === 'delete' && modal.isOpen && (\n        <RequisitionListModal\n          isOpen={modal.isOpen}\n          isLoading={modal.isLoading}\n          title={translations.deleteRequisitionListTitle}\n          modalContent={translations.deleteRequisitionListMessage}\n          confirmBtnCaption={translations.confirmAction}\n          closeBtnCaption={translations.cancelAction}\n          handleModalOnClose={closeModal}\n          handleModalOnConfirm={handleDeleteConfirm}\n        />\n      )}\n    </>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { HTMLAttributes, useEffect } from 'preact/compat';\nimport { FunctionComponent, VNode } from 'preact';\nimport { VComponent, classes } from '@adobe-commerce/elsie/lib';\nimport {\n  RequisitionListActions,\n  EmptyList,\n  PageSizePicker,\n  PaginationItemsCounter,\n} from '@/requisitionList/components';\nimport { RequisitionListForm } from '@/requisitionList/containers';\nimport {\n  Pagination,\n  Card,\n  Table,\n  InLineAlert,\n} from '@adobe-commerce/elsie/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { events } from '@adobe-commerce/event-bus';\nimport '@/requisitionList/components/RequisitionListGridWrapper/RequisitionListGridWrapper.css';\nimport { useRequisitionListAlert } from '@/requisitionList/hooks';\n\nexport interface RequisitionListGridWrapperProps\n  extends HTMLAttributes<HTMLDivElement> {\n  className?: string;\n  isLoading?: boolean;\n  header?: VNode;\n  rows: Array<Record<string, VNode | string | number | undefined>>;\n  skeletonRowCount: number;\n  pageInfo?: {\n    total_pages?: number;\n    current_page?: number;\n    page_size?: number;\n  };\n  totalCount?: number;\n  handlePageChange: (page?: number) => Promise<void>;\n  handlePageSizeChange?: (pageSize: number) => Promise<void>;\n  defaultPageSize?: number;\n  isAdding: boolean;\n  handleAddNew: () => void;\n  handleCancelCreate: () => void;\n}\n\nexport const RequisitionListGridWrapper: FunctionComponent<\n  RequisitionListGridWrapperProps\n> = ({\n  className,\n  isLoading = false,\n  header,\n  rows = [],\n  skeletonRowCount = 10,\n  pageInfo,\n  totalCount = 0,\n  handlePageChange,\n  handlePageSizeChange,\n  defaultPageSize = 10,\n  isAdding,\n  handleAddNew,\n  handleCancelCreate,\n  ...props\n}) => {\n  const translations = useText({\n    name: `RequisitionList.RequisitionListWrapper.name`,\n    itemsCount: `RequisitionList.RequisitionListWrapper.itemsCount`,\n    lastUpdated: `RequisitionList.RequisitionListWrapper.lastUpdated`,\n    actions: `RequisitionList.RequisitionListWrapper.actions`,\n    emptyList: `RequisitionList.RequisitionListWrapper.emptyList`,\n    show: `RequisitionList.PageSizePicker.show`,\n  });\n\n  const hasAnyItems = (pageInfo?.total_pages ?? 0) > 0;\n  const showEmptyList = !isLoading && rows.length === 0 && !hasAnyItems;\n\n  const { alert, setAlert, handleRequisitionListAlert } =\n    useRequisitionListAlert();\n\n  useEffect(() => {\n    const alertEvent = events.on(\n      'requisitionList/alert',\n      handleRequisitionListAlert\n    );\n\n    // Check for pending alert in localStorage (e.g., after redirect from deletion)\n    try {\n      const pendingAlert = localStorage.getItem('requisitionListPendingAlert');\n      if (pendingAlert) {\n        const alertPayload = JSON.parse(pendingAlert);\n        handleRequisitionListAlert(alertPayload);\n        localStorage.removeItem('requisitionListPendingAlert');\n      }\n    } catch (e) {\n      // Ignore localStorage errors (e.g., in private browsing mode)\n    }\n\n    return () => {\n      alertEvent?.off();\n    };\n  }, [handleRequisitionListAlert]);\n\n  return (\n    <div\n      {...props}\n      className={classes(['requisition-list-grid-wrapper', className])}\n      data-testid=\"requisition-list-grid-wrapper\"\n    >\n      {/* Requisition List Header */}\n      {header && (\n        <div\n          className={classes([\n            'requisition-list-grid-wrapper__header',\n            className,\n          ])}\n          data-testid=\"requisition-list-grid-wrapper-header\"\n        >\n          <VComponent node={header} />\n        </div>\n      )}\n      {/* Requisition List alerts go here */}\n      {alert && (\n        <div className=\"requisition-list__alert-wrapper\">\n          <InLineAlert\n            heading={alert.description}\n            type={alert.type}\n            variant=\"primary\"\n            onDismiss={() => setAlert(null)}\n          />\n        </div>\n      )}\n\n      {showEmptyList ? (\n        <EmptyList textContent={translations.emptyList} />\n      ) : (\n        <>\n          {/* Requisition Lists Table */}\n          <Table\n            columns={[\n              { key: 'name', label: translations.name },\n              { key: 'items_count', label: translations.itemsCount },\n              { key: 'last_updated', label: translations.lastUpdated },\n              { key: 'actions', label: translations.actions },\n            ]}\n            rowData={rows}\n            loading={isLoading}\n            skeletonRowCount={skeletonRowCount}\n          />\n          {pageInfo && (\n            <div\n              className={classes([\n                'requisition-list-grid-wrapper__pagination',\n                className,\n              ])}\n            >\n              <PaginationItemsCounter\n                pageInfo={pageInfo}\n                totalCount={totalCount}\n              />\n              {(pageInfo.total_pages || 0) > 1 && (\n                <Pagination\n                  totalPages={pageInfo.total_pages}\n                  currentPage={pageInfo.current_page || 1}\n                  onChange={handlePageChange}\n                  disabled={isLoading}\n                />\n              )}\n              <div className=\"requisition-list-grid-wrapper__pagination-picker\">\n                <span>{translations.show}</span>\n                <PageSizePicker\n                  currentPageSize={pageInfo.page_size || defaultPageSize}\n                  onPageSizeChange={\n                    handlePageSizeChange || (() => Promise.resolve())\n                  }\n                  disabled={isLoading}\n                />\n              </div>\n            </div>\n          )}\n        </>\n      )}\n\n      {/* Requisition Lists Form */}\n      <div\n        className={classes([\n          'requisition-list-grid-wrapper__add-new',\n          className,\n        ])}\n      >\n        {isAdding ? (\n          <Card variant=\"secondary\">\n            <RequisitionListForm\n              mode=\"create\"\n              onSuccess={async () => {\n                await handlePageChange();\n                handleCancelCreate();\n                handleRequisitionListAlert({\n                  type: 'success',\n                  action: 'create',\n                  context: 'requisitionList',\n                });\n              }}\n              onError={() => {\n                handleRequisitionListAlert({\n                  type: 'error',\n                  action: 'create',\n                  context: 'requisitionList',\n                });\n              }}\n              onCancel={handleCancelCreate}\n            />\n          </Card>\n        ) : (\n          <RequisitionListActions onAddNew={handleAddNew} />\n        )}\n      </div>\n    </div>\n  );\n};\n"],"names":["useRequisitionListGrid","callbacks","routeRequisitionListDetails","closeModal","translations","useText","reqLists","setReqLists","useState","isAdding","setIsAdding","isFetching","setIsFetching","handleAddNew","useCallback","handleCancelCreate","wrappedCallbacks","useMemo","rl","current","fetchPage","page","pageSize","data","getRequisitionLists","currentPage","_a","totalPages","_b","_c","prev","prevData","useEffect","requisitionListsEvent","events","DEFAULT_PAGE_SIZE","handlePageChange","currentPageSize","handlePageSizeChange","jsxs","jsx","e","result","Button","RequisitionListGrid","fallbackRoute","slots","isEnabled","useRequisitionListEnabled","modal","setModal","handleOpenRenameModal","handleOpenDeleteModal","rows","isLoading","pageInfo","totalCount","handleRenameSubmit","values","updateRequisitionList","handleDeleteConfirm","deleteRequisitionList","getHeader","Slot","Header","NotFound","Fragment","RequisitionListGridWrapper","RequisitionListModal","RequisitionListForm","className","header","skeletonRowCount","defaultPageSize","props","hasAnyItems","showEmptyList","alert","setAlert","handleRequisitionListAlert","useRequisitionListAlert","alertEvent","pendingAlert","alertPayload","classes","VComponent","InLineAlert","EmptyList","Table","PaginationItemsCounter","Pagination","PageSizePicker","Card","RequisitionListActions"],"mappings":"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"}