{"version":3,"file":"customerCompanyContext.js","sources":["/@dropins/storefront-company-switcher/src/api/setCompanyHeaders/setCompanyHeaders.ts","/@dropins/storefront-company-switcher/src/api/setGroupHeaders/setGroupHeaders.ts","/@dropins/storefront-company-switcher/src/api/initialize/initialize.ts","/@dropins/storefront-company-switcher/src/api/fetch-graphql/fetch-graphql.ts","/@dropins/storefront-company-switcher/src/api/customerCompanyContext/graphql/customerCompanyContext.graphql.ts","/@dropins/storefront-company-switcher/src/api/customerCompanyContext/graphql/customerGroupContext.graphql.ts","/@dropins/storefront-company-switcher/src/api/customerCompanyContext/customerCompanyContext.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport type { FetchGraphQL, setFetchGraphQlHeader, removeFetchGraphQlHeader } from '@adobe-commerce/fetch-graphql';\nimport { config } from '@/company-switcher/api';\n\n/**\n * Manages company-specific headers for GraphQL requests.\n * Singleton class that handles setting and removing company headers across multiple GraphQL modules.\n */\nclass CompanyHeaderManager {\n  private companyHeaderSet: boolean = false;\n  private companyHeaderAppliers: typeof setFetchGraphQlHeader[] = [];\n  private companyHeaderRemovers: typeof removeFetchGraphQlHeader[] = [];\n  private headerKey: string;\n\n  constructor() {\n    this.headerKey = config.getConfig().companyHeader;\n    this.setFetchGraphQlModules(config.getConfig().fetchGraphQlModules);\n  }\n\n  /**\n   * Sets the header key used for company identification\n   * @param headerKey - The header name to use for company ID\n   */\n  public setHeaderKey(headerKey: string): void {\n    this.headerKey = headerKey;\n  }\n\n  /**\n   * Configures GraphQL modules that will have company headers applied\n   * @param modules - Array of GraphQL modules with header management functions\n   */\n  public setFetchGraphQlModules(modules: FetchGraphQL[]): void {\n    this.companyHeaderAppliers = [];\n    this.companyHeaderRemovers = [];\n    modules.forEach((module: FetchGraphQL) => {\n      this.companyHeaderAppliers.push((key: string, value: string) => \n        module.setFetchGraphQlHeader(key, value)\n      );\n      this.companyHeaderRemovers.push((key: string) => \n        module.removeFetchGraphQlHeader(key)\n      );\n    });\n  }\n\n  /**\n   * Sets company headers for all configured GraphQL modules\n   * @param companyId - The company ID to set in headers, or null to remove headers\n   */\n  public setCompanyHeaders(companyId: string | null): void {\n    if (companyId === null) {\n      this.removeCompanyHeaders();\n      return;\n    }\n    this.companyHeaderAppliers.forEach((setFn) => {\n      setFn(this.headerKey, companyId);\n    });\n    this.companyHeaderSet = true;\n  }\n\n  /**\n   * Removes company headers from all configured GraphQL modules\n   */\n  public removeCompanyHeaders(): void {\n    this.companyHeaderRemovers.forEach((removeFn) => {\n      removeFn(this.headerKey);\n    });\n    this.companyHeaderSet = false;\n  }\n\n  /**\n   * Checks if company headers are currently set\n   * @returns true if company headers are set, false otherwise\n   */\n  public isCompanyHeaderSet(): boolean {\n    return this.companyHeaderSet;\n  }\n}\n\nlet _companyHeaderManager: CompanyHeaderManager | null = null;\n\n/**\n * Gets the singleton instance of CompanyHeaderManager\n * @returns The CompanyHeaderManager instance\n */\nexport const getCompanyHeaderManager = () => {\n  if (!_companyHeaderManager) {\n    _companyHeaderManager = new CompanyHeaderManager();\n  }\n  return _companyHeaderManager;\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\nimport type { FetchGraphQL, setFetchGraphQlHeader } from '@adobe-commerce/fetch-graphql';\nimport { config } from '@/company-switcher/api';\n\n/**\n * Manages customer group headers for GraphQL requests.\n * Singleton class that handles setting and removing group headers across multiple GraphQL modules.\n */\nclass GroupHeaderManager {\n  private groupHeaderSet: boolean = false;\n  private groupHeaderAppliers: typeof setFetchGraphQlHeader[] = [];\n  private groupHeaderRemovers: ((key: string) => void)[] = [];\n  private headerKey: string;\n  private defaultNLICustomerGroupId = 'b6589fc6ab0dc82cf12099d1c2d40ab994e8410c';\n\n\n  constructor() {\n    this.headerKey = config.getConfig().customerGroupHeader;\n    this.setFetchGraphQlModules(config.getConfig().groupGraphQlModules);\n  }\n\n  /**\n   * Sets the header key used for customer group identification\n   * @param headerKey - The header name to use for group ID\n   */\n  public setHeaderKey(headerKey: string): void {\n    this.headerKey = headerKey;\n  }\n\n  /**\n   * Configures GraphQL modules that will have group headers applied\n   * @param modules - Array of GraphQL modules with header management functions\n   */\n  public setFetchGraphQlModules(modules: FetchGraphQL[]): void {\n    modules.forEach((module: FetchGraphQL) => {\n      this.groupHeaderAppliers.push((key: string, value: string) => \n        module.setFetchGraphQlHeader(key, value)\n      );\n      this.groupHeaderRemovers.push((key: string) => \n        module.setFetchGraphQlHeader(key, this.defaultNLICustomerGroupId)\n      );\n    });\n  }\n\n  /**\n   * Sets customer group headers for all configured GraphQL modules.\n   * Always removes existing headers first before setting new ones.\n   * @param groupId - The group ID to set in headers, or null to only remove headers\n   */\n  public setGroupHeaders(groupId: string | null): void {\n    this.removeGroupHeaders();\n    if (groupId === null) {\n      return;\n    }\n    this.groupHeaderAppliers.forEach((setFn) => {\n      setFn(this.headerKey, groupId);\n    });\n    this.groupHeaderSet = true;\n  }\n\n  /**\n   * Removes customer group headers from all configured GraphQL modules\n   */\n  public removeGroupHeaders(): void {\n    this.groupHeaderRemovers.forEach((removeFn) => {\n      removeFn(this.headerKey);\n    });\n    this.groupHeaderSet = false;\n  }\n\n  /**\n   * Checks if customer group headers are currently set\n   * @returns true if group headers are set, false otherwise\n   */\n  public isGroupHeaderSet(): boolean {\n    return this.groupHeaderSet;\n  }\n}\n\nlet _groupHeaderManager: GroupHeaderManager | null = null;\n\n/**\n * Gets the singleton instance of GroupHeaderManager\n * @returns The GroupHeaderManager instance\n */\nexport const getGroupHeaderManager = () => {\n  if (!_groupHeaderManager) {\n    _groupHeaderManager = new GroupHeaderManager();\n  }\n  return _groupHeaderManager;\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport type { FetchGraphQL } from '@adobe-commerce/fetch-graphql';\nimport { Initializer } from '@adobe-commerce/elsie/lib';\nimport { Lang } from '@adobe-commerce/elsie/i18n';\nimport { getCompanyHeaderManager } from '@/company-switcher/api/setCompanyHeaders/setCompanyHeaders';\nimport { getGroupHeaderManager } from '@/company-switcher/api/setGroupHeaders/setGroupHeaders';\nimport { getCustomerCompanyInfo } from '@/company-switcher/api/customerCompanyContext/customerCompanyContext';\nimport { events } from '@adobe-commerce/event-bus';\n\n/**\n * Configuration properties for the company switcher initialization\n */\ninterface ConfigProps {\n  /** Optional language definitions for internationalization */\n  langDefinitions?: Lang;\n  /** HTTP header name for company identification */\n  companyHeader: string;\n  /** HTTP header name for customer group identification */\n  customerGroupHeader: string;\n  /** Session storage key for persisting company context */\n  companySessionStorageKey: string;\n  /** Session storage key for persisting group context */\n  groupSessionStorageKey: string;\n  /** GraphQL modules that will have company headers applied */\n  fetchGraphQlModules: FetchGraphQL[];\n  /** GraphQL modules that will have group headers applied */\n  groupGraphQlModules: FetchGraphQL[];\n}\n\n/**\n * Initializer for the company switcher drop-in.\n * Configures headers, storage, and GraphQL modules for company management.\n */\nexport const initialize = new Initializer<ConfigProps>({\n  init: async (config) => {\n    const defaultConfig = {\n      fetchGraphQlModules: [],\n      groupGraphQlModules: [],\n      companyHeader: 'X-Adobe-Company',\n      customerGroupHeader: 'Magento-Customer-Group',\n      companySessionStorageKey: 'DROPIN__COMPANYSWITCHER__COMPANY__CONTEXT',\n      groupSessionStorageKey: 'DROPIN__COMPANYSWITCHER__GROUP__CONTEXT'\n    };\n    initialize.config.setConfig({ ...defaultConfig, ...config });\n\n    const groupId = sessionStorage.getItem(initialize.config.getConfig().groupSessionStorageKey);\n    const companyId = sessionStorage.getItem(initialize.config.getConfig().companySessionStorageKey);\n    if (companyId && !getCompanyHeaderManager().isCompanyHeaderSet()) {\n      getCompanyHeaderManager().setCompanyHeaders(companyId);\n      events.emit('companyContext/changed', companyId);\n    }\n    if (groupId && !getGroupHeaderManager().isGroupHeaderSet()) {\n      getGroupHeaderManager().setGroupHeaders(groupId);\n    }\n\n    events.on('authenticated', async (authenticated: boolean) => {\n      const config = initialize.config.getConfig();\n      if (!authenticated) {\n        sessionStorage.removeItem(config.companySessionStorageKey);\n        sessionStorage.removeItem(config.groupSessionStorageKey);\n        getCompanyHeaderManager().removeCompanyHeaders();\n        getGroupHeaderManager().removeGroupHeaders();\n        events.emit('companyContext/changed', null);\n      } else {\n        const storedCompanyId = sessionStorage.getItem(config.companySessionStorageKey);\n        if (storedCompanyId || getCompanyHeaderManager().isCompanyHeaderSet()) {\n          return;\n        }\n        const companyInfo = await getCustomerCompanyInfo();\n        if (companyInfo.customerCompanies.length < 2) {\n          return;\n        }\n\n        const currentCompanyId = companyInfo.currentCompany.id;\n        const groupId = companyInfo.customerGroupId;\n        getCompanyHeaderManager().setCompanyHeaders(currentCompanyId);\n        getGroupHeaderManager().setGroupHeaders(groupId);\n        sessionStorage.setItem(config.companySessionStorageKey, currentCompanyId);\n        sessionStorage.setItem(config.groupSessionStorageKey, groupId);\n        events.emit('companyContext/changed', currentCompanyId);\n      }\n    }, { eager: true });\n  },\n  listeners: () => []\n});\n\n/**\n * Configuration object for getting and setting company switcher configuration.\n * Provides methods to access and update the current configuration.\n */\nexport const config = initialize.config;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FetchGraphQL } from '@adobe-commerce/fetch-graphql';\n\n/**\n * GraphQL client methods for making API requests.\n * Provides methods to configure endpoints, headers, and execute GraphQL queries.\n */\nexport const {\n  /** Sets the GraphQL endpoint URL */\n  setEndpoint,\n  /** Sets a single GraphQL header */\n  setFetchGraphQlHeader,\n  /** Removes a GraphQL header */\n  removeFetchGraphQlHeader,\n  /** Sets multiple GraphQL headers at once */\n  setFetchGraphQlHeaders,\n  /** Executes a GraphQL query or mutation */\n  fetchGraphQl,\n  /** Gets the current configuration */\n  getConfig,\n} = new FetchGraphQL().getMethods();\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const GET_CUSTOMER_COMPANY_CONTEXT = `\n  query GET_CUSTOMER_COMPANIES {\n    customer {\n      companies {\n        items {\n          name\n          id\n          status\n        }\n      }\n    }\n    company {\n      name\n      id\n      status\n    }\n    customerGroup {\n      uid\n    }\n  }\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const GET_CUSTOMER_GROUP_CONTEXT = `\n  query GET_CUSTOMER_GROUP {\n    customerGroup {\n      uid\n    }\n  }\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { fetchGraphQl, getConfig } from \"@/company-switcher/api\";\nimport type { Company, CompanyOption, CustomerCompanyInfo, GraphQLResponse } from '@/company-switcher/types/company';\nimport { GET_CUSTOMER_COMPANY_CONTEXT } from './graphql/customerCompanyContext.graphql';\nimport { GET_CUSTOMER_GROUP_CONTEXT } from './graphql/customerGroupContext.graphql';\n\nexport class CustomerCompanyContext {\n  private static instance: CustomerCompanyContext;\n\n  // Constants\n  private readonly EMPTY_CUSTOMER_COMPANY_CONTEXT: CustomerCompanyInfo = {\n    currentCompany: { id: '', name: '' },\n    customerCompanies: [],\n    customerGroupId: '',\n  };\n\n  private cache: CustomerCompanyInfo | null = null;\n\n  /**\n   * Get singleton instance\n   */\n  static getInstance(): CustomerCompanyContext {\n    return CustomerCompanyContext.instance ??= new CustomerCompanyContext();\n  }\n\n  /**\n   * Transforms a company object into a company option for UI components\n   */\n  private transformCompanyToOption = (company: Company): CompanyOption => ({\n    text: company.name,\n    value: company.id\n  });\n\n  /**\n   * Decodes base64 string and returns SHA1 hash\n   */\n  private async processCustomerGroupId(base64String: string): Promise<string> {\n    const decoded = Uint8Array.from(atob(base64String), c => c.charCodeAt(0));\n    const hashBuffer = await crypto.subtle.digest('SHA-1', decoded);\n    return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');\n  }\n\n  /**\n   * Checks if the user is authenticated by verifying the Authorization header\n   */\n  private isUserAuthenticated(): boolean {\n    return Boolean(getConfig().fetchGraphQlHeaders?.Authorization);\n  }\n\n  resetCache(): void {\n    this.cache = null;\n  }\n\n  /**\n   * Fetches and updates only the customer group information in the cache\n   * \n   * @returns Promise containing the updated customer group ID\n   * @throws Will not throw errors - returns null on failure\n   */\n  async updateCustomerGroup(): Promise<string | null> {\n    if (!this.isUserAuthenticated()) {\n      return null;\n    }\n\n    try {\n      const response = await fetchGraphQl<{ customerGroup: { uid: string } }>(GET_CUSTOMER_GROUP_CONTEXT);\n      if (response.errors) {\n        return null;\n      }\n      const customerGroupId = await this.processCustomerGroupId(response.data.customerGroup.uid);\n      if (this.cache) {\n        this.cache.customerGroupId = customerGroupId;\n      }\n      return customerGroupId;\n    } catch (e) {\n      console.error(e)\n      return null;\n    }\n  }\n\n  /**\n   * Fetches customer company information including the current company and all available companies\n   * \n   * @returns Promise containing current company and list of available companies\n   * @throws Will not throw errors - returns empty data on failure\n   */\n  async getCustomerCompanyInfo(): Promise<CustomerCompanyInfo> {\n    // Return cached data if available\n    if (this.cache) {\n      return this.cache;\n    }\n    \n    // Return empty data if user is not authenticated\n    if (!this.isUserAuthenticated()) {\n      return this.EMPTY_CUSTOMER_COMPANY_CONTEXT;\n    }\n\n    try {\n      // Fetch company data from GraphQL API\n      const response = (await fetchGraphQl<GraphQLResponse>(GET_CUSTOMER_COMPANY_CONTEXT));\n      if (response.errors) {\n        return this.EMPTY_CUSTOMER_COMPANY_CONTEXT;\n      }\n\n      const data = response.data;\n      const customerGroup = await this.processCustomerGroupId(response.data.customerGroup.uid);\n      // Whitelist approach: only allow APPROVED and BLOCKED companies\n      // BLOCKED companies allow users to log in and view but not perform actions\n      const activeCompanies = data.customer.companies.items.filter(\n        company => company.status === 'APPROVED' || company.status === 'BLOCKED'\n      );\n      const customerCompanies = activeCompanies.map(this.transformCompanyToOption);\n\n      this.cache = {\n        currentCompany: data.company,\n        customerCompanies,\n        customerGroupId: customerGroup\n      }\n      return this.cache;\n    } catch (e) {\n      console.error(e);\n      return this.EMPTY_CUSTOMER_COMPANY_CONTEXT;\n    }\n  }\n}\n\nexport const getCustomerCompanyInfo = (): Promise<CustomerCompanyInfo> => {\n  return CustomerCompanyContext.getInstance().getCustomerCompanyInfo();\n};\n\nexport const updateCustomerGroup = (): Promise<string | null> => {\n  return CustomerCompanyContext.getInstance().updateCustomerGroup();\n};"],"names":["CompanyHeaderManager","__publicField","config","headerKey","modules","module","key","value","companyId","setFn","removeFn","_companyHeaderManager","getCompanyHeaderManager","GroupHeaderManager","groupId","_groupHeaderManager","getGroupHeaderManager","initialize","Initializer","defaultConfig","events","authenticated","companyInfo","getCustomerCompanyInfo","currentCompanyId","setEndpoint","setFetchGraphQlHeader","removeFetchGraphQlHeader","setFetchGraphQlHeaders","fetchGraphQl","getConfig","FetchGraphQL","GET_CUSTOMER_COMPANY_CONTEXT","GET_CUSTOMER_GROUP_CONTEXT","_CustomerCompanyContext","company","base64String","decoded","c","hashBuffer","b","_a","response","customerGroupId","data","customerGroup","customerCompanies","CustomerCompanyContext","updateCustomerGroup"],"mappings":"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"}