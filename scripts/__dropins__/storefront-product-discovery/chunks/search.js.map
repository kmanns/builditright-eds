{"version":3,"file":"search.js","sources":["/@dropins/storefront-product-discovery/src/api/fetch-graphql/fetch-graphql.ts","/@dropins/storefront-product-discovery/src/data/transforms/product.ts","/@dropins/storefront-product-discovery/src/data/transforms/api.ts","/@dropins/storefront-product-discovery/src/api/search/graphql/search.graphql.ts","/@dropins/storefront-product-discovery/src/api/search/search.ts"],"sourcesContent":["/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { FetchGraphQL } from '@adobe-commerce/fetch-graphql';\n\nexport const {\n  setEndpoint,\n  setFetchGraphQlHeader,\n  removeFetchGraphQlHeader,\n  setFetchGraphQlHeaders,\n  getFetchGraphQlHeader,\n  fetchGraphQl,\n  getConfig,\n} = new FetchGraphQL().getMethods();\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\nimport { merge } from '@adobe-commerce/elsie/lib';\nimport { config } from '@/plp/api/initialize/initialize';\nimport { Product } from '../models/product';\n\nconst getCurrency = (currency?: string) => {\n  if (!currency || !Intl.supportedValuesOf(\"currency\").includes(currency)) {\n    return 'USD';\n  }\n  return currency;\n};\n\nexport const transformProduct = (data: any): Product | null => {\n  // check if data is null or undefined, and if so return an empty object\n  if (!data) {\n    return {\n      id: '',\n      name: '',\n      sku: '',\n      shortDescription: '',\n      url: '',\n      urlKey: '',\n      metaTitle: '',\n      metaKeywords: '',\n      metaDescription: '',\n      lowStock: false,\n      links: [],\n      images: [],\n      description: '',\n      externalId: '',\n      inputOptions: [],\n      addToCartAllowed: false,\n      price: undefined,\n      priceRange: undefined,\n      inStock: false,\n      typename: '',\n    };\n  }\n\n  const transformedProduct = {\n    id: data?.id || '',\n    name: data?.name || '',\n    sku: data?.sku || '',\n    shortDescription: data?.shortDescription || '',\n    url: data?.url || '',\n    urlKey: data?.urlKey || '',\n    metaTitle: data?.metaTitle || '',\n    metaKeywords: data?.metaKeywords || '',\n    metaDescription: data?.metaDescription || '',\n    lowStock: data?.lowStock || false,\n    links: data?.links || [],\n    images:\n      data?.images?.map((image: any) => ({\n        label: image.label || '',\n        roles: image.roles || [],\n        url: image.url?.replace(/^https?:\\/\\//, '//') || '',\n      })) || [],\n    description: data?.description || '',\n    externalId: data?.externalId || '',\n    inputOptions: data?.inputOptions || [],\n    addToCartAllowed: data?.addToCartAllowed || false,\n    price: data.price\n      ? {\n          final: {\n            amount: {\n              value: data?.price?.final?.amount?.value || 0,\n              currency: getCurrency(data?.price?.final?.amount?.currency),\n            },\n          },\n          regular: {\n            amount: {\n              value: data?.price?.regular?.amount?.value || 0,\n              currency: getCurrency(data?.price?.regular?.amount?.currency),\n            },\n          },\n          roles: data?.price?.roles || [],\n        }\n      : undefined,\n    priceRange: data?.priceRange\n      ? {\n          minimum: {\n            final: {\n              amount: {\n                value: data?.priceRange?.minimum?.final?.amount?.value || 0,\n                currency: getCurrency(data?.priceRange?.minimum?.final?.amount?.currency),\n              },\n            },\n            regular: {\n              amount: {\n                value: data?.priceRange?.minimum?.regular?.amount?.value || 0,\n                currency: getCurrency(data?.priceRange?.minimum?.regular?.amount?.currency),\n              },\n            },\n          },\n          maximum: {\n            final: {\n              amount: {\n                value: data?.priceRange?.maximum?.final?.amount?.value || 0,\n                currency: getCurrency(data?.priceRange?.maximum?.final?.amount?.currency),\n              },\n            },\n            regular: {\n              amount: {\n                value: data?.priceRange?.maximum?.regular?.amount?.value || 0,\n                currency: getCurrency(data?.priceRange?.maximum?.regular?.amount?.currency),\n              },\n            },\n          },\n        }\n      : undefined,\n    inStock: data?.inStock || false,\n    typename: data?.__typename || '',\n  };\n\n  return merge(\n    transformedProduct, // default transformer\n    config.getConfig().models?.Product?.transformer?.(data), // custom transformer\n  )\n};\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\nimport { merge } from '@adobe-commerce/elsie/lib';\nimport { config } from '@/plp/api/initialize/initialize';\nimport { ProductSearchResult, SearchVariables } from '@/plp/data/models';\nimport { Product } from '@/plp/data/models/product';\n\nimport { transformProduct } from './product';\n\n\nexport function transformProductSearchResponse(data: any, searchVariables?: SearchVariables): ProductSearchResult {\n  const productSearch = data?.productSearch;\n\n  const transformedResponse: ProductSearchResult = {\n    facets: transformFacets(productSearch?.facets || [], searchVariables),\n    items: productSearch?.items.map((product: any) => transformProduct(product?.productView)) || [],\n    pageInfo: {\n      currentPage: productSearch?.page_info?.current_page || 1,\n      totalPages: productSearch?.page_info?.total_pages || 1,\n      totalItems: productSearch?.page_info?.total_items || 0,\n      pageSize: productSearch?.page_info?.page_size || 10, //replace with default constant\n    },\n    totalCount: productSearch?.total_count || 0,\n    metadata: {\n      filterableAttributes: data?.attributeMetadata?.filterableInSearch || [],\n      sortableAttributes: transformSortAttributes(data?.attributeMetadata?.sortable || [], searchVariables),\n    }\n  };\n  return merge(\n    transformedResponse, // default transformer\n    config.getConfig().models?.ProductSearchResult?.transformer?.(data), // custom transformer\n  );\n}\n\nexport const transformSearchResultProducts = (searchResponse: { productSearch: { items: any[] } }): Product[] =>\n  searchResponse?.productSearch?.items?.reduce<Product[]>((returnedProductList, productItem) => {\n    if (!productItem?.productView) return returnedProductList; // Skip if no productView and product is null\n\n    const transformed = transformProduct(productItem.productView);\n    if (transformed) {\n      returnedProductList.push(transformed);\n    }\n\n    return returnedProductList;\n  }, []) || [];\n\nfunction transformSortAttributes(sortableAttributes: any[] = [], searchVariables?: SearchVariables): any[] {\n  if (!sortableAttributes || sortableAttributes.length === 0) {\n    return [];\n  }\n\n  return sortableAttributes\n    .filter((option) => {\n      // Only include position attribute if there's a category filter\n      if (option.attribute === 'position') {\n        const hasCategoryFilter = searchVariables?.filter?.some(\n          (filter) => filter.attribute === 'categoryPath'\n        );\n        return hasCategoryFilter;\n      }\n\n      // Include all other attributes\n      return true;\n    })\n    .map((option) => ({\n      ...option,\n      bidirectional: option.attribute === 'price',\n    }));\n}\n\nfunction transformFacets(facets: any[] = [], searchVariables?: SearchVariables): any[] {\n  if (!facets || facets.length === 0) {\n    return [];\n  }\n\n  const hasCategoryPathFilter = searchVariables?.filter?.some(\n    (filter) => filter.attribute === 'categoryPath'\n  );\n\n  // if hasCategoryPathFilter, then we need to remove facets with attribute 'categories'\n  if (hasCategoryPathFilter) {\n    return facets.filter((facet) => facet.attribute !== 'categories');\n  }\n\n  return facets;\n}\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this\n * file in accordance with the terms of the Adobe license agreement\n * accompanying it.\n *******************************************************************/\n\nimport { Facet, ProductView } from '../../graphql/fragments.graphql';\n\nconst PRODUCT_SEARCH_QUERY = /* GraphQL */ `\n  query productSearch(\n    $phrase: String!\n    $pageSize: Int\n    $currentPage: Int = 1\n    $filter: [SearchClauseInput!]\n    $sort: [ProductSearchSortInput!]\n    $context: QueryContextInput\n  ) {\n    attributeMetadata {\n      sortable {\n        label\n        attribute\n        numeric\n      }\n      filterableInSearch {\n        label\n        attribute\n        numeric\n      }\n    }\n\n    productSearch(\n      phrase: $phrase\n      page_size: $pageSize\n      current_page: $currentPage\n      filter: $filter\n      sort: $sort\n      context: $context\n    ) {\n      total_count\n      items {\n        ...ProductView\n      }\n      facets {\n        ...Facet\n      }\n      page_info {\n        current_page\n        page_size\n        total_pages\n      }\n    }\n  }\n  ${ProductView}\n  ${Facet}\n`;\n\nexport { PRODUCT_SEARCH_QUERY };\n","/********************************************************************\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  Adobe permits you to use, modify, and distribute this \n * file in accordance with the terms of the Adobe license agreement \n * accompanying it. \n *******************************************************************/\n\nimport { ProductSearchResult, Scope, SearchVariables, SortOrder, SearchFilter } from '@/plp/data/models';\nimport { fetchGraphQl } from '@/plp/api';\nimport { transformProductSearchResponse } from '@/plp/data/transforms';\nimport { events } from '@adobe-commerce/event-bus';\nimport { PRODUCT_SEARCH_QUERY } from './graphql/search.graphql';\nimport { \n  searchRequestSent, \n  searchResponseReceived, \n  updateSearchInputCtx,\n  updateSearchResultsCtx,\n  SEARCH_UNIT_ID, \n  PLP_UNIT_ID,\n} from '@/plp/utils/acdlEvents';\n\ntype SearchOptions = {\n  scope?: Scope;\n}\n\nexport const search = async (request: SearchVariables | null, options: SearchOptions = {}): Promise<ProductSearchResult> => {\n  const scope = options.scope === 'search' ? undefined : options.scope;\n\n  // empty result\n  const emptyResult = {\n    request: request || {} ,\n    result: {\n      facets: [],\n      pageInfo: { currentPage: 0, totalPages: 0, totalItems: 0, pageSize: 0 },\n      items: [],\n      totalCount: 0,\n      suggestions: [],\n      metadata: {\n        filterableAttributes: [],\n        sortableAttributes: []\n      }\n    }\n  };\n\n  // clear search results if no request are provided\n  if (request === null) {\n    events.emit('search/result', emptyResult, { scope });\n    return emptyResult.result;\n  }\n\n\n  // Emit loading state\n  events.emit('search/loading', true, { scope });\n\n  try {\n    const acdlUnitId = scope === 'popover' ? SEARCH_UNIT_ID : PLP_UNIT_ID;\n    const searchRequestId = window.crypto.randomUUID();\n    const params = new URLSearchParams(window.location.search);\n    \n    const currentPage = Number(params.get('page')) || 1;\n    const qParam = params.get('q');\n    // if we are passed a phrase, use it, otherwise use the q param\n    const phrase = request?.phrase || (qParam !== null && qParam.trim().length > 0 && qParam) || '';\n    \n    const sortParam = scope !== 'undefined' ? null : params.get('sort');\n    const sort: SortOrder[] = sortParam && sortParam.trim().length > 0\n      ? sortParam.split(',').map(token => {\n        token = token.trim();\n        if (!token) return null;\n\n        let attribute = '';\n        let direction: 'ASC' | 'DESC' = 'ASC';\n\n        if (token.includes(':')) {\n          [attribute, direction] = token.split(':') as [string, 'ASC' | 'DESC'];\n        } \n        else if (token.includes('_')) {\n          const lastUnderscore = token.lastIndexOf('_');\n          attribute = token.slice(0, lastUnderscore);               \n          direction = token.slice(lastUnderscore + 1).toUpperCase() === 'DESC' ? 'DESC' : 'ASC';\n        } \n        else {\n          attribute = token;\n        }\n        \n        if (attribute === 'position') {\n          return null;\n        }\n        \n        return { attribute, direction };\n      }).filter(Boolean) as SortOrder[]\n    : [];\n      \n    // if we are passed a scope, don't use the filter param\n    const filterParam = scope !== 'undefined' ? null : params.get('filter');\n    const filter: SearchFilter[] | undefined =\n    filterParam && filterParam.trim()\n      ? (() => {\n  \n          const decoded = decodeURIComponent(\n            filterParam.replace(/\\+/g, '%20')\n          );\n          \n          return decoded.split(/\\||;/).reduce<SearchFilter[]>((acc, part) => {\n            const trimmed = part.trim();\n            if (!trimmed.includes(':')) return acc;\n            const [attribute, ...rest] = trimmed.split(':');\n            const rawValue = rest.join(':').trim();\n            if (!attribute || !rawValue) return acc;\n            if (attribute === 'price' && rawValue.includes('-')) {\n              const [fromRaw, toRaw] = rawValue.split('-');\n            \n              const from = Number(fromRaw);\n              const to = Number(toRaw);\n            \n              if (!Number.isNaN(from) && !Number.isNaN(to)) {\n                acc.push({\n                  attribute: 'price',\n                  range: {\n                    from,\n                    to,\n                  },\n                });\n              }\n            \n              return acc;\n            }\n            \n            if (attribute === 'visibility') {\n              const firstCommaIndex = rawValue.indexOf(',');\n              acc.push({\n                attribute,\n                in:\n                  firstCommaIndex === -1\n                    ? [rawValue.trim()]\n                    : [\n                      `Catalog, Search`\n                      ],\n              });\n              return acc;\n            }\n           \n            acc.push({\n              attribute,\n              in: rawValue\n                .split(/[|,]/)\n                .map(v => v.trim())\n                .filter(Boolean),\n            });\n            \n            return acc;\n          }, []);\n        })()\n      : request?.filter;\n\n    const finalFilters: SearchFilter[] = filter ? [...filter] : [];\n\n    const pathname = window.location.pathname.replace(/^\\/|\\/$/g, '');\n    // if we are passed a scope or on the search page, don't add the categoryPath filter\n    const categoryFromPath =\n      !scope && pathname && !pathname.startsWith('search')\n        ? pathname.split('/').pop()\n        : null;\n\n    // cagetoryFromPath overrides any other categoryPath filters\n    if (categoryFromPath) {\n      let existingCategoryPathFilter = finalFilters.find(f => f.attribute === 'categoryPath');\n      const newCategoryPathFilter = {\n        attribute: 'categoryPath',\n        in: [categoryFromPath],\n      };\n\n      if (existingCategoryPathFilter) {\n        existingCategoryPathFilter = newCategoryPathFilter;\n      } else {\n        finalFilters.unshift(newCategoryPathFilter);\n      }\n    }\n\n    const phraseSearch = phrase || request.phrase;\n    const sortSearch = sort?.length ? sort : request.sort;\n    const filterSearch = filterParam !== null || categoryFromPath ? finalFilters : request.filter;\n\n    request = {\n      ...request,\n      phrase: phraseSearch,\n      sort: sortSearch,\n      filter: filterSearch,\n      currentPage,\n    };\n\n    updateSearchInputCtx(\n      acdlUnitId,\n      searchRequestId,\n      request.phrase || '',\n      request.filter || [],\n      request.pageSize || 0,\n      request.currentPage || 0,\n      request.sort || [],\n    );\n\n    // Publish search request event to ACDL\n    searchRequestSent(acdlUnitId);\n\n    // Execute search with validated request\n    const { errors, data } = await fetchGraphQl(PRODUCT_SEARCH_QUERY, {\n      method: 'GET',\n      variables: { ...request },\n    });\n\n    if (errors && !data) {\n      throw new Error('Error fetching product search');\n    }\n\n    const result = transformProductSearchResponse(data, request);\n\n    // Update search results context in ACDL\n    updateSearchResultsCtx(acdlUnitId, searchRequestId, result);\n\n    // Publish search response event to ACDL\n    searchResponseReceived(acdlUnitId)\n\n    // Emit single event with result and metadata\n    events.emit('search/result', { request, result }, { scope });\n\n    return result;\n\n  } catch (error) {\n    // Emit error event\n    events.emit('search/error', (error as Error).message, { scope });\n\n    // Emit result event with empty result\n    events.emit('search/result', emptyResult, { scope });\n\n    throw error;\n  } finally {\n    // Reset loading state\n    events.emit('search/loading', false, { scope });\n  }\n};"],"names":["setEndpoint","setFetchGraphQlHeader","removeFetchGraphQlHeader","setFetchGraphQlHeaders","getFetchGraphQlHeader","fetchGraphQl","getConfig","FetchGraphQL","getCurrency","currency","transformProduct","data","transformedProduct","_a","image","_d","_c","_b","_g","_f","_e","_j","_i","_h","_m","_l","_k","_n","_r","_q","_p","_o","_v","_u","_t","_s","_z","_y","_x","_w","_D","_C","_B","_A","_H","_G","_F","_E","_L","_K","_J","_I","_P","_O","_N","_M","_T","_S","_R","_Q","merge","_W","_V","_U","config","transformProductSearchResponse","searchVariables","productSearch","transformedResponse","transformFacets","product","transformSortAttributes","sortableAttributes","option","filter","facets","facet","PRODUCT_SEARCH_QUERY","ProductView","Facet","search","request","options","scope","emptyResult","events","acdlUnitId","SEARCH_UNIT_ID","PLP_UNIT_ID","searchRequestId","params","currentPage","qParam","phrase","sortParam","sort","token","attribute","direction","lastUnderscore","filterParam","acc","part","trimmed","rest","rawValue","fromRaw","toRaw","from","to","firstCommaIndex","v","finalFilters","pathname","categoryFromPath","existingCategoryPathFilter","f","newCategoryPathFilter","phraseSearch","sortSearch","filterSearch","updateSearchInputCtx","searchRequestSent","errors","result","updateSearchResultsCtx","searchResponseReceived","error"],"mappings":"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"}